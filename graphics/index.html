
<!doctype html>
<html lang="en" class="no-js">
  <head>
    
      <meta charset="utf-8">
      <meta name="viewport" content="width=device-width,initial-scale=1">
      
      
      
      
        <link rel="prev" href="../memory/">
      
      
        <link rel="next" href="../rendering/">
      
      
      <link rel="icon" href="../assets/images/favicon.png">
      <meta name="generator" content="mkdocs-1.6.0, mkdocs-material-9.5.28">
    
    
      
        <title>Graphics Programming - Game Development</title>
      
    
    
      <link rel="stylesheet" href="../assets/stylesheets/main.6543a935.min.css">
      
        
        <link rel="stylesheet" href="../assets/stylesheets/palette.06af60db.min.css">
      
      


    
    
      
    
    
      
        
        
        <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
        <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Roboto:300,300i,400,400i,700,700i%7CRoboto+Mono:400,400i,700,700i&display=fallback">
        <style>:root{--md-text-font:"Roboto";--md-code-font:"Roboto Mono"}</style>
      
    
    
    <script>__md_scope=new URL("..",location),__md_hash=e=>[...e].reduce((e,_)=>(e<<5)-e+_.charCodeAt(0),0),__md_get=(e,_=localStorage,t=__md_scope)=>JSON.parse(_.getItem(t.pathname+"."+e)),__md_set=(e,_,t=localStorage,a=__md_scope)=>{try{t.setItem(a.pathname+"."+e,JSON.stringify(_))}catch(e){}}</script>
    
      

    
    
    
  </head>
  
  
    
    
      
    
    
    
    
    <body dir="ltr" data-md-color-scheme="default" data-md-color-primary="indigo" data-md-color-accent="indigo">
  
    
    <input class="md-toggle" data-md-toggle="drawer" type="checkbox" id="__drawer" autocomplete="off">
    <input class="md-toggle" data-md-toggle="search" type="checkbox" id="__search" autocomplete="off">
    <label class="md-overlay" for="__drawer"></label>
    <div data-md-component="skip">
      
        
        <a href="#graphics-in-game-development" class="md-skip">
          Skip to content
        </a>
      
    </div>
    <div data-md-component="announce">
      
    </div>
    
    
      

<header class="md-header" data-md-component="header">
  <nav class="md-header__inner md-grid" aria-label="Header">
    <a href=".." title="Game Development" class="md-header__button md-logo" aria-label="Game Development" data-md-component="logo">
      
  
  <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M12 8a3 3 0 0 0 3-3 3 3 0 0 0-3-3 3 3 0 0 0-3 3 3 3 0 0 0 3 3m0 3.54C9.64 9.35 6.5 8 3 8v11c3.5 0 6.64 1.35 9 3.54 2.36-2.19 5.5-3.54 9-3.54V8c-3.5 0-6.64 1.35-9 3.54Z"/></svg>

    </a>
    <label class="md-header__button md-icon" for="__drawer">
      
      <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M3 6h18v2H3V6m0 5h18v2H3v-2m0 5h18v2H3v-2Z"/></svg>
    </label>
    <div class="md-header__title" data-md-component="header-title">
      <div class="md-header__ellipsis">
        <div class="md-header__topic">
          <span class="md-ellipsis">
            Game Development
          </span>
        </div>
        <div class="md-header__topic" data-md-component="header-topic">
          <span class="md-ellipsis">
            
              Graphics Programming
            
          </span>
        </div>
      </div>
    </div>
    
      
        <form class="md-header__option" data-md-component="palette">
  
    
    
    
    <input class="md-option" data-md-color-media="" data-md-color-scheme="default" data-md-color-primary="indigo" data-md-color-accent="indigo"  aria-label="Switch to dark mode"  type="radio" name="__palette" id="__palette_0">
    
      <label class="md-header__button md-icon" title="Switch to dark mode" for="__palette_1" hidden>
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M17 6H7c-3.31 0-6 2.69-6 6s2.69 6 6 6h10c3.31 0 6-2.69 6-6s-2.69-6-6-6zm0 10H7c-2.21 0-4-1.79-4-4s1.79-4 4-4h10c2.21 0 4 1.79 4 4s-1.79 4-4 4zM7 9c-1.66 0-3 1.34-3 3s1.34 3 3 3 3-1.34 3-3-1.34-3-3-3z"/></svg>
      </label>
    
  
    
    
    
    <input class="md-option" data-md-color-media="" data-md-color-scheme="slate" data-md-color-primary="indigo" data-md-color-accent="indigo"  aria-label="Switch to light mode"  type="radio" name="__palette" id="__palette_1">
    
      <label class="md-header__button md-icon" title="Switch to light mode" for="__palette_0" hidden>
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M17 7H7a5 5 0 0 0-5 5 5 5 0 0 0 5 5h10a5 5 0 0 0 5-5 5 5 0 0 0-5-5m0 8a3 3 0 0 1-3-3 3 3 0 0 1 3-3 3 3 0 0 1 3 3 3 3 0 0 1-3 3Z"/></svg>
      </label>
    
  
</form>
      
    
    
      <script>var media,input,key,value,palette=__md_get("__palette");if(palette&&palette.color){"(prefers-color-scheme)"===palette.color.media&&(media=matchMedia("(prefers-color-scheme: light)"),input=document.querySelector(media.matches?"[data-md-color-media='(prefers-color-scheme: light)']":"[data-md-color-media='(prefers-color-scheme: dark)']"),palette.color.media=input.getAttribute("data-md-color-media"),palette.color.scheme=input.getAttribute("data-md-color-scheme"),palette.color.primary=input.getAttribute("data-md-color-primary"),palette.color.accent=input.getAttribute("data-md-color-accent"));for([key,value]of Object.entries(palette.color))document.body.setAttribute("data-md-color-"+key,value)}</script>
    
    
    
      <label class="md-header__button md-icon" for="__search">
        
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.516 6.516 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5Z"/></svg>
      </label>
      <div class="md-search" data-md-component="search" role="dialog">
  <label class="md-search__overlay" for="__search"></label>
  <div class="md-search__inner" role="search">
    <form class="md-search__form" name="search">
      <input type="text" class="md-search__input" name="query" aria-label="Search" placeholder="Search" autocapitalize="off" autocorrect="off" autocomplete="off" spellcheck="false" data-md-component="search-query" required>
      <label class="md-search__icon md-icon" for="__search">
        
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.516 6.516 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5Z"/></svg>
        
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11h12Z"/></svg>
      </label>
      <nav class="md-search__options" aria-label="Search">
        
        <button type="reset" class="md-search__icon md-icon" title="Clear" aria-label="Clear" tabindex="-1">
          
          <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M19 6.41 17.59 5 12 10.59 6.41 5 5 6.41 10.59 12 5 17.59 6.41 19 12 13.41 17.59 19 19 17.59 13.41 12 19 6.41Z"/></svg>
        </button>
      </nav>
      
        <div class="md-search__suggest" data-md-component="search-suggest"></div>
      
    </form>
    <div class="md-search__output">
      <div class="md-search__scrollwrap" tabindex="0" data-md-scrollfix>
        <div class="md-search-result" data-md-component="search-result">
          <div class="md-search-result__meta">
            Initializing search
          </div>
          <ol class="md-search-result__list" role="presentation"></ol>
        </div>
      </div>
    </div>
  </div>
</div>
    
    
  </nav>
  
</header>
    
    <div class="md-container" data-md-component="container">
      
      
        
          
            
<nav class="md-tabs" aria-label="Tabs" data-md-component="tabs">
  <div class="md-grid">
    <ul class="md-tabs__list">
      
        
  
  
  
    <li class="md-tabs__item">
      <a href=".." class="md-tabs__link">
        
  
    
  
  Home

      </a>
    </li>
  

      
        
  
  
  
    <li class="md-tabs__item">
      <a href="../cpp/" class="md-tabs__link">
        
  
    
  
  C++

      </a>
    </li>
  

      
        
  
  
  
    
    
      <li class="md-tabs__item">
        <a href="../dsa/" class="md-tabs__link">
          
  
  Core Concepts

        </a>
      </li>
    
  

      
        
  
  
    
  
  
    
    
      <li class="md-tabs__item md-tabs__item--active">
        <a href="./" class="md-tabs__link">
          
  
  Graphics

        </a>
      </li>
    
  

      
        
  
  
  
    <li class="md-tabs__item">
      <a href="../patterns/" class="md-tabs__link">
        
  
    
  
  Programming Patterns

      </a>
    </li>
  

      
        
  
  
  
    
    
      <li class="md-tabs__item">
        <a href="../ai/" class="md-tabs__link">
          
  
  AI

        </a>
      </li>
    
  

      
        
  
  
  
    <li class="md-tabs__item">
      <a href="../engine/" class="md-tabs__link">
        
  
    
  
  Game Engine Architecture

      </a>
    </li>
  

      
        
  
  
  
    <li class="md-tabs__item">
      <a href="../algorithms/" class="md-tabs__link">
        
  
    
  
  Algorithms

      </a>
    </li>
  

      
        
  
  
  
    <li class="md-tabs__item">
      <a href="../intersections/" class="md-tabs__link">
        
  
    
  
  Intersections

      </a>
    </li>
  

      
        
  
  
  
    <li class="md-tabs__item">
      <a href="../graph/" class="md-tabs__link">
        
  
    
  
  Graph

      </a>
    </li>
  

      
        
  
  
  
    <li class="md-tabs__item">
      <a href="../gameplay/" class="md-tabs__link">
        
  
    
  
  Gameplay

      </a>
    </li>
  

      
        
  
  
  
    <li class="md-tabs__item">
      <a href="../maths/" class="md-tabs__link">
        
  
    
  
  Maths

      </a>
    </li>
  

      
    </ul>
  </div>
</nav>
          
        
      
      <main class="md-main" data-md-component="main">
        <div class="md-main__inner md-grid">
          
            
              
              <div class="md-sidebar md-sidebar--primary" data-md-component="sidebar" data-md-type="navigation" >
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    


  


  

<nav class="md-nav md-nav--primary md-nav--lifted md-nav--integrated" aria-label="Navigation" data-md-level="0">
  <label class="md-nav__title" for="__drawer">
    <a href=".." title="Game Development" class="md-nav__button md-logo" aria-label="Game Development" data-md-component="logo">
      
  
  <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M12 8a3 3 0 0 0 3-3 3 3 0 0 0-3-3 3 3 0 0 0-3 3 3 3 0 0 0 3 3m0 3.54C9.64 9.35 6.5 8 3 8v11c3.5 0 6.64 1.35 9 3.54 2.36-2.19 5.5-3.54 9-3.54V8c-3.5 0-6.64 1.35-9 3.54Z"/></svg>

    </a>
    Game Development
  </label>
  
  <ul class="md-nav__list" data-md-scrollfix>
    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href=".." class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Home
  </span>
  

      </a>
    </li>
  

    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="../cpp/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    C++
  </span>
  

      </a>
    </li>
  

    
      
      
  
  
  
  
    
    
    
      
      
        
      
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_3" >
        
          
          <label class="md-nav__link" for="__nav_3" id="__nav_3_label" tabindex="0">
            
  
  <span class="md-ellipsis">
    Core Concepts
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_3_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_3">
            <span class="md-nav__icon md-icon"></span>
            Core Concepts
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../dsa/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Data Structures and Algorithms
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../memory/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Memory Management
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

    
      
      
  
  
    
  
  
  
    
    
    
      
        
        
      
      
        
      
    
    
    <li class="md-nav__item md-nav__item--active md-nav__item--section md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_4" checked>
        
          
          <label class="md-nav__link" for="__nav_4" id="__nav_4_label" tabindex="">
            
  
  <span class="md-ellipsis">
    Graphics
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_4_label" aria-expanded="true">
          <label class="md-nav__title" for="__nav_4">
            <span class="md-nav__icon md-icon"></span>
            Graphics
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
    
  
  
  
    <li class="md-nav__item md-nav__item--active">
      
      <input class="md-nav__toggle md-toggle" type="checkbox" id="__toc">
      
      
        
      
      
        <label class="md-nav__link md-nav__link--active" for="__toc">
          
  
  <span class="md-ellipsis">
    Graphics Programming
  </span>
  

          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <a href="./" class="md-nav__link md-nav__link--active">
        
  
  <span class="md-ellipsis">
    Graphics Programming
  </span>
  

      </a>
      
        

<nav class="md-nav md-nav--secondary" aria-label="Table of contents">
  
  
  
    
  
  
    <label class="md-nav__title" for="__toc">
      <span class="md-nav__icon md-icon"></span>
      Table of contents
    </label>
    <ul class="md-nav__list" data-md-component="toc" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#table-of-contents" class="md-nav__link">
    <span class="md-ellipsis">
      Table of Contents
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#introduction-to-computer-graphics" class="md-nav__link">
    <span class="md-ellipsis">
      Introduction to Computer Graphics
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#2d-graphics" class="md-nav__link">
    <span class="md-ellipsis">
      2D Graphics
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#3d-graphics" class="md-nav__link">
    <span class="md-ellipsis">
      3D Graphics
    </span>
  </a>
  
    <nav class="md-nav" aria-label="3D Graphics">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#3d-modeling-and-mesh-creation" class="md-nav__link">
    <span class="md-ellipsis">
      3D Modeling and Mesh Creation
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#introduction-to-3d-modeling" class="md-nav__link">
    <span class="md-ellipsis">
      Introduction to 3D Modeling
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Introduction to 3D Modeling">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#definition-and-importance-of-3d-modeling-in-games-and-other-applications" class="md-nav__link">
    <span class="md-ellipsis">
      Definition and Importance of 3D Modeling in Games and Other Applications
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#overview-of-the-3d-modeling-workflow" class="md-nav__link">
    <span class="md-ellipsis">
      Overview of the 3D Modeling Workflow
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#understanding-the-building-blocks-of-3d-models" class="md-nav__link">
    <span class="md-ellipsis">
      Understanding the Building Blocks of 3D Models
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Understanding the Building Blocks of 3D Models">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#definition-of-vertices-edges-and-faces" class="md-nav__link">
    <span class="md-ellipsis">
      Definition of Vertices, Edges, and Faces
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#how-these-elements-come-together-to-form-a-3d-mesh" class="md-nav__link">
    <span class="md-ellipsis">
      How These Elements Come Together to Form a 3D Mesh
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#introduction-to-polygons" class="md-nav__link">
    <span class="md-ellipsis">
      Introduction to Polygons
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Introduction to Polygons">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#definition-and-types-of-polygons" class="md-nav__link">
    <span class="md-ellipsis">
      Definition and Types of Polygons
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#importance-of-polygon-structure-in-3d-modeling" class="md-nav__link">
    <span class="md-ellipsis">
      Importance of Polygon Structure in 3D Modeling
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#use-of-index-winding-order-and-back-face-culling" class="md-nav__link">
    <span class="md-ellipsis">
      Use of Index, Winding Order, and Back Face Culling
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Use of Index, Winding Order, and Back Face Culling">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#use-of-index" class="md-nav__link">
    <span class="md-ellipsis">
      Use of Index
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#winding-order" class="md-nav__link">
    <span class="md-ellipsis">
      Winding Order
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#back-face-culling" class="md-nav__link">
    <span class="md-ellipsis">
      Back Face Culling
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#graphics-pipeline" class="md-nav__link">
    <span class="md-ellipsis">
      Graphics Pipeline
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Graphics Pipeline">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#overview-of-the-pipeline-stages" class="md-nav__link">
    <span class="md-ellipsis">
      Overview of the Pipeline Stages
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#detailed-breakdown" class="md-nav__link">
    <span class="md-ellipsis">
      Detailed Breakdown
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Detailed Breakdown">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#1-application-stage" class="md-nav__link">
    <span class="md-ellipsis">
      1. Application Stage
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#2-geometry-processing" class="md-nav__link">
    <span class="md-ellipsis">
      2. Geometry Processing
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#3-rasterization" class="md-nav__link">
    <span class="md-ellipsis">
      3. Rasterization
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#4-pixel-processing" class="md-nav__link">
    <span class="md-ellipsis">
      4. Pixel Processing
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#5-output-merger" class="md-nav__link">
    <span class="md-ellipsis">
      5. Output Merger
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#pipeline-optimizations-for-game-development" class="md-nav__link">
    <span class="md-ellipsis">
      Pipeline Optimizations for Game Development
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Pipeline Optimizations for Game Development">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#batching" class="md-nav__link">
    <span class="md-ellipsis">
      Batching
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Batching">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#implementation-overview" class="md-nav__link">
    <span class="md-ellipsis">
      Implementation Overview
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#explanation" class="md-nav__link">
    <span class="md-ellipsis">
      Explanation
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#occlusion-culling" class="md-nav__link">
    <span class="md-ellipsis">
      Occlusion Culling
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Occlusion Culling">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#how-occlusion-culling-works" class="md-nav__link">
    <span class="md-ellipsis">
      How Occlusion Culling Works
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#implementation-of-occlusion-culling-in-c" class="md-nav__link">
    <span class="md-ellipsis">
      Implementation of Occlusion Culling in C++
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#explanation_1" class="md-nav__link">
    <span class="md-ellipsis">
      Explanation
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#deferred-rendering" class="md-nav__link">
    <span class="md-ellipsis">
      Deferred Rendering
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Deferred Rendering">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#implementation-overview_1" class="md-nav__link">
    <span class="md-ellipsis">
      Implementation Overview:
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#explanation_2" class="md-nav__link">
    <span class="md-ellipsis">
      Explanation
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#forward-rendering" class="md-nav__link">
    <span class="md-ellipsis">
      Forward Rendering
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Forward Rendering">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#implementation-overview_2" class="md-nav__link">
    <span class="md-ellipsis">
      Implementation Overview
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#explanation_3" class="md-nav__link">
    <span class="md-ellipsis">
      Explanation
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#advanced-techniques" class="md-nav__link">
    <span class="md-ellipsis">
      Advanced Techniques
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#graphics-transformations" class="md-nav__link">
    <span class="md-ellipsis">
      Graphics Transformations
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Graphics Transformations">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#types-of-transformations" class="md-nav__link">
    <span class="md-ellipsis">
      Types of Transformations
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Types of Transformations">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#1-translation" class="md-nav__link">
    <span class="md-ellipsis">
      1. Translation
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#2-rotation" class="md-nav__link">
    <span class="md-ellipsis">
      2. Rotation
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#3-scaling" class="md-nav__link">
    <span class="md-ellipsis">
      3. Scaling
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#4-shear" class="md-nav__link">
    <span class="md-ellipsis">
      4. Shear
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#5-projection" class="md-nav__link">
    <span class="md-ellipsis">
      5. Projection
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#orthographic-projection" class="md-nav__link">
    <span class="md-ellipsis">
      Orthographic Projection
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#perspective-projection" class="md-nav__link">
    <span class="md-ellipsis">
      Perspective Projection
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#explanation-of-perspective-projection-matrix" class="md-nav__link">
    <span class="md-ellipsis">
      Explanation of Perspective Projection Matrix
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#coordinate-spaces" class="md-nav__link">
    <span class="md-ellipsis">
      Coordinate Spaces
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Coordinate Spaces">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#1-object-space-model-space" class="md-nav__link">
    <span class="md-ellipsis">
      1. Object Space (Model Space)
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#2-world-space" class="md-nav__link">
    <span class="md-ellipsis">
      2. World Space
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#3-view-space-camera-space" class="md-nav__link">
    <span class="md-ellipsis">
      3. View Space (Camera Space)
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#4-clip-space" class="md-nav__link">
    <span class="md-ellipsis">
      4. Clip Space
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#5-screen-space" class="md-nav__link">
    <span class="md-ellipsis">
      5. Screen Space
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#coordinate-transformations-in-detail" class="md-nav__link">
    <span class="md-ellipsis">
      Coordinate Transformations in Detail
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Coordinate Transformations in Detail">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#1-model-transformation-object-space-to-world-space" class="md-nav__link">
    <span class="md-ellipsis">
      1. Model Transformation (Object Space to World Space)
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#2-view-transformation-world-space-to-view-space" class="md-nav__link">
    <span class="md-ellipsis">
      2. View Transformation (World Space to View Space)
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#3-projection-transformation-view-space-to-clip-space" class="md-nav__link">
    <span class="md-ellipsis">
      3. Projection Transformation (View Space to Clip Space)
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#4-normalized-device-coordinates-ndc" class="md-nav__link">
    <span class="md-ellipsis">
      4. Normalized Device Coordinates (NDC)
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#5-viewport-transformation-ndc-to-screen-space" class="md-nav__link">
    <span class="md-ellipsis">
      5. Viewport Transformation (NDC to Screen Space)
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#transformation-matrices" class="md-nav__link">
    <span class="md-ellipsis">
      Transformation Matrices
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Transformation Matrices">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#1-translation-matrix" class="md-nav__link">
    <span class="md-ellipsis">
      1. Translation Matrix
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#2-rotation-matrix-around-z-axis" class="md-nav__link">
    <span class="md-ellipsis">
      2. Rotation Matrix (around Z-axis)
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#3-scaling-matrix" class="md-nav__link">
    <span class="md-ellipsis">
      3. Scaling Matrix
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#transformation-pipeline" class="md-nav__link">
    <span class="md-ellipsis">
      Transformation Pipeline
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Transformation Pipeline">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#1-model-transformation" class="md-nav__link">
    <span class="md-ellipsis">
      1. Model Transformation
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#2-view-transformation" class="md-nav__link">
    <span class="md-ellipsis">
      2. View Transformation
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#3-projection-transformation" class="md-nav__link">
    <span class="md-ellipsis">
      3. Projection Transformation
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#4-viewport-transformation" class="md-nav__link">
    <span class="md-ellipsis">
      4. Viewport Transformation
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#diagram" class="md-nav__link">
    <span class="md-ellipsis">
      Diagram
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#detailed-example" class="md-nav__link">
    <span class="md-ellipsis">
      Detailed Example
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#implementation-in-code" class="md-nav__link">
    <span class="md-ellipsis">
      Implementation in Code
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#shader-implementation" class="md-nav__link">
    <span class="md-ellipsis">
      Shader Implementation
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#advanced-concepts" class="md-nav__link">
    <span class="md-ellipsis">
      Advanced Concepts
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#optimization-techniques" class="md-nav__link">
    <span class="md-ellipsis">
      Optimization Techniques
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#rendering-techniques" class="md-nav__link">
    <span class="md-ellipsis">
      Rendering Techniques
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Rendering Techniques">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#forward-rendering_1" class="md-nav__link">
    <span class="md-ellipsis">
      Forward Rendering
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#deferred-rendering_1" class="md-nav__link">
    <span class="md-ellipsis">
      Deferred Rendering
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#ray-tracing" class="md-nav__link">
    <span class="md-ellipsis">
      Ray Tracing
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#global-illumination" class="md-nav__link">
    <span class="md-ellipsis">
      Global Illumination
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#shaders" class="md-nav__link">
    <span class="md-ellipsis">
      Shaders
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Shaders">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#vertex-shaders" class="md-nav__link">
    <span class="md-ellipsis">
      Vertex Shaders
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Vertex Shaders">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#implementation" class="md-nav__link">
    <span class="md-ellipsis">
      Implementation
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#explanation_4" class="md-nav__link">
    <span class="md-ellipsis">
      Explanation
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#fragment-shaders" class="md-nav__link">
    <span class="md-ellipsis">
      Fragment Shaders
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Fragment Shaders">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#implementation_1" class="md-nav__link">
    <span class="md-ellipsis">
      Implementation
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#explanation_5" class="md-nav__link">
    <span class="md-ellipsis">
      Explanation
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#geometry-shaders" class="md-nav__link">
    <span class="md-ellipsis">
      Geometry Shaders
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Geometry Shaders">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#overview" class="md-nav__link">
    <span class="md-ellipsis">
      Overview
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#compute-shaders" class="md-nav__link">
    <span class="md-ellipsis">
      Compute Shaders
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#lighting-and-shadows" class="md-nav__link">
    <span class="md-ellipsis">
      Lighting and Shadows
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Lighting and Shadows">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#types-of-lights" class="md-nav__link">
    <span class="md-ellipsis">
      Types of Lights
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#shadow-mapping" class="md-nav__link">
    <span class="md-ellipsis">
      Shadow Mapping
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Shadow Mapping">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#implementation-overview_3" class="md-nav__link">
    <span class="md-ellipsis">
      Implementation Overview
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#explanation_6" class="md-nav__link">
    <span class="md-ellipsis">
      Explanation
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#ambient-occlusion" class="md-nav__link">
    <span class="md-ellipsis">
      Ambient Occlusion
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Ambient Occlusion">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#ssao-compute-shader" class="md-nav__link">
    <span class="md-ellipsis">
      SSAO compute shader
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#blur-compute-shader" class="md-nav__link">
    <span class="md-ellipsis">
      Blur Compute Shader
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#ssao-compute-shader-explanation" class="md-nav__link">
    <span class="md-ellipsis">
      SSAO Compute Shader Explanation:
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#blur-compute-shader-explanation" class="md-nav__link">
    <span class="md-ellipsis">
      Blur Compute Shader Explanation:
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#texturing" class="md-nav__link">
    <span class="md-ellipsis">
      Texturing
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Texturing">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#uv-mapping" class="md-nav__link">
    <span class="md-ellipsis">
      UV Mapping
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#texture-atlases" class="md-nav__link">
    <span class="md-ellipsis">
      Texture Atlases
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#normal-mapping" class="md-nav__link">
    <span class="md-ellipsis">
      Normal Mapping
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#parallax-mapping" class="md-nav__link">
    <span class="md-ellipsis">
      Parallax Mapping
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#animation" class="md-nav__link">
    <span class="md-ellipsis">
      Animation
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Animation">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#keyframe-animation" class="md-nav__link">
    <span class="md-ellipsis">
      Keyframe Animation
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#skeletal-animation" class="md-nav__link">
    <span class="md-ellipsis">
      Skeletal Animation
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#inverse-kinematics-ik" class="md-nav__link">
    <span class="md-ellipsis">
      Inverse Kinematics (IK)
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#motion-capture" class="md-nav__link">
    <span class="md-ellipsis">
      Motion Capture
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#optimization" class="md-nav__link">
    <span class="md-ellipsis">
      Optimization
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Optimization">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#level-of-detail-lod" class="md-nav__link">
    <span class="md-ellipsis">
      Level of Detail (LOD)
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#occlusion-culling_1" class="md-nav__link">
    <span class="md-ellipsis">
      Occlusion Culling
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Occlusion Culling">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#advanced-techniques-in-occlusion-culling" class="md-nav__link">
    <span class="md-ellipsis">
      Advanced Techniques in Occlusion Culling
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Advanced Techniques in Occlusion Culling">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#1-hierarchical-z-buffering-hzb" class="md-nav__link">
    <span class="md-ellipsis">
      1. Hierarchical Z-Buffering (HZB)
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#2-potentially-visible-set-pvs-computation" class="md-nav__link">
    <span class="md-ellipsis">
      2. Potentially Visible Set (PVS) Computation
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#3-hardware-occlusion-queries" class="md-nav__link">
    <span class="md-ellipsis">
      3. Hardware Occlusion Queries
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#implementation-of-hierarchical-z-buffering-in-c" class="md-nav__link">
    <span class="md-ellipsis">
      Implementation of Hierarchical Z-Buffering in C++
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#explanation_7" class="md-nav__link">
    <span class="md-ellipsis">
      Explanation
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#potentially-visible-set-pvs-computation" class="md-nav__link">
    <span class="md-ellipsis">
      Potentially Visible Set (PVS) Computation
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#hardware-occlusion-queries" class="md-nav__link">
    <span class="md-ellipsis">
      Hardware Occlusion Queries
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#summary" class="md-nav__link">
    <span class="md-ellipsis">
      Summary
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#frustum-culling" class="md-nav__link">
    <span class="md-ellipsis">
      Frustum Culling
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Frustum Culling">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#explanation_8" class="md-nav__link">
    <span class="md-ellipsis">
      Explanation
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#steps-in-frustum-culling" class="md-nav__link">
    <span class="md-ellipsis">
      Steps in Frustum Culling
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#implementing-frustum-culling-in-c" class="md-nav__link">
    <span class="md-ellipsis">
      Implementing Frustum Culling in C++
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#explanation_9" class="md-nav__link">
    <span class="md-ellipsis">
      Explanation
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#instancing" class="md-nav__link">
    <span class="md-ellipsis">
      Instancing
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#post-processing" class="md-nav__link">
    <span class="md-ellipsis">
      Post-Processing
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Post-Processing">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#common-post-processing-effects" class="md-nav__link">
    <span class="md-ellipsis">
      Common Post-Processing Effects
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#implementation-framework" class="md-nav__link">
    <span class="md-ellipsis">
      Implementation Framework
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#shader-management" class="md-nav__link">
    <span class="md-ellipsis">
      Shader Management
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#effecth" class="md-nav__link">
    <span class="md-ellipsis">
      Effect.h
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#bloomeffecth" class="md-nav__link">
    <span class="md-ellipsis">
      BloomEffect.h
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#postprocessingpipelineh" class="md-nav__link">
    <span class="md-ellipsis">
      PostProcessingPipeline.h
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#maincpp" class="md-nav__link">
    <span class="md-ellipsis">
      Main.cpp
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#explanation_10" class="md-nav__link">
    <span class="md-ellipsis">
      Explanation
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#shaders_1" class="md-nav__link">
    <span class="md-ellipsis">
      Shaders
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Shaders">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#bloomvert" class="md-nav__link">
    <span class="md-ellipsis">
      bloom.vert
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#bloomfrag" class="md-nav__link">
    <span class="md-ellipsis">
      bloom.frag
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#bloom-effect" class="md-nav__link">
    <span class="md-ellipsis">
      Bloom Effect
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Bloom Effect">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#key-steps" class="md-nav__link">
    <span class="md-ellipsis">
      Key Steps
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#bloomvert_1" class="md-nav__link">
    <span class="md-ellipsis">
      bloom.vert
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#bloomfrag_1" class="md-nav__link">
    <span class="md-ellipsis">
      bloom.frag
    </span>
  </a>
  
    <nav class="md-nav" aria-label="bloom.frag">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#bright-pass-extract-bright-areas" class="md-nav__link">
    <span class="md-ellipsis">
      Bright Pass (extract bright areas)
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#gaussian-blur-horizontal-and-vertical-passes" class="md-nav__link">
    <span class="md-ellipsis">
      Gaussian Blur (horizontal and vertical passes)
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#bloomeffecth_1" class="md-nav__link">
    <span class="md-ellipsis">
      BloomEffect.h
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#bloomeffectcpp" class="md-nav__link">
    <span class="md-ellipsis">
      BloomEffect.cpp
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#explanation-of-the-bloom-effect-implementation" class="md-nav__link">
    <span class="md-ellipsis">
      Explanation of the Bloom Effect Implementation
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#graphics-apis" class="md-nav__link">
    <span class="md-ellipsis">
      Graphics APIs
    </span>
  </a>
  
</li>
      
    </ul>
  
</nav>
      
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../rendering/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Rendering Techniques
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="../patterns/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Programming Patterns
  </span>
  

      </a>
    </li>
  

    
      
      
  
  
  
  
    
    
    
      
      
        
      
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_6" >
        
          
          <label class="md-nav__link" for="__nav_6" id="__nav_6_label" tabindex="0">
            
  
  <span class="md-ellipsis">
    AI
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_6_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_6">
            <span class="md-nav__icon md-icon"></span>
            AI
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../ai/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Artificial Intelligence in Games
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="../engine/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Game Engine Architecture
  </span>
  

      </a>
    </li>
  

    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="../algorithms/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Algorithms
  </span>
  

      </a>
    </li>
  

    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="../intersections/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Intersections
  </span>
  

      </a>
    </li>
  

    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="../graph/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Graph
  </span>
  

      </a>
    </li>
  

    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="../gameplay/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Gameplay
  </span>
  

      </a>
    </li>
  

    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="../maths/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Maths
  </span>
  

      </a>
    </li>
  

    
  </ul>
</nav>
                  </div>
                </div>
              </div>
            
            
          
          
            <div class="md-content" data-md-component="content">
              <article class="md-content__inner md-typeset">
                
                  


<h1 id="graphics-in-game-development">Graphics in Game Development</h1>
<p>Welcome to the Graphics section of our Game Development resource center. This page covers essential topics related to computer graphics in game development.</p>
<h2 id="table-of-contents">Table of Contents</h2>
<ol>
<li><a href="#introduction-to-computer-graphics">Introduction to Computer Graphics</a></li>
<li><a href="#2d-graphics">2D Graphics</a></li>
<li><a href="#3d-graphics">3D Graphics</a></li>
<li><a href="#graphics-pipeline">Graphics Pipeline</a></li>
<li><a href="#graphics transformations">Graphics Transformations</a></li>
<li><a href="#rendering-techniques">Rendering Techniques</a></li>
<li><a href="#lines-and-circles">Lines and Circles</a> </li>
<li><a href="#ray-tracing">Ray Tracing</a></li>
<li><a href="#shaders">Shaders</a></li>
<li><a href="#lighting-and-shadows">Lighting and Shadows</a></li>
<li><a href="#texturing">Texturing</a></li>
<li><a href="#animation">Animation</a></li>
<li><a href="#optimization">Optimization</a></li>
<li><a href="#graphics-apis">Graphics APIs</a></li>
</ol>
<h2 id="introduction-to-computer-graphics">Introduction to Computer Graphics</h2>
<ul>
<li>Basic concepts and principles</li>
<li>The graphics pipeline</li>
<li>Coordinate systems and transformations</li>
</ul>
<h2 id="2d-graphics">2D Graphics</h2>
<ul>
<li>Sprites and sprite sheets</li>
<li>Tile-based graphics</li>
<li>Particle systems</li>
</ul>
<h2 id="3d-graphics">3D Graphics</h2>
<h3 id="3d-modeling-and-mesh-creation">3D Modeling and Mesh Creation</h3>
<h3 id="introduction-to-3d-modeling">Introduction to 3D Modeling</h3>
<h4 id="definition-and-importance-of-3d-modeling-in-games-and-other-applications">Definition and Importance of 3D Modeling in Games and Other Applications</h4>
<p><strong>Definition of 3D Modeling:</strong></p>
<p>3D modeling is the process of creating a three-dimensional representation of any object or surface by manipulating polygons, edges, and vertices in a simulated 3D space. These models are created using specialized software and are essential for various digital applications, including video games, films, architecture, and virtual reality.</p>
<p><strong>Importance in Games:</strong></p>
<ul>
<li><strong>Visual Realism:</strong> 3D models bring characters, environments, and objects to life, adding depth and realism to video games. High-quality models enhance the player's immersion and overall experience.</li>
<li><strong>Gameplay Mechanics:</strong> Detailed 3D models allow for intricate animations and interactions, which are crucial for gameplay mechanics. For example, a well-modeled character can perform complex movements and actions, making the game more engaging.</li>
<li><strong>Customization:</strong> Games often include customizable characters or items. 3D modeling enables the creation of various assets that players can modify, adding a personal touch to their gaming experience.</li>
<li><strong>Optimization:</strong> Efficient 3D models help in optimizing game performance. Properly constructed models can ensure smooth gameplay even on devices with lower processing power.</li>
</ul>
<p><strong>Importance in Other Applications:</strong></p>
<ul>
<li><strong>Film and Animation:</strong> 3D modeling is fundamental in creating stunning visual effects and animations. Characters and environments are modeled in 3D before being animated and rendered for films.</li>
<li><strong>Architecture and Design:</strong> Architects use 3D models to visualize and present their designs. This allows for better planning, presentation, and modification before actual construction begins.</li>
<li><strong>Virtual Reality (VR) and Augmented Reality (AR):</strong> 3D models are crucial in creating immersive VR and AR experiences, allowing users to interact with digital objects as if they were real.</li>
<li><strong>Product Design:</strong> Manufacturers use 3D modeling to prototype and design products. This helps in visualizing and refining designs before production.</li>
</ul>
<h4 id="overview-of-the-3d-modeling-workflow">Overview of the 3D Modeling Workflow</h4>
<p><strong>1. Concept and Planning:</strong></p>
<ul>
<li><strong>Idea Generation:</strong> Start with an idea or concept, often visualized through sketches or concept art. This step defines the look and feel of the model.</li>
<li><strong>Reference Gathering:</strong> Collect references to understand the details, proportions, and textures of the object to be modeled. These references guide the modeling process.</li>
</ul>
<p><strong>2. Blocking Out the Basic Shape:</strong></p>
<ul>
<li><strong>Basic Shapes:</strong> Begin by creating the basic shapes that make up the model. This stage focuses on getting the overall proportions and silhouette right.</li>
<li><strong>Low-Poly Model:</strong> Develop a low-polygon version of the model to establish the primary form without details.</li>
</ul>
<p><strong>3. Adding Detail:</strong></p>
<ul>
<li><strong>Model Refinement:</strong> Add more polygons and refine the model to include finer details. This may involve techniques like extrusion, beveling, and subdivision.</li>
<li><strong>High-Poly Model:</strong> Create a high-polygon version if needed, especially for models that require intricate details.</li>
</ul>
<p><strong>4. Texturing and UV Mapping:</strong></p>
<ul>
<li><strong>UV Unwrapping:</strong> Flatten the 3D model into a 2D representation to map textures accurately.</li>
<li><strong>Texture Painting:</strong> Apply textures to give the model color, patterns, and surface details. This can include diffuse maps, normal maps, and specular maps.</li>
</ul>
<p><strong>5. Rigging and Animation (if applicable):</strong></p>
<ul>
<li><strong>Skeleton Creation:</strong> Create a skeleton (rig) for the model, defining how it can move.</li>
<li><strong>Weight Painting:</strong> Assign weights to the model's vertices to control how they move with the rig.</li>
<li><strong>Animation:</strong> Animate the model if it needs to perform actions or movements.</li>
</ul>
<p><strong>6. Optimization:</strong></p>
<ul>
<li><strong>Polycount Reduction:</strong> Simplify the model to ensure it runs smoothly in real-time applications without sacrificing too much detail.</li>
<li><strong>Level of Detail (LOD):</strong> Create different versions of the model with varying levels of detail for performance optimization.</li>
</ul>
<p><strong>7. Exporting and Integration:</strong></p>
<ul>
<li><strong>Export:</strong> Export the model in a format compatible with the target application (e.g., game engine, rendering software).</li>
<li><strong>Integration:</strong> Import the model into the application, ensuring it works correctly within the desired environment.</li>
</ul>
<h3 id="understanding-the-building-blocks-of-3d-models">Understanding the Building Blocks of 3D Models</h3>
<h4 id="definition-of-vertices-edges-and-faces">Definition of Vertices, Edges, and Faces</h4>
<p><strong>Vertices:</strong></p>
<ul>
<li><strong>Definition:</strong> Vertices (singular: vertex) are points in 3D space that define the corners of a 3D model. Each vertex is defined by its coordinates (x, y, z) in the 3D space.</li>
<li><strong>Technical Representation:</strong> In programming, vertices are typically stored as arrays or lists of coordinate values. For example, in OpenGL, you might define vertices as follows:
  <div class="highlight"><pre><span></span><code><a id="__codelineno-0-1" name="__codelineno-0-1" href="#__codelineno-0-1"></a><span class="n">GLfloat</span><span class="w"> </span><span class="n">vertices</span><span class="p">[]</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-0-2" name="__codelineno-0-2" href="#__codelineno-0-2"></a><span class="w">    </span><span class="c1">// Coordinates for a simple triangle</span>
<a id="__codelineno-0-3" name="__codelineno-0-3" href="#__codelineno-0-3"></a><span class="w">    </span><span class="mf">0.0f</span><span class="p">,</span><span class="w">  </span><span class="mf">1.0f</span><span class="p">,</span><span class="w"> </span><span class="mf">0.0f</span><span class="p">,</span>
<a id="__codelineno-0-4" name="__codelineno-0-4" href="#__codelineno-0-4"></a><span class="w">   </span><span class="mf">-1.0f</span><span class="p">,</span><span class="w"> </span><span class="mf">-1.0f</span><span class="p">,</span><span class="w"> </span><span class="mf">0.0f</span><span class="p">,</span>
<a id="__codelineno-0-5" name="__codelineno-0-5" href="#__codelineno-0-5"></a><span class="w">    </span><span class="mf">1.0f</span><span class="p">,</span><span class="w"> </span><span class="mf">-1.0f</span><span class="p">,</span><span class="w"> </span><span class="mf">0.0f</span>
<a id="__codelineno-0-6" name="__codelineno-0-6" href="#__codelineno-0-6"></a><span class="p">};</span>
</code></pre></div></li>
</ul>
<p><strong>Edges:</strong></p>
<ul>
<li><strong>Definition:</strong> Edges are straight lines that connect two vertices. They define the outline or skeleton of a 3D model by connecting the vertices.</li>
<li><strong>Technical Representation:</strong> Edges can be represented by pairs of indices that refer to the vertices they connect. For example:
  <div class="highlight"><pre><span></span><code><a id="__codelineno-1-1" name="__codelineno-1-1" href="#__codelineno-1-1"></a><span class="n">GLuint</span><span class="w"> </span><span class="n">edges</span><span class="p">[]</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-1-2" name="__codelineno-1-2" href="#__codelineno-1-2"></a><span class="w">    </span><span class="mi">0</span><span class="p">,</span><span class="w"> </span><span class="mi">1</span><span class="p">,</span><span class="w">  </span><span class="c1">// Edge between vertex 0 and vertex 1</span>
<a id="__codelineno-1-3" name="__codelineno-1-3" href="#__codelineno-1-3"></a><span class="w">    </span><span class="mi">1</span><span class="p">,</span><span class="w"> </span><span class="mi">2</span><span class="p">,</span><span class="w">  </span><span class="c1">// Edge between vertex 1 and vertex 2</span>
<a id="__codelineno-1-4" name="__codelineno-1-4" href="#__codelineno-1-4"></a><span class="w">    </span><span class="mi">2</span><span class="p">,</span><span class="w"> </span><span class="mi">0</span><span class="w">   </span><span class="c1">// Edge between vertex 2 and vertex 0</span>
<a id="__codelineno-1-5" name="__codelineno-1-5" href="#__codelineno-1-5"></a><span class="p">};</span>
</code></pre></div></li>
</ul>
<p><strong>Faces:</strong></p>
<ul>
<li><strong>Definition:</strong> Faces are flat surfaces enclosed by edges. In 3D models, faces are usually polygons (often triangles or quads) that define the surface of the model.</li>
<li><strong>Technical Representation:</strong> Faces are defined by the indices of the vertices that form the polygon. For instance, a triangle face can be represented as:
  <div class="highlight"><pre><span></span><code><a id="__codelineno-2-1" name="__codelineno-2-1" href="#__codelineno-2-1"></a><span class="n">GLuint</span><span class="w"> </span><span class="n">faces</span><span class="p">[]</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-2-2" name="__codelineno-2-2" href="#__codelineno-2-2"></a><span class="w">    </span><span class="mi">0</span><span class="p">,</span><span class="w"> </span><span class="mi">1</span><span class="p">,</span><span class="w"> </span><span class="mi">2</span><span class="w">  </span><span class="c1">// Triangle formed by vertices 0, 1, and 2</span>
<a id="__codelineno-2-3" name="__codelineno-2-3" href="#__codelineno-2-3"></a><span class="p">};</span>
</code></pre></div></li>
</ul>
<h4 id="how-these-elements-come-together-to-form-a-3d-mesh">How These Elements Come Together to Form a 3D Mesh</h4>
<p><strong>Forming a Mesh:</strong></p>
<ul>
<li><strong>Definition:</strong> A 3D mesh is a collection of vertices, edges, and faces that define the shape of a 3D object. It is the basic structure used to create 3D models.</li>
<li><strong>Data Structures:</strong> In programming, a 3D mesh is typically represented using data structures that store vertices, edges, and faces efficiently. Commonly, meshes are stored in arrays or buffers.</li>
</ul>
<p><strong>Example of a Simple Mesh:</strong></p>
<p>Consider a simple 3D model of a triangle. This can be represented in code by defining the vertices, edges, and faces.</p>
<p><strong>Vertices Array:</strong>
<div class="highlight"><pre><span></span><code><a id="__codelineno-3-1" name="__codelineno-3-1" href="#__codelineno-3-1"></a><span class="n">GLfloat</span><span class="w"> </span><span class="n">vertices</span><span class="p">[]</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-3-2" name="__codelineno-3-2" href="#__codelineno-3-2"></a><span class="w">    </span><span class="mf">0.0f</span><span class="p">,</span><span class="w">  </span><span class="mf">1.0f</span><span class="p">,</span><span class="w"> </span><span class="mf">0.0f</span><span class="p">,</span><span class="w">  </span><span class="c1">// Vertex 0</span>
<a id="__codelineno-3-3" name="__codelineno-3-3" href="#__codelineno-3-3"></a><span class="w">   </span><span class="mf">-1.0f</span><span class="p">,</span><span class="w"> </span><span class="mf">-1.0f</span><span class="p">,</span><span class="w"> </span><span class="mf">0.0f</span><span class="p">,</span><span class="w">  </span><span class="c1">// Vertex 1</span>
<a id="__codelineno-3-4" name="__codelineno-3-4" href="#__codelineno-3-4"></a><span class="w">    </span><span class="mf">1.0f</span><span class="p">,</span><span class="w"> </span><span class="mf">-1.0f</span><span class="p">,</span><span class="w"> </span><span class="mf">0.0f</span><span class="w">   </span><span class="c1">// Vertex 2</span>
<a id="__codelineno-3-5" name="__codelineno-3-5" href="#__codelineno-3-5"></a><span class="p">};</span>
</code></pre></div></p>
<p><strong>Edges Array:</strong>
<div class="highlight"><pre><span></span><code><a id="__codelineno-4-1" name="__codelineno-4-1" href="#__codelineno-4-1"></a><span class="n">GLuint</span><span class="w"> </span><span class="n">edges</span><span class="p">[]</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-4-2" name="__codelineno-4-2" href="#__codelineno-4-2"></a><span class="w">    </span><span class="mi">0</span><span class="p">,</span><span class="w"> </span><span class="mi">1</span><span class="p">,</span><span class="w">  </span><span class="c1">// Edge from vertex 0 to vertex 1</span>
<a id="__codelineno-4-3" name="__codelineno-4-3" href="#__codelineno-4-3"></a><span class="w">    </span><span class="mi">1</span><span class="p">,</span><span class="w"> </span><span class="mi">2</span><span class="p">,</span><span class="w">  </span><span class="c1">// Edge from vertex 1 to vertex 2</span>
<a id="__codelineno-4-4" name="__codelineno-4-4" href="#__codelineno-4-4"></a><span class="w">    </span><span class="mi">2</span><span class="p">,</span><span class="w"> </span><span class="mi">0</span><span class="w">   </span><span class="c1">// Edge from vertex 2 to vertex 0</span>
<a id="__codelineno-4-5" name="__codelineno-4-5" href="#__codelineno-4-5"></a><span class="p">};</span>
</code></pre></div></p>
<p><strong>Faces Array:</strong>
<div class="highlight"><pre><span></span><code><a id="__codelineno-5-1" name="__codelineno-5-1" href="#__codelineno-5-1"></a><span class="n">GLuint</span><span class="w"> </span><span class="n">faces</span><span class="p">[]</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-5-2" name="__codelineno-5-2" href="#__codelineno-5-2"></a><span class="w">    </span><span class="mi">0</span><span class="p">,</span><span class="w"> </span><span class="mi">1</span><span class="p">,</span><span class="w"> </span><span class="mi">2</span><span class="w">  </span><span class="c1">// Face formed by vertices 0, 1, and 2</span>
<a id="__codelineno-5-3" name="__codelineno-5-3" href="#__codelineno-5-3"></a><span class="p">};</span>
</code></pre></div></p>
<p><strong>Constructing the Mesh:</strong></p>
<ol>
<li><strong>Define Vertices:</strong> The coordinates of each vertex are defined in the <code>vertices</code> array.</li>
<li><strong>Connect Vertices with Edges:</strong> The <code>edges</code> array specifies which pairs of vertices are connected by edges.</li>
<li><strong>Form Faces:</strong> The <code>faces</code> array specifies which vertices form each face of the mesh. In this example, a single triangular face is formed by vertices 0, 1, and 2.</li>
</ol>
<p><strong>Rendering the Mesh:</strong></p>
<ul>
<li>
<p><strong>Vertex Buffer Objects (VBOs):</strong> In modern OpenGL, vertices are often stored in Vertex Buffer Objects for efficient rendering.
  <div class="highlight"><pre><span></span><code><a id="__codelineno-6-1" name="__codelineno-6-1" href="#__codelineno-6-1"></a><span class="n">GLuint</span><span class="w"> </span><span class="n">VBO</span><span class="p">;</span>
<a id="__codelineno-6-2" name="__codelineno-6-2" href="#__codelineno-6-2"></a><span class="n">glGenBuffers</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span><span class="w"> </span><span class="o">&amp;</span><span class="n">VBO</span><span class="p">);</span>
<a id="__codelineno-6-3" name="__codelineno-6-3" href="#__codelineno-6-3"></a><span class="n">glBindBuffer</span><span class="p">(</span><span class="n">GL_ARRAY_BUFFER</span><span class="p">,</span><span class="w"> </span><span class="n">VBO</span><span class="p">);</span>
<a id="__codelineno-6-4" name="__codelineno-6-4" href="#__codelineno-6-4"></a><span class="n">glBufferData</span><span class="p">(</span><span class="n">GL_ARRAY_BUFFER</span><span class="p">,</span><span class="w"> </span><span class="k">sizeof</span><span class="p">(</span><span class="n">vertices</span><span class="p">),</span><span class="w"> </span><span class="n">vertices</span><span class="p">,</span><span class="w"> </span><span class="n">GL_STATIC_DRAW</span><span class="p">);</span>
</code></pre></div></p>
</li>
<li>
<p><strong>Element Buffer Objects (EBOs):</strong> Faces can be stored in Element Buffer Objects, which allow for indexed drawing.
  <div class="highlight"><pre><span></span><code><a id="__codelineno-7-1" name="__codelineno-7-1" href="#__codelineno-7-1"></a><span class="n">GLuint</span><span class="w"> </span><span class="n">EBO</span><span class="p">;</span>
<a id="__codelineno-7-2" name="__codelineno-7-2" href="#__codelineno-7-2"></a><span class="n">glGenBuffers</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span><span class="w"> </span><span class="o">&amp;</span><span class="n">EBO</span><span class="p">);</span>
<a id="__codelineno-7-3" name="__codelineno-7-3" href="#__codelineno-7-3"></a><span class="n">glBindBuffer</span><span class="p">(</span><span class="n">GL_ELEMENT_ARRAY_BUFFER</span><span class="p">,</span><span class="w"> </span><span class="n">EBO</span><span class="p">);</span>
<a id="__codelineno-7-4" name="__codelineno-7-4" href="#__codelineno-7-4"></a><span class="n">glBufferData</span><span class="p">(</span><span class="n">GL_ELEMENT_ARRAY_BUFFER</span><span class="p">,</span><span class="w"> </span><span class="k">sizeof</span><span class="p">(</span><span class="n">faces</span><span class="p">),</span><span class="w"> </span><span class="n">faces</span><span class="p">,</span><span class="w"> </span><span class="n">GL_STATIC_DRAW</span><span class="p">);</span>
</code></pre></div></p>
</li>
<li>
<p><strong>Drawing the Mesh:</strong>
  <div class="highlight"><pre><span></span><code><a id="__codelineno-8-1" name="__codelineno-8-1" href="#__codelineno-8-1"></a><span class="n">glDrawElements</span><span class="p">(</span><span class="n">GL_TRIANGLES</span><span class="p">,</span><span class="w"> </span><span class="mi">3</span><span class="p">,</span><span class="w"> </span><span class="n">GL_UNSIGNED_INT</span><span class="p">,</span><span class="w"> </span><span class="mi">0</span><span class="p">);</span>
</code></pre></div></p>
</li>
</ul>
<p>By combining vertices, edges, and faces in these data structures and using OpenGL or similar graphics libraries, you can create and render complex 3D models efficiently. This foundational understanding allows programmers to manipulate 3D models for various applications, from simple static objects to dynamic, animated characters in video games.</p>
<h3 id="introduction-to-polygons">Introduction to Polygons</h3>
<h4 id="definition-and-types-of-polygons">Definition and Types of Polygons</h4>
<p><strong>Definition of Polygons:</strong></p>
<ul>
<li><strong>Polygons</strong> are flat, two-dimensional shapes made up of straight lines that are connected end-to-end to form a closed chain or circuit. In the context of 3D modeling, polygons are used to define the surfaces of 3D models.</li>
<li>A polygon is typically defined by its vertices, which are the points where the edges of the polygon meet. Each edge is a line segment connecting two vertices.</li>
</ul>
<p><strong>Types of Polygons:</strong></p>
<ol>
<li>
<p><strong>Triangles:</strong></p>
<ul>
<li><strong>Definition:</strong> A polygon with three sides and three vertices.</li>
<li><strong>Importance:</strong> Triangles are the simplest type of polygon and are widely used in 3D modeling and rendering because any surface can be broken down into a set of triangles. Triangles are always planar, meaning they lie on a single plane, which simplifies calculations for rendering and transformations.</li>
<li><strong>Technical Example:</strong> 
 <div class="highlight"><pre><span></span><code><a id="__codelineno-9-1" name="__codelineno-9-1" href="#__codelineno-9-1"></a><span class="n">GLuint</span><span class="w"> </span><span class="n">triangle</span><span class="p">[]</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-9-2" name="__codelineno-9-2" href="#__codelineno-9-2"></a><span class="w">    </span><span class="mi">0</span><span class="p">,</span><span class="w"> </span><span class="mi">1</span><span class="p">,</span><span class="w"> </span><span class="mi">2</span><span class="w">  </span><span class="c1">// Triangle defined by vertices 0, 1, and 2</span>
<a id="__codelineno-9-3" name="__codelineno-9-3" href="#__codelineno-9-3"></a><span class="p">};</span>
</code></pre></div></li>
</ul>
</li>
<li>
<p><strong>Quads:</strong></p>
<ul>
<li><strong>Definition:</strong> A polygon with four sides and four vertices.</li>
<li><strong>Importance:</strong> Quads are often used in 3D modeling because they can represent rectangular surfaces more naturally than triangles. However, quads can become non-planar (i.e., the vertices do not lie on a single plane), leading to rendering issues. For this reason, quads are typically divided into two triangles when rendering.</li>
<li><strong>Technical Example:</strong> 
 <div class="highlight"><pre><span></span><code><a id="__codelineno-10-1" name="__codelineno-10-1" href="#__codelineno-10-1"></a><span class="n">GLuint</span><span class="w"> </span><span class="n">quad</span><span class="p">[]</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-10-2" name="__codelineno-10-2" href="#__codelineno-10-2"></a><span class="w">    </span><span class="mi">0</span><span class="p">,</span><span class="w"> </span><span class="mi">1</span><span class="p">,</span><span class="w"> </span><span class="mi">2</span><span class="p">,</span><span class="w"> </span><span class="mi">3</span><span class="w">  </span><span class="c1">// Quad defined by vertices 0, 1, 2, and 3</span>
<a id="__codelineno-10-3" name="__codelineno-10-3" href="#__codelineno-10-3"></a><span class="p">};</span>
</code></pre></div></li>
</ul>
</li>
<li>
<p><strong>N-Gons:</strong></p>
<ul>
<li><strong>Definition:</strong> A polygon with more than four sides and vertices (where "n" denotes the number of sides).</li>
<li><strong>Importance:</strong> N-gons are useful for modeling complex shapes with fewer polygons, but they can introduce issues in rendering and deformation. Many 3D modeling software automatically converts n-gons to triangles or quads during the export or rendering process to ensure compatibility.</li>
<li><strong>Technical Example:</strong> 
 <div class="highlight"><pre><span></span><code><a id="__codelineno-11-1" name="__codelineno-11-1" href="#__codelineno-11-1"></a><span class="n">GLuint</span><span class="w"> </span><span class="n">ngon</span><span class="p">[]</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-11-2" name="__codelineno-11-2" href="#__codelineno-11-2"></a><span class="w">    </span><span class="mi">0</span><span class="p">,</span><span class="w"> </span><span class="mi">1</span><span class="p">,</span><span class="w"> </span><span class="mi">2</span><span class="p">,</span><span class="w"> </span><span class="mi">3</span><span class="p">,</span><span class="w"> </span><span class="mi">4</span><span class="w">  </span><span class="c1">// N-gon defined by vertices 0, 1, 2, 3, and 4</span>
<a id="__codelineno-11-3" name="__codelineno-11-3" href="#__codelineno-11-3"></a><span class="p">};</span>
</code></pre></div></li>
</ul>
</li>
</ol>
<h4 id="importance-of-polygon-structure-in-3d-modeling">Importance of Polygon Structure in 3D Modeling</h4>
<p><strong>1. Performance and Optimization:</strong></p>
<ul>
<li><strong>Rendering Efficiency:</strong> The structure of polygons directly affects rendering performance. Triangles are the most efficient for graphics hardware to process. Modern GPUs are optimized to handle triangles, making them the preferred choice for real-time rendering in games and interactive applications.</li>
<li><strong>Memory Usage:</strong> The number of polygons impacts the memory required to store and render the 3D model. Lower polygon counts generally lead to better performance and lower memory usage, which is critical for real-time applications like video games and VR.</li>
</ul>
<p><strong>2. Model Quality and Deformation:</strong></p>
<ul>
<li><strong>Surface Smoothness:</strong> The arrangement and density of polygons determine the smoothness of a 3D model's surface. More polygons can create smoother surfaces but at the cost of higher computational and memory demands.</li>
<li><strong>Animation and Rigging:</strong> Proper polygon structure ensures that models deform correctly during animations. For example, edge loops around joints in a character model allow for natural bending and movement.</li>
</ul>
<p><strong>3. Texturing and UV Mapping:</strong></p>
<ul>
<li><strong>UV Unwrapping:</strong> The structure of polygons affects how textures are applied to a 3D model. Quads and well-organized polygon structures facilitate easier and more accurate UV unwrapping, which is the process of projecting a 2D texture onto a 3D surface.</li>
<li><strong>Texture Distortion:</strong> Poorly structured polygons can lead to texture stretching and distortion, which affects the visual quality of the model. Maintaining a consistent and logical polygon structure helps in minimizing these issues.</li>
</ul>
<p><strong>4. Geometry and Topology:</strong></p>
<ul>
<li><strong>Topology:</strong> The arrangement and flow of polygons, known as topology, are crucial for creating models that deform well and look natural. Good topology follows the natural contours of the modeled object and avoids unnecessary complexity.</li>
<li><strong>Non-Manifold Geometry:</strong> Ensuring that the polygon structure is manifold (every edge belongs to exactly two faces) is essential for proper rendering and simulation. Non-manifold geometry can cause issues in rendering, physics simulations, and other processes.</li>
</ul>
<p><strong>5. Subdivision Surfaces:</strong></p>
<ul>
<li><strong>Subdivision Modeling:</strong> Subdivision surfaces allow for the creation of high-detail models from low-polygon meshes. Properly structured quads are especially important in subdivision modeling, as they subdivide more predictably and produce smoother results.</li>
</ul>
<p>By understanding the different types of polygons and the importance of their structure, programmers and modelers can create efficient, high-quality 3D models that perform well and look great in various applications.</p>
<ul>
<li><strong>Polycount Considerations</strong><ul>
<li>The impact of polycount on performance and visual quality.</li>
<li>Balancing detail and efficiency for different types of assets (characters, environments, props).</li>
</ul>
</li>
<li><strong>Optimization Techniques</strong><ul>
<li>Reducing polycount while maintaining visual fidelity.</li>
<li>Using normal maps and other techniques to simulate detail on low-poly models.</li>
</ul>
</li>
<li><strong>Level of Detail (LOD)</strong><ul>
<li>Creating multiple versions of a model with different polycounts.</li>
<li>Implementing LOD in game engines to optimize performance.</li>
</ul>
</li>
<li><strong>Polycount in Various Contexts</strong><ul>
<li>Different polycount requirements for real-time applications (games, VR) versus pre-rendered content (films, high-end visualizations).</li>
</ul>
</li>
</ul>
<h3 id="use-of-index-winding-order-and-back-face-culling">Use of Index, Winding Order, and Back Face Culling</h3>
<h4 id="use-of-index">Use of Index</h4>
<p><strong>Definition:</strong></p>
<ul>
<li>An index is an integer value that references a specific vertex in a vertex array. Using indices helps in reusing vertices and reducing memory usage by avoiding duplicate vertices.</li>
</ul>
<p><strong>Purpose:</strong></p>
<ul>
<li><strong>Efficiency:</strong> Indices allow for more efficient memory usage and rendering. Instead of storing multiple copies of the same vertex, an index array can be used to reference vertices, edges, and faces multiple times.</li>
<li><strong>Performance:</strong> Graphics APIs like OpenGL and Direct3D use indices to optimize the rendering process. Indexed drawing allows the GPU to fetch vertex data more efficiently, leading to faster rendering times.</li>
</ul>
<p><strong>Example:</strong>
<div class="highlight"><pre><span></span><code><a id="__codelineno-12-1" name="__codelineno-12-1" href="#__codelineno-12-1"></a><span class="c1">// Define vertices for a square (2 triangles)</span>
<a id="__codelineno-12-2" name="__codelineno-12-2" href="#__codelineno-12-2"></a><span class="n">GLfloat</span><span class="w"> </span><span class="n">vertices</span><span class="p">[]</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-12-3" name="__codelineno-12-3" href="#__codelineno-12-3"></a><span class="w">    </span><span class="mf">-0.5f</span><span class="p">,</span><span class="w"> </span><span class="mf">-0.5f</span><span class="p">,</span><span class="w"> </span><span class="mf">0.0f</span><span class="p">,</span><span class="w">  </span><span class="c1">// Vertex 0</span>
<a id="__codelineno-12-4" name="__codelineno-12-4" href="#__codelineno-12-4"></a><span class="w">     </span><span class="mf">0.5f</span><span class="p">,</span><span class="w"> </span><span class="mf">-0.5f</span><span class="p">,</span><span class="w"> </span><span class="mf">0.0f</span><span class="p">,</span><span class="w">  </span><span class="c1">// Vertex 1</span>
<a id="__codelineno-12-5" name="__codelineno-12-5" href="#__codelineno-12-5"></a><span class="w">     </span><span class="mf">0.5f</span><span class="p">,</span><span class="w">  </span><span class="mf">0.5f</span><span class="p">,</span><span class="w"> </span><span class="mf">0.0f</span><span class="p">,</span><span class="w">  </span><span class="c1">// Vertex 2</span>
<a id="__codelineno-12-6" name="__codelineno-12-6" href="#__codelineno-12-6"></a><span class="w">    </span><span class="mf">-0.5f</span><span class="p">,</span><span class="w">  </span><span class="mf">0.5f</span><span class="p">,</span><span class="w"> </span><span class="mf">0.0f</span><span class="w">   </span><span class="c1">// Vertex 3</span>
<a id="__codelineno-12-7" name="__codelineno-12-7" href="#__codelineno-12-7"></a><span class="p">};</span>
<a id="__codelineno-12-8" name="__codelineno-12-8" href="#__codelineno-12-8"></a>
<a id="__codelineno-12-9" name="__codelineno-12-9" href="#__codelineno-12-9"></a><span class="c1">// Define indices for the two triangles</span>
<a id="__codelineno-12-10" name="__codelineno-12-10" href="#__codelineno-12-10"></a><span class="n">GLuint</span><span class="w"> </span><span class="n">indices</span><span class="p">[]</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-12-11" name="__codelineno-12-11" href="#__codelineno-12-11"></a><span class="w">    </span><span class="mi">0</span><span class="p">,</span><span class="w"> </span><span class="mi">1</span><span class="p">,</span><span class="w"> </span><span class="mi">2</span><span class="p">,</span><span class="w">  </span><span class="c1">// First triangle</span>
<a id="__codelineno-12-12" name="__codelineno-12-12" href="#__codelineno-12-12"></a><span class="w">    </span><span class="mi">2</span><span class="p">,</span><span class="w"> </span><span class="mi">3</span><span class="p">,</span><span class="w"> </span><span class="mi">0</span><span class="w">   </span><span class="c1">// Second triangle</span>
<a id="__codelineno-12-13" name="__codelineno-12-13" href="#__codelineno-12-13"></a><span class="p">};</span>
<a id="__codelineno-12-14" name="__codelineno-12-14" href="#__codelineno-12-14"></a>
<a id="__codelineno-12-15" name="__codelineno-12-15" href="#__codelineno-12-15"></a><span class="c1">// Setting up VBO and EBO in OpenGL</span>
<a id="__codelineno-12-16" name="__codelineno-12-16" href="#__codelineno-12-16"></a><span class="n">GLuint</span><span class="w"> </span><span class="n">VBO</span><span class="p">,</span><span class="w"> </span><span class="n">EBO</span><span class="p">;</span>
<a id="__codelineno-12-17" name="__codelineno-12-17" href="#__codelineno-12-17"></a><span class="n">glGenBuffers</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span><span class="w"> </span><span class="o">&amp;</span><span class="n">VBO</span><span class="p">);</span>
<a id="__codelineno-12-18" name="__codelineno-12-18" href="#__codelineno-12-18"></a><span class="n">glGenBuffers</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span><span class="w"> </span><span class="o">&amp;</span><span class="n">EBO</span><span class="p">);</span>
<a id="__codelineno-12-19" name="__codelineno-12-19" href="#__codelineno-12-19"></a>
<a id="__codelineno-12-20" name="__codelineno-12-20" href="#__codelineno-12-20"></a><span class="n">glBindBuffer</span><span class="p">(</span><span class="n">GL_ARRAY_BUFFER</span><span class="p">,</span><span class="w"> </span><span class="n">VBO</span><span class="p">);</span>
<a id="__codelineno-12-21" name="__codelineno-12-21" href="#__codelineno-12-21"></a><span class="n">glBufferData</span><span class="p">(</span><span class="n">GL_ARRAY_BUFFER</span><span class="p">,</span><span class="w"> </span><span class="k">sizeof</span><span class="p">(</span><span class="n">vertices</span><span class="p">),</span><span class="w"> </span><span class="n">vertices</span><span class="p">,</span><span class="w"> </span><span class="n">GL_STATIC_DRAW</span><span class="p">);</span>
<a id="__codelineno-12-22" name="__codelineno-12-22" href="#__codelineno-12-22"></a>
<a id="__codelineno-12-23" name="__codelineno-12-23" href="#__codelineno-12-23"></a><span class="n">glBindBuffer</span><span class="p">(</span><span class="n">GL_ELEMENT_ARRAY_BUFFER</span><span class="p">,</span><span class="w"> </span><span class="n">EBO</span><span class="p">);</span>
<a id="__codelineno-12-24" name="__codelineno-12-24" href="#__codelineno-12-24"></a><span class="n">glBufferData</span><span class="p">(</span><span class="n">GL_ELEMENT_ARRAY_BUFFER</span><span class="p">,</span><span class="w"> </span><span class="k">sizeof</span><span class="p">(</span><span class="n">indices</span><span class="p">),</span><span class="w"> </span><span class="n">indices</span><span class="p">,</span><span class="w"> </span><span class="n">GL_STATIC_DRAW</span><span class="p">);</span>
<a id="__codelineno-12-25" name="__codelineno-12-25" href="#__codelineno-12-25"></a>
<a id="__codelineno-12-26" name="__codelineno-12-26" href="#__codelineno-12-26"></a><span class="c1">// Drawing the square using indices</span>
<a id="__codelineno-12-27" name="__codelineno-12-27" href="#__codelineno-12-27"></a><span class="n">glDrawElements</span><span class="p">(</span><span class="n">GL_TRIANGLES</span><span class="p">,</span><span class="w"> </span><span class="mi">6</span><span class="p">,</span><span class="w"> </span><span class="n">GL_UNSIGNED_INT</span><span class="p">,</span><span class="w"> </span><span class="mi">0</span><span class="p">);</span>
</code></pre></div></p>
<h4 id="winding-order">Winding Order</h4>
<p>Winding order refers to the order in which vertices of a polygon are specified. The order determines the orientation of the face (i.e., which side is the front and which is the back).</p>
<p><strong>Types:</strong></p>
<ol>
<li><strong>Clockwise (CW):</strong> Vertices are specified in a clockwise order.</li>
<li><strong>Counter-Clockwise (CCW):</strong> Vertices are specified in a counter-clockwise order.</li>
</ol>
<p><strong>Purpose:</strong></p>
<ul>
<li><strong>Face Orientation:</strong> Winding order is used to determine the orientation of the face. This is crucial for correctly displaying the front and back faces of polygons.</li>
<li><strong>Back Face Culling:</strong> By defining a consistent winding order, the graphics pipeline can perform back face culling to improve performance by not rendering faces that are not visible to the camera.</li>
</ul>
<p><strong>Example:</strong>
<div class="highlight"><pre><span></span><code><a id="__codelineno-13-1" name="__codelineno-13-1" href="#__codelineno-13-1"></a><span class="c1">// Define vertices for a triangle</span>
<a id="__codelineno-13-2" name="__codelineno-13-2" href="#__codelineno-13-2"></a><span class="n">GLfloat</span><span class="w"> </span><span class="n">vertices</span><span class="p">[]</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-13-3" name="__codelineno-13-3" href="#__codelineno-13-3"></a><span class="w">    </span><span class="mf">0.0f</span><span class="p">,</span><span class="w">  </span><span class="mf">0.5f</span><span class="p">,</span><span class="w"> </span><span class="mf">0.0f</span><span class="p">,</span><span class="w">  </span><span class="c1">// Vertex 0</span>
<a id="__codelineno-13-4" name="__codelineno-13-4" href="#__codelineno-13-4"></a><span class="w">    </span><span class="mf">-0.5f</span><span class="p">,</span><span class="w"> </span><span class="mf">-0.5f</span><span class="p">,</span><span class="w"> </span><span class="mf">0.0f</span><span class="p">,</span><span class="w"> </span><span class="c1">// Vertex 1</span>
<a id="__codelineno-13-5" name="__codelineno-13-5" href="#__codelineno-13-5"></a><span class="w">    </span><span class="mf">0.5f</span><span class="p">,</span><span class="w"> </span><span class="mf">-0.5f</span><span class="p">,</span><span class="w"> </span><span class="mf">0.0f</span><span class="w">   </span><span class="c1">// Vertex 2</span>
<a id="__codelineno-13-6" name="__codelineno-13-6" href="#__codelineno-13-6"></a><span class="p">};</span>
<a id="__codelineno-13-7" name="__codelineno-13-7" href="#__codelineno-13-7"></a>
<a id="__codelineno-13-8" name="__codelineno-13-8" href="#__codelineno-13-8"></a><span class="c1">// Counter-clockwise winding order</span>
<a id="__codelineno-13-9" name="__codelineno-13-9" href="#__codelineno-13-9"></a><span class="n">GLuint</span><span class="w"> </span><span class="n">indicesCCW</span><span class="p">[]</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-13-10" name="__codelineno-13-10" href="#__codelineno-13-10"></a><span class="w">    </span><span class="mi">0</span><span class="p">,</span><span class="w"> </span><span class="mi">1</span><span class="p">,</span><span class="w"> </span><span class="mi">2</span>
<a id="__codelineno-13-11" name="__codelineno-13-11" href="#__codelineno-13-11"></a><span class="p">};</span>
<a id="__codelineno-13-12" name="__codelineno-13-12" href="#__codelineno-13-12"></a>
<a id="__codelineno-13-13" name="__codelineno-13-13" href="#__codelineno-13-13"></a><span class="c1">// Clockwise winding order</span>
<a id="__codelineno-13-14" name="__codelineno-13-14" href="#__codelineno-13-14"></a><span class="n">GLuint</span><span class="w"> </span><span class="n">indicesCW</span><span class="p">[]</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-13-15" name="__codelineno-13-15" href="#__codelineno-13-15"></a><span class="w">    </span><span class="mi">0</span><span class="p">,</span><span class="w"> </span><span class="mi">2</span><span class="p">,</span><span class="w"> </span><span class="mi">1</span>
<a id="__codelineno-13-16" name="__codelineno-13-16" href="#__codelineno-13-16"></a><span class="p">};</span>
<a id="__codelineno-13-17" name="__codelineno-13-17" href="#__codelineno-13-17"></a>
<a id="__codelineno-13-18" name="__codelineno-13-18" href="#__codelineno-13-18"></a><span class="c1">// OpenGL default is counter-clockwise</span>
<a id="__codelineno-13-19" name="__codelineno-13-19" href="#__codelineno-13-19"></a><span class="n">glFrontFace</span><span class="p">(</span><span class="n">GL_CCW</span><span class="p">);</span>
</code></pre></div></p>
<h4 id="back-face-culling">Back Face Culling</h4>
<p>Back face culling is a technique used in 3D graphics to improve rendering performance by not drawing faces of polygons that are facing away from the camera.</p>
<p><strong>Purpose:</strong></p>
<ul>
<li><strong>Performance Optimization:</strong> By not rendering faces that are not visible, back face culling reduces the number of draw calls and the amount of processing required, leading to improved rendering performance.</li>
<li><strong>Hidden Surface Removal:</strong> It helps in removing hidden surfaces, ensuring that only the visible parts of objects are rendered, which reduces the load on the GPU.</li>
</ul>
<p><strong>Implementation:</strong></p>
<ul>
<li>The graphics pipeline determines whether a face is front-facing or back-facing based on the winding order and the camera's orientation.</li>
<li>Faces with vertices ordered according to the defined front face (e.g., counter-clockwise) are considered front-facing.</li>
<li>Back face culling can be enabled or disabled depending on the needs of the application.</li>
</ul>
<p><strong>Example:</strong>
<div class="highlight"><pre><span></span><code><a id="__codelineno-14-1" name="__codelineno-14-1" href="#__codelineno-14-1"></a><span class="c1">// Enable back face culling</span>
<a id="__codelineno-14-2" name="__codelineno-14-2" href="#__codelineno-14-2"></a><span class="n">glEnable</span><span class="p">(</span><span class="n">GL_CULL_FACE</span><span class="p">);</span>
<a id="__codelineno-14-3" name="__codelineno-14-3" href="#__codelineno-14-3"></a>
<a id="__codelineno-14-4" name="__codelineno-14-4" href="#__codelineno-14-4"></a><span class="c1">// Set the face to be culled (GL_BACK means back faces will be culled)</span>
<a id="__codelineno-14-5" name="__codelineno-14-5" href="#__codelineno-14-5"></a><span class="n">glCullFace</span><span class="p">(</span><span class="n">GL_BACK</span><span class="p">);</span>
<a id="__codelineno-14-6" name="__codelineno-14-6" href="#__codelineno-14-6"></a>
<a id="__codelineno-14-7" name="__codelineno-14-7" href="#__codelineno-14-7"></a><span class="c1">// Specify the front face winding order (GL_CCW for counter-clockwise)</span>
<a id="__codelineno-14-8" name="__codelineno-14-8" href="#__codelineno-14-8"></a><span class="n">glFrontFace</span><span class="p">(</span><span class="n">GL_CCW</span><span class="p">);</span>
</code></pre></div></p>
<p><strong>Visualization:</strong></p>
<p>Imagine a cube. If back face culling is enabled, the faces of the cube that are not visible to the camera (those facing away) will not be rendered. This optimization significantly reduces the number of faces the GPU needs to process.</p>
<p>By understanding and implementing indices, winding order, and back face culling, programmers can create more efficient and optimized 3D graphics applications. These techniques are fundamental in ensuring that 3D models are rendered correctly and efficiently, improving both performance and visual quality.</p>
<h2 id="graphics-pipeline">Graphics Pipeline</h2>
<p>The graphics pipeline is a crucial concept in game development, describing the series of steps that transform 3D scene data into a 2D image on the screen. Understanding this pipeline is essential for optimizing game performance and achieving desired visual effects.</p>
<h3 id="overview-of-the-pipeline-stages">Overview of the Pipeline Stages</h3>
<ol>
<li>
<p><strong>Application Stage</strong></p>
<ul>
<li>CPU-side operations</li>
<li>Scene management and culling</li>
<li>Animation updates</li>
<li>Physics calculations</li>
</ul>
</li>
<li>
<p><strong>Geometry Processing</strong></p>
<ul>
<li>Vertex Shader</li>
<li>Tessellation (optional)</li>
<li>Geometry Shader (optional)</li>
</ul>
</li>
<li>
<p><strong>Rasterization</strong></p>
<ul>
<li>Triangle setup and rasterization</li>
<li>Fragment generation</li>
</ul>
</li>
<li>
<p><strong>Pixel Processing</strong></p>
<ul>
<li>Fragment Shader</li>
<li>Per-sample operations</li>
</ul>
</li>
<li>
<p><strong>Output Merger</strong></p>
<ul>
<li>Depth and stencil testing</li>
<li>Blending</li>
<li>Output to render target</li>
</ul>
</li>
</ol>
<h3 id="detailed-breakdown">Detailed Breakdown</h3>
<h4 id="1-application-stage">1. Application Stage</h4>
<ul>
<li><strong>Scene Graph Management</strong>: Organize and update the hierarchical structure of game objects.</li>
<li><strong>Frustum Culling</strong>: Determine which objects are visible within the camera's field of view.</li>
<li><strong>Level of Detail (LOD) Selection</strong>: Choose appropriate model detail based on distance from the camera.</li>
<li><strong>Animation Updates</strong>: Calculate skeletal animations, particle systems, etc.</li>
<li><strong>Physics Simulations</strong>: Update object positions and velocities based on physics calculations.</li>
</ul>
<h4 id="2-geometry-processing">2. Geometry Processing</h4>
<ul>
<li><strong>Vertex Shader</strong>:<ul>
<li>Transform vertex positions from object space to clip space.</li>
<li>Calculate vertex lighting, if using per-vertex lighting.</li>
<li>Pass data to later stages (e.g., texture coordinates, normals).</li>
</ul>
</li>
</ul>
<p>Example Vertex Shader (GLSL):
  <div class="highlight"><pre><span></span><code><a id="__codelineno-15-1" name="__codelineno-15-1" href="#__codelineno-15-1"></a><span class="cp">#version 330 core</span>
<a id="__codelineno-15-2" name="__codelineno-15-2" href="#__codelineno-15-2"></a><span class="k">layout</span><span class="w"> </span><span class="p">(</span><span class="n">location</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mo">0</span><span class="p">)</span><span class="w"> </span><span class="k">in</span><span class="w"> </span><span class="kt">vec3</span><span class="w"> </span><span class="n">aPos</span><span class="p">;</span>
<a id="__codelineno-15-3" name="__codelineno-15-3" href="#__codelineno-15-3"></a><span class="k">layout</span><span class="w"> </span><span class="p">(</span><span class="n">location</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">1</span><span class="p">)</span><span class="w"> </span><span class="k">in</span><span class="w"> </span><span class="kt">vec2</span><span class="w"> </span><span class="n">aTexCoord</span><span class="p">;</span>
<a id="__codelineno-15-4" name="__codelineno-15-4" href="#__codelineno-15-4"></a>
<a id="__codelineno-15-5" name="__codelineno-15-5" href="#__codelineno-15-5"></a><span class="k">uniform</span><span class="w"> </span><span class="kt">mat4</span><span class="w"> </span><span class="n">model</span><span class="p">;</span>
<a id="__codelineno-15-6" name="__codelineno-15-6" href="#__codelineno-15-6"></a><span class="k">uniform</span><span class="w"> </span><span class="kt">mat4</span><span class="w"> </span><span class="n">view</span><span class="p">;</span>
<a id="__codelineno-15-7" name="__codelineno-15-7" href="#__codelineno-15-7"></a><span class="k">uniform</span><span class="w"> </span><span class="kt">mat4</span><span class="w"> </span><span class="n">projection</span><span class="p">;</span>
<a id="__codelineno-15-8" name="__codelineno-15-8" href="#__codelineno-15-8"></a>
<a id="__codelineno-15-9" name="__codelineno-15-9" href="#__codelineno-15-9"></a><span class="k">out</span><span class="w"> </span><span class="kt">vec2</span><span class="w"> </span><span class="n">TexCoord</span><span class="p">;</span>
<a id="__codelineno-15-10" name="__codelineno-15-10" href="#__codelineno-15-10"></a>
<a id="__codelineno-15-11" name="__codelineno-15-11" href="#__codelineno-15-11"></a><span class="kt">void</span><span class="w"> </span><span class="n">main</span><span class="p">()</span>
<a id="__codelineno-15-12" name="__codelineno-15-12" href="#__codelineno-15-12"></a><span class="p">{</span>
<a id="__codelineno-15-13" name="__codelineno-15-13" href="#__codelineno-15-13"></a><span class="w">    </span><span class="nb">gl_Position</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">projection</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="n">view</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="n">model</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="kt">vec4</span><span class="p">(</span><span class="n">aPos</span><span class="p">,</span><span class="w"> </span><span class="mf">1.0</span><span class="p">);</span>
<a id="__codelineno-15-14" name="__codelineno-15-14" href="#__codelineno-15-14"></a><span class="w">    </span><span class="n">TexCoord</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">aTexCoord</span><span class="p">;</span>
<a id="__codelineno-15-15" name="__codelineno-15-15" href="#__codelineno-15-15"></a><span class="p">}</span>
</code></pre></div></p>
<ul>
<li>
<p><strong>Tessellation</strong> (Optional):</p>
<ul>
<li>Subdivide geometry for increased detail.</li>
<li>Useful for dynamic level of detail and displacement mapping.</li>
</ul>
</li>
<li>
<p><strong>Geometry Shader</strong> (Optional):</p>
<ul>
<li>Create or modify geometry on the GPU.</li>
<li>Useful for particle systems, fur generation, etc.</li>
</ul>
</li>
</ul>
<h4 id="3-rasterization">3. Rasterization</h4>
<ul>
<li>Convert 3D primitives (usually triangles) into 2D fragments.</li>
<li>Perform perspective-correct interpolation of vertex attributes.</li>
<li>Apply scissor testing and viewport transformation.</li>
</ul>
<h4 id="4-pixel-processing">4. Pixel Processing</h4>
<ul>
<li><strong>Fragment Shader</strong>:<ul>
<li>Determine the color of each fragment.</li>
<li>Apply texturing, lighting calculations, and other effects.</li>
</ul>
</li>
</ul>
<p>Example Fragment Shader (GLSL):
  <div class="highlight"><pre><span></span><code><a id="__codelineno-16-1" name="__codelineno-16-1" href="#__codelineno-16-1"></a><span class="cp">#version 330 core</span>
<a id="__codelineno-16-2" name="__codelineno-16-2" href="#__codelineno-16-2"></a><span class="k">in</span><span class="w"> </span><span class="kt">vec2</span><span class="w"> </span><span class="n">TexCoord</span><span class="p">;</span>
<a id="__codelineno-16-3" name="__codelineno-16-3" href="#__codelineno-16-3"></a><span class="k">out</span><span class="w"> </span><span class="kt">vec4</span><span class="w"> </span><span class="n">FragColor</span><span class="p">;</span>
<a id="__codelineno-16-4" name="__codelineno-16-4" href="#__codelineno-16-4"></a>
<a id="__codelineno-16-5" name="__codelineno-16-5" href="#__codelineno-16-5"></a><span class="k">uniform</span><span class="w"> </span><span class="kt">sampler2D</span><span class="w"> </span><span class="n">ourTexture</span><span class="p">;</span>
<a id="__codelineno-16-6" name="__codelineno-16-6" href="#__codelineno-16-6"></a>
<a id="__codelineno-16-7" name="__codelineno-16-7" href="#__codelineno-16-7"></a><span class="kt">void</span><span class="w"> </span><span class="n">main</span><span class="p">()</span>
<a id="__codelineno-16-8" name="__codelineno-16-8" href="#__codelineno-16-8"></a><span class="p">{</span>
<a id="__codelineno-16-9" name="__codelineno-16-9" href="#__codelineno-16-9"></a><span class="w">    </span><span class="n">FragColor</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">texture</span><span class="p">(</span><span class="n">ourTexture</span><span class="p">,</span><span class="w"> </span><span class="n">TexCoord</span><span class="p">);</span>
<a id="__codelineno-16-10" name="__codelineno-16-10" href="#__codelineno-16-10"></a><span class="p">}</span>
</code></pre></div></p>
<ul>
<li><strong>Per-Sample Operations</strong>:<ul>
<li>Early depth and stencil tests (if enabled).</li>
<li>Alpha test (if using alpha cutout techniques).</li>
</ul>
</li>
</ul>
<h4 id="5-output-merger">5. Output Merger</h4>
<ul>
<li>Perform depth and stencil testing.</li>
<li>Apply blending for transparent objects.</li>
<li>Write final color to the framebuffer or render target.</li>
</ul>
<h2 id="pipeline-optimizations-for-game-development">Pipeline Optimizations for Game Development</h2>
<h3 id="batching">Batching</h3>
<p>Batching is an optimization technique used in game rendering to reduce the number of draw calls sent to the GPU. By combining multiple similar objects into a single draw call, batching significantly improves rendering performance, especially in scenes with many objects.</p>
<h4 id="implementation-overview">Implementation Overview</h4>
<p>We'll implement a batching system that groups objects with the same material and combines their geometry into larger buffers. This system will support both static and dynamic batching, with the ability to update dynamic batches each frame.</p>
<p>Key Components:</p>
<ol>
<li>Batch manager</li>
<li>Static batch generation</li>
<li>Dynamic batch updating</li>
<li>Render queue integration</li>
</ol>
<p>C++ implementation:</p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-17-1" name="__codelineno-17-1" href="#__codelineno-17-1"></a><span class="c1">// BatchingSystem.h</span>
<a id="__codelineno-17-2" name="__codelineno-17-2" href="#__codelineno-17-2"></a><span class="cp">#pragma once</span>
<a id="__codelineno-17-3" name="__codelineno-17-3" href="#__codelineno-17-3"></a>
<a id="__codelineno-17-4" name="__codelineno-17-4" href="#__codelineno-17-4"></a><span class="cp">#include</span><span class="w"> </span><span class="cpf">&quot;RenderSystem.h&quot;</span>
<a id="__codelineno-17-5" name="__codelineno-17-5" href="#__codelineno-17-5"></a><span class="cp">#include</span><span class="w"> </span><span class="cpf">&quot;Mesh.h&quot;</span>
<a id="__codelineno-17-6" name="__codelineno-17-6" href="#__codelineno-17-6"></a><span class="cp">#include</span><span class="w"> </span><span class="cpf">&quot;Material.h&quot;</span>
<a id="__codelineno-17-7" name="__codelineno-17-7" href="#__codelineno-17-7"></a><span class="cp">#include</span><span class="w"> </span><span class="cpf">&quot;Transform.h&quot;</span>
<a id="__codelineno-17-8" name="__codelineno-17-8" href="#__codelineno-17-8"></a>
<a id="__codelineno-17-9" name="__codelineno-17-9" href="#__codelineno-17-9"></a><span class="k">struct</span><span class="w"> </span><span class="nc">BatchInstance</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-17-10" name="__codelineno-17-10" href="#__codelineno-17-10"></a><span class="w">    </span><span class="n">Matrix4x4</span><span class="w"> </span><span class="n">transform</span><span class="p">;</span>
<a id="__codelineno-17-11" name="__codelineno-17-11" href="#__codelineno-17-11"></a><span class="w">    </span><span class="c1">// Additional per-instance data (e.g., color, custom parameters)</span>
<a id="__codelineno-17-12" name="__codelineno-17-12" href="#__codelineno-17-12"></a><span class="p">};</span>
<a id="__codelineno-17-13" name="__codelineno-17-13" href="#__codelineno-17-13"></a>
<a id="__codelineno-17-14" name="__codelineno-17-14" href="#__codelineno-17-14"></a><span class="k">class</span><span class="w"> </span><span class="nc">Batch</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-17-15" name="__codelineno-17-15" href="#__codelineno-17-15"></a><span class="k">public</span><span class="o">:</span>
<a id="__codelineno-17-16" name="__codelineno-17-16" href="#__codelineno-17-16"></a><span class="w">    </span><span class="n">Batch</span><span class="p">(</span><span class="k">const</span><span class="w"> </span><span class="n">Mesh</span><span class="o">*</span><span class="w"> </span><span class="n">mesh</span><span class="p">,</span><span class="w"> </span><span class="k">const</span><span class="w"> </span><span class="n">Material</span><span class="o">*</span><span class="w"> </span><span class="n">material</span><span class="p">);</span>
<a id="__codelineno-17-17" name="__codelineno-17-17" href="#__codelineno-17-17"></a><span class="w">    </span><span class="kt">void</span><span class="w"> </span><span class="nf">AddInstance</span><span class="p">(</span><span class="k">const</span><span class="w"> </span><span class="n">BatchInstance</span><span class="o">&amp;</span><span class="w"> </span><span class="n">instance</span><span class="p">);</span>
<a id="__codelineno-17-18" name="__codelineno-17-18" href="#__codelineno-17-18"></a><span class="w">    </span><span class="kt">void</span><span class="w"> </span><span class="nf">UpdateInstanceData</span><span class="p">();</span>
<a id="__codelineno-17-19" name="__codelineno-17-19" href="#__codelineno-17-19"></a><span class="w">    </span><span class="kt">void</span><span class="w"> </span><span class="nf">Render</span><span class="p">(</span><span class="n">RenderSystem</span><span class="o">*</span><span class="w"> </span><span class="n">renderSystem</span><span class="p">);</span>
<a id="__codelineno-17-20" name="__codelineno-17-20" href="#__codelineno-17-20"></a>
<a id="__codelineno-17-21" name="__codelineno-17-21" href="#__codelineno-17-21"></a><span class="k">private</span><span class="o">:</span>
<a id="__codelineno-17-22" name="__codelineno-17-22" href="#__codelineno-17-22"></a><span class="w">    </span><span class="k">const</span><span class="w"> </span><span class="n">Mesh</span><span class="o">*</span><span class="w"> </span><span class="n">m_Mesh</span><span class="p">;</span>
<a id="__codelineno-17-23" name="__codelineno-17-23" href="#__codelineno-17-23"></a><span class="w">    </span><span class="k">const</span><span class="w"> </span><span class="n">Material</span><span class="o">*</span><span class="w"> </span><span class="n">m_Material</span><span class="p">;</span>
<a id="__codelineno-17-24" name="__codelineno-17-24" href="#__codelineno-17-24"></a><span class="w">    </span><span class="n">std</span><span class="o">::</span><span class="n">vector</span><span class="o">&lt;</span><span class="n">BatchInstance</span><span class="o">&gt;</span><span class="w"> </span><span class="n">m_Instances</span><span class="p">;</span>
<a id="__codelineno-17-25" name="__codelineno-17-25" href="#__codelineno-17-25"></a><span class="w">    </span><span class="n">VertexBuffer</span><span class="w"> </span><span class="n">m_InstanceBuffer</span><span class="p">;</span>
<a id="__codelineno-17-26" name="__codelineno-17-26" href="#__codelineno-17-26"></a><span class="p">};</span>
<a id="__codelineno-17-27" name="__codelineno-17-27" href="#__codelineno-17-27"></a>
<a id="__codelineno-17-28" name="__codelineno-17-28" href="#__codelineno-17-28"></a><span class="k">class</span><span class="w"> </span><span class="nc">BatchingSystem</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-17-29" name="__codelineno-17-29" href="#__codelineno-17-29"></a><span class="k">public</span><span class="o">:</span>
<a id="__codelineno-17-30" name="__codelineno-17-30" href="#__codelineno-17-30"></a><span class="w">    </span><span class="n">BatchingSystem</span><span class="p">(</span><span class="n">RenderSystem</span><span class="o">*</span><span class="w"> </span><span class="n">renderSystem</span><span class="p">);</span>
<a id="__codelineno-17-31" name="__codelineno-17-31" href="#__codelineno-17-31"></a><span class="w">    </span><span class="o">~</span><span class="n">BatchingSystem</span><span class="p">();</span>
<a id="__codelineno-17-32" name="__codelineno-17-32" href="#__codelineno-17-32"></a>
<a id="__codelineno-17-33" name="__codelineno-17-33" href="#__codelineno-17-33"></a><span class="w">    </span><span class="kt">void</span><span class="w"> </span><span class="nf">AddStaticObject</span><span class="p">(</span><span class="k">const</span><span class="w"> </span><span class="n">Mesh</span><span class="o">*</span><span class="w"> </span><span class="n">mesh</span><span class="p">,</span><span class="w"> </span><span class="k">const</span><span class="w"> </span><span class="n">Material</span><span class="o">*</span><span class="w"> </span><span class="n">material</span><span class="p">,</span><span class="w"> </span><span class="k">const</span><span class="w"> </span><span class="n">Transform</span><span class="o">&amp;</span><span class="w"> </span><span class="n">transform</span><span class="p">);</span>
<a id="__codelineno-17-34" name="__codelineno-17-34" href="#__codelineno-17-34"></a><span class="w">    </span><span class="kt">void</span><span class="w"> </span><span class="nf">AddDynamicObject</span><span class="p">(</span><span class="k">const</span><span class="w"> </span><span class="n">Mesh</span><span class="o">*</span><span class="w"> </span><span class="n">mesh</span><span class="p">,</span><span class="w"> </span><span class="k">const</span><span class="w"> </span><span class="n">Material</span><span class="o">*</span><span class="w"> </span><span class="n">material</span><span class="p">,</span><span class="w"> </span><span class="k">const</span><span class="w"> </span><span class="n">Transform</span><span class="o">&amp;</span><span class="w"> </span><span class="n">transform</span><span class="p">);</span>
<a id="__codelineno-17-35" name="__codelineno-17-35" href="#__codelineno-17-35"></a><span class="w">    </span><span class="kt">void</span><span class="w"> </span><span class="nf">UpdateDynamicObjects</span><span class="p">();</span>
<a id="__codelineno-17-36" name="__codelineno-17-36" href="#__codelineno-17-36"></a><span class="w">    </span><span class="kt">void</span><span class="w"> </span><span class="nf">Render</span><span class="p">();</span>
<a id="__codelineno-17-37" name="__codelineno-17-37" href="#__codelineno-17-37"></a>
<a id="__codelineno-17-38" name="__codelineno-17-38" href="#__codelineno-17-38"></a><span class="k">private</span><span class="o">:</span>
<a id="__codelineno-17-39" name="__codelineno-17-39" href="#__codelineno-17-39"></a><span class="w">    </span><span class="kt">void</span><span class="w"> </span><span class="n">GenerateStaticBatches</span><span class="p">();</span>
<a id="__codelineno-17-40" name="__codelineno-17-40" href="#__codelineno-17-40"></a><span class="w">    </span><span class="n">Batch</span><span class="o">*</span><span class="w"> </span><span class="nf">FindOrCreateBatch</span><span class="p">(</span><span class="k">const</span><span class="w"> </span><span class="n">Mesh</span><span class="o">*</span><span class="w"> </span><span class="n">mesh</span><span class="p">,</span><span class="w"> </span><span class="k">const</span><span class="w"> </span><span class="n">Material</span><span class="o">*</span><span class="w"> </span><span class="n">material</span><span class="p">,</span><span class="w"> </span><span class="kt">bool</span><span class="w"> </span><span class="n">isStatic</span><span class="p">);</span>
<a id="__codelineno-17-41" name="__codelineno-17-41" href="#__codelineno-17-41"></a>
<a id="__codelineno-17-42" name="__codelineno-17-42" href="#__codelineno-17-42"></a><span class="w">    </span><span class="n">RenderSystem</span><span class="o">*</span><span class="w"> </span><span class="n">m_RenderSystem</span><span class="p">;</span>
<a id="__codelineno-17-43" name="__codelineno-17-43" href="#__codelineno-17-43"></a><span class="w">    </span><span class="n">std</span><span class="o">::</span><span class="n">vector</span><span class="o">&lt;</span><span class="n">Batch</span><span class="o">*&gt;</span><span class="w"> </span><span class="n">m_StaticBatches</span><span class="p">;</span>
<a id="__codelineno-17-44" name="__codelineno-17-44" href="#__codelineno-17-44"></a><span class="w">    </span><span class="n">std</span><span class="o">::</span><span class="n">vector</span><span class="o">&lt;</span><span class="n">Batch</span><span class="o">*&gt;</span><span class="w"> </span><span class="n">m_DynamicBatches</span><span class="p">;</span>
<a id="__codelineno-17-45" name="__codelineno-17-45" href="#__codelineno-17-45"></a><span class="w">    </span><span class="n">std</span><span class="o">::</span><span class="n">unordered_map</span><span class="o">&lt;</span><span class="kt">uint64_t</span><span class="p">,</span><span class="w"> </span><span class="n">Batch</span><span class="o">*&gt;</span><span class="w"> </span><span class="n">m_BatchMap</span><span class="p">;</span>
<a id="__codelineno-17-46" name="__codelineno-17-46" href="#__codelineno-17-46"></a><span class="p">};</span>
<a id="__codelineno-17-47" name="__codelineno-17-47" href="#__codelineno-17-47"></a>
<a id="__codelineno-17-48" name="__codelineno-17-48" href="#__codelineno-17-48"></a><span class="c1">// BatchingSystem.cpp</span>
<a id="__codelineno-17-49" name="__codelineno-17-49" href="#__codelineno-17-49"></a><span class="cp">#include</span><span class="w"> </span><span class="cpf">&quot;BatchingSystem.h&quot;</span>
<a id="__codelineno-17-50" name="__codelineno-17-50" href="#__codelineno-17-50"></a>
<a id="__codelineno-17-51" name="__codelineno-17-51" href="#__codelineno-17-51"></a><span class="n">BatchingSystem</span><span class="o">::</span><span class="n">BatchingSystem</span><span class="p">(</span><span class="n">RenderSystem</span><span class="o">*</span><span class="w"> </span><span class="n">renderSystem</span><span class="p">)</span>
<a id="__codelineno-17-52" name="__codelineno-17-52" href="#__codelineno-17-52"></a><span class="w">    </span><span class="o">:</span><span class="w"> </span><span class="n">m_RenderSystem</span><span class="p">(</span><span class="n">renderSystem</span><span class="p">)</span><span class="w"> </span><span class="p">{}</span>
<a id="__codelineno-17-53" name="__codelineno-17-53" href="#__codelineno-17-53"></a>
<a id="__codelineno-17-54" name="__codelineno-17-54" href="#__codelineno-17-54"></a><span class="kt">void</span><span class="w"> </span><span class="n">BatchingSystem</span><span class="o">::</span><span class="n">AddStaticObject</span><span class="p">(</span><span class="k">const</span><span class="w"> </span><span class="n">Mesh</span><span class="o">*</span><span class="w"> </span><span class="n">mesh</span><span class="p">,</span><span class="w"> </span><span class="k">const</span><span class="w"> </span><span class="n">Material</span><span class="o">*</span><span class="w"> </span><span class="n">material</span><span class="p">,</span><span class="w"> </span><span class="k">const</span><span class="w"> </span><span class="n">Transform</span><span class="o">&amp;</span><span class="w"> </span><span class="n">transform</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-17-55" name="__codelineno-17-55" href="#__codelineno-17-55"></a><span class="w">    </span><span class="n">Batch</span><span class="o">*</span><span class="w"> </span><span class="n">batch</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">FindOrCreateBatch</span><span class="p">(</span><span class="n">mesh</span><span class="p">,</span><span class="w"> </span><span class="n">material</span><span class="p">,</span><span class="w"> </span><span class="nb">true</span><span class="p">);</span>
<a id="__codelineno-17-56" name="__codelineno-17-56" href="#__codelineno-17-56"></a><span class="w">    </span><span class="n">BatchInstance</span><span class="w"> </span><span class="n">instance</span><span class="p">;</span>
<a id="__codelineno-17-57" name="__codelineno-17-57" href="#__codelineno-17-57"></a><span class="w">    </span><span class="n">instance</span><span class="p">.</span><span class="n">transform</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">transform</span><span class="p">.</span><span class="n">GetMatrix</span><span class="p">();</span>
<a id="__codelineno-17-58" name="__codelineno-17-58" href="#__codelineno-17-58"></a><span class="w">    </span><span class="n">batch</span><span class="o">-&gt;</span><span class="n">AddInstance</span><span class="p">(</span><span class="n">instance</span><span class="p">);</span>
<a id="__codelineno-17-59" name="__codelineno-17-59" href="#__codelineno-17-59"></a><span class="p">}</span>
<a id="__codelineno-17-60" name="__codelineno-17-60" href="#__codelineno-17-60"></a>
<a id="__codelineno-17-61" name="__codelineno-17-61" href="#__codelineno-17-61"></a><span class="kt">void</span><span class="w"> </span><span class="n">BatchingSystem</span><span class="o">::</span><span class="n">AddDynamicObject</span><span class="p">(</span><span class="k">const</span><span class="w"> </span><span class="n">Mesh</span><span class="o">*</span><span class="w"> </span><span class="n">mesh</span><span class="p">,</span><span class="w"> </span><span class="k">const</span><span class="w"> </span><span class="n">Material</span><span class="o">*</span><span class="w"> </span><span class="n">material</span><span class="p">,</span><span class="w"> </span><span class="k">const</span><span class="w"> </span><span class="n">Transform</span><span class="o">&amp;</span><span class="w"> </span><span class="n">transform</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-17-62" name="__codelineno-17-62" href="#__codelineno-17-62"></a><span class="w">    </span><span class="n">Batch</span><span class="o">*</span><span class="w"> </span><span class="n">batch</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">FindOrCreateBatch</span><span class="p">(</span><span class="n">mesh</span><span class="p">,</span><span class="w"> </span><span class="n">material</span><span class="p">,</span><span class="w"> </span><span class="nb">false</span><span class="p">);</span>
<a id="__codelineno-17-63" name="__codelineno-17-63" href="#__codelineno-17-63"></a><span class="w">    </span><span class="n">BatchInstance</span><span class="w"> </span><span class="n">instance</span><span class="p">;</span>
<a id="__codelineno-17-64" name="__codelineno-17-64" href="#__codelineno-17-64"></a><span class="w">    </span><span class="n">instance</span><span class="p">.</span><span class="n">transform</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">transform</span><span class="p">.</span><span class="n">GetMatrix</span><span class="p">();</span>
<a id="__codelineno-17-65" name="__codelineno-17-65" href="#__codelineno-17-65"></a><span class="w">    </span><span class="n">batch</span><span class="o">-&gt;</span><span class="n">AddInstance</span><span class="p">(</span><span class="n">instance</span><span class="p">);</span>
<a id="__codelineno-17-66" name="__codelineno-17-66" href="#__codelineno-17-66"></a><span class="p">}</span>
<a id="__codelineno-17-67" name="__codelineno-17-67" href="#__codelineno-17-67"></a>
<a id="__codelineno-17-68" name="__codelineno-17-68" href="#__codelineno-17-68"></a><span class="kt">void</span><span class="w"> </span><span class="n">BatchingSystem</span><span class="o">::</span><span class="n">UpdateDynamicObjects</span><span class="p">()</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-17-69" name="__codelineno-17-69" href="#__codelineno-17-69"></a><span class="w">    </span><span class="k">for</span><span class="w"> </span><span class="p">(</span><span class="n">Batch</span><span class="o">*</span><span class="w"> </span><span class="n">batch</span><span class="w"> </span><span class="o">:</span><span class="w"> </span><span class="n">m_DynamicBatches</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-17-70" name="__codelineno-17-70" href="#__codelineno-17-70"></a><span class="w">        </span><span class="n">batch</span><span class="o">-&gt;</span><span class="n">UpdateInstanceData</span><span class="p">();</span>
<a id="__codelineno-17-71" name="__codelineno-17-71" href="#__codelineno-17-71"></a><span class="w">    </span><span class="p">}</span>
<a id="__codelineno-17-72" name="__codelineno-17-72" href="#__codelineno-17-72"></a><span class="p">}</span>
<a id="__codelineno-17-73" name="__codelineno-17-73" href="#__codelineno-17-73"></a>
<a id="__codelineno-17-74" name="__codelineno-17-74" href="#__codelineno-17-74"></a><span class="kt">void</span><span class="w"> </span><span class="n">BatchingSystem</span><span class="o">::</span><span class="n">Render</span><span class="p">()</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-17-75" name="__codelineno-17-75" href="#__codelineno-17-75"></a><span class="w">    </span><span class="k">for</span><span class="w"> </span><span class="p">(</span><span class="n">Batch</span><span class="o">*</span><span class="w"> </span><span class="n">batch</span><span class="w"> </span><span class="o">:</span><span class="w"> </span><span class="n">m_StaticBatches</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-17-76" name="__codelineno-17-76" href="#__codelineno-17-76"></a><span class="w">        </span><span class="n">batch</span><span class="o">-&gt;</span><span class="n">Render</span><span class="p">(</span><span class="n">m_RenderSystem</span><span class="p">);</span>
<a id="__codelineno-17-77" name="__codelineno-17-77" href="#__codelineno-17-77"></a><span class="w">    </span><span class="p">}</span>
<a id="__codelineno-17-78" name="__codelineno-17-78" href="#__codelineno-17-78"></a><span class="w">    </span><span class="k">for</span><span class="w"> </span><span class="p">(</span><span class="n">Batch</span><span class="o">*</span><span class="w"> </span><span class="n">batch</span><span class="w"> </span><span class="o">:</span><span class="w"> </span><span class="n">m_DynamicBatches</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-17-79" name="__codelineno-17-79" href="#__codelineno-17-79"></a><span class="w">        </span><span class="n">batch</span><span class="o">-&gt;</span><span class="n">Render</span><span class="p">(</span><span class="n">m_RenderSystem</span><span class="p">);</span>
<a id="__codelineno-17-80" name="__codelineno-17-80" href="#__codelineno-17-80"></a><span class="w">    </span><span class="p">}</span>
<a id="__codelineno-17-81" name="__codelineno-17-81" href="#__codelineno-17-81"></a><span class="p">}</span>
<a id="__codelineno-17-82" name="__codelineno-17-82" href="#__codelineno-17-82"></a>
<a id="__codelineno-17-83" name="__codelineno-17-83" href="#__codelineno-17-83"></a><span class="n">Batch</span><span class="o">*</span><span class="w"> </span><span class="n">BatchingSystem</span><span class="o">::</span><span class="n">FindOrCreateBatch</span><span class="p">(</span><span class="k">const</span><span class="w"> </span><span class="n">Mesh</span><span class="o">*</span><span class="w"> </span><span class="n">mesh</span><span class="p">,</span><span class="w"> </span><span class="k">const</span><span class="w"> </span><span class="n">Material</span><span class="o">*</span><span class="w"> </span><span class="n">material</span><span class="p">,</span><span class="w"> </span><span class="kt">bool</span><span class="w"> </span><span class="n">isStatic</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-17-84" name="__codelineno-17-84" href="#__codelineno-17-84"></a><span class="w">    </span><span class="kt">uint64_t</span><span class="w"> </span><span class="n">batchKey</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">reinterpret_cast</span><span class="o">&lt;</span><span class="kt">uint64_t</span><span class="o">&gt;</span><span class="p">(</span><span class="n">mesh</span><span class="p">)</span><span class="w"> </span><span class="o">^</span><span class="w"> </span><span class="k">reinterpret_cast</span><span class="o">&lt;</span><span class="kt">uint64_t</span><span class="o">&gt;</span><span class="p">(</span><span class="n">material</span><span class="p">);</span>
<a id="__codelineno-17-85" name="__codelineno-17-85" href="#__codelineno-17-85"></a><span class="w">    </span><span class="k">auto</span><span class="w"> </span><span class="n">it</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">m_BatchMap</span><span class="p">.</span><span class="n">find</span><span class="p">(</span><span class="n">batchKey</span><span class="p">);</span>
<a id="__codelineno-17-86" name="__codelineno-17-86" href="#__codelineno-17-86"></a><span class="w">    </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">it</span><span class="w"> </span><span class="o">!=</span><span class="w"> </span><span class="n">m_BatchMap</span><span class="p">.</span><span class="n">end</span><span class="p">())</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-17-87" name="__codelineno-17-87" href="#__codelineno-17-87"></a><span class="w">        </span><span class="k">return</span><span class="w"> </span><span class="n">it</span><span class="o">-&gt;</span><span class="n">second</span><span class="p">;</span>
<a id="__codelineno-17-88" name="__codelineno-17-88" href="#__codelineno-17-88"></a><span class="w">    </span><span class="p">}</span>
<a id="__codelineno-17-89" name="__codelineno-17-89" href="#__codelineno-17-89"></a>
<a id="__codelineno-17-90" name="__codelineno-17-90" href="#__codelineno-17-90"></a><span class="w">    </span><span class="n">Batch</span><span class="o">*</span><span class="w"> </span><span class="n">newBatch</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">new</span><span class="w"> </span><span class="n">Batch</span><span class="p">(</span><span class="n">mesh</span><span class="p">,</span><span class="w"> </span><span class="n">material</span><span class="p">);</span>
<a id="__codelineno-17-91" name="__codelineno-17-91" href="#__codelineno-17-91"></a><span class="w">    </span><span class="n">m_BatchMap</span><span class="p">[</span><span class="n">batchKey</span><span class="p">]</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">newBatch</span><span class="p">;</span>
<a id="__codelineno-17-92" name="__codelineno-17-92" href="#__codelineno-17-92"></a><span class="w">    </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">isStatic</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-17-93" name="__codelineno-17-93" href="#__codelineno-17-93"></a><span class="w">        </span><span class="n">m_StaticBatches</span><span class="p">.</span><span class="n">push_back</span><span class="p">(</span><span class="n">newBatch</span><span class="p">);</span>
<a id="__codelineno-17-94" name="__codelineno-17-94" href="#__codelineno-17-94"></a><span class="w">    </span><span class="p">}</span><span class="w"> </span><span class="k">else</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-17-95" name="__codelineno-17-95" href="#__codelineno-17-95"></a><span class="w">        </span><span class="n">m_DynamicBatches</span><span class="p">.</span><span class="n">push_back</span><span class="p">(</span><span class="n">newBatch</span><span class="p">);</span>
<a id="__codelineno-17-96" name="__codelineno-17-96" href="#__codelineno-17-96"></a><span class="w">    </span><span class="p">}</span>
<a id="__codelineno-17-97" name="__codelineno-17-97" href="#__codelineno-17-97"></a><span class="w">    </span><span class="k">return</span><span class="w"> </span><span class="n">newBatch</span><span class="p">;</span>
<a id="__codelineno-17-98" name="__codelineno-17-98" href="#__codelineno-17-98"></a><span class="p">}</span>
<a id="__codelineno-17-99" name="__codelineno-17-99" href="#__codelineno-17-99"></a>
<a id="__codelineno-17-100" name="__codelineno-17-100" href="#__codelineno-17-100"></a><span class="c1">// Batch implementation</span>
<a id="__codelineno-17-101" name="__codelineno-17-101" href="#__codelineno-17-101"></a><span class="n">Batch</span><span class="o">::</span><span class="n">Batch</span><span class="p">(</span><span class="k">const</span><span class="w"> </span><span class="n">Mesh</span><span class="o">*</span><span class="w"> </span><span class="n">mesh</span><span class="p">,</span><span class="w"> </span><span class="k">const</span><span class="w"> </span><span class="n">Material</span><span class="o">*</span><span class="w"> </span><span class="n">material</span><span class="p">)</span>
<a id="__codelineno-17-102" name="__codelineno-17-102" href="#__codelineno-17-102"></a><span class="w">    </span><span class="o">:</span><span class="w"> </span><span class="n">m_Mesh</span><span class="p">(</span><span class="n">mesh</span><span class="p">),</span><span class="w"> </span><span class="n">m_Material</span><span class="p">(</span><span class="n">material</span><span class="p">)</span><span class="w"> </span><span class="p">{}</span>
<a id="__codelineno-17-103" name="__codelineno-17-103" href="#__codelineno-17-103"></a>
<a id="__codelineno-17-104" name="__codelineno-17-104" href="#__codelineno-17-104"></a><span class="kt">void</span><span class="w"> </span><span class="n">Batch</span><span class="o">::</span><span class="n">AddInstance</span><span class="p">(</span><span class="k">const</span><span class="w"> </span><span class="n">BatchInstance</span><span class="o">&amp;</span><span class="w"> </span><span class="n">instance</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-17-105" name="__codelineno-17-105" href="#__codelineno-17-105"></a><span class="w">    </span><span class="n">m_Instances</span><span class="p">.</span><span class="n">push_back</span><span class="p">(</span><span class="n">instance</span><span class="p">);</span>
<a id="__codelineno-17-106" name="__codelineno-17-106" href="#__codelineno-17-106"></a><span class="p">}</span>
<a id="__codelineno-17-107" name="__codelineno-17-107" href="#__codelineno-17-107"></a>
<a id="__codelineno-17-108" name="__codelineno-17-108" href="#__codelineno-17-108"></a><span class="kt">void</span><span class="w"> </span><span class="n">Batch</span><span class="o">::</span><span class="n">UpdateInstanceData</span><span class="p">()</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-17-109" name="__codelineno-17-109" href="#__codelineno-17-109"></a><span class="w">    </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">m_Instances</span><span class="p">.</span><span class="n">empty</span><span class="p">())</span><span class="w"> </span><span class="k">return</span><span class="p">;</span>
<a id="__codelineno-17-110" name="__codelineno-17-110" href="#__codelineno-17-110"></a>
<a id="__codelineno-17-111" name="__codelineno-17-111" href="#__codelineno-17-111"></a><span class="w">    </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">m_InstanceBuffer</span><span class="p">.</span><span class="n">GetSize</span><span class="p">()</span><span class="w"> </span><span class="o">&lt;</span><span class="w"> </span><span class="n">m_Instances</span><span class="p">.</span><span class="n">size</span><span class="p">()</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="k">sizeof</span><span class="p">(</span><span class="n">BatchInstance</span><span class="p">))</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-17-112" name="__codelineno-17-112" href="#__codelineno-17-112"></a><span class="w">        </span><span class="n">m_InstanceBuffer</span><span class="p">.</span><span class="n">Create</span><span class="p">(</span><span class="k">sizeof</span><span class="p">(</span><span class="n">BatchInstance</span><span class="p">)</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="n">m_Instances</span><span class="p">.</span><span class="n">size</span><span class="p">(),</span><span class="w"> </span><span class="n">BufferUsage</span><span class="o">::</span><span class="n">Dynamic</span><span class="p">);</span>
<a id="__codelineno-17-113" name="__codelineno-17-113" href="#__codelineno-17-113"></a><span class="w">    </span><span class="p">}</span>
<a id="__codelineno-17-114" name="__codelineno-17-114" href="#__codelineno-17-114"></a>
<a id="__codelineno-17-115" name="__codelineno-17-115" href="#__codelineno-17-115"></a><span class="w">    </span><span class="n">m_InstanceBuffer</span><span class="p">.</span><span class="n">Update</span><span class="p">(</span><span class="n">m_Instances</span><span class="p">.</span><span class="n">data</span><span class="p">(),</span><span class="w"> </span><span class="n">m_Instances</span><span class="p">.</span><span class="n">size</span><span class="p">()</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="k">sizeof</span><span class="p">(</span><span class="n">BatchInstance</span><span class="p">));</span>
<a id="__codelineno-17-116" name="__codelineno-17-116" href="#__codelineno-17-116"></a><span class="p">}</span>
<a id="__codelineno-17-117" name="__codelineno-17-117" href="#__codelineno-17-117"></a>
<a id="__codelineno-17-118" name="__codelineno-17-118" href="#__codelineno-17-118"></a><span class="kt">void</span><span class="w"> </span><span class="n">Batch</span><span class="o">::</span><span class="n">Render</span><span class="p">(</span><span class="n">RenderSystem</span><span class="o">*</span><span class="w"> </span><span class="n">renderSystem</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-17-119" name="__codelineno-17-119" href="#__codelineno-17-119"></a><span class="w">    </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">m_Instances</span><span class="p">.</span><span class="n">empty</span><span class="p">())</span><span class="w"> </span><span class="k">return</span><span class="p">;</span>
<a id="__codelineno-17-120" name="__codelineno-17-120" href="#__codelineno-17-120"></a>
<a id="__codelineno-17-121" name="__codelineno-17-121" href="#__codelineno-17-121"></a><span class="w">    </span><span class="n">m_Material</span><span class="o">-&gt;</span><span class="n">Bind</span><span class="p">(</span><span class="n">renderSystem</span><span class="p">);</span>
<a id="__codelineno-17-122" name="__codelineno-17-122" href="#__codelineno-17-122"></a><span class="w">    </span><span class="n">renderSystem</span><span class="o">-&gt;</span><span class="n">SetVertexBuffer</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="w"> </span><span class="n">m_Mesh</span><span class="o">-&gt;</span><span class="n">GetVertexBuffer</span><span class="p">());</span>
<a id="__codelineno-17-123" name="__codelineno-17-123" href="#__codelineno-17-123"></a><span class="w">    </span><span class="n">renderSystem</span><span class="o">-&gt;</span><span class="n">SetVertexBuffer</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span><span class="w"> </span><span class="o">&amp;</span><span class="n">m_InstanceBuffer</span><span class="p">);</span>
<a id="__codelineno-17-124" name="__codelineno-17-124" href="#__codelineno-17-124"></a><span class="w">    </span><span class="n">renderSystem</span><span class="o">-&gt;</span><span class="n">SetIndexBuffer</span><span class="p">(</span><span class="n">m_Mesh</span><span class="o">-&gt;</span><span class="n">GetIndexBuffer</span><span class="p">());</span>
<a id="__codelineno-17-125" name="__codelineno-17-125" href="#__codelineno-17-125"></a><span class="w">    </span><span class="n">renderSystem</span><span class="o">-&gt;</span><span class="n">DrawIndexedInstanced</span><span class="p">(</span><span class="n">m_Mesh</span><span class="o">-&gt;</span><span class="n">GetIndexCount</span><span class="p">(),</span><span class="w"> </span><span class="n">m_Instances</span><span class="p">.</span><span class="n">size</span><span class="p">());</span>
<a id="__codelineno-17-126" name="__codelineno-17-126" href="#__codelineno-17-126"></a><span class="p">}</span>
</code></pre></div>
<p>Now, let's look at the shader code that supports instanced rendering:</p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-18-1" name="__codelineno-18-1" href="#__codelineno-18-1"></a><span class="c1">// InstancedRendering.vert</span>
<a id="__codelineno-18-2" name="__codelineno-18-2" href="#__codelineno-18-2"></a><span class="cp">#version 450</span>
<a id="__codelineno-18-3" name="__codelineno-18-3" href="#__codelineno-18-3"></a>
<a id="__codelineno-18-4" name="__codelineno-18-4" href="#__codelineno-18-4"></a><span class="k">layout</span><span class="p">(</span><span class="n">location</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mo">0</span><span class="p">)</span><span class="w"> </span><span class="k">in</span><span class="w"> </span><span class="kt">vec3</span><span class="w"> </span><span class="n">inPosition</span><span class="p">;</span>
<a id="__codelineno-18-5" name="__codelineno-18-5" href="#__codelineno-18-5"></a><span class="k">layout</span><span class="p">(</span><span class="n">location</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">1</span><span class="p">)</span><span class="w"> </span><span class="k">in</span><span class="w"> </span><span class="kt">vec3</span><span class="w"> </span><span class="n">inNormal</span><span class="p">;</span>
<a id="__codelineno-18-6" name="__codelineno-18-6" href="#__codelineno-18-6"></a><span class="k">layout</span><span class="p">(</span><span class="n">location</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">2</span><span class="p">)</span><span class="w"> </span><span class="k">in</span><span class="w"> </span><span class="kt">vec2</span><span class="w"> </span><span class="n">inTexCoord</span><span class="p">;</span>
<a id="__codelineno-18-7" name="__codelineno-18-7" href="#__codelineno-18-7"></a>
<a id="__codelineno-18-8" name="__codelineno-18-8" href="#__codelineno-18-8"></a><span class="k">layout</span><span class="p">(</span><span class="n">location</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">3</span><span class="p">)</span><span class="w"> </span><span class="k">in</span><span class="w"> </span><span class="kt">mat4</span><span class="w"> </span><span class="n">inInstanceTransform</span><span class="p">;</span>
<a id="__codelineno-18-9" name="__codelineno-18-9" href="#__codelineno-18-9"></a>
<a id="__codelineno-18-10" name="__codelineno-18-10" href="#__codelineno-18-10"></a><span class="k">layout</span><span class="p">(</span><span class="n">location</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mo">0</span><span class="p">)</span><span class="w"> </span><span class="k">out</span><span class="w"> </span><span class="kt">vec3</span><span class="w"> </span><span class="n">outWorldPos</span><span class="p">;</span>
<a id="__codelineno-18-11" name="__codelineno-18-11" href="#__codelineno-18-11"></a><span class="k">layout</span><span class="p">(</span><span class="n">location</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">1</span><span class="p">)</span><span class="w"> </span><span class="k">out</span><span class="w"> </span><span class="kt">vec3</span><span class="w"> </span><span class="n">outNormal</span><span class="p">;</span>
<a id="__codelineno-18-12" name="__codelineno-18-12" href="#__codelineno-18-12"></a><span class="k">layout</span><span class="p">(</span><span class="n">location</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">2</span><span class="p">)</span><span class="w"> </span><span class="k">out</span><span class="w"> </span><span class="kt">vec2</span><span class="w"> </span><span class="n">outTexCoord</span><span class="p">;</span>
<a id="__codelineno-18-13" name="__codelineno-18-13" href="#__codelineno-18-13"></a>
<a id="__codelineno-18-14" name="__codelineno-18-14" href="#__codelineno-18-14"></a><span class="k">layout</span><span class="p">(</span><span class="n">std140</span><span class="p">,</span><span class="w"> </span><span class="n">binding</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mo">0</span><span class="p">)</span><span class="w"> </span><span class="k">uniform</span><span class="w"> </span><span class="n">CameraData</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-18-15" name="__codelineno-18-15" href="#__codelineno-18-15"></a><span class="w">    </span><span class="kt">mat4</span><span class="w"> </span><span class="n">viewProjection</span><span class="p">;</span>
<a id="__codelineno-18-16" name="__codelineno-18-16" href="#__codelineno-18-16"></a><span class="p">};</span>
<a id="__codelineno-18-17" name="__codelineno-18-17" href="#__codelineno-18-17"></a>
<a id="__codelineno-18-18" name="__codelineno-18-18" href="#__codelineno-18-18"></a><span class="kt">void</span><span class="w"> </span><span class="n">main</span><span class="p">()</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-18-19" name="__codelineno-18-19" href="#__codelineno-18-19"></a><span class="w">    </span><span class="kt">vec4</span><span class="w"> </span><span class="n">worldPos</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">inInstanceTransform</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="kt">vec4</span><span class="p">(</span><span class="n">inPosition</span><span class="p">,</span><span class="w"> </span><span class="mf">1.0</span><span class="p">);</span>
<a id="__codelineno-18-20" name="__codelineno-18-20" href="#__codelineno-18-20"></a><span class="w">    </span><span class="nb">gl_Position</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">viewProjection</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="n">worldPos</span><span class="p">;</span>
<a id="__codelineno-18-21" name="__codelineno-18-21" href="#__codelineno-18-21"></a><span class="w">    </span><span class="n">outWorldPos</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">worldPos</span><span class="p">.</span><span class="n">xyz</span><span class="p">;</span>
<a id="__codelineno-18-22" name="__codelineno-18-22" href="#__codelineno-18-22"></a><span class="w">    </span><span class="n">outNormal</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="kt">mat3</span><span class="p">(</span><span class="n">inInstanceTransform</span><span class="p">)</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="n">inNormal</span><span class="p">;</span>
<a id="__codelineno-18-23" name="__codelineno-18-23" href="#__codelineno-18-23"></a><span class="w">    </span><span class="n">outTexCoord</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">inTexCoord</span><span class="p">;</span>
<a id="__codelineno-18-24" name="__codelineno-18-24" href="#__codelineno-18-24"></a><span class="p">}</span>
<a id="__codelineno-18-25" name="__codelineno-18-25" href="#__codelineno-18-25"></a>
<a id="__codelineno-18-26" name="__codelineno-18-26" href="#__codelineno-18-26"></a><span class="c1">// InstancedRendering.frag</span>
<a id="__codelineno-18-27" name="__codelineno-18-27" href="#__codelineno-18-27"></a><span class="cp">#version 450</span>
<a id="__codelineno-18-28" name="__codelineno-18-28" href="#__codelineno-18-28"></a>
<a id="__codelineno-18-29" name="__codelineno-18-29" href="#__codelineno-18-29"></a><span class="k">layout</span><span class="p">(</span><span class="n">location</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mo">0</span><span class="p">)</span><span class="w"> </span><span class="k">in</span><span class="w"> </span><span class="kt">vec3</span><span class="w"> </span><span class="n">inWorldPos</span><span class="p">;</span>
<a id="__codelineno-18-30" name="__codelineno-18-30" href="#__codelineno-18-30"></a><span class="k">layout</span><span class="p">(</span><span class="n">location</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">1</span><span class="p">)</span><span class="w"> </span><span class="k">in</span><span class="w"> </span><span class="kt">vec3</span><span class="w"> </span><span class="n">inNormal</span><span class="p">;</span>
<a id="__codelineno-18-31" name="__codelineno-18-31" href="#__codelineno-18-31"></a><span class="k">layout</span><span class="p">(</span><span class="n">location</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">2</span><span class="p">)</span><span class="w"> </span><span class="k">in</span><span class="w"> </span><span class="kt">vec2</span><span class="w"> </span><span class="n">inTexCoord</span><span class="p">;</span>
<a id="__codelineno-18-32" name="__codelineno-18-32" href="#__codelineno-18-32"></a>
<a id="__codelineno-18-33" name="__codelineno-18-33" href="#__codelineno-18-33"></a><span class="k">layout</span><span class="p">(</span><span class="n">location</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mo">0</span><span class="p">)</span><span class="w"> </span><span class="k">out</span><span class="w"> </span><span class="kt">vec4</span><span class="w"> </span><span class="n">outColor</span><span class="p">;</span>
<a id="__codelineno-18-34" name="__codelineno-18-34" href="#__codelineno-18-34"></a>
<a id="__codelineno-18-35" name="__codelineno-18-35" href="#__codelineno-18-35"></a><span class="k">layout</span><span class="p">(</span><span class="n">binding</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">1</span><span class="p">)</span><span class="w"> </span><span class="k">uniform</span><span class="w"> </span><span class="kt">sampler2D</span><span class="w"> </span><span class="n">albedoTexture</span><span class="p">;</span>
<a id="__codelineno-18-36" name="__codelineno-18-36" href="#__codelineno-18-36"></a>
<a id="__codelineno-18-37" name="__codelineno-18-37" href="#__codelineno-18-37"></a><span class="kt">void</span><span class="w"> </span><span class="n">main</span><span class="p">()</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-18-38" name="__codelineno-18-38" href="#__codelineno-18-38"></a><span class="w">    </span><span class="kt">vec3</span><span class="w"> </span><span class="n">normal</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">normalize</span><span class="p">(</span><span class="n">inNormal</span><span class="p">);</span>
<a id="__codelineno-18-39" name="__codelineno-18-39" href="#__codelineno-18-39"></a><span class="w">    </span><span class="kt">vec3</span><span class="w"> </span><span class="n">lightDir</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">normalize</span><span class="p">(</span><span class="kt">vec3</span><span class="p">(</span><span class="mf">1.0</span><span class="p">,</span><span class="w"> </span><span class="mf">1.0</span><span class="p">,</span><span class="w"> </span><span class="mf">1.0</span><span class="p">));</span><span class="w"> </span><span class="c1">// Directional light</span>
<a id="__codelineno-18-40" name="__codelineno-18-40" href="#__codelineno-18-40"></a>
<a id="__codelineno-18-41" name="__codelineno-18-41" href="#__codelineno-18-41"></a><span class="w">    </span><span class="kt">float</span><span class="w"> </span><span class="n">diffuse</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">max</span><span class="p">(</span><span class="n">dot</span><span class="p">(</span><span class="n">normal</span><span class="p">,</span><span class="w"> </span><span class="n">lightDir</span><span class="p">),</span><span class="w"> </span><span class="mf">0.0</span><span class="p">);</span>
<a id="__codelineno-18-42" name="__codelineno-18-42" href="#__codelineno-18-42"></a>
<a id="__codelineno-18-43" name="__codelineno-18-43" href="#__codelineno-18-43"></a><span class="w">    </span><span class="kt">vec3</span><span class="w"> </span><span class="n">albedo</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">texture</span><span class="p">(</span><span class="n">albedoTexture</span><span class="p">,</span><span class="w"> </span><span class="n">inTexCoord</span><span class="p">).</span><span class="n">rgb</span><span class="p">;</span>
<a id="__codelineno-18-44" name="__codelineno-18-44" href="#__codelineno-18-44"></a><span class="w">    </span><span class="kt">vec3</span><span class="w"> </span><span class="n">lighting</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">albedo</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="p">(</span><span class="mf">0.2</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="mf">0.8</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="n">diffuse</span><span class="p">);</span><span class="w"> </span><span class="c1">// Simple ambient + diffuse lighting</span>
<a id="__codelineno-18-45" name="__codelineno-18-45" href="#__codelineno-18-45"></a>
<a id="__codelineno-18-46" name="__codelineno-18-46" href="#__codelineno-18-46"></a><span class="w">    </span><span class="n">outColor</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="kt">vec4</span><span class="p">(</span><span class="n">lighting</span><span class="p">,</span><span class="w"> </span><span class="mf">1.0</span><span class="p">);</span>
<a id="__codelineno-18-47" name="__codelineno-18-47" href="#__codelineno-18-47"></a><span class="p">}</span>
</code></pre></div>
<h4 id="explanation">Explanation</h4>
<ol>
<li>
<p>Batch Management:</p>
<ul>
<li>The <code>BatchingSystem</code> class manages both static and dynamic batches.</li>
<li>Objects are grouped into batches based on their mesh and material.</li>
<li>Static batches are created once and remain unchanged, while dynamic batches can be updated each frame.</li>
</ul>
</li>
<li>
<p>Instance Data:</p>
<ul>
<li>Each instance in a batch stores its transform matrix and potentially other per-instance data.</li>
<li>This data is stored in a separate vertex buffer (m_InstanceBuffer) for efficient GPU access.</li>
</ul>
</li>
<li>
<p>Batch Rendering:</p>
<ul>
<li>When rendering a batch, we bind the shared mesh data (vertices and indices) and the instance buffer.</li>
<li>We use instanced rendering (DrawIndexedInstanced) to draw all instances in a single draw call.</li>
</ul>
</li>
<li>
<p>Shader Support:</p>
<ul>
<li>The vertex shader reads the instance transform as an additional vertex attribute.</li>
<li>This allows each instance to have its own transformation while sharing the same base geometry.</li>
</ul>
</li>
<li>
<p>Performance Considerations:</p>
<ul>
<li>Batching significantly reduces the number of draw calls, which can be a major performance bottleneck.</li>
<li>It's particularly effective for scenes with many similar objects (e.g., trees, grass, debris).</li>
<li>The trade-off is increased memory usage for storing instance data and potentially larger vertex buffers.</li>
</ul>
</li>
<li>
<p>Dynamic Batching:</p>
<ul>
<li>For objects that move or change frequently, we update their instance data each frame.</li>
<li>This allows for a balance between the performance benefits of batching and the flexibility of dynamic objects.</li>
</ul>
</li>
<li>
<p>Batch Creation and Lookup:</p>
<ul>
<li>We use a hash map to quickly find existing batches based on mesh and material combinations.</li>
<li>This ensures we don't create duplicate batches unnecessarily.</li>
</ul>
</li>
</ol>
<p>This implementation provides a solid foundation for a batching system in a professional game engine. Further improvements could include:</p>
<ul>
<li>GPU-driven culling to efficiently handle very large numbers of instances</li>
<li>Level-of-detail (LOD) system integration for distance-based mesh simplification</li>
<li>Support for skinned mesh instancing for characters or animated objects</li>
<li>
<p>Integration with a job system for multi-threaded batch updates</p>
</li>
<li>
<p><strong>Instancing</strong>: Render multiple instances of the same mesh in a single draw call.</p>
</li>
</ul>
<h3 id="occlusion-culling">Occlusion Culling</h3>
<p>Occlusion culling is a technique used in computer graphics to improve rendering performance by not rendering objects that are blocked (occluded) by other objects in the scene. This allows the graphics pipeline to skip rendering objects that are not visible to the camera, saving computational resources and improving efficiency.</p>
<h4 id="how-occlusion-culling-works">How Occlusion Culling Works</h4>
<ol>
<li>
<p><strong>Depth Buffering:</strong></p>
<p>The depth buffer (or z-buffer) is used to keep track of the depth of every pixel on the screen. When a new pixel is processed, it is compared to the existing value in the depth buffer to determine if it should be drawn or discarded.</p>
</li>
<li>
<p><strong>Occluders and Occludees:</strong></p>
<ul>
<li><strong>Occluders:</strong> Large objects that can potentially block the view of other objects. Examples include walls, buildings, and mountains.</li>
<li><strong>Occludees:</strong> Objects that might be blocked by occluders. Examples include smaller objects like trees, furniture, or characters.</li>
</ul>
</li>
<li>
<p><strong>Hierarchical Z-Buffer (HZB):</strong></p>
<p>A hierarchical approach is used where the scene is divided into different levels of detail. This allows for quick rejection of large portions of the scene that are occluded.</p>
</li>
<li>
<p><strong>Software Occlusion Culling:</strong></p>
<p>In some cases, occlusion culling can be done on the CPU before sending data to the GPU. This is useful for complex scenes where it is beneficial to reduce the load on the GPU.</p>
</li>
</ol>
<h3 id="implementation-of-occlusion-culling-in-c">Implementation of Occlusion Culling in C++</h3>
<p>Implementing occlusion culling involves several steps, including setting up the depth buffer, identifying occluders and occludees, and performing the occlusion test. Below is a simplified example of how this can be done.</p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-19-1" name="__codelineno-19-1" href="#__codelineno-19-1"></a><span class="cp">#include</span><span class="w"> </span><span class="cpf">&lt;iostream&gt;</span>
<a id="__codelineno-19-2" name="__codelineno-19-2" href="#__codelineno-19-2"></a><span class="cp">#include</span><span class="w"> </span><span class="cpf">&lt;vector&gt;</span>
<a id="__codelineno-19-3" name="__codelineno-19-3" href="#__codelineno-19-3"></a><span class="cp">#include</span><span class="w"> </span><span class="cpf">&lt;glm/glm.hpp&gt;</span>
<a id="__codelineno-19-4" name="__codelineno-19-4" href="#__codelineno-19-4"></a><span class="cp">#include</span><span class="w"> </span><span class="cpf">&lt;glm/gtc/matrix_transform.hpp&gt;</span>
<a id="__codelineno-19-5" name="__codelineno-19-5" href="#__codelineno-19-5"></a><span class="cp">#include</span><span class="w"> </span><span class="cpf">&lt;glm/gtc/type_ptr.hpp&gt;</span>
<a id="__codelineno-19-6" name="__codelineno-19-6" href="#__codelineno-19-6"></a>
<a id="__codelineno-19-7" name="__codelineno-19-7" href="#__codelineno-19-7"></a><span class="c1">// Simplified example structures</span>
<a id="__codelineno-19-8" name="__codelineno-19-8" href="#__codelineno-19-8"></a><span class="k">struct</span><span class="w"> </span><span class="nc">BoundingBox</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-19-9" name="__codelineno-19-9" href="#__codelineno-19-9"></a><span class="w">    </span><span class="n">glm</span><span class="o">::</span><span class="n">vec3</span><span class="w"> </span><span class="n">min</span><span class="p">;</span>
<a id="__codelineno-19-10" name="__codelineno-19-10" href="#__codelineno-19-10"></a><span class="w">    </span><span class="n">glm</span><span class="o">::</span><span class="n">vec3</span><span class="w"> </span><span class="n">max</span><span class="p">;</span>
<a id="__codelineno-19-11" name="__codelineno-19-11" href="#__codelineno-19-11"></a><span class="p">};</span>
<a id="__codelineno-19-12" name="__codelineno-19-12" href="#__codelineno-19-12"></a>
<a id="__codelineno-19-13" name="__codelineno-19-13" href="#__codelineno-19-13"></a><span class="k">struct</span><span class="w"> </span><span class="nc">Object</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-19-14" name="__codelineno-19-14" href="#__codelineno-19-14"></a><span class="w">    </span><span class="n">BoundingBox</span><span class="w"> </span><span class="n">bbox</span><span class="p">;</span>
<a id="__codelineno-19-15" name="__codelineno-19-15" href="#__codelineno-19-15"></a><span class="w">    </span><span class="kt">bool</span><span class="w"> </span><span class="n">visible</span><span class="p">;</span>
<a id="__codelineno-19-16" name="__codelineno-19-16" href="#__codelineno-19-16"></a><span class="p">};</span>
<a id="__codelineno-19-17" name="__codelineno-19-17" href="#__codelineno-19-17"></a>
<a id="__codelineno-19-18" name="__codelineno-19-18" href="#__codelineno-19-18"></a><span class="k">class</span><span class="w"> </span><span class="nc">OcclusionCulling</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-19-19" name="__codelineno-19-19" href="#__codelineno-19-19"></a><span class="k">public</span><span class="o">:</span>
<a id="__codelineno-19-20" name="__codelineno-19-20" href="#__codelineno-19-20"></a><span class="w">    </span><span class="n">OcclusionCulling</span><span class="p">(</span><span class="kt">int</span><span class="w"> </span><span class="n">width</span><span class="p">,</span><span class="w"> </span><span class="kt">int</span><span class="w"> </span><span class="n">height</span><span class="p">)</span>
<a id="__codelineno-19-21" name="__codelineno-19-21" href="#__codelineno-19-21"></a><span class="w">        </span><span class="o">:</span><span class="w"> </span><span class="n">width</span><span class="p">(</span><span class="n">width</span><span class="p">),</span><span class="w"> </span><span class="n">height</span><span class="p">(</span><span class="n">height</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-19-22" name="__codelineno-19-22" href="#__codelineno-19-22"></a><span class="w">        </span><span class="n">depthBuffer</span><span class="p">.</span><span class="n">resize</span><span class="p">(</span><span class="n">width</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="n">height</span><span class="p">,</span><span class="w"> </span><span class="n">std</span><span class="o">::</span><span class="n">numeric_limits</span><span class="o">&lt;</span><span class="kt">float</span><span class="o">&gt;::</span><span class="n">max</span><span class="p">());</span>
<a id="__codelineno-19-23" name="__codelineno-19-23" href="#__codelineno-19-23"></a><span class="w">    </span><span class="p">}</span>
<a id="__codelineno-19-24" name="__codelineno-19-24" href="#__codelineno-19-24"></a>
<a id="__codelineno-19-25" name="__codelineno-19-25" href="#__codelineno-19-25"></a><span class="w">    </span><span class="kt">void</span><span class="w"> </span><span class="n">clearDepthBuffer</span><span class="p">()</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-19-26" name="__codelineno-19-26" href="#__codelineno-19-26"></a><span class="w">        </span><span class="n">std</span><span class="o">::</span><span class="n">fill</span><span class="p">(</span><span class="n">depthBuffer</span><span class="p">.</span><span class="n">begin</span><span class="p">(),</span><span class="w"> </span><span class="n">depthBuffer</span><span class="p">.</span><span class="n">end</span><span class="p">(),</span><span class="w"> </span><span class="n">std</span><span class="o">::</span><span class="n">numeric_limits</span><span class="o">&lt;</span><span class="kt">float</span><span class="o">&gt;::</span><span class="n">max</span><span class="p">());</span>
<a id="__codelineno-19-27" name="__codelineno-19-27" href="#__codelineno-19-27"></a><span class="w">    </span><span class="p">}</span>
<a id="__codelineno-19-28" name="__codelineno-19-28" href="#__codelineno-19-28"></a>
<a id="__codelineno-19-29" name="__codelineno-19-29" href="#__codelineno-19-29"></a><span class="w">    </span><span class="kt">bool</span><span class="w"> </span><span class="n">isOccluded</span><span class="p">(</span><span class="k">const</span><span class="w"> </span><span class="n">BoundingBox</span><span class="o">&amp;</span><span class="w"> </span><span class="n">bbox</span><span class="p">,</span><span class="w"> </span><span class="k">const</span><span class="w"> </span><span class="n">glm</span><span class="o">::</span><span class="n">mat4</span><span class="o">&amp;</span><span class="w"> </span><span class="n">viewProjMatrix</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-19-30" name="__codelineno-19-30" href="#__codelineno-19-30"></a><span class="w">        </span><span class="c1">// Project the bounding box corners to screen space</span>
<a id="__codelineno-19-31" name="__codelineno-19-31" href="#__codelineno-19-31"></a><span class="w">        </span><span class="n">std</span><span class="o">::</span><span class="n">vector</span><span class="o">&lt;</span><span class="n">glm</span><span class="o">::</span><span class="n">vec4</span><span class="o">&gt;</span><span class="w"> </span><span class="n">corners</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-19-32" name="__codelineno-19-32" href="#__codelineno-19-32"></a><span class="w">            </span><span class="n">glm</span><span class="o">::</span><span class="n">vec4</span><span class="p">(</span><span class="n">bbox</span><span class="p">.</span><span class="n">min</span><span class="p">.</span><span class="n">x</span><span class="p">,</span><span class="w"> </span><span class="n">bbox</span><span class="p">.</span><span class="n">min</span><span class="p">.</span><span class="n">y</span><span class="p">,</span><span class="w"> </span><span class="n">bbox</span><span class="p">.</span><span class="n">min</span><span class="p">.</span><span class="n">z</span><span class="p">,</span><span class="w"> </span><span class="mf">1.0f</span><span class="p">),</span>
<a id="__codelineno-19-33" name="__codelineno-19-33" href="#__codelineno-19-33"></a><span class="w">            </span><span class="n">glm</span><span class="o">::</span><span class="n">vec4</span><span class="p">(</span><span class="n">bbox</span><span class="p">.</span><span class="n">max</span><span class="p">.</span><span class="n">x</span><span class="p">,</span><span class="w"> </span><span class="n">bbox</span><span class="p">.</span><span class="n">min</span><span class="p">.</span><span class="n">y</span><span class="p">,</span><span class="w"> </span><span class="n">bbox</span><span class="p">.</span><span class="n">min</span><span class="p">.</span><span class="n">z</span><span class="p">,</span><span class="w"> </span><span class="mf">1.0f</span><span class="p">),</span>
<a id="__codelineno-19-34" name="__codelineno-19-34" href="#__codelineno-19-34"></a><span class="w">            </span><span class="n">glm</span><span class="o">::</span><span class="n">vec4</span><span class="p">(</span><span class="n">bbox</span><span class="p">.</span><span class="n">min</span><span class="p">.</span><span class="n">x</span><span class="p">,</span><span class="w"> </span><span class="n">bbox</span><span class="p">.</span><span class="n">max</span><span class="p">.</span><span class="n">y</span><span class="p">,</span><span class="w"> </span><span class="n">bbox</span><span class="p">.</span><span class="n">min</span><span class="p">.</span><span class="n">z</span><span class="p">,</span><span class="w"> </span><span class="mf">1.0f</span><span class="p">),</span>
<a id="__codelineno-19-35" name="__codelineno-19-35" href="#__codelineno-19-35"></a><span class="w">            </span><span class="n">glm</span><span class="o">::</span><span class="n">vec4</span><span class="p">(</span><span class="n">bbox</span><span class="p">.</span><span class="n">max</span><span class="p">.</span><span class="n">x</span><span class="p">,</span><span class="w"> </span><span class="n">bbox</span><span class="p">.</span><span class="n">max</span><span class="p">.</span><span class="n">y</span><span class="p">,</span><span class="w"> </span><span class="n">bbox</span><span class="p">.</span><span class="n">min</span><span class="p">.</span><span class="n">z</span><span class="p">,</span><span class="w"> </span><span class="mf">1.0f</span><span class="p">),</span>
<a id="__codelineno-19-36" name="__codelineno-19-36" href="#__codelineno-19-36"></a><span class="w">            </span><span class="n">glm</span><span class="o">::</span><span class="n">vec4</span><span class="p">(</span><span class="n">bbox</span><span class="p">.</span><span class="n">min</span><span class="p">.</span><span class="n">x</span><span class="p">,</span><span class="w"> </span><span class="n">bbox</span><span class="p">.</span><span class="n">min</span><span class="p">.</span><span class="n">y</span><span class="p">,</span><span class="w"> </span><span class="n">bbox</span><span class="p">.</span><span class="n">max</span><span class="p">.</span><span class="n">z</span><span class="p">,</span><span class="w"> </span><span class="mf">1.0f</span><span class="p">),</span>
<a id="__codelineno-19-37" name="__codelineno-19-37" href="#__codelineno-19-37"></a><span class="w">            </span><span class="n">glm</span><span class="o">::</span><span class="n">vec4</span><span class="p">(</span><span class="n">bbox</span><span class="p">.</span><span class="n">max</span><span class="p">.</span><span class="n">x</span><span class="p">,</span><span class="w"> </span><span class="n">bbox</span><span class="p">.</span><span class="n">min</span><span class="p">.</span><span class="n">y</span><span class="p">,</span><span class="w"> </span><span class="n">bbox</span><span class="p">.</span><span class="n">max</span><span class="p">.</span><span class="n">z</span><span class="p">,</span><span class="w"> </span><span class="mf">1.0f</span><span class="p">),</span>
<a id="__codelineno-19-38" name="__codelineno-19-38" href="#__codelineno-19-38"></a><span class="w">            </span><span class="n">glm</span><span class="o">::</span><span class="n">vec4</span><span class="p">(</span><span class="n">bbox</span><span class="p">.</span><span class="n">min</span><span class="p">.</span><span class="n">x</span><span class="p">,</span><span class="w"> </span><span class="n">bbox</span><span class="p">.</span><span class="n">max</span><span class="p">.</span><span class="n">y</span><span class="p">,</span><span class="w"> </span><span class="n">bbox</span><span class="p">.</span><span class="n">max</span><span class="p">.</span><span class="n">z</span><span class="p">,</span><span class="w"> </span><span class="mf">1.0f</span><span class="p">),</span>
<a id="__codelineno-19-39" name="__codelineno-19-39" href="#__codelineno-19-39"></a><span class="w">            </span><span class="n">glm</span><span class="o">::</span><span class="n">vec4</span><span class="p">(</span><span class="n">bbox</span><span class="p">.</span><span class="n">max</span><span class="p">.</span><span class="n">x</span><span class="p">,</span><span class="w"> </span><span class="n">bbox</span><span class="p">.</span><span class="n">max</span><span class="p">.</span><span class="n">y</span><span class="p">,</span><span class="w"> </span><span class="n">bbox</span><span class="p">.</span><span class="n">max</span><span class="p">.</span><span class="n">z</span><span class="p">,</span><span class="w"> </span><span class="mf">1.0f</span><span class="p">)</span>
<a id="__codelineno-19-40" name="__codelineno-19-40" href="#__codelineno-19-40"></a><span class="w">        </span><span class="p">};</span>
<a id="__codelineno-19-41" name="__codelineno-19-41" href="#__codelineno-19-41"></a>
<a id="__codelineno-19-42" name="__codelineno-19-42" href="#__codelineno-19-42"></a><span class="w">        </span><span class="kt">bool</span><span class="w"> </span><span class="n">occluded</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nb">true</span><span class="p">;</span>
<a id="__codelineno-19-43" name="__codelineno-19-43" href="#__codelineno-19-43"></a><span class="w">        </span><span class="k">for</span><span class="w"> </span><span class="p">(</span><span class="k">const</span><span class="w"> </span><span class="k">auto</span><span class="o">&amp;</span><span class="w"> </span><span class="n">corner</span><span class="w"> </span><span class="o">:</span><span class="w"> </span><span class="n">corners</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-19-44" name="__codelineno-19-44" href="#__codelineno-19-44"></a><span class="w">            </span><span class="n">glm</span><span class="o">::</span><span class="n">vec4</span><span class="w"> </span><span class="n">screenSpaceCorner</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">viewProjMatrix</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="n">corner</span><span class="p">;</span>
<a id="__codelineno-19-45" name="__codelineno-19-45" href="#__codelineno-19-45"></a><span class="w">            </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">screenSpaceCorner</span><span class="p">.</span><span class="n">w</span><span class="w"> </span><span class="o">&gt;</span><span class="w"> </span><span class="mf">0.0f</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-19-46" name="__codelineno-19-46" href="#__codelineno-19-46"></a><span class="w">                </span><span class="n">screenSpaceCorner</span><span class="w"> </span><span class="o">/=</span><span class="w"> </span><span class="n">screenSpaceCorner</span><span class="p">.</span><span class="n">w</span><span class="p">;</span><span class="w"> </span><span class="c1">// Perspective divide</span>
<a id="__codelineno-19-47" name="__codelineno-19-47" href="#__codelineno-19-47"></a><span class="w">                </span><span class="kt">int</span><span class="w"> </span><span class="n">x</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">static_cast</span><span class="o">&lt;</span><span class="kt">int</span><span class="o">&gt;</span><span class="p">((</span><span class="n">screenSpaceCorner</span><span class="p">.</span><span class="n">x</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="mf">0.5f</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="mf">0.5f</span><span class="p">)</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="n">width</span><span class="p">);</span>
<a id="__codelineno-19-48" name="__codelineno-19-48" href="#__codelineno-19-48"></a><span class="w">                </span><span class="kt">int</span><span class="w"> </span><span class="n">y</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">static_cast</span><span class="o">&lt;</span><span class="kt">int</span><span class="o">&gt;</span><span class="p">((</span><span class="n">screenSpaceCorner</span><span class="p">.</span><span class="n">y</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="mf">0.5f</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="mf">0.5f</span><span class="p">)</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="n">height</span><span class="p">);</span>
<a id="__codelineno-19-49" name="__codelineno-19-49" href="#__codelineno-19-49"></a><span class="w">                </span><span class="kt">float</span><span class="w"> </span><span class="n">depth</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">screenSpaceCorner</span><span class="p">.</span><span class="n">z</span><span class="p">;</span>
<a id="__codelineno-19-50" name="__codelineno-19-50" href="#__codelineno-19-50"></a>
<a id="__codelineno-19-51" name="__codelineno-19-51" href="#__codelineno-19-51"></a><span class="w">                </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">x</span><span class="w"> </span><span class="o">&gt;=</span><span class="w"> </span><span class="mi">0</span><span class="w"> </span><span class="o">&amp;&amp;</span><span class="w"> </span><span class="n">x</span><span class="w"> </span><span class="o">&lt;</span><span class="w"> </span><span class="n">width</span><span class="w"> </span><span class="o">&amp;&amp;</span><span class="w"> </span><span class="n">y</span><span class="w"> </span><span class="o">&gt;=</span><span class="w"> </span><span class="mi">0</span><span class="w"> </span><span class="o">&amp;&amp;</span><span class="w"> </span><span class="n">y</span><span class="w"> </span><span class="o">&lt;</span><span class="w"> </span><span class="n">height</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-19-52" name="__codelineno-19-52" href="#__codelineno-19-52"></a><span class="w">                    </span><span class="kt">int</span><span class="w"> </span><span class="n">index</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">y</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="n">width</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="n">x</span><span class="p">;</span>
<a id="__codelineno-19-53" name="__codelineno-19-53" href="#__codelineno-19-53"></a><span class="w">                    </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">depth</span><span class="w"> </span><span class="o">&lt;</span><span class="w"> </span><span class="n">depthBuffer</span><span class="p">[</span><span class="n">index</span><span class="p">])</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-19-54" name="__codelineno-19-54" href="#__codelineno-19-54"></a><span class="w">                        </span><span class="n">occluded</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nb">false</span><span class="p">;</span>
<a id="__codelineno-19-55" name="__codelineno-19-55" href="#__codelineno-19-55"></a><span class="w">                        </span><span class="k">break</span><span class="p">;</span>
<a id="__codelineno-19-56" name="__codelineno-19-56" href="#__codelineno-19-56"></a><span class="w">                    </span><span class="p">}</span>
<a id="__codelineno-19-57" name="__codelineno-19-57" href="#__codelineno-19-57"></a><span class="w">                </span><span class="p">}</span>
<a id="__codelineno-19-58" name="__codelineno-19-58" href="#__codelineno-19-58"></a><span class="w">            </span><span class="p">}</span>
<a id="__codelineno-19-59" name="__codelineno-19-59" href="#__codelineno-19-59"></a><span class="w">        </span><span class="p">}</span>
<a id="__codelineno-19-60" name="__codelineno-19-60" href="#__codelineno-19-60"></a><span class="w">        </span><span class="k">return</span><span class="w"> </span><span class="n">occluded</span><span class="p">;</span>
<a id="__codelineno-19-61" name="__codelineno-19-61" href="#__codelineno-19-61"></a><span class="w">    </span><span class="p">}</span>
<a id="__codelineno-19-62" name="__codelineno-19-62" href="#__codelineno-19-62"></a>
<a id="__codelineno-19-63" name="__codelineno-19-63" href="#__codelineno-19-63"></a><span class="w">    </span><span class="kt">void</span><span class="w"> </span><span class="n">updateDepthBuffer</span><span class="p">(</span><span class="k">const</span><span class="w"> </span><span class="n">BoundingBox</span><span class="o">&amp;</span><span class="w"> </span><span class="n">bbox</span><span class="p">,</span><span class="w"> </span><span class="k">const</span><span class="w"> </span><span class="n">glm</span><span class="o">::</span><span class="n">mat4</span><span class="o">&amp;</span><span class="w"> </span><span class="n">viewProjMatrix</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-19-64" name="__codelineno-19-64" href="#__codelineno-19-64"></a><span class="w">        </span><span class="c1">// Project the bounding box corners to screen space and update the depth buffer</span>
<a id="__codelineno-19-65" name="__codelineno-19-65" href="#__codelineno-19-65"></a><span class="w">        </span><span class="n">std</span><span class="o">::</span><span class="n">vector</span><span class="o">&lt;</span><span class="n">glm</span><span class="o">::</span><span class="n">vec4</span><span class="o">&gt;</span><span class="w"> </span><span class="n">corners</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-19-66" name="__codelineno-19-66" href="#__codelineno-19-66"></a><span class="w">            </span><span class="n">glm</span><span class="o">::</span><span class="n">vec4</span><span class="p">(</span><span class="n">bbox</span><span class="p">.</span><span class="n">min</span><span class="p">.</span><span class="n">x</span><span class="p">,</span><span class="w"> </span><span class="n">bbox</span><span class="p">.</span><span class="n">min</span><span class="p">.</span><span class="n">y</span><span class="p">,</span><span class="w"> </span><span class="n">bbox</span><span class="p">.</span><span class="n">min</span><span class="p">.</span><span class="n">z</span><span class="p">,</span><span class="w"> </span><span class="mf">1.0f</span><span class="p">),</span>
<a id="__codelineno-19-67" name="__codelineno-19-67" href="#__codelineno-19-67"></a><span class="w">            </span><span class="n">glm</span><span class="o">::</span><span class="n">vec4</span><span class="p">(</span><span class="n">bbox</span><span class="p">.</span><span class="n">max</span><span class="p">.</span><span class="n">x</span><span class="p">,</span><span class="w"> </span><span class="n">bbox</span><span class="p">.</span><span class="n">min</span><span class="p">.</span><span class="n">y</span><span class="p">,</span><span class="w"> </span><span class="n">bbox</span><span class="p">.</span><span class="n">min</span><span class="p">.</span><span class="n">z</span><span class="p">,</span><span class="w"> </span><span class="mf">1.0f</span><span class="p">),</span>
<a id="__codelineno-19-68" name="__codelineno-19-68" href="#__codelineno-19-68"></a><span class="w">            </span><span class="n">glm</span><span class="o">::</span><span class="n">vec4</span><span class="p">(</span><span class="n">bbox</span><span class="p">.</span><span class="n">min</span><span class="p">.</span><span class="n">x</span><span class="p">,</span><span class="w"> </span><span class="n">bbox</span><span class="p">.</span><span class="n">max</span><span class="p">.</span><span class="n">y</span><span class="p">,</span><span class="w"> </span><span class="n">bbox</span><span class="p">.</span><span class="n">min</span><span class="p">.</span><span class="n">z</span><span class="p">,</span><span class="w"> </span><span class="mf">1.0f</span><span class="p">),</span>
<a id="__codelineno-19-69" name="__codelineno-19-69" href="#__codelineno-19-69"></a><span class="w">            </span><span class="n">glm</span><span class="o">::</span><span class="n">vec4</span><span class="p">(</span><span class="n">bbox</span><span class="p">.</span><span class="n">max</span><span class="p">.</span><span class="n">x</span><span class="p">,</span><span class="w"> </span><span class="n">bbox</span><span class="p">.</span><span class="n">max</span><span class="p">.</span><span class="n">y</span><span class="p">,</span><span class="w"> </span><span class="n">bbox</span><span class="p">.</span><span class="n">min</span><span class="p">.</span><span class="n">z</span><span class="p">,</span><span class="w"> </span><span class="mf">1.0f</span><span class="p">),</span>
<a id="__codelineno-19-70" name="__codelineno-19-70" href="#__codelineno-19-70"></a><span class="w">            </span><span class="n">glm</span><span class="o">::</span><span class="n">vec4</span><span class="p">(</span><span class="n">bbox</span><span class="p">.</span><span class="n">min</span><span class="p">.</span><span class="n">x</span><span class="p">,</span><span class="w"> </span><span class="n">bbox</span><span class="p">.</span><span class="n">min</span><span class="p">.</span><span class="n">y</span><span class="p">,</span><span class="w"> </span><span class="n">bbox</span><span class="p">.</span><span class="n">max</span><span class="p">.</span><span class="n">z</span><span class="p">,</span><span class="w"> </span><span class="mf">1.0f</span><span class="p">),</span>
<a id="__codelineno-19-71" name="__codelineno-19-71" href="#__codelineno-19-71"></a><span class="w">            </span><span class="n">glm</span><span class="o">::</span><span class="n">vec4</span><span class="p">(</span><span class="n">bbox</span><span class="p">.</span><span class="n">max</span><span class="p">.</span><span class="n">x</span><span class="p">,</span><span class="w"> </span><span class="n">bbox</span><span class="p">.</span><span class="n">min</span><span class="p">.</span><span class="n">y</span><span class="p">,</span><span class="w"> </span><span class="n">bbox</span><span class="p">.</span><span class="n">max</span><span class="p">.</span><span class="n">z</span><span class="p">,</span><span class="w"> </span><span class="mf">1.0f</span><span class="p">),</span>
<a id="__codelineno-19-72" name="__codelineno-19-72" href="#__codelineno-19-72"></a><span class="w">            </span><span class="n">glm</span><span class="o">::</span><span class="n">vec4</span><span class="p">(</span><span class="n">bbox</span><span class="p">.</span><span class="n">min</span><span class="p">.</span><span class="n">x</span><span class="p">,</span><span class="w"> </span><span class="n">bbox</span><span class="p">.</span><span class="n">max</span><span class="p">.</span><span class="n">y</span><span class="p">,</span><span class="w"> </span><span class="n">bbox</span><span class="p">.</span><span class="n">max</span><span class="p">.</span><span class="n">z</span><span class="p">,</span><span class="w"> </span><span class="mf">1.0f</span><span class="p">),</span>
<a id="__codelineno-19-73" name="__codelineno-19-73" href="#__codelineno-19-73"></a><span class="w">            </span><span class="n">glm</span><span class="o">::</span><span class="n">vec4</span><span class="p">(</span><span class="n">bbox</span><span class="p">.</span><span class="n">max</span><span class="p">.</span><span class="n">x</span><span class="p">,</span><span class="w"> </span><span class="n">bbox</span><span class="p">.</span><span class="n">max</span><span class="p">.</span><span class="n">y</span><span class="p">,</span><span class="w"> </span><span class="n">bbox</span><span class="p">.</span><span class="n">max</span><span class="p">.</span><span class="n">z</span><span class="p">,</span><span class="w"> </span><span class="mf">1.0f</span><span class="p">)</span>
<a id="__codelineno-19-74" name="__codelineno-19-74" href="#__codelineno-19-74"></a><span class="w">        </span><span class="p">};</span>
<a id="__codelineno-19-75" name="__codelineno-19-75" href="#__codelineno-19-75"></a>
<a id="__codelineno-19-76" name="__codelineno-19-76" href="#__codelineno-19-76"></a><span class="w">        </span><span class="k">for</span><span class="w"> </span><span class="p">(</span><span class="k">const</span><span class="w"> </span><span class="k">auto</span><span class="o">&amp;</span><span class="w"> </span><span class="n">corner</span><span class="w"> </span><span class="o">:</span><span class="w"> </span><span class="n">corners</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-19-77" name="__codelineno-19-77" href="#__codelineno-19-77"></a><span class="w">            </span><span class="n">glm</span><span class="o">::</span><span class="n">vec4</span><span class="w"> </span><span class="n">screenSpaceCorner</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">viewProjMatrix</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="n">corner</span><span class="p">;</span>
<a id="__codelineno-19-78" name="__codelineno-19-78" href="#__codelineno-19-78"></a><span class="w">            </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">screenSpaceCorner</span><span class="p">.</span><span class="n">w</span><span class="w"> </span><span class="o">&gt;</span><span class="w"> </span><span class="mf">0.0f</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-19-79" name="__codelineno-19-79" href="#__codelineno-19-79"></a><span class="w">                </span><span class="n">screenSpaceCorner</span><span class="w"> </span><span class="o">/=</span><span class="w"> </span><span class="n">screenSpaceCorner</span><span class="p">.</span><span class="n">w</span><span class="p">;</span><span class="w"> </span><span class="c1">// Perspective divide</span>
<a id="__codelineno-19-80" name="__codelineno-19-80" href="#__codelineno-19-80"></a><span class="w">                </span><span class="kt">int</span><span class="w"> </span><span class="n">x</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">static_cast</span><span class="o">&lt;</span><span class="kt">int</span><span class="o">&gt;</span><span class="p">((</span><span class="n">screenSpaceCorner</span><span class="p">.</span><span class="n">x</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="mf">0.5f</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="mf">0.5f</span><span class="p">)</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="n">width</span><span class="p">);</span>
<a id="__codelineno-19-81" name="__codelineno-19-81" href="#__codelineno-19-81"></a><span class="w">                </span><span class="kt">int</span><span class="w"> </span><span class="n">y</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">static_cast</span><span class="o">&lt;</span><span class="kt">int</span><span class="o">&gt;</span><span class="p">((</span><span class="n">screenSpaceCorner</span><span class="p">.</span><span class="n">y</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="mf">0.5f</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="mf">0.5f</span><span class="p">)</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="n">height</span><span class="p">);</span>
<a id="__codelineno-19-82" name="__codelineno-19-82" href="#__codelineno-19-82"></a><span class="w">                </span><span class="kt">float</span><span class="w"> </span><span class="n">depth</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">screenSpaceCorner</span><span class="p">.</span><span class="n">z</span><span class="p">;</span>
<a id="__codelineno-19-83" name="__codelineno-19-83" href="#__codelineno-19-83"></a>
<a id="__codelineno-19-84" name="__codelineno-19-84" href="#__codelineno-19-84"></a><span class="w">                </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">x</span><span class="w"> </span><span class="o">&gt;=</span><span class="w"> </span><span class="mi">0</span><span class="w"> </span><span class="o">&amp;&amp;</span><span class="w"> </span><span class="n">x</span><span class="w"> </span><span class="o">&lt;</span><span class="w"> </span><span class="n">width</span><span class="w"> </span><span class="o">&amp;&amp;</span><span class="w"> </span><span class="n">y</span><span class="w"> </span><span class="o">&gt;=</span><span class="w"> </span><span class="mi">0</span><span class="w"> </span><span class="o">&amp;&amp;</span><span class="w"> </span><span class="n">y</span><span class="w"> </span><span class="o">&lt;</span><span class="w"> </span><span class="n">height</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-19-85" name="__codelineno-19-85" href="#__codelineno-19-85"></a><span class="w">                    </span><span class="kt">int</span><span class="w"> </span><span class="n">index</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">y</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="n">width</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="n">x</span><span class="p">;</span>
<a id="__codelineno-19-86" name="__codelineno-19-86" href="#__codelineno-19-86"></a><span class="w">                    </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">depth</span><span class="w"> </span><span class="o">&lt;</span><span class="w"> </span><span class="n">depthBuffer</span><span class="p">[</span><span class="n">index</span><span class="p">])</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-19-87" name="__codelineno-19-87" href="#__codelineno-19-87"></a><span class="w">                        </span><span class="n">depthBuffer</span><span class="p">[</span><span class="n">index</span><span class="p">]</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">depth</span><span class="p">;</span>
<a id="__codelineno-19-88" name="__codelineno-19-88" href="#__codelineno-19-88"></a><span class="w">                    </span><span class="p">}</span>
<a id="__codelineno-19-89" name="__codelineno-19-89" href="#__codelineno-19-89"></a><span class="w">                </span><span class="p">}</span>
<a id="__codelineno-19-90" name="__codelineno-19-90" href="#__codelineno-19-90"></a><span class="w">            </span><span class="p">}</span>
<a id="__codelineno-19-91" name="__codelineno-19-91" href="#__codelineno-19-91"></a><span class="w">        </span><span class="p">}</span>
<a id="__codelineno-19-92" name="__codelineno-19-92" href="#__codelineno-19-92"></a><span class="w">    </span><span class="p">}</span>
<a id="__codelineno-19-93" name="__codelineno-19-93" href="#__codelineno-19-93"></a>
<a id="__codelineno-19-94" name="__codelineno-19-94" href="#__codelineno-19-94"></a><span class="k">private</span><span class="o">:</span>
<a id="__codelineno-19-95" name="__codelineno-19-95" href="#__codelineno-19-95"></a><span class="w">    </span><span class="kt">int</span><span class="w"> </span><span class="n">width</span><span class="p">,</span><span class="w"> </span><span class="n">height</span><span class="p">;</span>
<a id="__codelineno-19-96" name="__codelineno-19-96" href="#__codelineno-19-96"></a><span class="w">    </span><span class="n">std</span><span class="o">::</span><span class="n">vector</span><span class="o">&lt;</span><span class="kt">float</span><span class="o">&gt;</span><span class="w"> </span><span class="n">depthBuffer</span><span class="p">;</span>
<a id="__codelineno-19-97" name="__codelineno-19-97" href="#__codelineno-19-97"></a><span class="p">};</span>
<a id="__codelineno-19-98" name="__codelineno-19-98" href="#__codelineno-19-98"></a>
<a id="__codelineno-19-99" name="__codelineno-19-99" href="#__codelineno-19-99"></a><span class="kt">int</span><span class="w"> </span><span class="nf">main</span><span class="p">()</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-19-100" name="__codelineno-19-100" href="#__codelineno-19-100"></a><span class="w">    </span><span class="kt">int</span><span class="w"> </span><span class="n">width</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">800</span><span class="p">;</span>
<a id="__codelineno-19-101" name="__codelineno-19-101" href="#__codelineno-19-101"></a><span class="w">    </span><span class="kt">int</span><span class="w"> </span><span class="n">height</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">600</span><span class="p">;</span>
<a id="__codelineno-19-102" name="__codelineno-19-102" href="#__codelineno-19-102"></a><span class="w">    </span><span class="n">OcclusionCulling</span><span class="w"> </span><span class="n">occlusionCulling</span><span class="p">(</span><span class="n">width</span><span class="p">,</span><span class="w"> </span><span class="n">height</span><span class="p">);</span>
<a id="__codelineno-19-103" name="__codelineno-19-103" href="#__codelineno-19-103"></a>
<a id="__codelineno-19-104" name="__codelineno-19-104" href="#__codelineno-19-104"></a><span class="w">    </span><span class="n">glm</span><span class="o">::</span><span class="n">mat4</span><span class="w"> </span><span class="n">viewMatrix</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">glm</span><span class="o">::</span><span class="n">lookAt</span><span class="p">(</span><span class="n">glm</span><span class="o">::</span><span class="n">vec3</span><span class="p">(</span><span class="mf">0.0f</span><span class="p">,</span><span class="w"> </span><span class="mf">0.0f</span><span class="p">,</span><span class="w"> </span><span class="mf">5.0f</span><span class="p">),</span><span class="w"> </span><span class="n">glm</span><span class="o">::</span><span class="n">vec3</span><span class="p">(</span><span class="mf">0.0f</span><span class="p">),</span><span class="w"> </span><span class="n">glm</span><span class="o">::</span><span class="n">vec3</span><span class="p">(</span><span class="mf">0.0f</span><span class="p">,</span><span class="w"> </span><span class="mf">1.0f</span><span class="p">,</span><span class="w"> </span><span class="mf">0.0f</span><span class="p">));</span>
<a id="__codelineno-19-105" name="__codelineno-19-105" href="#__codelineno-19-105"></a><span class="w">    </span><span class="n">glm</span><span class="o">::</span><span class="n">mat4</span><span class="w"> </span><span class="n">projectionMatrix</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">glm</span><span class="o">::</span><span class="n">perspective</span><span class="p">(</span><span class="n">glm</span><span class="o">::</span><span class="n">radians</span><span class="p">(</span><span class="mf">45.0f</span><span class="p">),</span><span class="w"> </span><span class="mf">4.0f</span><span class="w"> </span><span class="o">/</span><span class="w"> </span><span class="mf">3.0f</span><span class="p">,</span><span class="w"> </span><span class="mf">0.1f</span><span class="p">,</span><span class="w"> </span><span class="mf">100.0f</span><span class="p">);</span>
<a id="__codelineno-19-106" name="__codelineno-19-106" href="#__codelineno-19-106"></a><span class="w">    </span><span class="n">glm</span><span class="o">::</span><span class="n">mat4</span><span class="w"> </span><span class="n">viewProjMatrix</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">projectionMatrix</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="n">viewMatrix</span><span class="p">;</span>
<a id="__codelineno-19-107" name="__codelineno-19-107" href="#__codelineno-19-107"></a>
<a id="__codelineno-19-108" name="__codelineno-19-108" href="#__codelineno-19-108"></a><span class="w">    </span><span class="n">BoundingBox</span><span class="w"> </span><span class="n">occluder</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="n">glm</span><span class="o">::</span><span class="n">vec3</span><span class="p">(</span><span class="mf">-1.0f</span><span class="p">,</span><span class="w"> </span><span class="mf">-1.0f</span><span class="p">,</span><span class="w"> </span><span class="mf">-1.0f</span><span class="p">),</span><span class="w"> </span><span class="n">glm</span><span class="o">::</span><span class="n">vec3</span><span class="p">(</span><span class="mf">1.0f</span><span class="p">,</span><span class="w"> </span><span class="mf">1.0f</span><span class="p">,</span><span class="w"> </span><span class="mf">1.0f</span><span class="p">)</span><span class="w"> </span><span class="p">};</span>
<a id="__codelineno-19-109" name="__codelineno-19-109" href="#__codelineno-19-109"></a><span class="w">    </span><span class="n">BoundingBox</span><span class="w"> </span><span class="n">occludee</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="n">glm</span><span class="o">::</span><span class="n">vec3</span><span class="p">(</span><span class="mf">-0.5f</span><span class="p">,</span><span class="w"> </span><span class="mf">-0.5f</span><span class="p">,</span><span class="w"> </span><span class="mf">-0.5f</span><span class="p">),</span><span class="w"> </span><span class="n">glm</span><span class="o">::</span><span class="n">vec3</span><span class="p">(</span><span class="mf">0.5f</span><span class="p">,</span><span class="w"> </span><span class="mf">0.5f</span><span class="p">,</span><span class="w"> </span><span class="mf">0.5f</span><span class="p">)</span><span class="w"> </span><span class="p">};</span>
<a id="__codelineno-19-110" name="__codelineno-19-110" href="#__codelineno-19-110"></a>
<a id="__codelineno-19-111" name="__codelineno-19-111" href="#__codelineno-19-111"></a><span class="w">    </span><span class="c1">// Clear the depth buffer</span>
<a id="__codelineno-19-112" name="__codelineno-19-112" href="#__codelineno-19-112"></a><span class="w">    </span><span class="n">occlusionCulling</span><span class="p">.</span><span class="n">clearDepthBuffer</span><span class="p">();</span>
<a id="__codelineno-19-113" name="__codelineno-19-113" href="#__codelineno-19-113"></a>
<a id="__codelineno-19-114" name="__codelineno-19-114" href="#__codelineno-19-114"></a><span class="w">    </span><span class="c1">// Update depth buffer with occluder</span>
<a id="__codelineno-19-115" name="__codelineno-19-115" href="#__codelineno-19-115"></a><span class="w">    </span><span class="n">occlusionCulling</span><span class="p">.</span><span class="n">updateDepthBuffer</span><span class="p">(</span><span class="n">occluder</span><span class="p">,</span><span class="w"> </span><span class="n">viewProjMatrix</span><span class="p">);</span>
<a id="__codelineno-19-116" name="__codelineno-19-116" href="#__codelineno-19-116"></a>
<a id="__codelineno-19-117" name="__codelineno-19-117" href="#__codelineno-19-117"></a><span class="w">    </span><span class="c1">// Check if the occludee is occluded</span>
<a id="__codelineno-19-118" name="__codelineno-19-118" href="#__codelineno-19-118"></a><span class="w">    </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">occlusionCulling</span><span class="p">.</span><span class="n">isOccluded</span><span class="p">(</span><span class="n">occludee</span><span class="p">,</span><span class="w"> </span><span class="n">viewProjMatrix</span><span class="p">))</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-19-119" name="__codelineno-19-119" href="#__codelineno-19-119"></a><span class="w">        </span><span class="n">std</span><span class="o">::</span><span class="n">cout</span><span class="w"> </span><span class="o">&lt;&lt;</span><span class="w"> </span><span class="s">&quot;Occludee is occluded.&quot;</span><span class="w"> </span><span class="o">&lt;&lt;</span><span class="w"> </span><span class="n">std</span><span class="o">::</span><span class="n">endl</span><span class="p">;</span>
<a id="__codelineno-19-120" name="__codelineno-19-120" href="#__codelineno-19-120"></a><span class="w">    </span><span class="p">}</span><span class="w"> </span><span class="k">else</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-19-121" name="__codelineno-19-121" href="#__codelineno-19-121"></a><span class="w">        </span><span class="n">std</span><span class="o">::</span><span class="n">cout</span><span class="w"> </span><span class="o">&lt;&lt;</span><span class="w"> </span><span class="s">&quot;Occludee is visible.&quot;</span><span class="w"> </span><span class="o">&lt;&lt;</span><span class="w"> </span><span class="n">std</span><span class="o">::</span><span class="n">endl</span><span class="p">;</span>
<a id="__codelineno-19-122" name="__codelineno-19-122" href="#__codelineno-19-122"></a><span class="w">    </span><span class="p">}</span>
<a id="__codelineno-19-123" name="__codelineno-19-123" href="#__codelineno-19-123"></a>
<a id="__codelineno-19-124" name="__codelineno-19-124" href="#__codelineno-19-124"></a><span class="w">    </span><span class="k">return</span><span class="w"> </span><span class="mi">0</span><span class="p">;</span>
<a id="__codelineno-19-125" name="__codelineno-19-125" href="#__codelineno-19-125"></a><span class="p">}</span>
</code></pre></div>
<h3 id="explanation_1">Explanation</h3>
<ol>
<li>
<p><strong>OcclusionCulling Class:</strong></p>
<ul>
<li><strong>Constructor:</strong> Initializes the depth buffer with the screen dimensions and sets all values to the maximum possible depth.</li>
<li><strong>clearDepthBuffer:</strong> Resets the depth buffer at the beginning of each frame.</li>
<li><strong>isOccluded:</strong> Checks if the bounding box is occluded by projecting its corners to screen space and comparing depths with the depth buffer.</li>
<li><strong>updateDepthBuffer:</strong> Updates the depth buffer with the depth values of the bounding box's corners.</li>
</ul>
</li>
<li>
<p><strong>Main Function:</strong></p>
<ul>
<li><strong>View and Projection Matrices:</strong> Set up the view and projection matrices using <code>glm::lookAt</code> and <code>glm::perspective</code>.</li>
<li><strong>Occluder and Occludee:</strong> Define bounding boxes for an occluder and an occludee.</li>
<li><strong>Depth Buffer Update:</strong> Update the depth buffer with the occluder's bounding box.</li>
<li><strong>Occlusion Test:</strong> Check if the occludee is occluded.</li>
</ul>
</li>
</ol>
<p>This is a simplified example to demonstrate the concept. In practice, occlusion culling involves more sophisticated techniques and optimizations, such as hierarchical z-buffering, potentially visible set (PVS) computation, and hardware occlusion queries.</p>
<ol>
<li><strong>Shader Permutations</strong>: Create optimized shader variants for different material properties or lighting conditions.</li>
</ol>
<h3 id="deferred-rendering">Deferred Rendering</h3>
<p>Deferred Rendering is an advanced rendering technique that separates the geometry and lighting calculations into distinct passes. This approach allows for efficient handling of multiple light sources and complex lighting models, particularly in scenes with many objects and lights.</p>
<h4 id="implementation-overview_1">Implementation Overview:</h4>
<p>We'll implement a deferred rendering system that consists of a geometry pass, lighting pass, and final composition. This system will support multiple light types and can easily be extended with additional post-processing effects.</p>
<p>Key Components:</p>
<ol>
<li>G-Buffer generation</li>
<li>Light accumulation</li>
<li>Final composition</li>
<li>Support for multiple light types (point, spot, directional)</li>
</ol>
<p>Here's a professional-grade C++ implementation using a modern graphics API:</p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-20-1" name="__codelineno-20-1" href="#__codelineno-20-1"></a><span class="c1">// DeferredRenderer.h</span>
<a id="__codelineno-20-2" name="__codelineno-20-2" href="#__codelineno-20-2"></a><span class="cp">#pragma once</span>
<a id="__codelineno-20-3" name="__codelineno-20-3" href="#__codelineno-20-3"></a>
<a id="__codelineno-20-4" name="__codelineno-20-4" href="#__codelineno-20-4"></a><span class="cp">#include</span><span class="w"> </span><span class="cpf">&quot;RenderSystem.h&quot;</span>
<a id="__codelineno-20-5" name="__codelineno-20-5" href="#__codelineno-20-5"></a><span class="cp">#include</span><span class="w"> </span><span class="cpf">&quot;Shader.h&quot;</span>
<a id="__codelineno-20-6" name="__codelineno-20-6" href="#__codelineno-20-6"></a><span class="cp">#include</span><span class="w"> </span><span class="cpf">&quot;RenderTexture.h&quot;</span>
<a id="__codelineno-20-7" name="__codelineno-20-7" href="#__codelineno-20-7"></a><span class="cp">#include</span><span class="w"> </span><span class="cpf">&quot;Scene.h&quot;</span>
<a id="__codelineno-20-8" name="__codelineno-20-8" href="#__codelineno-20-8"></a><span class="cp">#include</span><span class="w"> </span><span class="cpf">&quot;Camera.h&quot;</span>
<a id="__codelineno-20-9" name="__codelineno-20-9" href="#__codelineno-20-9"></a><span class="cp">#include</span><span class="w"> </span><span class="cpf">&quot;Light.h&quot;</span>
<a id="__codelineno-20-10" name="__codelineno-20-10" href="#__codelineno-20-10"></a>
<a id="__codelineno-20-11" name="__codelineno-20-11" href="#__codelineno-20-11"></a><span class="k">class</span><span class="w"> </span><span class="nc">DeferredRenderer</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-20-12" name="__codelineno-20-12" href="#__codelineno-20-12"></a><span class="k">public</span><span class="o">:</span>
<a id="__codelineno-20-13" name="__codelineno-20-13" href="#__codelineno-20-13"></a><span class="w">    </span><span class="n">DeferredRenderer</span><span class="p">(</span><span class="n">RenderSystem</span><span class="o">*</span><span class="w"> </span><span class="n">renderSystem</span><span class="p">,</span><span class="w"> </span><span class="kt">int</span><span class="w"> </span><span class="n">width</span><span class="p">,</span><span class="w"> </span><span class="kt">int</span><span class="w"> </span><span class="n">height</span><span class="p">);</span>
<a id="__codelineno-20-14" name="__codelineno-20-14" href="#__codelineno-20-14"></a><span class="w">    </span><span class="o">~</span><span class="n">DeferredRenderer</span><span class="p">();</span>
<a id="__codelineno-20-15" name="__codelineno-20-15" href="#__codelineno-20-15"></a>
<a id="__codelineno-20-16" name="__codelineno-20-16" href="#__codelineno-20-16"></a><span class="w">    </span><span class="kt">void</span><span class="w"> </span><span class="nf">Render</span><span class="p">(</span><span class="k">const</span><span class="w"> </span><span class="n">Scene</span><span class="o">&amp;</span><span class="w"> </span><span class="n">scene</span><span class="p">,</span><span class="w"> </span><span class="k">const</span><span class="w"> </span><span class="n">Camera</span><span class="o">&amp;</span><span class="w"> </span><span class="n">camera</span><span class="p">);</span>
<a id="__codelineno-20-17" name="__codelineno-20-17" href="#__codelineno-20-17"></a>
<a id="__codelineno-20-18" name="__codelineno-20-18" href="#__codelineno-20-18"></a><span class="k">private</span><span class="o">:</span>
<a id="__codelineno-20-19" name="__codelineno-20-19" href="#__codelineno-20-19"></a><span class="w">    </span><span class="kt">void</span><span class="w"> </span><span class="n">CreateGBuffer</span><span class="p">();</span>
<a id="__codelineno-20-20" name="__codelineno-20-20" href="#__codelineno-20-20"></a><span class="w">    </span><span class="kt">void</span><span class="w"> </span><span class="nf">GeometryPass</span><span class="p">(</span><span class="k">const</span><span class="w"> </span><span class="n">Scene</span><span class="o">&amp;</span><span class="w"> </span><span class="n">scene</span><span class="p">,</span><span class="w"> </span><span class="k">const</span><span class="w"> </span><span class="n">Camera</span><span class="o">&amp;</span><span class="w"> </span><span class="n">camera</span><span class="p">);</span>
<a id="__codelineno-20-21" name="__codelineno-20-21" href="#__codelineno-20-21"></a><span class="w">    </span><span class="kt">void</span><span class="w"> </span><span class="nf">LightingPass</span><span class="p">(</span><span class="k">const</span><span class="w"> </span><span class="n">Scene</span><span class="o">&amp;</span><span class="w"> </span><span class="n">scene</span><span class="p">,</span><span class="w"> </span><span class="k">const</span><span class="w"> </span><span class="n">Camera</span><span class="o">&amp;</span><span class="w"> </span><span class="n">camera</span><span class="p">);</span>
<a id="__codelineno-20-22" name="__codelineno-20-22" href="#__codelineno-20-22"></a><span class="w">    </span><span class="kt">void</span><span class="w"> </span><span class="nf">CompositionPass</span><span class="p">();</span>
<a id="__codelineno-20-23" name="__codelineno-20-23" href="#__codelineno-20-23"></a>
<a id="__codelineno-20-24" name="__codelineno-20-24" href="#__codelineno-20-24"></a><span class="w">    </span><span class="n">RenderSystem</span><span class="o">*</span><span class="w"> </span><span class="n">m_RenderSystem</span><span class="p">;</span>
<a id="__codelineno-20-25" name="__codelineno-20-25" href="#__codelineno-20-25"></a><span class="w">    </span><span class="kt">int</span><span class="w"> </span><span class="n">m_Width</span><span class="p">,</span><span class="w"> </span><span class="n">m_Height</span><span class="p">;</span>
<a id="__codelineno-20-26" name="__codelineno-20-26" href="#__codelineno-20-26"></a>
<a id="__codelineno-20-27" name="__codelineno-20-27" href="#__codelineno-20-27"></a><span class="w">    </span><span class="k">struct</span><span class="w"> </span><span class="nc">GBuffer</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-20-28" name="__codelineno-20-28" href="#__codelineno-20-28"></a><span class="w">        </span><span class="n">RenderTexture</span><span class="w"> </span><span class="n">AlbedoRoughness</span><span class="p">;</span>
<a id="__codelineno-20-29" name="__codelineno-20-29" href="#__codelineno-20-29"></a><span class="w">        </span><span class="n">RenderTexture</span><span class="w"> </span><span class="n">NormalMetallic</span><span class="p">;</span>
<a id="__codelineno-20-30" name="__codelineno-20-30" href="#__codelineno-20-30"></a><span class="w">        </span><span class="n">RenderTexture</span><span class="w"> </span><span class="n">Position</span><span class="p">;</span>
<a id="__codelineno-20-31" name="__codelineno-20-31" href="#__codelineno-20-31"></a><span class="w">        </span><span class="n">RenderTexture</span><span class="w"> </span><span class="n">Depth</span><span class="p">;</span>
<a id="__codelineno-20-32" name="__codelineno-20-32" href="#__codelineno-20-32"></a><span class="w">    </span><span class="p">}</span><span class="w"> </span><span class="n">m_GBuffer</span><span class="p">;</span>
<a id="__codelineno-20-33" name="__codelineno-20-33" href="#__codelineno-20-33"></a>
<a id="__codelineno-20-34" name="__codelineno-20-34" href="#__codelineno-20-34"></a><span class="w">    </span><span class="n">RenderTexture</span><span class="w"> </span><span class="n">m_LightAccumulation</span><span class="p">;</span>
<a id="__codelineno-20-35" name="__codelineno-20-35" href="#__codelineno-20-35"></a>
<a id="__codelineno-20-36" name="__codelineno-20-36" href="#__codelineno-20-36"></a><span class="w">    </span><span class="n">Shader</span><span class="w"> </span><span class="n">m_GeometryPassShader</span><span class="p">;</span>
<a id="__codelineno-20-37" name="__codelineno-20-37" href="#__codelineno-20-37"></a><span class="w">    </span><span class="n">Shader</span><span class="w"> </span><span class="n">m_PointLightShader</span><span class="p">;</span>
<a id="__codelineno-20-38" name="__codelineno-20-38" href="#__codelineno-20-38"></a><span class="w">    </span><span class="n">Shader</span><span class="w"> </span><span class="n">m_SpotLightShader</span><span class="p">;</span>
<a id="__codelineno-20-39" name="__codelineno-20-39" href="#__codelineno-20-39"></a><span class="w">    </span><span class="n">Shader</span><span class="w"> </span><span class="n">m_DirectionalLightShader</span><span class="p">;</span>
<a id="__codelineno-20-40" name="__codelineno-20-40" href="#__codelineno-20-40"></a><span class="w">    </span><span class="n">Shader</span><span class="w"> </span><span class="n">m_CompositionShader</span><span class="p">;</span>
<a id="__codelineno-20-41" name="__codelineno-20-41" href="#__codelineno-20-41"></a><span class="p">};</span>
<a id="__codelineno-20-42" name="__codelineno-20-42" href="#__codelineno-20-42"></a>
<a id="__codelineno-20-43" name="__codelineno-20-43" href="#__codelineno-20-43"></a><span class="c1">// DeferredRenderer.cpp</span>
<a id="__codelineno-20-44" name="__codelineno-20-44" href="#__codelineno-20-44"></a><span class="cp">#include</span><span class="w"> </span><span class="cpf">&quot;DeferredRenderer.h&quot;</span>
<a id="__codelineno-20-45" name="__codelineno-20-45" href="#__codelineno-20-45"></a>
<a id="__codelineno-20-46" name="__codelineno-20-46" href="#__codelineno-20-46"></a><span class="n">DeferredRenderer</span><span class="o">::</span><span class="n">DeferredRenderer</span><span class="p">(</span><span class="n">RenderSystem</span><span class="o">*</span><span class="w"> </span><span class="n">renderSystem</span><span class="p">,</span><span class="w"> </span><span class="kt">int</span><span class="w"> </span><span class="n">width</span><span class="p">,</span><span class="w"> </span><span class="kt">int</span><span class="w"> </span><span class="n">height</span><span class="p">)</span>
<a id="__codelineno-20-47" name="__codelineno-20-47" href="#__codelineno-20-47"></a><span class="w">    </span><span class="o">:</span><span class="w"> </span><span class="n">m_RenderSystem</span><span class="p">(</span><span class="n">renderSystem</span><span class="p">),</span><span class="w"> </span><span class="n">m_Width</span><span class="p">(</span><span class="n">width</span><span class="p">),</span><span class="w"> </span><span class="n">m_Height</span><span class="p">(</span><span class="n">height</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-20-48" name="__codelineno-20-48" href="#__codelineno-20-48"></a><span class="w">    </span><span class="n">CreateGBuffer</span><span class="p">();</span>
<a id="__codelineno-20-49" name="__codelineno-20-49" href="#__codelineno-20-49"></a>
<a id="__codelineno-20-50" name="__codelineno-20-50" href="#__codelineno-20-50"></a><span class="w">    </span><span class="n">m_GeometryPassShader</span><span class="p">.</span><span class="n">Initialize</span><span class="p">(</span><span class="n">renderSystem</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;Shaders/GeometryPass.vert&quot;</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;Shaders/GeometryPass.frag&quot;</span><span class="p">);</span>
<a id="__codelineno-20-51" name="__codelineno-20-51" href="#__codelineno-20-51"></a><span class="w">    </span><span class="n">m_PointLightShader</span><span class="p">.</span><span class="n">Initialize</span><span class="p">(</span><span class="n">renderSystem</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;Shaders/FullscreenQuad.vert&quot;</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;Shaders/PointLight.frag&quot;</span><span class="p">);</span>
<a id="__codelineno-20-52" name="__codelineno-20-52" href="#__codelineno-20-52"></a><span class="w">    </span><span class="n">m_SpotLightShader</span><span class="p">.</span><span class="n">Initialize</span><span class="p">(</span><span class="n">renderSystem</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;Shaders/FullscreenQuad.vert&quot;</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;Shaders/SpotLight.frag&quot;</span><span class="p">);</span>
<a id="__codelineno-20-53" name="__codelineno-20-53" href="#__codelineno-20-53"></a><span class="w">    </span><span class="n">m_DirectionalLightShader</span><span class="p">.</span><span class="n">Initialize</span><span class="p">(</span><span class="n">renderSystem</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;Shaders/FullscreenQuad.vert&quot;</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;Shaders/DirectionalLight.frag&quot;</span><span class="p">);</span>
<a id="__codelineno-20-54" name="__codelineno-20-54" href="#__codelineno-20-54"></a><span class="w">    </span><span class="n">m_CompositionShader</span><span class="p">.</span><span class="n">Initialize</span><span class="p">(</span><span class="n">renderSystem</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;Shaders/FullscreenQuad.vert&quot;</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;Shaders/Composition.frag&quot;</span><span class="p">);</span>
<a id="__codelineno-20-55" name="__codelineno-20-55" href="#__codelineno-20-55"></a><span class="p">}</span>
<a id="__codelineno-20-56" name="__codelineno-20-56" href="#__codelineno-20-56"></a>
<a id="__codelineno-20-57" name="__codelineno-20-57" href="#__codelineno-20-57"></a><span class="kt">void</span><span class="w"> </span><span class="n">DeferredRenderer</span><span class="o">::</span><span class="n">CreateGBuffer</span><span class="p">()</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-20-58" name="__codelineno-20-58" href="#__codelineno-20-58"></a><span class="w">    </span><span class="n">m_GBuffer</span><span class="p">.</span><span class="n">AlbedoRoughness</span><span class="p">.</span><span class="n">Create</span><span class="p">(</span><span class="n">m_RenderSystem</span><span class="p">,</span><span class="w"> </span><span class="n">m_Width</span><span class="p">,</span><span class="w"> </span><span class="n">m_Height</span><span class="p">,</span><span class="w"> </span><span class="n">TextureFormat</span><span class="o">::</span><span class="n">RGBA8_UNORM</span><span class="p">);</span>
<a id="__codelineno-20-59" name="__codelineno-20-59" href="#__codelineno-20-59"></a><span class="w">    </span><span class="n">m_GBuffer</span><span class="p">.</span><span class="n">NormalMetallic</span><span class="p">.</span><span class="n">Create</span><span class="p">(</span><span class="n">m_RenderSystem</span><span class="p">,</span><span class="w"> </span><span class="n">m_Width</span><span class="p">,</span><span class="w"> </span><span class="n">m_Height</span><span class="p">,</span><span class="w"> </span><span class="n">TextureFormat</span><span class="o">::</span><span class="n">RGBA16_FLOAT</span><span class="p">);</span>
<a id="__codelineno-20-60" name="__codelineno-20-60" href="#__codelineno-20-60"></a><span class="w">    </span><span class="n">m_GBuffer</span><span class="p">.</span><span class="n">Position</span><span class="p">.</span><span class="n">Create</span><span class="p">(</span><span class="n">m_RenderSystem</span><span class="p">,</span><span class="w"> </span><span class="n">m_Width</span><span class="p">,</span><span class="w"> </span><span class="n">m_Height</span><span class="p">,</span><span class="w"> </span><span class="n">TextureFormat</span><span class="o">::</span><span class="n">RGB16_FLOAT</span><span class="p">);</span>
<a id="__codelineno-20-61" name="__codelineno-20-61" href="#__codelineno-20-61"></a><span class="w">    </span><span class="n">m_GBuffer</span><span class="p">.</span><span class="n">Depth</span><span class="p">.</span><span class="n">Create</span><span class="p">(</span><span class="n">m_RenderSystem</span><span class="p">,</span><span class="w"> </span><span class="n">m_Width</span><span class="p">,</span><span class="w"> </span><span class="n">m_Height</span><span class="p">,</span><span class="w"> </span><span class="n">TextureFormat</span><span class="o">::</span><span class="n">D32_FLOAT</span><span class="p">);</span>
<a id="__codelineno-20-62" name="__codelineno-20-62" href="#__codelineno-20-62"></a>
<a id="__codelineno-20-63" name="__codelineno-20-63" href="#__codelineno-20-63"></a><span class="w">    </span><span class="n">m_LightAccumulation</span><span class="p">.</span><span class="n">Create</span><span class="p">(</span><span class="n">m_RenderSystem</span><span class="p">,</span><span class="w"> </span><span class="n">m_Width</span><span class="p">,</span><span class="w"> </span><span class="n">m_Height</span><span class="p">,</span><span class="w"> </span><span class="n">TextureFormat</span><span class="o">::</span><span class="n">RGBA16_FLOAT</span><span class="p">);</span>
<a id="__codelineno-20-64" name="__codelineno-20-64" href="#__codelineno-20-64"></a><span class="p">}</span>
<a id="__codelineno-20-65" name="__codelineno-20-65" href="#__codelineno-20-65"></a>
<a id="__codelineno-20-66" name="__codelineno-20-66" href="#__codelineno-20-66"></a><span class="kt">void</span><span class="w"> </span><span class="n">DeferredRenderer</span><span class="o">::</span><span class="n">Render</span><span class="p">(</span><span class="k">const</span><span class="w"> </span><span class="n">Scene</span><span class="o">&amp;</span><span class="w"> </span><span class="n">scene</span><span class="p">,</span><span class="w"> </span><span class="k">const</span><span class="w"> </span><span class="n">Camera</span><span class="o">&amp;</span><span class="w"> </span><span class="n">camera</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-20-67" name="__codelineno-20-67" href="#__codelineno-20-67"></a><span class="w">    </span><span class="n">GeometryPass</span><span class="p">(</span><span class="n">scene</span><span class="p">,</span><span class="w"> </span><span class="n">camera</span><span class="p">);</span>
<a id="__codelineno-20-68" name="__codelineno-20-68" href="#__codelineno-20-68"></a><span class="w">    </span><span class="n">LightingPass</span><span class="p">(</span><span class="n">scene</span><span class="p">,</span><span class="w"> </span><span class="n">camera</span><span class="p">);</span>
<a id="__codelineno-20-69" name="__codelineno-20-69" href="#__codelineno-20-69"></a><span class="w">    </span><span class="n">CompositionPass</span><span class="p">();</span>
<a id="__codelineno-20-70" name="__codelineno-20-70" href="#__codelineno-20-70"></a><span class="p">}</span>
<a id="__codelineno-20-71" name="__codelineno-20-71" href="#__codelineno-20-71"></a>
<a id="__codelineno-20-72" name="__codelineno-20-72" href="#__codelineno-20-72"></a><span class="kt">void</span><span class="w"> </span><span class="n">DeferredRenderer</span><span class="o">::</span><span class="n">GeometryPass</span><span class="p">(</span><span class="k">const</span><span class="w"> </span><span class="n">Scene</span><span class="o">&amp;</span><span class="w"> </span><span class="n">scene</span><span class="p">,</span><span class="w"> </span><span class="k">const</span><span class="w"> </span><span class="n">Camera</span><span class="o">&amp;</span><span class="w"> </span><span class="n">camera</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-20-73" name="__codelineno-20-73" href="#__codelineno-20-73"></a><span class="w">    </span><span class="n">m_RenderSystem</span><span class="o">-&gt;</span><span class="n">SetRenderTargets</span><span class="p">({</span>
<a id="__codelineno-20-74" name="__codelineno-20-74" href="#__codelineno-20-74"></a><span class="w">        </span><span class="o">&amp;</span><span class="n">m_GBuffer</span><span class="p">.</span><span class="n">AlbedoRoughness</span><span class="p">,</span>
<a id="__codelineno-20-75" name="__codelineno-20-75" href="#__codelineno-20-75"></a><span class="w">        </span><span class="o">&amp;</span><span class="n">m_GBuffer</span><span class="p">.</span><span class="n">NormalMetallic</span><span class="p">,</span>
<a id="__codelineno-20-76" name="__codelineno-20-76" href="#__codelineno-20-76"></a><span class="w">        </span><span class="o">&amp;</span><span class="n">m_GBuffer</span><span class="p">.</span><span class="n">Position</span>
<a id="__codelineno-20-77" name="__codelineno-20-77" href="#__codelineno-20-77"></a><span class="w">    </span><span class="p">},</span><span class="w"> </span><span class="o">&amp;</span><span class="n">m_GBuffer</span><span class="p">.</span><span class="n">Depth</span><span class="p">);</span>
<a id="__codelineno-20-78" name="__codelineno-20-78" href="#__codelineno-20-78"></a><span class="w">    </span><span class="n">m_RenderSystem</span><span class="o">-&gt;</span><span class="n">Clear</span><span class="p">(</span><span class="n">ClearFlags</span><span class="o">::</span><span class="n">Color</span><span class="w"> </span><span class="o">|</span><span class="w"> </span><span class="n">ClearFlags</span><span class="o">::</span><span class="n">Depth</span><span class="p">);</span>
<a id="__codelineno-20-79" name="__codelineno-20-79" href="#__codelineno-20-79"></a>
<a id="__codelineno-20-80" name="__codelineno-20-80" href="#__codelineno-20-80"></a><span class="w">    </span><span class="n">m_GeometryPassShader</span><span class="p">.</span><span class="n">Bind</span><span class="p">();</span>
<a id="__codelineno-20-81" name="__codelineno-20-81" href="#__codelineno-20-81"></a><span class="w">    </span><span class="n">m_GeometryPassShader</span><span class="p">.</span><span class="n">SetMatrix</span><span class="p">(</span><span class="s">&quot;viewProjection&quot;</span><span class="p">,</span><span class="w"> </span><span class="n">camera</span><span class="p">.</span><span class="n">GetViewProjectionMatrix</span><span class="p">());</span>
<a id="__codelineno-20-82" name="__codelineno-20-82" href="#__codelineno-20-82"></a>
<a id="__codelineno-20-83" name="__codelineno-20-83" href="#__codelineno-20-83"></a><span class="w">    </span><span class="k">for</span><span class="w"> </span><span class="p">(</span><span class="k">const</span><span class="w"> </span><span class="k">auto</span><span class="o">&amp;</span><span class="w"> </span><span class="n">object</span><span class="w"> </span><span class="o">:</span><span class="w"> </span><span class="n">scene</span><span class="p">.</span><span class="n">GetObjects</span><span class="p">())</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-20-84" name="__codelineno-20-84" href="#__codelineno-20-84"></a><span class="w">        </span><span class="n">m_GeometryPassShader</span><span class="p">.</span><span class="n">SetMatrix</span><span class="p">(</span><span class="s">&quot;model&quot;</span><span class="p">,</span><span class="w"> </span><span class="n">object</span><span class="p">.</span><span class="n">GetTransform</span><span class="p">());</span>
<a id="__codelineno-20-85" name="__codelineno-20-85" href="#__codelineno-20-85"></a><span class="w">        </span><span class="n">object</span><span class="p">.</span><span class="n">Render</span><span class="p">();</span>
<a id="__codelineno-20-86" name="__codelineno-20-86" href="#__codelineno-20-86"></a><span class="w">    </span><span class="p">}</span>
<a id="__codelineno-20-87" name="__codelineno-20-87" href="#__codelineno-20-87"></a><span class="p">}</span>
<a id="__codelineno-20-88" name="__codelineno-20-88" href="#__codelineno-20-88"></a>
<a id="__codelineno-20-89" name="__codelineno-20-89" href="#__codelineno-20-89"></a><span class="kt">void</span><span class="w"> </span><span class="n">DeferredRenderer</span><span class="o">::</span><span class="n">LightingPass</span><span class="p">(</span><span class="k">const</span><span class="w"> </span><span class="n">Scene</span><span class="o">&amp;</span><span class="w"> </span><span class="n">scene</span><span class="p">,</span><span class="w"> </span><span class="k">const</span><span class="w"> </span><span class="n">Camera</span><span class="o">&amp;</span><span class="w"> </span><span class="n">camera</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-20-90" name="__codelineno-20-90" href="#__codelineno-20-90"></a><span class="w">    </span><span class="n">m_RenderSystem</span><span class="o">-&gt;</span><span class="n">SetRenderTarget</span><span class="p">(</span><span class="o">&amp;</span><span class="n">m_LightAccumulation</span><span class="p">);</span>
<a id="__codelineno-20-91" name="__codelineno-20-91" href="#__codelineno-20-91"></a><span class="w">    </span><span class="n">m_RenderSystem</span><span class="o">-&gt;</span><span class="n">Clear</span><span class="p">(</span><span class="n">ClearFlags</span><span class="o">::</span><span class="n">Color</span><span class="p">);</span>
<a id="__codelineno-20-92" name="__codelineno-20-92" href="#__codelineno-20-92"></a>
<a id="__codelineno-20-93" name="__codelineno-20-93" href="#__codelineno-20-93"></a><span class="w">    </span><span class="c1">// Bind G-Buffer textures</span>
<a id="__codelineno-20-94" name="__codelineno-20-94" href="#__codelineno-20-94"></a><span class="w">    </span><span class="n">m_RenderSystem</span><span class="o">-&gt;</span><span class="n">SetTexture</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="w"> </span><span class="n">m_GBuffer</span><span class="p">.</span><span class="n">AlbedoRoughness</span><span class="p">);</span>
<a id="__codelineno-20-95" name="__codelineno-20-95" href="#__codelineno-20-95"></a><span class="w">    </span><span class="n">m_RenderSystem</span><span class="o">-&gt;</span><span class="n">SetTexture</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span><span class="w"> </span><span class="n">m_GBuffer</span><span class="p">.</span><span class="n">NormalMetallic</span><span class="p">);</span>
<a id="__codelineno-20-96" name="__codelineno-20-96" href="#__codelineno-20-96"></a><span class="w">    </span><span class="n">m_RenderSystem</span><span class="o">-&gt;</span><span class="n">SetTexture</span><span class="p">(</span><span class="mi">2</span><span class="p">,</span><span class="w"> </span><span class="n">m_GBuffer</span><span class="p">.</span><span class="n">Position</span><span class="p">);</span>
<a id="__codelineno-20-97" name="__codelineno-20-97" href="#__codelineno-20-97"></a><span class="w">    </span><span class="n">m_RenderSystem</span><span class="o">-&gt;</span><span class="n">SetTexture</span><span class="p">(</span><span class="mi">3</span><span class="p">,</span><span class="w"> </span><span class="n">m_GBuffer</span><span class="p">.</span><span class="n">Depth</span><span class="p">);</span>
<a id="__codelineno-20-98" name="__codelineno-20-98" href="#__codelineno-20-98"></a>
<a id="__codelineno-20-99" name="__codelineno-20-99" href="#__codelineno-20-99"></a><span class="w">    </span><span class="k">for</span><span class="w"> </span><span class="p">(</span><span class="k">const</span><span class="w"> </span><span class="k">auto</span><span class="o">&amp;</span><span class="w"> </span><span class="n">light</span><span class="w"> </span><span class="o">:</span><span class="w"> </span><span class="n">scene</span><span class="p">.</span><span class="n">GetLights</span><span class="p">())</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-20-100" name="__codelineno-20-100" href="#__codelineno-20-100"></a><span class="w">        </span><span class="k">switch</span><span class="w"> </span><span class="p">(</span><span class="n">light</span><span class="p">.</span><span class="n">GetType</span><span class="p">())</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-20-101" name="__codelineno-20-101" href="#__codelineno-20-101"></a><span class="w">            </span><span class="k">case</span><span class="w"> </span><span class="no">LightType</span><span class="o">::</span><span class="no">Point</span><span class="p">:</span>
<a id="__codelineno-20-102" name="__codelineno-20-102" href="#__codelineno-20-102"></a><span class="w">                </span><span class="n">m_PointLightShader</span><span class="p">.</span><span class="n">Bind</span><span class="p">();</span>
<a id="__codelineno-20-103" name="__codelineno-20-103" href="#__codelineno-20-103"></a><span class="w">                </span><span class="n">m_PointLightShader</span><span class="p">.</span><span class="n">SetVector3</span><span class="p">(</span><span class="s">&quot;lightPosition&quot;</span><span class="p">,</span><span class="w"> </span><span class="n">light</span><span class="p">.</span><span class="n">GetPosition</span><span class="p">());</span>
<a id="__codelineno-20-104" name="__codelineno-20-104" href="#__codelineno-20-104"></a><span class="w">                </span><span class="n">m_PointLightShader</span><span class="p">.</span><span class="n">SetVector3</span><span class="p">(</span><span class="s">&quot;lightColor&quot;</span><span class="p">,</span><span class="w"> </span><span class="n">light</span><span class="p">.</span><span class="n">GetColor</span><span class="p">());</span>
<a id="__codelineno-20-105" name="__codelineno-20-105" href="#__codelineno-20-105"></a><span class="w">                </span><span class="n">m_PointLightShader</span><span class="p">.</span><span class="n">SetFloat</span><span class="p">(</span><span class="s">&quot;lightRadius&quot;</span><span class="p">,</span><span class="w"> </span><span class="n">light</span><span class="p">.</span><span class="n">GetRadius</span><span class="p">());</span>
<a id="__codelineno-20-106" name="__codelineno-20-106" href="#__codelineno-20-106"></a><span class="w">                </span><span class="k">break</span><span class="p">;</span>
<a id="__codelineno-20-107" name="__codelineno-20-107" href="#__codelineno-20-107"></a><span class="w">            </span><span class="k">case</span><span class="w"> </span><span class="no">LightType</span><span class="o">::</span><span class="no">Spot</span><span class="p">:</span>
<a id="__codelineno-20-108" name="__codelineno-20-108" href="#__codelineno-20-108"></a><span class="w">                </span><span class="n">m_SpotLightShader</span><span class="p">.</span><span class="n">Bind</span><span class="p">();</span>
<a id="__codelineno-20-109" name="__codelineno-20-109" href="#__codelineno-20-109"></a><span class="w">                </span><span class="n">m_SpotLightShader</span><span class="p">.</span><span class="n">SetVector3</span><span class="p">(</span><span class="s">&quot;lightPosition&quot;</span><span class="p">,</span><span class="w"> </span><span class="n">light</span><span class="p">.</span><span class="n">GetPosition</span><span class="p">());</span>
<a id="__codelineno-20-110" name="__codelineno-20-110" href="#__codelineno-20-110"></a><span class="w">                </span><span class="n">m_SpotLightShader</span><span class="p">.</span><span class="n">SetVector3</span><span class="p">(</span><span class="s">&quot;lightDirection&quot;</span><span class="p">,</span><span class="w"> </span><span class="n">light</span><span class="p">.</span><span class="n">GetDirection</span><span class="p">());</span>
<a id="__codelineno-20-111" name="__codelineno-20-111" href="#__codelineno-20-111"></a><span class="w">                </span><span class="n">m_SpotLightShader</span><span class="p">.</span><span class="n">SetVector3</span><span class="p">(</span><span class="s">&quot;lightColor&quot;</span><span class="p">,</span><span class="w"> </span><span class="n">light</span><span class="p">.</span><span class="n">GetColor</span><span class="p">());</span>
<a id="__codelineno-20-112" name="__codelineno-20-112" href="#__codelineno-20-112"></a><span class="w">                </span><span class="n">m_SpotLightShader</span><span class="p">.</span><span class="n">SetFloat</span><span class="p">(</span><span class="s">&quot;lightAngle&quot;</span><span class="p">,</span><span class="w"> </span><span class="n">light</span><span class="p">.</span><span class="n">GetAngle</span><span class="p">());</span>
<a id="__codelineno-20-113" name="__codelineno-20-113" href="#__codelineno-20-113"></a><span class="w">                </span><span class="k">break</span><span class="p">;</span>
<a id="__codelineno-20-114" name="__codelineno-20-114" href="#__codelineno-20-114"></a><span class="w">            </span><span class="k">case</span><span class="w"> </span><span class="no">LightType</span><span class="o">::</span><span class="no">Directional</span><span class="p">:</span>
<a id="__codelineno-20-115" name="__codelineno-20-115" href="#__codelineno-20-115"></a><span class="w">                </span><span class="n">m_DirectionalLightShader</span><span class="p">.</span><span class="n">Bind</span><span class="p">();</span>
<a id="__codelineno-20-116" name="__codelineno-20-116" href="#__codelineno-20-116"></a><span class="w">                </span><span class="n">m_DirectionalLightShader</span><span class="p">.</span><span class="n">SetVector3</span><span class="p">(</span><span class="s">&quot;lightDirection&quot;</span><span class="p">,</span><span class="w"> </span><span class="n">light</span><span class="p">.</span><span class="n">GetDirection</span><span class="p">());</span>
<a id="__codelineno-20-117" name="__codelineno-20-117" href="#__codelineno-20-117"></a><span class="w">                </span><span class="n">m_DirectionalLightShader</span><span class="p">.</span><span class="n">SetVector3</span><span class="p">(</span><span class="s">&quot;lightColor&quot;</span><span class="p">,</span><span class="w"> </span><span class="n">light</span><span class="p">.</span><span class="n">GetColor</span><span class="p">());</span>
<a id="__codelineno-20-118" name="__codelineno-20-118" href="#__codelineno-20-118"></a><span class="w">                </span><span class="k">break</span><span class="p">;</span>
<a id="__codelineno-20-119" name="__codelineno-20-119" href="#__codelineno-20-119"></a><span class="w">        </span><span class="p">}</span>
<a id="__codelineno-20-120" name="__codelineno-20-120" href="#__codelineno-20-120"></a><span class="w">        </span><span class="n">m_RenderSystem</span><span class="o">-&gt;</span><span class="n">DrawFullscreenQuad</span><span class="p">();</span>
<a id="__codelineno-20-121" name="__codelineno-20-121" href="#__codelineno-20-121"></a><span class="w">    </span><span class="p">}</span>
<a id="__codelineno-20-122" name="__codelineno-20-122" href="#__codelineno-20-122"></a><span class="p">}</span>
<a id="__codelineno-20-123" name="__codelineno-20-123" href="#__codelineno-20-123"></a>
<a id="__codelineno-20-124" name="__codelineno-20-124" href="#__codelineno-20-124"></a><span class="kt">void</span><span class="w"> </span><span class="n">DeferredRenderer</span><span class="o">::</span><span class="n">CompositionPass</span><span class="p">()</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-20-125" name="__codelineno-20-125" href="#__codelineno-20-125"></a><span class="w">    </span><span class="n">m_RenderSystem</span><span class="o">-&gt;</span><span class="n">SetRenderTarget</span><span class="p">(</span><span class="n">m_RenderSystem</span><span class="o">-&gt;</span><span class="n">GetBackBuffer</span><span class="p">());</span>
<a id="__codelineno-20-126" name="__codelineno-20-126" href="#__codelineno-20-126"></a>
<a id="__codelineno-20-127" name="__codelineno-20-127" href="#__codelineno-20-127"></a><span class="w">    </span><span class="n">m_CompositionShader</span><span class="p">.</span><span class="n">Bind</span><span class="p">();</span>
<a id="__codelineno-20-128" name="__codelineno-20-128" href="#__codelineno-20-128"></a><span class="w">    </span><span class="n">m_RenderSystem</span><span class="o">-&gt;</span><span class="n">SetTexture</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="w"> </span><span class="n">m_GBuffer</span><span class="p">.</span><span class="n">AlbedoRoughness</span><span class="p">);</span>
<a id="__codelineno-20-129" name="__codelineno-20-129" href="#__codelineno-20-129"></a><span class="w">    </span><span class="n">m_RenderSystem</span><span class="o">-&gt;</span><span class="n">SetTexture</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span><span class="w"> </span><span class="n">m_LightAccumulation</span><span class="p">);</span>
<a id="__codelineno-20-130" name="__codelineno-20-130" href="#__codelineno-20-130"></a>
<a id="__codelineno-20-131" name="__codelineno-20-131" href="#__codelineno-20-131"></a><span class="w">    </span><span class="n">m_RenderSystem</span><span class="o">-&gt;</span><span class="n">DrawFullscreenQuad</span><span class="p">();</span>
<a id="__codelineno-20-132" name="__codelineno-20-132" href="#__codelineno-20-132"></a><span class="p">}</span>
</code></pre></div>
<p>Now, let's look at the shader code for the various passes:</p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-21-1" name="__codelineno-21-1" href="#__codelineno-21-1"></a><span class="c1">// GeometryPass.vert</span>
<a id="__codelineno-21-2" name="__codelineno-21-2" href="#__codelineno-21-2"></a><span class="cp">#version 450</span>
<a id="__codelineno-21-3" name="__codelineno-21-3" href="#__codelineno-21-3"></a>
<a id="__codelineno-21-4" name="__codelineno-21-4" href="#__codelineno-21-4"></a><span class="k">layout</span><span class="p">(</span><span class="n">location</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mo">0</span><span class="p">)</span><span class="w"> </span><span class="k">in</span><span class="w"> </span><span class="kt">vec3</span><span class="w"> </span><span class="n">inPosition</span><span class="p">;</span>
<a id="__codelineno-21-5" name="__codelineno-21-5" href="#__codelineno-21-5"></a><span class="k">layout</span><span class="p">(</span><span class="n">location</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">1</span><span class="p">)</span><span class="w"> </span><span class="k">in</span><span class="w"> </span><span class="kt">vec3</span><span class="w"> </span><span class="n">inNormal</span><span class="p">;</span>
<a id="__codelineno-21-6" name="__codelineno-21-6" href="#__codelineno-21-6"></a><span class="k">layout</span><span class="p">(</span><span class="n">location</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">2</span><span class="p">)</span><span class="w"> </span><span class="k">in</span><span class="w"> </span><span class="kt">vec2</span><span class="w"> </span><span class="n">inTexCoord</span><span class="p">;</span>
<a id="__codelineno-21-7" name="__codelineno-21-7" href="#__codelineno-21-7"></a><span class="k">layout</span><span class="p">(</span><span class="n">location</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">3</span><span class="p">)</span><span class="w"> </span><span class="k">in</span><span class="w"> </span><span class="kt">vec3</span><span class="w"> </span><span class="n">inTangent</span><span class="p">;</span>
<a id="__codelineno-21-8" name="__codelineno-21-8" href="#__codelineno-21-8"></a>
<a id="__codelineno-21-9" name="__codelineno-21-9" href="#__codelineno-21-9"></a><span class="k">layout</span><span class="p">(</span><span class="n">location</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mo">0</span><span class="p">)</span><span class="w"> </span><span class="k">out</span><span class="w"> </span><span class="kt">vec3</span><span class="w"> </span><span class="n">outWorldPos</span><span class="p">;</span>
<a id="__codelineno-21-10" name="__codelineno-21-10" href="#__codelineno-21-10"></a><span class="k">layout</span><span class="p">(</span><span class="n">location</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">1</span><span class="p">)</span><span class="w"> </span><span class="k">out</span><span class="w"> </span><span class="kt">vec2</span><span class="w"> </span><span class="n">outTexCoord</span><span class="p">;</span>
<a id="__codelineno-21-11" name="__codelineno-21-11" href="#__codelineno-21-11"></a><span class="k">layout</span><span class="p">(</span><span class="n">location</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">2</span><span class="p">)</span><span class="w"> </span><span class="k">out</span><span class="w"> </span><span class="kt">mat3</span><span class="w"> </span><span class="n">outTBN</span><span class="p">;</span>
<a id="__codelineno-21-12" name="__codelineno-21-12" href="#__codelineno-21-12"></a>
<a id="__codelineno-21-13" name="__codelineno-21-13" href="#__codelineno-21-13"></a><span class="k">layout</span><span class="p">(</span><span class="n">std140</span><span class="p">,</span><span class="w"> </span><span class="n">binding</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mo">0</span><span class="p">)</span><span class="w"> </span><span class="k">uniform</span><span class="w"> </span><span class="n">CameraData</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-21-14" name="__codelineno-21-14" href="#__codelineno-21-14"></a><span class="w">    </span><span class="kt">mat4</span><span class="w"> </span><span class="n">viewProjection</span><span class="p">;</span>
<a id="__codelineno-21-15" name="__codelineno-21-15" href="#__codelineno-21-15"></a><span class="p">};</span>
<a id="__codelineno-21-16" name="__codelineno-21-16" href="#__codelineno-21-16"></a>
<a id="__codelineno-21-17" name="__codelineno-21-17" href="#__codelineno-21-17"></a><span class="k">layout</span><span class="p">(</span><span class="n">std140</span><span class="p">,</span><span class="w"> </span><span class="n">binding</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">1</span><span class="p">)</span><span class="w"> </span><span class="k">uniform</span><span class="w"> </span><span class="n">ModelData</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-21-18" name="__codelineno-21-18" href="#__codelineno-21-18"></a><span class="w">    </span><span class="kt">mat4</span><span class="w"> </span><span class="n">model</span><span class="p">;</span>
<a id="__codelineno-21-19" name="__codelineno-21-19" href="#__codelineno-21-19"></a><span class="p">};</span>
<a id="__codelineno-21-20" name="__codelineno-21-20" href="#__codelineno-21-20"></a>
<a id="__codelineno-21-21" name="__codelineno-21-21" href="#__codelineno-21-21"></a><span class="kt">void</span><span class="w"> </span><span class="n">main</span><span class="p">()</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-21-22" name="__codelineno-21-22" href="#__codelineno-21-22"></a><span class="w">    </span><span class="kt">vec4</span><span class="w"> </span><span class="n">worldPos</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">model</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="kt">vec4</span><span class="p">(</span><span class="n">inPosition</span><span class="p">,</span><span class="w"> </span><span class="mf">1.0</span><span class="p">);</span>
<a id="__codelineno-21-23" name="__codelineno-21-23" href="#__codelineno-21-23"></a><span class="w">    </span><span class="nb">gl_Position</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">viewProjection</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="n">worldPos</span><span class="p">;</span>
<a id="__codelineno-21-24" name="__codelineno-21-24" href="#__codelineno-21-24"></a><span class="w">    </span><span class="n">outWorldPos</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">worldPos</span><span class="p">.</span><span class="n">xyz</span><span class="p">;</span>
<a id="__codelineno-21-25" name="__codelineno-21-25" href="#__codelineno-21-25"></a><span class="w">    </span><span class="n">outTexCoord</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">inTexCoord</span><span class="p">;</span>
<a id="__codelineno-21-26" name="__codelineno-21-26" href="#__codelineno-21-26"></a>
<a id="__codelineno-21-27" name="__codelineno-21-27" href="#__codelineno-21-27"></a><span class="w">    </span><span class="kt">vec3</span><span class="w"> </span><span class="n">N</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">normalize</span><span class="p">(</span><span class="kt">mat3</span><span class="p">(</span><span class="n">model</span><span class="p">)</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="n">inNormal</span><span class="p">);</span>
<a id="__codelineno-21-28" name="__codelineno-21-28" href="#__codelineno-21-28"></a><span class="w">    </span><span class="kt">vec3</span><span class="w"> </span><span class="n">T</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">normalize</span><span class="p">(</span><span class="kt">mat3</span><span class="p">(</span><span class="n">model</span><span class="p">)</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="n">inTangent</span><span class="p">);</span>
<a id="__codelineno-21-29" name="__codelineno-21-29" href="#__codelineno-21-29"></a><span class="w">    </span><span class="kt">vec3</span><span class="w"> </span><span class="n">B</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">cross</span><span class="p">(</span><span class="n">N</span><span class="p">,</span><span class="w"> </span><span class="n">T</span><span class="p">);</span>
<a id="__codelineno-21-30" name="__codelineno-21-30" href="#__codelineno-21-30"></a><span class="w">    </span><span class="n">outTBN</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="kt">mat3</span><span class="p">(</span><span class="n">T</span><span class="p">,</span><span class="w"> </span><span class="n">B</span><span class="p">,</span><span class="w"> </span><span class="n">N</span><span class="p">);</span>
<a id="__codelineno-21-31" name="__codelineno-21-31" href="#__codelineno-21-31"></a><span class="p">}</span>
<a id="__codelineno-21-32" name="__codelineno-21-32" href="#__codelineno-21-32"></a>
<a id="__codelineno-21-33" name="__codelineno-21-33" href="#__codelineno-21-33"></a><span class="c1">// GeometryPass.frag</span>
<a id="__codelineno-21-34" name="__codelineno-21-34" href="#__codelineno-21-34"></a><span class="cp">#version 450</span>
<a id="__codelineno-21-35" name="__codelineno-21-35" href="#__codelineno-21-35"></a>
<a id="__codelineno-21-36" name="__codelineno-21-36" href="#__codelineno-21-36"></a><span class="k">layout</span><span class="p">(</span><span class="n">location</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mo">0</span><span class="p">)</span><span class="w"> </span><span class="k">in</span><span class="w"> </span><span class="kt">vec3</span><span class="w"> </span><span class="n">inWorldPos</span><span class="p">;</span>
<a id="__codelineno-21-37" name="__codelineno-21-37" href="#__codelineno-21-37"></a><span class="k">layout</span><span class="p">(</span><span class="n">location</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">1</span><span class="p">)</span><span class="w"> </span><span class="k">in</span><span class="w"> </span><span class="kt">vec2</span><span class="w"> </span><span class="n">inTexCoord</span><span class="p">;</span>
<a id="__codelineno-21-38" name="__codelineno-21-38" href="#__codelineno-21-38"></a><span class="k">layout</span><span class="p">(</span><span class="n">location</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">2</span><span class="p">)</span><span class="w"> </span><span class="k">in</span><span class="w"> </span><span class="kt">mat3</span><span class="w"> </span><span class="n">inTBN</span><span class="p">;</span>
<a id="__codelineno-21-39" name="__codelineno-21-39" href="#__codelineno-21-39"></a>
<a id="__codelineno-21-40" name="__codelineno-21-40" href="#__codelineno-21-40"></a><span class="k">layout</span><span class="p">(</span><span class="n">location</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mo">0</span><span class="p">)</span><span class="w"> </span><span class="k">out</span><span class="w"> </span><span class="kt">vec4</span><span class="w"> </span><span class="n">outAlbedoRoughness</span><span class="p">;</span>
<a id="__codelineno-21-41" name="__codelineno-21-41" href="#__codelineno-21-41"></a><span class="k">layout</span><span class="p">(</span><span class="n">location</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">1</span><span class="p">)</span><span class="w"> </span><span class="k">out</span><span class="w"> </span><span class="kt">vec4</span><span class="w"> </span><span class="n">outNormalMetallic</span><span class="p">;</span>
<a id="__codelineno-21-42" name="__codelineno-21-42" href="#__codelineno-21-42"></a><span class="k">layout</span><span class="p">(</span><span class="n">location</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">2</span><span class="p">)</span><span class="w"> </span><span class="k">out</span><span class="w"> </span><span class="kt">vec3</span><span class="w"> </span><span class="n">outPosition</span><span class="p">;</span>
<a id="__codelineno-21-43" name="__codelineno-21-43" href="#__codelineno-21-43"></a>
<a id="__codelineno-21-44" name="__codelineno-21-44" href="#__codelineno-21-44"></a><span class="k">layout</span><span class="p">(</span><span class="n">binding</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mo">0</span><span class="p">)</span><span class="w"> </span><span class="k">uniform</span><span class="w"> </span><span class="kt">sampler2D</span><span class="w"> </span><span class="n">albedoMap</span><span class="p">;</span>
<a id="__codelineno-21-45" name="__codelineno-21-45" href="#__codelineno-21-45"></a><span class="k">layout</span><span class="p">(</span><span class="n">binding</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">1</span><span class="p">)</span><span class="w"> </span><span class="k">uniform</span><span class="w"> </span><span class="kt">sampler2D</span><span class="w"> </span><span class="n">normalMap</span><span class="p">;</span>
<a id="__codelineno-21-46" name="__codelineno-21-46" href="#__codelineno-21-46"></a><span class="k">layout</span><span class="p">(</span><span class="n">binding</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">2</span><span class="p">)</span><span class="w"> </span><span class="k">uniform</span><span class="w"> </span><span class="kt">sampler2D</span><span class="w"> </span><span class="n">roughnessMap</span><span class="p">;</span>
<a id="__codelineno-21-47" name="__codelineno-21-47" href="#__codelineno-21-47"></a><span class="k">layout</span><span class="p">(</span><span class="n">binding</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">3</span><span class="p">)</span><span class="w"> </span><span class="k">uniform</span><span class="w"> </span><span class="kt">sampler2D</span><span class="w"> </span><span class="n">metallicMap</span><span class="p">;</span>
<a id="__codelineno-21-48" name="__codelineno-21-48" href="#__codelineno-21-48"></a>
<a id="__codelineno-21-49" name="__codelineno-21-49" href="#__codelineno-21-49"></a><span class="kt">void</span><span class="w"> </span><span class="n">main</span><span class="p">()</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-21-50" name="__codelineno-21-50" href="#__codelineno-21-50"></a><span class="w">    </span><span class="kt">vec3</span><span class="w"> </span><span class="n">albedo</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">texture</span><span class="p">(</span><span class="n">albedoMap</span><span class="p">,</span><span class="w"> </span><span class="n">inTexCoord</span><span class="p">).</span><span class="n">rgb</span><span class="p">;</span>
<a id="__codelineno-21-51" name="__codelineno-21-51" href="#__codelineno-21-51"></a><span class="w">    </span><span class="kt">float</span><span class="w"> </span><span class="n">roughness</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">texture</span><span class="p">(</span><span class="n">roughnessMap</span><span class="p">,</span><span class="w"> </span><span class="n">inTexCoord</span><span class="p">).</span><span class="n">r</span><span class="p">;</span>
<a id="__codelineno-21-52" name="__codelineno-21-52" href="#__codelineno-21-52"></a><span class="w">    </span><span class="kt">float</span><span class="w"> </span><span class="n">metallic</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">texture</span><span class="p">(</span><span class="n">metallicMap</span><span class="p">,</span><span class="w"> </span><span class="n">inTexCoord</span><span class="p">).</span><span class="n">r</span><span class="p">;</span>
<a id="__codelineno-21-53" name="__codelineno-21-53" href="#__codelineno-21-53"></a>
<a id="__codelineno-21-54" name="__codelineno-21-54" href="#__codelineno-21-54"></a><span class="w">    </span><span class="kt">vec3</span><span class="w"> </span><span class="n">normal</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">texture</span><span class="p">(</span><span class="n">normalMap</span><span class="p">,</span><span class="w"> </span><span class="n">inTexCoord</span><span class="p">).</span><span class="n">xyz</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="mf">2.0</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="mf">1.0</span><span class="p">;</span>
<a id="__codelineno-21-55" name="__codelineno-21-55" href="#__codelineno-21-55"></a><span class="w">    </span><span class="n">normal</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">normalize</span><span class="p">(</span><span class="n">inTBN</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="n">normal</span><span class="p">);</span>
<a id="__codelineno-21-56" name="__codelineno-21-56" href="#__codelineno-21-56"></a>
<a id="__codelineno-21-57" name="__codelineno-21-57" href="#__codelineno-21-57"></a><span class="w">    </span><span class="n">outAlbedoRoughness</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="kt">vec4</span><span class="p">(</span><span class="n">albedo</span><span class="p">,</span><span class="w"> </span><span class="n">roughness</span><span class="p">);</span>
<a id="__codelineno-21-58" name="__codelineno-21-58" href="#__codelineno-21-58"></a><span class="w">    </span><span class="n">outNormalMetallic</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="kt">vec4</span><span class="p">(</span><span class="n">normal</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="mf">0.5</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="mf">0.5</span><span class="p">,</span><span class="w"> </span><span class="n">metallic</span><span class="p">);</span>
<a id="__codelineno-21-59" name="__codelineno-21-59" href="#__codelineno-21-59"></a><span class="w">    </span><span class="n">outPosition</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">inWorldPos</span><span class="p">;</span>
<a id="__codelineno-21-60" name="__codelineno-21-60" href="#__codelineno-21-60"></a><span class="p">}</span>
<a id="__codelineno-21-61" name="__codelineno-21-61" href="#__codelineno-21-61"></a>
<a id="__codelineno-21-62" name="__codelineno-21-62" href="#__codelineno-21-62"></a><span class="c1">// PointLight.frag</span>
<a id="__codelineno-21-63" name="__codelineno-21-63" href="#__codelineno-21-63"></a><span class="cp">#version 450</span>
<a id="__codelineno-21-64" name="__codelineno-21-64" href="#__codelineno-21-64"></a>
<a id="__codelineno-21-65" name="__codelineno-21-65" href="#__codelineno-21-65"></a><span class="k">layout</span><span class="p">(</span><span class="n">location</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mo">0</span><span class="p">)</span><span class="w"> </span><span class="k">out</span><span class="w"> </span><span class="kt">vec4</span><span class="w"> </span><span class="n">outColor</span><span class="p">;</span>
<a id="__codelineno-21-66" name="__codelineno-21-66" href="#__codelineno-21-66"></a>
<a id="__codelineno-21-67" name="__codelineno-21-67" href="#__codelineno-21-67"></a><span class="k">layout</span><span class="p">(</span><span class="n">binding</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mo">0</span><span class="p">)</span><span class="w"> </span><span class="k">uniform</span><span class="w"> </span><span class="kt">sampler2D</span><span class="w"> </span><span class="n">albedoRoughnessTex</span><span class="p">;</span>
<a id="__codelineno-21-68" name="__codelineno-21-68" href="#__codelineno-21-68"></a><span class="k">layout</span><span class="p">(</span><span class="n">binding</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">1</span><span class="p">)</span><span class="w"> </span><span class="k">uniform</span><span class="w"> </span><span class="kt">sampler2D</span><span class="w"> </span><span class="n">normalMetallicTex</span><span class="p">;</span>
<a id="__codelineno-21-69" name="__codelineno-21-69" href="#__codelineno-21-69"></a><span class="k">layout</span><span class="p">(</span><span class="n">binding</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">2</span><span class="p">)</span><span class="w"> </span><span class="k">uniform</span><span class="w"> </span><span class="kt">sampler2D</span><span class="w"> </span><span class="n">positionTex</span><span class="p">;</span>
<a id="__codelineno-21-70" name="__codelineno-21-70" href="#__codelineno-21-70"></a>
<a id="__codelineno-21-71" name="__codelineno-21-71" href="#__codelineno-21-71"></a><span class="k">layout</span><span class="p">(</span><span class="n">std140</span><span class="p">,</span><span class="w"> </span><span class="n">binding</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mo">0</span><span class="p">)</span><span class="w"> </span><span class="k">uniform</span><span class="w"> </span><span class="n">LightData</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-21-72" name="__codelineno-21-72" href="#__codelineno-21-72"></a><span class="w">    </span><span class="kt">vec3</span><span class="w"> </span><span class="n">lightPosition</span><span class="p">;</span>
<a id="__codelineno-21-73" name="__codelineno-21-73" href="#__codelineno-21-73"></a><span class="w">    </span><span class="kt">vec3</span><span class="w"> </span><span class="n">lightColor</span><span class="p">;</span>
<a id="__codelineno-21-74" name="__codelineno-21-74" href="#__codelineno-21-74"></a><span class="w">    </span><span class="kt">float</span><span class="w"> </span><span class="n">lightRadius</span><span class="p">;</span>
<a id="__codelineno-21-75" name="__codelineno-21-75" href="#__codelineno-21-75"></a><span class="p">};</span>
<a id="__codelineno-21-76" name="__codelineno-21-76" href="#__codelineno-21-76"></a>
<a id="__codelineno-21-77" name="__codelineno-21-77" href="#__codelineno-21-77"></a><span class="k">layout</span><span class="p">(</span><span class="n">std140</span><span class="p">,</span><span class="w"> </span><span class="n">binding</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">1</span><span class="p">)</span><span class="w"> </span><span class="k">uniform</span><span class="w"> </span><span class="n">CameraData</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-21-78" name="__codelineno-21-78" href="#__codelineno-21-78"></a><span class="w">    </span><span class="kt">vec3</span><span class="w"> </span><span class="n">cameraPosition</span><span class="p">;</span>
<a id="__codelineno-21-79" name="__codelineno-21-79" href="#__codelineno-21-79"></a><span class="p">};</span>
<a id="__codelineno-21-80" name="__codelineno-21-80" href="#__codelineno-21-80"></a>
<a id="__codelineno-21-81" name="__codelineno-21-81" href="#__codelineno-21-81"></a><span class="kt">void</span><span class="w"> </span><span class="n">main</span><span class="p">()</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-21-82" name="__codelineno-21-82" href="#__codelineno-21-82"></a><span class="w">    </span><span class="kt">vec2</span><span class="w"> </span><span class="n">texCoord</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nb">gl_FragCoord</span><span class="p">.</span><span class="n">xy</span><span class="w"> </span><span class="o">/</span><span class="w"> </span><span class="n">textureSize</span><span class="p">(</span><span class="n">albedoRoughnessTex</span><span class="p">,</span><span class="w"> </span><span class="mo">0</span><span class="p">);</span>
<a id="__codelineno-21-83" name="__codelineno-21-83" href="#__codelineno-21-83"></a>
<a id="__codelineno-21-84" name="__codelineno-21-84" href="#__codelineno-21-84"></a><span class="w">    </span><span class="kt">vec4</span><span class="w"> </span><span class="n">albedoRoughness</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">texture</span><span class="p">(</span><span class="n">albedoRoughnessTex</span><span class="p">,</span><span class="w"> </span><span class="n">texCoord</span><span class="p">);</span>
<a id="__codelineno-21-85" name="__codelineno-21-85" href="#__codelineno-21-85"></a><span class="w">    </span><span class="kt">vec4</span><span class="w"> </span><span class="n">normalMetallic</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">texture</span><span class="p">(</span><span class="n">normalMetallicTex</span><span class="p">,</span><span class="w"> </span><span class="n">texCoord</span><span class="p">);</span>
<a id="__codelineno-21-86" name="__codelineno-21-86" href="#__codelineno-21-86"></a><span class="w">    </span><span class="kt">vec3</span><span class="w"> </span><span class="n">position</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">texture</span><span class="p">(</span><span class="n">positionTex</span><span class="p">,</span><span class="w"> </span><span class="n">texCoord</span><span class="p">).</span><span class="n">xyz</span><span class="p">;</span>
<a id="__codelineno-21-87" name="__codelineno-21-87" href="#__codelineno-21-87"></a>
<a id="__codelineno-21-88" name="__codelineno-21-88" href="#__codelineno-21-88"></a><span class="w">    </span><span class="kt">vec3</span><span class="w"> </span><span class="n">albedo</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">albedoRoughness</span><span class="p">.</span><span class="n">rgb</span><span class="p">;</span>
<a id="__codelineno-21-89" name="__codelineno-21-89" href="#__codelineno-21-89"></a><span class="w">    </span><span class="kt">float</span><span class="w"> </span><span class="n">roughness</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">albedoRoughness</span><span class="p">.</span><span class="n">a</span><span class="p">;</span>
<a id="__codelineno-21-90" name="__codelineno-21-90" href="#__codelineno-21-90"></a><span class="w">    </span><span class="kt">vec3</span><span class="w"> </span><span class="n">normal</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">normalMetallic</span><span class="p">.</span><span class="n">rgb</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="mf">2.0</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="mf">1.0</span><span class="p">;</span>
<a id="__codelineno-21-91" name="__codelineno-21-91" href="#__codelineno-21-91"></a><span class="w">    </span><span class="kt">float</span><span class="w"> </span><span class="n">metallic</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">normalMetallic</span><span class="p">.</span><span class="n">a</span><span class="p">;</span>
<a id="__codelineno-21-92" name="__codelineno-21-92" href="#__codelineno-21-92"></a>
<a id="__codelineno-21-93" name="__codelineno-21-93" href="#__codelineno-21-93"></a><span class="w">    </span><span class="kt">vec3</span><span class="w"> </span><span class="n">lightDir</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">lightPosition</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="n">position</span><span class="p">;</span>
<a id="__codelineno-21-94" name="__codelineno-21-94" href="#__codelineno-21-94"></a><span class="w">    </span><span class="kt">float</span><span class="w"> </span><span class="n">distance</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">length</span><span class="p">(</span><span class="n">lightDir</span><span class="p">);</span>
<a id="__codelineno-21-95" name="__codelineno-21-95" href="#__codelineno-21-95"></a><span class="w">    </span><span class="n">lightDir</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">normalize</span><span class="p">(</span><span class="n">lightDir</span><span class="p">);</span>
<a id="__codelineno-21-96" name="__codelineno-21-96" href="#__codelineno-21-96"></a>
<a id="__codelineno-21-97" name="__codelineno-21-97" href="#__codelineno-21-97"></a><span class="w">    </span><span class="kt">float</span><span class="w"> </span><span class="n">attenuation</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">max</span><span class="p">(</span><span class="mf">0.0</span><span class="p">,</span><span class="w"> </span><span class="mf">1.0</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="p">(</span><span class="n">distance</span><span class="w"> </span><span class="o">/</span><span class="w"> </span><span class="n">lightRadius</span><span class="p">));</span>
<a id="__codelineno-21-98" name="__codelineno-21-98" href="#__codelineno-21-98"></a><span class="w">    </span><span class="n">attenuation</span><span class="w"> </span><span class="o">*=</span><span class="w"> </span><span class="n">attenuation</span><span class="p">;</span>
<a id="__codelineno-21-99" name="__codelineno-21-99" href="#__codelineno-21-99"></a>
<a id="__codelineno-21-100" name="__codelineno-21-100" href="#__codelineno-21-100"></a><span class="w">    </span><span class="kt">vec3</span><span class="w"> </span><span class="n">viewDir</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">normalize</span><span class="p">(</span><span class="n">cameraPosition</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="n">position</span><span class="p">);</span>
<a id="__codelineno-21-101" name="__codelineno-21-101" href="#__codelineno-21-101"></a><span class="w">    </span><span class="kt">vec3</span><span class="w"> </span><span class="n">halfDir</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">normalize</span><span class="p">(</span><span class="n">lightDir</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="n">viewDir</span><span class="p">);</span>
<a id="__codelineno-21-102" name="__codelineno-21-102" href="#__codelineno-21-102"></a>
<a id="__codelineno-21-103" name="__codelineno-21-103" href="#__codelineno-21-103"></a><span class="w">    </span><span class="kt">float</span><span class="w"> </span><span class="n">NdotL</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">max</span><span class="p">(</span><span class="n">dot</span><span class="p">(</span><span class="n">normal</span><span class="p">,</span><span class="w"> </span><span class="n">lightDir</span><span class="p">),</span><span class="w"> </span><span class="mf">0.0</span><span class="p">);</span>
<a id="__codelineno-21-104" name="__codelineno-21-104" href="#__codelineno-21-104"></a><span class="w">    </span><span class="kt">float</span><span class="w"> </span><span class="n">NdotH</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">max</span><span class="p">(</span><span class="n">dot</span><span class="p">(</span><span class="n">normal</span><span class="p">,</span><span class="w"> </span><span class="n">halfDir</span><span class="p">),</span><span class="w"> </span><span class="mf">0.0</span><span class="p">);</span>
<a id="__codelineno-21-105" name="__codelineno-21-105" href="#__codelineno-21-105"></a><span class="w">    </span><span class="kt">float</span><span class="w"> </span><span class="n">NdotV</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">max</span><span class="p">(</span><span class="n">dot</span><span class="p">(</span><span class="n">normal</span><span class="p">,</span><span class="w"> </span><span class="n">viewDir</span><span class="p">),</span><span class="w"> </span><span class="mf">0.0</span><span class="p">);</span>
<a id="__codelineno-21-106" name="__codelineno-21-106" href="#__codelineno-21-106"></a>
<a id="__codelineno-21-107" name="__codelineno-21-107" href="#__codelineno-21-107"></a><span class="w">    </span><span class="c1">// Implement your PBR lighting model here</span>
<a id="__codelineno-21-108" name="__codelineno-21-108" href="#__codelineno-21-108"></a><span class="w">    </span><span class="c1">// This is a simplified example</span>
<a id="__codelineno-21-109" name="__codelineno-21-109" href="#__codelineno-21-109"></a><span class="w">    </span><span class="kt">vec3</span><span class="w"> </span><span class="n">specular</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">pow</span><span class="p">(</span><span class="n">NdotH</span><span class="p">,</span><span class="w"> </span><span class="p">(</span><span class="mf">1.0</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="n">roughness</span><span class="p">)</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="mf">256.0</span><span class="p">)</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="n">lightColor</span><span class="p">;</span>
<a id="__codelineno-21-110" name="__codelineno-21-110" href="#__codelineno-21-110"></a><span class="w">    </span><span class="kt">vec3</span><span class="w"> </span><span class="n">diffuse</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">albedo</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="n">NdotL</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="n">lightColor</span><span class="p">;</span>
<a id="__codelineno-21-111" name="__codelineno-21-111" href="#__codelineno-21-111"></a>
<a id="__codelineno-21-112" name="__codelineno-21-112" href="#__codelineno-21-112"></a><span class="w">    </span><span class="n">outColor</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="kt">vec4</span><span class="p">((</span><span class="n">diffuse</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="n">specular</span><span class="p">)</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="n">attenuation</span><span class="p">,</span><span class="w"> </span><span class="mf">1.0</span><span class="p">);</span>
<a id="__codelineno-21-113" name="__codelineno-21-113" href="#__codelineno-21-113"></a><span class="p">}</span>
<a id="__codelineno-21-114" name="__codelineno-21-114" href="#__codelineno-21-114"></a>
<a id="__codelineno-21-115" name="__codelineno-21-115" href="#__codelineno-21-115"></a><span class="c1">// Composition.frag</span>
<a id="__codelineno-21-116" name="__codelineno-21-116" href="#__codelineno-21-116"></a><span class="cp">#version 450</span>
<a id="__codelineno-21-117" name="__codelineno-21-117" href="#__codelineno-21-117"></a>
<a id="__codelineno-21-118" name="__codelineno-21-118" href="#__codelineno-21-118"></a><span class="k">layout</span><span class="p">(</span><span class="n">location</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mo">0</span><span class="p">)</span><span class="w"> </span><span class="k">out</span><span class="w"> </span><span class="kt">vec4</span><span class="w"> </span><span class="n">outColor</span><span class="p">;</span>
<a id="__codelineno-21-119" name="__codelineno-21-119" href="#__codelineno-21-119"></a>
<a id="__codelineno-21-120" name="__codelineno-21-120" href="#__codelineno-21-120"></a><span class="k">layout</span><span class="p">(</span><span class="n">binding</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mo">0</span><span class="p">)</span><span class="w"> </span><span class="k">uniform</span><span class="w"> </span><span class="kt">sampler2D</span><span class="w"> </span><span class="n">albedoRoughnessTex</span><span class="p">;</span>
<a id="__codelineno-21-121" name="__codelineno-21-121" href="#__codelineno-21-121"></a><span class="k">layout</span><span class="p">(</span><span class="n">binding</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">1</span><span class="p">)</span><span class="w"> </span><span class="k">uniform</span><span class="w"> </span><span class="kt">sampler2D</span><span class="w"> </span><span class="n">lightAccumulationTex</span><span class="p">;</span>
<a id="__codelineno-21-122" name="__codelineno-21-122" href="#__codelineno-21-122"></a>
<a id="__codelineno-21-123" name="__codelineno-21-123" href="#__codelineno-21-123"></a><span class="kt">void</span><span class="w"> </span><span class="n">main</span><span class="p">()</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-21-124" name="__codelineno-21-124" href="#__codelineno-21-124"></a><span class="w">    </span><span class="kt">vec2</span><span class="w"> </span><span class="n">texCoord</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nb">gl_FragCoord</span><span class="p">.</span><span class="n">xy</span><span class="w"> </span><span class="o">/</span><span class="w"> </span><span class="n">textureSize</span><span class="p">(</span><span class="n">albedoRoughnessTex</span><span class="p">,</span><span class="w"> </span><span class="mo">0</span><span class="p">);</span>
<a id="__codelineno-21-125" name="__codelineno-21-125" href="#__codelineno-21-125"></a>
<a id="__codelineno-21-126" name="__codelineno-21-126" href="#__codelineno-21-126"></a><span class="w">    </span><span class="kt">vec3</span><span class="w"> </span><span class="n">albedo</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">texture</span><span class="p">(</span><span class="n">albedoRoughnessTex</span><span class="p">,</span><span class="w"> </span><span class="n">texCoord</span><span class="p">).</span><span class="n">rgb</span><span class="p">;</span>
<a id="__codelineno-21-127" name="__codelineno-21-127" href="#__codelineno-21-127"></a><span class="w">    </span><span class="kt">vec3</span><span class="w"> </span><span class="n">lighting</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">texture</span><span class="p">(</span><span class="n">lightAccumulationTex</span><span class="p">,</span><span class="w"> </span><span class="n">texCoord</span><span class="p">).</span><span class="n">rgb</span><span class="p">;</span>
<a id="__codelineno-21-128" name="__codelineno-21-128" href="#__codelineno-21-128"></a>
<a id="__codelineno-21-129" name="__codelineno-21-129" href="#__codelineno-21-129"></a><span class="w">    </span><span class="kt">vec3</span><span class="w"> </span><span class="n">finalColor</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">albedo</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="n">lighting</span><span class="p">;</span>
<a id="__codelineno-21-130" name="__codelineno-21-130" href="#__codelineno-21-130"></a>
<a id="__codelineno-21-131" name="__codelineno-21-131" href="#__codelineno-21-131"></a><span class="w">    </span><span class="c1">// Apply tone mapping and gamma correction here if needed</span>
<a id="__codelineno-21-132" name="__codelineno-21-132" href="#__codelineno-21-132"></a>
<a id="__codelineno-21-133" name="__codelineno-21-133" href="#__codelineno-21-133"></a><span class="w">    </span><span class="n">outColor</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="kt">vec4</span><span class="p">(</span><span class="n">finalColor</span><span class="p">,</span><span class="w"> </span><span class="mf">1.0</span><span class="p">);</span>
<a id="__codelineno-21-134" name="__codelineno-21-134" href="#__codelineno-21-134"></a><span class="p">}</span>
</code></pre></div>
<h4 id="explanation_2">Explanation</h4>
<ol>
<li>
<p>G-Buffer Generation (Geometry Pass):</p>
<ul>
<li>We render the scene geometry to multiple render targets (G-Buffer).</li>
<li>The G-Buffer stores albedo, roughness, normals, metallic, and position data.</li>
<li>This pass is done once per frame, regardless of the number of lights.</li>
</ul>
</li>
<li>
<p>Lighting Pass:</p>
<ul>
<li>For each light, we render a full-screen quad.</li>
<li>The fragment shader reads from the G-Buffer textures to reconstruct the surface properties.</li>
<li>Lighting calculations are performed for each pixel affected by the light.</li>
<li>Results are accumulated in the light accumulation buffer.</li>
</ul>
</li>
<li>
<p>Composition Pass:</p>
<ul>
<li>We combine the albedo information with the accumulated lighting.</li>
<li>Additional post-processing effects can be applied at this stage.</li>
</ul>
</li>
<li>
<p>Benefits:</p>
<ul>
<li>Decouples geometry complexity from lighting complexity.</li>
<li>Allows for a large number of lights with relatively low performance impact.</li>
<li>Simplifies implementation of complex lighting models and effects.</li>
</ul>
</li>
<li>
<p>Performance Considerations:</p>
<ul>
<li>G-Buffer creation and storage can be memory-intensive.</li>
<li>Bandwidth usage is higher due to reading and writing multiple textures.</li>
<li>Modern GPUs handle deferred rendering very efficiently.</li>
</ul>
</li>
<li>
<p>Light Types:</p>
<ul>
<li>Different shaders are used for different light types (point, spot, directional).</li>
<li>This allows for optimized calculations based on light properties.</li>
</ul>
</li>
<li>
<p>PBR Integration:</p>
<ul>
<li>The G-Buffer stores PBR material properties (roughness, metallic).</li>
<li>The lighting pass implements PBR lighting calculations.</li>
</ul>
</li>
</ol>
<p>This implementation provides a solid foundation for a deferred rendering system in a professional game engine. Further improvements could include:</p>
<ul>
<li>Tiled or clustered deferred rendering for better performance with many lights</li>
<li>Screen-space reflections using the G-Buffer data</li>
<li>Volumetric lighting effects</li>
<li>Deferred decals</li>
<li>Anti-aliasing techniques specific to deferred rendering (e.g., GTAO)</li>
</ul>
<h3 id="forward-rendering">Forward Rendering</h3>
<p>Forward Rendering is a traditional rendering technique where lighting calculations are performed for each object as it's rendered. This approach is straightforward and can be efficient for scenes with a moderate number of lights and objects.</p>
<h4 id="implementation-overview_2">Implementation Overview</h4>
<p>We'll implement a forward rendering system that supports multiple light types and can handle dynamic objects. This system will include a single rendering pass that combines geometry processing and lighting calculations.</p>
<p>Key Components:</p>
<ol>
<li>Single-pass rendering</li>
<li>Per-object lighting calculations</li>
<li>Support for multiple light types (point, spot, directional)</li>
<li>Basic shadow mapping integration</li>
</ol>
<p>Here's C++ implementation:</p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-22-1" name="__codelineno-22-1" href="#__codelineno-22-1"></a><span class="c1">// ForwardRenderer.h</span>
<a id="__codelineno-22-2" name="__codelineno-22-2" href="#__codelineno-22-2"></a><span class="cp">#pragma once</span>
<a id="__codelineno-22-3" name="__codelineno-22-3" href="#__codelineno-22-3"></a>
<a id="__codelineno-22-4" name="__codelineno-22-4" href="#__codelineno-22-4"></a><span class="cp">#include</span><span class="w"> </span><span class="cpf">&quot;RenderSystem.h&quot;</span>
<a id="__codelineno-22-5" name="__codelineno-22-5" href="#__codelineno-22-5"></a><span class="cp">#include</span><span class="w"> </span><span class="cpf">&quot;Shader.h&quot;</span>
<a id="__codelineno-22-6" name="__codelineno-22-6" href="#__codelineno-22-6"></a><span class="cp">#include</span><span class="w"> </span><span class="cpf">&quot;Scene.h&quot;</span>
<a id="__codelineno-22-7" name="__codelineno-22-7" href="#__codelineno-22-7"></a><span class="cp">#include</span><span class="w"> </span><span class="cpf">&quot;Camera.h&quot;</span>
<a id="__codelineno-22-8" name="__codelineno-22-8" href="#__codelineno-22-8"></a><span class="cp">#include</span><span class="w"> </span><span class="cpf">&quot;Light.h&quot;</span>
<a id="__codelineno-22-9" name="__codelineno-22-9" href="#__codelineno-22-9"></a><span class="cp">#include</span><span class="w"> </span><span class="cpf">&quot;ShadowMap.h&quot;</span>
<a id="__codelineno-22-10" name="__codelineno-22-10" href="#__codelineno-22-10"></a>
<a id="__codelineno-22-11" name="__codelineno-22-11" href="#__codelineno-22-11"></a><span class="k">class</span><span class="w"> </span><span class="nc">ForwardRenderer</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-22-12" name="__codelineno-22-12" href="#__codelineno-22-12"></a><span class="k">public</span><span class="o">:</span>
<a id="__codelineno-22-13" name="__codelineno-22-13" href="#__codelineno-22-13"></a><span class="w">    </span><span class="n">ForwardRenderer</span><span class="p">(</span><span class="n">RenderSystem</span><span class="o">*</span><span class="w"> </span><span class="n">renderSystem</span><span class="p">);</span>
<a id="__codelineno-22-14" name="__codelineno-22-14" href="#__codelineno-22-14"></a><span class="w">    </span><span class="o">~</span><span class="n">ForwardRenderer</span><span class="p">();</span>
<a id="__codelineno-22-15" name="__codelineno-22-15" href="#__codelineno-22-15"></a>
<a id="__codelineno-22-16" name="__codelineno-22-16" href="#__codelineno-22-16"></a><span class="w">    </span><span class="kt">void</span><span class="w"> </span><span class="nf">Render</span><span class="p">(</span><span class="k">const</span><span class="w"> </span><span class="n">Scene</span><span class="o">&amp;</span><span class="w"> </span><span class="n">scene</span><span class="p">,</span><span class="w"> </span><span class="k">const</span><span class="w"> </span><span class="n">Camera</span><span class="o">&amp;</span><span class="w"> </span><span class="n">camera</span><span class="p">);</span>
<a id="__codelineno-22-17" name="__codelineno-22-17" href="#__codelineno-22-17"></a>
<a id="__codelineno-22-18" name="__codelineno-22-18" href="#__codelineno-22-18"></a><span class="k">private</span><span class="o">:</span>
<a id="__codelineno-22-19" name="__codelineno-22-19" href="#__codelineno-22-19"></a><span class="w">    </span><span class="kt">void</span><span class="w"> </span><span class="n">RenderObjects</span><span class="p">(</span><span class="k">const</span><span class="w"> </span><span class="n">Scene</span><span class="o">&amp;</span><span class="w"> </span><span class="n">scene</span><span class="p">,</span><span class="w"> </span><span class="k">const</span><span class="w"> </span><span class="n">Camera</span><span class="o">&amp;</span><span class="w"> </span><span class="n">camera</span><span class="p">);</span>
<a id="__codelineno-22-20" name="__codelineno-22-20" href="#__codelineno-22-20"></a><span class="w">    </span><span class="kt">void</span><span class="w"> </span><span class="nf">SetupLighting</span><span class="p">(</span><span class="k">const</span><span class="w"> </span><span class="n">Scene</span><span class="o">&amp;</span><span class="w"> </span><span class="n">scene</span><span class="p">,</span><span class="w"> </span><span class="k">const</span><span class="w"> </span><span class="n">Camera</span><span class="o">&amp;</span><span class="w"> </span><span class="n">camera</span><span class="p">);</span>
<a id="__codelineno-22-21" name="__codelineno-22-21" href="#__codelineno-22-21"></a>
<a id="__codelineno-22-22" name="__codelineno-22-22" href="#__codelineno-22-22"></a><span class="w">    </span><span class="n">RenderSystem</span><span class="o">*</span><span class="w"> </span><span class="n">m_RenderSystem</span><span class="p">;</span>
<a id="__codelineno-22-23" name="__codelineno-22-23" href="#__codelineno-22-23"></a><span class="w">    </span><span class="n">Shader</span><span class="w"> </span><span class="n">m_ForwardShader</span><span class="p">;</span>
<a id="__codelineno-22-24" name="__codelineno-22-24" href="#__codelineno-22-24"></a><span class="w">    </span><span class="n">ShadowMap</span><span class="w"> </span><span class="n">m_ShadowMap</span><span class="p">;</span>
<a id="__codelineno-22-25" name="__codelineno-22-25" href="#__codelineno-22-25"></a>
<a id="__codelineno-22-26" name="__codelineno-22-26" href="#__codelineno-22-26"></a><span class="w">    </span><span class="k">static</span><span class="w"> </span><span class="k">const</span><span class="w"> </span><span class="kt">int</span><span class="w"> </span><span class="n">MAX_LIGHTS</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">8</span><span class="p">;</span>
<a id="__codelineno-22-27" name="__codelineno-22-27" href="#__codelineno-22-27"></a><span class="w">    </span><span class="k">struct</span><span class="w"> </span><span class="nc">LightData</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-22-28" name="__codelineno-22-28" href="#__codelineno-22-28"></a><span class="w">        </span><span class="n">Vector4</span><span class="w"> </span><span class="n">position</span><span class="p">;</span><span class="w">  </span><span class="c1">// w component is used to differentiate between point (1.0) and directional (0.0) lights</span>
<a id="__codelineno-22-29" name="__codelineno-22-29" href="#__codelineno-22-29"></a><span class="w">        </span><span class="n">Vector4</span><span class="w"> </span><span class="n">direction</span><span class="p">;</span><span class="w"> </span><span class="c1">// w component is used for spot light angle cosine</span>
<a id="__codelineno-22-30" name="__codelineno-22-30" href="#__codelineno-22-30"></a><span class="w">        </span><span class="n">Vector4</span><span class="w"> </span><span class="n">color</span><span class="p">;</span><span class="w">     </span><span class="c1">// w component is used for light intensity</span>
<a id="__codelineno-22-31" name="__codelineno-22-31" href="#__codelineno-22-31"></a><span class="w">        </span><span class="n">Matrix4x4</span><span class="w"> </span><span class="n">shadowMatrix</span><span class="p">;</span>
<a id="__codelineno-22-32" name="__codelineno-22-32" href="#__codelineno-22-32"></a><span class="w">    </span><span class="p">};</span>
<a id="__codelineno-22-33" name="__codelineno-22-33" href="#__codelineno-22-33"></a><span class="w">    </span><span class="n">std</span><span class="o">::</span><span class="n">array</span><span class="o">&lt;</span><span class="n">LightData</span><span class="p">,</span><span class="w"> </span><span class="n">MAX_LIGHTS</span><span class="o">&gt;</span><span class="w"> </span><span class="n">m_LightDataArray</span><span class="p">;</span>
<a id="__codelineno-22-34" name="__codelineno-22-34" href="#__codelineno-22-34"></a><span class="p">};</span>
<a id="__codelineno-22-35" name="__codelineno-22-35" href="#__codelineno-22-35"></a>
<a id="__codelineno-22-36" name="__codelineno-22-36" href="#__codelineno-22-36"></a><span class="c1">// ForwardRenderer.cpp</span>
<a id="__codelineno-22-37" name="__codelineno-22-37" href="#__codelineno-22-37"></a><span class="cp">#include</span><span class="w"> </span><span class="cpf">&quot;ForwardRenderer.h&quot;</span>
<a id="__codelineno-22-38" name="__codelineno-22-38" href="#__codelineno-22-38"></a>
<a id="__codelineno-22-39" name="__codelineno-22-39" href="#__codelineno-22-39"></a><span class="n">ForwardRenderer</span><span class="o">::</span><span class="n">ForwardRenderer</span><span class="p">(</span><span class="n">RenderSystem</span><span class="o">*</span><span class="w"> </span><span class="n">renderSystem</span><span class="p">)</span>
<a id="__codelineno-22-40" name="__codelineno-22-40" href="#__codelineno-22-40"></a><span class="w">    </span><span class="o">:</span><span class="w"> </span><span class="n">m_RenderSystem</span><span class="p">(</span><span class="n">renderSystem</span><span class="p">),</span><span class="w"> </span><span class="n">m_ShadowMap</span><span class="p">(</span><span class="n">renderSystem</span><span class="p">,</span><span class="w"> </span><span class="mi">2048</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-22-41" name="__codelineno-22-41" href="#__codelineno-22-41"></a><span class="w">    </span><span class="n">m_ForwardShader</span><span class="p">.</span><span class="n">Initialize</span><span class="p">(</span><span class="n">renderSystem</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;Shaders/Forward.vert&quot;</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;Shaders/Forward.frag&quot;</span><span class="p">);</span>
<a id="__codelineno-22-42" name="__codelineno-22-42" href="#__codelineno-22-42"></a><span class="p">}</span>
<a id="__codelineno-22-43" name="__codelineno-22-43" href="#__codelineno-22-43"></a>
<a id="__codelineno-22-44" name="__codelineno-22-44" href="#__codelineno-22-44"></a><span class="kt">void</span><span class="w"> </span><span class="n">ForwardRenderer</span><span class="o">::</span><span class="n">Render</span><span class="p">(</span><span class="k">const</span><span class="w"> </span><span class="n">Scene</span><span class="o">&amp;</span><span class="w"> </span><span class="n">scene</span><span class="p">,</span><span class="w"> </span><span class="k">const</span><span class="w"> </span><span class="n">Camera</span><span class="o">&amp;</span><span class="w"> </span><span class="n">camera</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-22-45" name="__codelineno-22-45" href="#__codelineno-22-45"></a><span class="w">    </span><span class="n">m_ShadowMap</span><span class="p">.</span><span class="n">Render</span><span class="p">(</span><span class="n">scene</span><span class="p">);</span>
<a id="__codelineno-22-46" name="__codelineno-22-46" href="#__codelineno-22-46"></a>
<a id="__codelineno-22-47" name="__codelineno-22-47" href="#__codelineno-22-47"></a><span class="w">    </span><span class="n">m_RenderSystem</span><span class="o">-&gt;</span><span class="n">SetRenderTarget</span><span class="p">(</span><span class="n">m_RenderSystem</span><span class="o">-&gt;</span><span class="n">GetBackBuffer</span><span class="p">());</span>
<a id="__codelineno-22-48" name="__codelineno-22-48" href="#__codelineno-22-48"></a><span class="w">    </span><span class="n">m_RenderSystem</span><span class="o">-&gt;</span><span class="n">Clear</span><span class="p">(</span><span class="n">ClearFlags</span><span class="o">::</span><span class="n">Color</span><span class="w"> </span><span class="o">|</span><span class="w"> </span><span class="n">ClearFlags</span><span class="o">::</span><span class="n">Depth</span><span class="p">);</span>
<a id="__codelineno-22-49" name="__codelineno-22-49" href="#__codelineno-22-49"></a>
<a id="__codelineno-22-50" name="__codelineno-22-50" href="#__codelineno-22-50"></a><span class="w">    </span><span class="n">SetupLighting</span><span class="p">(</span><span class="n">scene</span><span class="p">,</span><span class="w"> </span><span class="n">camera</span><span class="p">);</span>
<a id="__codelineno-22-51" name="__codelineno-22-51" href="#__codelineno-22-51"></a><span class="w">    </span><span class="n">RenderObjects</span><span class="p">(</span><span class="n">scene</span><span class="p">,</span><span class="w"> </span><span class="n">camera</span><span class="p">);</span>
<a id="__codelineno-22-52" name="__codelineno-22-52" href="#__codelineno-22-52"></a><span class="p">}</span>
<a id="__codelineno-22-53" name="__codelineno-22-53" href="#__codelineno-22-53"></a>
<a id="__codelineno-22-54" name="__codelineno-22-54" href="#__codelineno-22-54"></a><span class="kt">void</span><span class="w"> </span><span class="n">ForwardRenderer</span><span class="o">::</span><span class="n">SetupLighting</span><span class="p">(</span><span class="k">const</span><span class="w"> </span><span class="n">Scene</span><span class="o">&amp;</span><span class="w"> </span><span class="n">scene</span><span class="p">,</span><span class="w"> </span><span class="k">const</span><span class="w"> </span><span class="n">Camera</span><span class="o">&amp;</span><span class="w"> </span><span class="n">camera</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-22-55" name="__codelineno-22-55" href="#__codelineno-22-55"></a><span class="w">    </span><span class="kt">int</span><span class="w"> </span><span class="n">lightCount</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">0</span><span class="p">;</span>
<a id="__codelineno-22-56" name="__codelineno-22-56" href="#__codelineno-22-56"></a><span class="w">    </span><span class="k">for</span><span class="w"> </span><span class="p">(</span><span class="k">const</span><span class="w"> </span><span class="k">auto</span><span class="o">&amp;</span><span class="w"> </span><span class="n">light</span><span class="w"> </span><span class="o">:</span><span class="w"> </span><span class="n">scene</span><span class="p">.</span><span class="n">GetLights</span><span class="p">())</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-22-57" name="__codelineno-22-57" href="#__codelineno-22-57"></a><span class="w">        </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">lightCount</span><span class="w"> </span><span class="o">&gt;=</span><span class="w"> </span><span class="n">MAX_LIGHTS</span><span class="p">)</span><span class="w"> </span><span class="k">break</span><span class="p">;</span>
<a id="__codelineno-22-58" name="__codelineno-22-58" href="#__codelineno-22-58"></a>
<a id="__codelineno-22-59" name="__codelineno-22-59" href="#__codelineno-22-59"></a><span class="w">        </span><span class="n">LightData</span><span class="o">&amp;</span><span class="w"> </span><span class="n">data</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">m_LightDataArray</span><span class="p">[</span><span class="n">lightCount</span><span class="p">];</span>
<a id="__codelineno-22-60" name="__codelineno-22-60" href="#__codelineno-22-60"></a><span class="w">        </span><span class="n">data</span><span class="p">.</span><span class="n">color</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">Vector4</span><span class="p">(</span><span class="n">light</span><span class="p">.</span><span class="n">GetColor</span><span class="p">(),</span><span class="w"> </span><span class="n">light</span><span class="p">.</span><span class="n">GetIntensity</span><span class="p">());</span>
<a id="__codelineno-22-61" name="__codelineno-22-61" href="#__codelineno-22-61"></a>
<a id="__codelineno-22-62" name="__codelineno-22-62" href="#__codelineno-22-62"></a><span class="w">        </span><span class="k">switch</span><span class="w"> </span><span class="p">(</span><span class="n">light</span><span class="p">.</span><span class="n">GetType</span><span class="p">())</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-22-63" name="__codelineno-22-63" href="#__codelineno-22-63"></a><span class="w">            </span><span class="k">case</span><span class="w"> </span><span class="no">LightType</span><span class="o">::</span><span class="no">Directional</span><span class="p">:</span>
<a id="__codelineno-22-64" name="__codelineno-22-64" href="#__codelineno-22-64"></a><span class="w">                </span><span class="n">data</span><span class="p">.</span><span class="n">position</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">Vector4</span><span class="p">(</span><span class="n">light</span><span class="p">.</span><span class="n">GetDirection</span><span class="p">(),</span><span class="w"> </span><span class="mf">0.0f</span><span class="p">);</span>
<a id="__codelineno-22-65" name="__codelineno-22-65" href="#__codelineno-22-65"></a><span class="w">                </span><span class="n">data</span><span class="p">.</span><span class="n">shadowMatrix</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">light</span><span class="p">.</span><span class="n">GetShadowMatrix</span><span class="p">();</span>
<a id="__codelineno-22-66" name="__codelineno-22-66" href="#__codelineno-22-66"></a><span class="w">                </span><span class="k">break</span><span class="p">;</span>
<a id="__codelineno-22-67" name="__codelineno-22-67" href="#__codelineno-22-67"></a><span class="w">            </span><span class="k">case</span><span class="w"> </span><span class="no">LightType</span><span class="o">::</span><span class="no">Point</span><span class="p">:</span>
<a id="__codelineno-22-68" name="__codelineno-22-68" href="#__codelineno-22-68"></a><span class="w">                </span><span class="n">data</span><span class="p">.</span><span class="n">position</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">Vector4</span><span class="p">(</span><span class="n">light</span><span class="p">.</span><span class="n">GetPosition</span><span class="p">(),</span><span class="w"> </span><span class="mf">1.0f</span><span class="p">);</span>
<a id="__codelineno-22-69" name="__codelineno-22-69" href="#__codelineno-22-69"></a><span class="w">                </span><span class="n">data</span><span class="p">.</span><span class="n">direction</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">Vector4</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="w"> </span><span class="mi">0</span><span class="p">,</span><span class="w"> </span><span class="mi">0</span><span class="p">,</span><span class="w"> </span><span class="n">light</span><span class="p">.</span><span class="n">GetRadius</span><span class="p">());</span>
<a id="__codelineno-22-70" name="__codelineno-22-70" href="#__codelineno-22-70"></a><span class="w">                </span><span class="k">break</span><span class="p">;</span>
<a id="__codelineno-22-71" name="__codelineno-22-71" href="#__codelineno-22-71"></a><span class="w">            </span><span class="k">case</span><span class="w"> </span><span class="no">LightType</span><span class="o">::</span><span class="no">Spot</span><span class="p">:</span>
<a id="__codelineno-22-72" name="__codelineno-22-72" href="#__codelineno-22-72"></a><span class="w">                </span><span class="n">data</span><span class="p">.</span><span class="n">position</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">Vector4</span><span class="p">(</span><span class="n">light</span><span class="p">.</span><span class="n">GetPosition</span><span class="p">(),</span><span class="w"> </span><span class="mf">1.0f</span><span class="p">);</span>
<a id="__codelineno-22-73" name="__codelineno-22-73" href="#__codelineno-22-73"></a><span class="w">                </span><span class="n">data</span><span class="p">.</span><span class="n">direction</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">Vector4</span><span class="p">(</span><span class="n">light</span><span class="p">.</span><span class="n">GetDirection</span><span class="p">(),</span><span class="w"> </span><span class="n">cos</span><span class="p">(</span><span class="n">light</span><span class="p">.</span><span class="n">GetAngle</span><span class="p">()));</span>
<a id="__codelineno-22-74" name="__codelineno-22-74" href="#__codelineno-22-74"></a><span class="w">                </span><span class="n">data</span><span class="p">.</span><span class="n">shadowMatrix</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">light</span><span class="p">.</span><span class="n">GetShadowMatrix</span><span class="p">();</span>
<a id="__codelineno-22-75" name="__codelineno-22-75" href="#__codelineno-22-75"></a><span class="w">                </span><span class="k">break</span><span class="p">;</span>
<a id="__codelineno-22-76" name="__codelineno-22-76" href="#__codelineno-22-76"></a><span class="w">        </span><span class="p">}</span>
<a id="__codelineno-22-77" name="__codelineno-22-77" href="#__codelineno-22-77"></a>
<a id="__codelineno-22-78" name="__codelineno-22-78" href="#__codelineno-22-78"></a><span class="w">        </span><span class="n">lightCount</span><span class="o">++</span><span class="p">;</span>
<a id="__codelineno-22-79" name="__codelineno-22-79" href="#__codelineno-22-79"></a><span class="w">    </span><span class="p">}</span>
<a id="__codelineno-22-80" name="__codelineno-22-80" href="#__codelineno-22-80"></a>
<a id="__codelineno-22-81" name="__codelineno-22-81" href="#__codelineno-22-81"></a><span class="w">    </span><span class="n">m_ForwardShader</span><span class="p">.</span><span class="n">SetInt</span><span class="p">(</span><span class="s">&quot;lightCount&quot;</span><span class="p">,</span><span class="w"> </span><span class="n">lightCount</span><span class="p">);</span>
<a id="__codelineno-22-82" name="__codelineno-22-82" href="#__codelineno-22-82"></a><span class="w">    </span><span class="n">m_ForwardShader</span><span class="p">.</span><span class="n">SetBuffer</span><span class="p">(</span><span class="s">&quot;LightData&quot;</span><span class="p">,</span><span class="w"> </span><span class="n">m_LightDataArray</span><span class="p">.</span><span class="n">data</span><span class="p">(),</span><span class="w"> </span><span class="k">sizeof</span><span class="p">(</span><span class="n">LightData</span><span class="p">)</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="n">lightCount</span><span class="p">);</span>
<a id="__codelineno-22-83" name="__codelineno-22-83" href="#__codelineno-22-83"></a><span class="p">}</span>
<a id="__codelineno-22-84" name="__codelineno-22-84" href="#__codelineno-22-84"></a>
<a id="__codelineno-22-85" name="__codelineno-22-85" href="#__codelineno-22-85"></a><span class="kt">void</span><span class="w"> </span><span class="n">ForwardRenderer</span><span class="o">::</span><span class="n">RenderObjects</span><span class="p">(</span><span class="k">const</span><span class="w"> </span><span class="n">Scene</span><span class="o">&amp;</span><span class="w"> </span><span class="n">scene</span><span class="p">,</span><span class="w"> </span><span class="k">const</span><span class="w"> </span><span class="n">Camera</span><span class="o">&amp;</span><span class="w"> </span><span class="n">camera</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-22-86" name="__codelineno-22-86" href="#__codelineno-22-86"></a><span class="w">    </span><span class="n">m_ForwardShader</span><span class="p">.</span><span class="n">Bind</span><span class="p">();</span>
<a id="__codelineno-22-87" name="__codelineno-22-87" href="#__codelineno-22-87"></a><span class="w">    </span><span class="n">m_ForwardShader</span><span class="p">.</span><span class="n">SetMatrix</span><span class="p">(</span><span class="s">&quot;viewProjection&quot;</span><span class="p">,</span><span class="w"> </span><span class="n">camera</span><span class="p">.</span><span class="n">GetViewProjectionMatrix</span><span class="p">());</span>
<a id="__codelineno-22-88" name="__codelineno-22-88" href="#__codelineno-22-88"></a><span class="w">    </span><span class="n">m_ForwardShader</span><span class="p">.</span><span class="n">SetVector3</span><span class="p">(</span><span class="s">&quot;cameraPosition&quot;</span><span class="p">,</span><span class="w"> </span><span class="n">camera</span><span class="p">.</span><span class="n">GetPosition</span><span class="p">());</span>
<a id="__codelineno-22-89" name="__codelineno-22-89" href="#__codelineno-22-89"></a><span class="w">    </span><span class="n">m_ForwardShader</span><span class="p">.</span><span class="n">SetTexture</span><span class="p">(</span><span class="s">&quot;shadowMap&quot;</span><span class="p">,</span><span class="w"> </span><span class="n">m_ShadowMap</span><span class="p">.</span><span class="n">GetShadowTexture</span><span class="p">());</span>
<a id="__codelineno-22-90" name="__codelineno-22-90" href="#__codelineno-22-90"></a>
<a id="__codelineno-22-91" name="__codelineno-22-91" href="#__codelineno-22-91"></a><span class="w">    </span><span class="k">for</span><span class="w"> </span><span class="p">(</span><span class="k">const</span><span class="w"> </span><span class="k">auto</span><span class="o">&amp;</span><span class="w"> </span><span class="n">object</span><span class="w"> </span><span class="o">:</span><span class="w"> </span><span class="n">scene</span><span class="p">.</span><span class="n">GetObjects</span><span class="p">())</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-22-92" name="__codelineno-22-92" href="#__codelineno-22-92"></a><span class="w">        </span><span class="n">m_ForwardShader</span><span class="p">.</span><span class="n">SetMatrix</span><span class="p">(</span><span class="s">&quot;model&quot;</span><span class="p">,</span><span class="w"> </span><span class="n">object</span><span class="p">.</span><span class="n">GetTransform</span><span class="p">());</span>
<a id="__codelineno-22-93" name="__codelineno-22-93" href="#__codelineno-22-93"></a><span class="w">        </span><span class="n">object</span><span class="p">.</span><span class="n">GetMaterial</span><span class="p">().</span><span class="n">Bind</span><span class="p">(</span><span class="n">m_ForwardShader</span><span class="p">);</span>
<a id="__codelineno-22-94" name="__codelineno-22-94" href="#__codelineno-22-94"></a><span class="w">        </span><span class="n">object</span><span class="p">.</span><span class="n">GetMesh</span><span class="p">().</span><span class="n">Render</span><span class="p">();</span>
<a id="__codelineno-22-95" name="__codelineno-22-95" href="#__codelineno-22-95"></a><span class="w">    </span><span class="p">}</span>
<a id="__codelineno-22-96" name="__codelineno-22-96" href="#__codelineno-22-96"></a><span class="p">}</span>
</code></pre></div>
<p>Now, let's look at the shader code for forward rendering:</p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-23-1" name="__codelineno-23-1" href="#__codelineno-23-1"></a><span class="c1">// Forward.vert</span>
<a id="__codelineno-23-2" name="__codelineno-23-2" href="#__codelineno-23-2"></a><span class="cp">#version 450</span>
<a id="__codelineno-23-3" name="__codelineno-23-3" href="#__codelineno-23-3"></a>
<a id="__codelineno-23-4" name="__codelineno-23-4" href="#__codelineno-23-4"></a><span class="k">layout</span><span class="p">(</span><span class="n">location</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mo">0</span><span class="p">)</span><span class="w"> </span><span class="k">in</span><span class="w"> </span><span class="kt">vec3</span><span class="w"> </span><span class="n">inPosition</span><span class="p">;</span>
<a id="__codelineno-23-5" name="__codelineno-23-5" href="#__codelineno-23-5"></a><span class="k">layout</span><span class="p">(</span><span class="n">location</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">1</span><span class="p">)</span><span class="w"> </span><span class="k">in</span><span class="w"> </span><span class="kt">vec3</span><span class="w"> </span><span class="n">inNormal</span><span class="p">;</span>
<a id="__codelineno-23-6" name="__codelineno-23-6" href="#__codelineno-23-6"></a><span class="k">layout</span><span class="p">(</span><span class="n">location</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">2</span><span class="p">)</span><span class="w"> </span><span class="k">in</span><span class="w"> </span><span class="kt">vec2</span><span class="w"> </span><span class="n">inTexCoord</span><span class="p">;</span>
<a id="__codelineno-23-7" name="__codelineno-23-7" href="#__codelineno-23-7"></a><span class="k">layout</span><span class="p">(</span><span class="n">location</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">3</span><span class="p">)</span><span class="w"> </span><span class="k">in</span><span class="w"> </span><span class="kt">vec3</span><span class="w"> </span><span class="n">inTangent</span><span class="p">;</span>
<a id="__codelineno-23-8" name="__codelineno-23-8" href="#__codelineno-23-8"></a>
<a id="__codelineno-23-9" name="__codelineno-23-9" href="#__codelineno-23-9"></a><span class="k">layout</span><span class="p">(</span><span class="n">location</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mo">0</span><span class="p">)</span><span class="w"> </span><span class="k">out</span><span class="w"> </span><span class="kt">vec3</span><span class="w"> </span><span class="n">outWorldPos</span><span class="p">;</span>
<a id="__codelineno-23-10" name="__codelineno-23-10" href="#__codelineno-23-10"></a><span class="k">layout</span><span class="p">(</span><span class="n">location</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">1</span><span class="p">)</span><span class="w"> </span><span class="k">out</span><span class="w"> </span><span class="kt">vec2</span><span class="w"> </span><span class="n">outTexCoord</span><span class="p">;</span>
<a id="__codelineno-23-11" name="__codelineno-23-11" href="#__codelineno-23-11"></a><span class="k">layout</span><span class="p">(</span><span class="n">location</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">2</span><span class="p">)</span><span class="w"> </span><span class="k">out</span><span class="w"> </span><span class="kt">mat3</span><span class="w"> </span><span class="n">outTBN</span><span class="p">;</span>
<a id="__codelineno-23-12" name="__codelineno-23-12" href="#__codelineno-23-12"></a>
<a id="__codelineno-23-13" name="__codelineno-23-13" href="#__codelineno-23-13"></a><span class="k">layout</span><span class="p">(</span><span class="n">std140</span><span class="p">,</span><span class="w"> </span><span class="n">binding</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mo">0</span><span class="p">)</span><span class="w"> </span><span class="k">uniform</span><span class="w"> </span><span class="n">CameraData</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-23-14" name="__codelineno-23-14" href="#__codelineno-23-14"></a><span class="w">    </span><span class="kt">mat4</span><span class="w"> </span><span class="n">viewProjection</span><span class="p">;</span>
<a id="__codelineno-23-15" name="__codelineno-23-15" href="#__codelineno-23-15"></a><span class="w">    </span><span class="kt">vec3</span><span class="w"> </span><span class="n">cameraPosition</span><span class="p">;</span>
<a id="__codelineno-23-16" name="__codelineno-23-16" href="#__codelineno-23-16"></a><span class="p">};</span>
<a id="__codelineno-23-17" name="__codelineno-23-17" href="#__codelineno-23-17"></a>
<a id="__codelineno-23-18" name="__codelineno-23-18" href="#__codelineno-23-18"></a><span class="k">layout</span><span class="p">(</span><span class="n">std140</span><span class="p">,</span><span class="w"> </span><span class="n">binding</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">1</span><span class="p">)</span><span class="w"> </span><span class="k">uniform</span><span class="w"> </span><span class="n">ModelData</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-23-19" name="__codelineno-23-19" href="#__codelineno-23-19"></a><span class="w">    </span><span class="kt">mat4</span><span class="w"> </span><span class="n">model</span><span class="p">;</span>
<a id="__codelineno-23-20" name="__codelineno-23-20" href="#__codelineno-23-20"></a><span class="p">};</span>
<a id="__codelineno-23-21" name="__codelineno-23-21" href="#__codelineno-23-21"></a>
<a id="__codelineno-23-22" name="__codelineno-23-22" href="#__codelineno-23-22"></a><span class="kt">void</span><span class="w"> </span><span class="n">main</span><span class="p">()</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-23-23" name="__codelineno-23-23" href="#__codelineno-23-23"></a><span class="w">    </span><span class="kt">vec4</span><span class="w"> </span><span class="n">worldPos</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">model</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="kt">vec4</span><span class="p">(</span><span class="n">inPosition</span><span class="p">,</span><span class="w"> </span><span class="mf">1.0</span><span class="p">);</span>
<a id="__codelineno-23-24" name="__codelineno-23-24" href="#__codelineno-23-24"></a><span class="w">    </span><span class="nb">gl_Position</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">viewProjection</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="n">worldPos</span><span class="p">;</span>
<a id="__codelineno-23-25" name="__codelineno-23-25" href="#__codelineno-23-25"></a><span class="w">    </span><span class="n">outWorldPos</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">worldPos</span><span class="p">.</span><span class="n">xyz</span><span class="p">;</span>
<a id="__codelineno-23-26" name="__codelineno-23-26" href="#__codelineno-23-26"></a><span class="w">    </span><span class="n">outTexCoord</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">inTexCoord</span><span class="p">;</span>
<a id="__codelineno-23-27" name="__codelineno-23-27" href="#__codelineno-23-27"></a>
<a id="__codelineno-23-28" name="__codelineno-23-28" href="#__codelineno-23-28"></a><span class="w">    </span><span class="kt">vec3</span><span class="w"> </span><span class="n">N</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">normalize</span><span class="p">(</span><span class="kt">mat3</span><span class="p">(</span><span class="n">model</span><span class="p">)</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="n">inNormal</span><span class="p">);</span>
<a id="__codelineno-23-29" name="__codelineno-23-29" href="#__codelineno-23-29"></a><span class="w">    </span><span class="kt">vec3</span><span class="w"> </span><span class="n">T</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">normalize</span><span class="p">(</span><span class="kt">mat3</span><span class="p">(</span><span class="n">model</span><span class="p">)</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="n">inTangent</span><span class="p">);</span>
<a id="__codelineno-23-30" name="__codelineno-23-30" href="#__codelineno-23-30"></a><span class="w">    </span><span class="kt">vec3</span><span class="w"> </span><span class="n">B</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">cross</span><span class="p">(</span><span class="n">N</span><span class="p">,</span><span class="w"> </span><span class="n">T</span><span class="p">);</span>
<a id="__codelineno-23-31" name="__codelineno-23-31" href="#__codelineno-23-31"></a><span class="w">    </span><span class="n">outTBN</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="kt">mat3</span><span class="p">(</span><span class="n">T</span><span class="p">,</span><span class="w"> </span><span class="n">B</span><span class="p">,</span><span class="w"> </span><span class="n">N</span><span class="p">);</span>
<a id="__codelineno-23-32" name="__codelineno-23-32" href="#__codelineno-23-32"></a><span class="p">}</span>
<a id="__codelineno-23-33" name="__codelineno-23-33" href="#__codelineno-23-33"></a>
<a id="__codelineno-23-34" name="__codelineno-23-34" href="#__codelineno-23-34"></a><span class="c1">// Forward.frag</span>
<a id="__codelineno-23-35" name="__codelineno-23-35" href="#__codelineno-23-35"></a><span class="cp">#version 450</span>
<a id="__codelineno-23-36" name="__codelineno-23-36" href="#__codelineno-23-36"></a>
<a id="__codelineno-23-37" name="__codelineno-23-37" href="#__codelineno-23-37"></a><span class="k">layout</span><span class="p">(</span><span class="n">location</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mo">0</span><span class="p">)</span><span class="w"> </span><span class="k">in</span><span class="w"> </span><span class="kt">vec3</span><span class="w"> </span><span class="n">inWorldPos</span><span class="p">;</span>
<a id="__codelineno-23-38" name="__codelineno-23-38" href="#__codelineno-23-38"></a><span class="k">layout</span><span class="p">(</span><span class="n">location</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">1</span><span class="p">)</span><span class="w"> </span><span class="k">in</span><span class="w"> </span><span class="kt">vec2</span><span class="w"> </span><span class="n">inTexCoord</span><span class="p">;</span>
<a id="__codelineno-23-39" name="__codelineno-23-39" href="#__codelineno-23-39"></a><span class="k">layout</span><span class="p">(</span><span class="n">location</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">2</span><span class="p">)</span><span class="w"> </span><span class="k">in</span><span class="w"> </span><span class="kt">mat3</span><span class="w"> </span><span class="n">inTBN</span><span class="p">;</span>
<a id="__codelineno-23-40" name="__codelineno-23-40" href="#__codelineno-23-40"></a>
<a id="__codelineno-23-41" name="__codelineno-23-41" href="#__codelineno-23-41"></a><span class="k">layout</span><span class="p">(</span><span class="n">location</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mo">0</span><span class="p">)</span><span class="w"> </span><span class="k">out</span><span class="w"> </span><span class="kt">vec4</span><span class="w"> </span><span class="n">outColor</span><span class="p">;</span>
<a id="__codelineno-23-42" name="__codelineno-23-42" href="#__codelineno-23-42"></a>
<a id="__codelineno-23-43" name="__codelineno-23-43" href="#__codelineno-23-43"></a><span class="k">layout</span><span class="p">(</span><span class="n">binding</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mo">0</span><span class="p">)</span><span class="w"> </span><span class="k">uniform</span><span class="w"> </span><span class="kt">sampler2D</span><span class="w"> </span><span class="n">albedoMap</span><span class="p">;</span>
<a id="__codelineno-23-44" name="__codelineno-23-44" href="#__codelineno-23-44"></a><span class="k">layout</span><span class="p">(</span><span class="n">binding</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">1</span><span class="p">)</span><span class="w"> </span><span class="k">uniform</span><span class="w"> </span><span class="kt">sampler2D</span><span class="w"> </span><span class="n">normalMap</span><span class="p">;</span>
<a id="__codelineno-23-45" name="__codelineno-23-45" href="#__codelineno-23-45"></a><span class="k">layout</span><span class="p">(</span><span class="n">binding</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">2</span><span class="p">)</span><span class="w"> </span><span class="k">uniform</span><span class="w"> </span><span class="kt">sampler2D</span><span class="w"> </span><span class="n">roughnessMap</span><span class="p">;</span>
<a id="__codelineno-23-46" name="__codelineno-23-46" href="#__codelineno-23-46"></a><span class="k">layout</span><span class="p">(</span><span class="n">binding</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">3</span><span class="p">)</span><span class="w"> </span><span class="k">uniform</span><span class="w"> </span><span class="kt">sampler2D</span><span class="w"> </span><span class="n">metallicMap</span><span class="p">;</span>
<a id="__codelineno-23-47" name="__codelineno-23-47" href="#__codelineno-23-47"></a><span class="k">layout</span><span class="p">(</span><span class="n">binding</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">4</span><span class="p">)</span><span class="w"> </span><span class="k">uniform</span><span class="w"> </span><span class="kt">sampler2D</span><span class="w"> </span><span class="n">shadowMap</span><span class="p">;</span>
<a id="__codelineno-23-48" name="__codelineno-23-48" href="#__codelineno-23-48"></a>
<a id="__codelineno-23-49" name="__codelineno-23-49" href="#__codelineno-23-49"></a><span class="k">layout</span><span class="p">(</span><span class="n">std140</span><span class="p">,</span><span class="w"> </span><span class="n">binding</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mo">0</span><span class="p">)</span><span class="w"> </span><span class="k">uniform</span><span class="w"> </span><span class="n">CameraData</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-23-50" name="__codelineno-23-50" href="#__codelineno-23-50"></a><span class="w">    </span><span class="kt">mat4</span><span class="w"> </span><span class="n">viewProjection</span><span class="p">;</span>
<a id="__codelineno-23-51" name="__codelineno-23-51" href="#__codelineno-23-51"></a><span class="w">    </span><span class="kt">vec3</span><span class="w"> </span><span class="n">cameraPosition</span><span class="p">;</span>
<a id="__codelineno-23-52" name="__codelineno-23-52" href="#__codelineno-23-52"></a><span class="p">};</span>
<a id="__codelineno-23-53" name="__codelineno-23-53" href="#__codelineno-23-53"></a>
<a id="__codelineno-23-54" name="__codelineno-23-54" href="#__codelineno-23-54"></a><span class="k">struct</span><span class="w"> </span><span class="n">Light</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-23-55" name="__codelineno-23-55" href="#__codelineno-23-55"></a><span class="w">    </span><span class="kt">vec4</span><span class="w"> </span><span class="n">position</span><span class="p">;</span><span class="w">    </span><span class="c1">// w is used to determine light type</span>
<a id="__codelineno-23-56" name="__codelineno-23-56" href="#__codelineno-23-56"></a><span class="w">    </span><span class="kt">vec4</span><span class="w"> </span><span class="n">direction</span><span class="p">;</span><span class="w">   </span><span class="c1">// w is used for spot light angle</span>
<a id="__codelineno-23-57" name="__codelineno-23-57" href="#__codelineno-23-57"></a><span class="w">    </span><span class="kt">vec4</span><span class="w"> </span><span class="n">color</span><span class="p">;</span><span class="w">       </span><span class="c1">// w is intensity</span>
<a id="__codelineno-23-58" name="__codelineno-23-58" href="#__codelineno-23-58"></a><span class="w">    </span><span class="kt">mat4</span><span class="w"> </span><span class="n">shadowMatrix</span><span class="p">;</span>
<a id="__codelineno-23-59" name="__codelineno-23-59" href="#__codelineno-23-59"></a><span class="p">};</span>
<a id="__codelineno-23-60" name="__codelineno-23-60" href="#__codelineno-23-60"></a>
<a id="__codelineno-23-61" name="__codelineno-23-61" href="#__codelineno-23-61"></a><span class="k">layout</span><span class="p">(</span><span class="n">std140</span><span class="p">,</span><span class="w"> </span><span class="n">binding</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">2</span><span class="p">)</span><span class="w"> </span><span class="k">uniform</span><span class="w"> </span><span class="n">LightData</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-23-62" name="__codelineno-23-62" href="#__codelineno-23-62"></a><span class="w">    </span><span class="n">Light</span><span class="w"> </span><span class="n">lights</span><span class="p">[</span><span class="mi">8</span><span class="p">];</span>
<a id="__codelineno-23-63" name="__codelineno-23-63" href="#__codelineno-23-63"></a><span class="p">};</span>
<a id="__codelineno-23-64" name="__codelineno-23-64" href="#__codelineno-23-64"></a>
<a id="__codelineno-23-65" name="__codelineno-23-65" href="#__codelineno-23-65"></a><span class="k">uniform</span><span class="w"> </span><span class="kt">int</span><span class="w"> </span><span class="n">lightCount</span><span class="p">;</span>
<a id="__codelineno-23-66" name="__codelineno-23-66" href="#__codelineno-23-66"></a>
<a id="__codelineno-23-67" name="__codelineno-23-67" href="#__codelineno-23-67"></a><span class="kt">float</span><span class="w"> </span><span class="n">CalculateShadow</span><span class="p">(</span><span class="kt">vec4</span><span class="w"> </span><span class="n">fragPosLightSpace</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-23-68" name="__codelineno-23-68" href="#__codelineno-23-68"></a><span class="w">    </span><span class="kt">vec3</span><span class="w"> </span><span class="n">projCoords</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">fragPosLightSpace</span><span class="p">.</span><span class="n">xyz</span><span class="w"> </span><span class="o">/</span><span class="w"> </span><span class="n">fragPosLightSpace</span><span class="p">.</span><span class="n">w</span><span class="p">;</span>
<a id="__codelineno-23-69" name="__codelineno-23-69" href="#__codelineno-23-69"></a><span class="w">    </span><span class="n">projCoords</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">projCoords</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="mf">0.5</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="mf">0.5</span><span class="p">;</span>
<a id="__codelineno-23-70" name="__codelineno-23-70" href="#__codelineno-23-70"></a><span class="w">    </span><span class="kt">float</span><span class="w"> </span><span class="n">closestDepth</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">texture</span><span class="p">(</span><span class="n">shadowMap</span><span class="p">,</span><span class="w"> </span><span class="n">projCoords</span><span class="p">.</span><span class="n">xy</span><span class="p">).</span><span class="n">r</span><span class="p">;</span>
<a id="__codelineno-23-71" name="__codelineno-23-71" href="#__codelineno-23-71"></a><span class="w">    </span><span class="kt">float</span><span class="w"> </span><span class="n">currentDepth</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">projCoords</span><span class="p">.</span><span class="n">z</span><span class="p">;</span>
<a id="__codelineno-23-72" name="__codelineno-23-72" href="#__codelineno-23-72"></a><span class="w">    </span><span class="kt">float</span><span class="w"> </span><span class="n">bias</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mf">0.005</span><span class="p">;</span>
<a id="__codelineno-23-73" name="__codelineno-23-73" href="#__codelineno-23-73"></a><span class="w">    </span><span class="k">return</span><span class="w"> </span><span class="n">currentDepth</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="n">bias</span><span class="w"> </span><span class="o">&gt;</span><span class="w"> </span><span class="n">closestDepth</span><span class="w"> </span><span class="o">?</span><span class="w"> </span><span class="mf">0.0</span><span class="w"> </span><span class="o">:</span><span class="w"> </span><span class="mf">1.0</span><span class="p">;</span>
<a id="__codelineno-23-74" name="__codelineno-23-74" href="#__codelineno-23-74"></a><span class="p">}</span>
<a id="__codelineno-23-75" name="__codelineno-23-75" href="#__codelineno-23-75"></a>
<a id="__codelineno-23-76" name="__codelineno-23-76" href="#__codelineno-23-76"></a><span class="kt">void</span><span class="w"> </span><span class="n">main</span><span class="p">()</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-23-77" name="__codelineno-23-77" href="#__codelineno-23-77"></a><span class="w">    </span><span class="kt">vec3</span><span class="w"> </span><span class="n">albedo</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">texture</span><span class="p">(</span><span class="n">albedoMap</span><span class="p">,</span><span class="w"> </span><span class="n">inTexCoord</span><span class="p">).</span><span class="n">rgb</span><span class="p">;</span>
<a id="__codelineno-23-78" name="__codelineno-23-78" href="#__codelineno-23-78"></a><span class="w">    </span><span class="kt">float</span><span class="w"> </span><span class="n">roughness</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">texture</span><span class="p">(</span><span class="n">roughnessMap</span><span class="p">,</span><span class="w"> </span><span class="n">inTexCoord</span><span class="p">).</span><span class="n">r</span><span class="p">;</span>
<a id="__codelineno-23-79" name="__codelineno-23-79" href="#__codelineno-23-79"></a><span class="w">    </span><span class="kt">float</span><span class="w"> </span><span class="n">metallic</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">texture</span><span class="p">(</span><span class="n">metallicMap</span><span class="p">,</span><span class="w"> </span><span class="n">inTexCoord</span><span class="p">).</span><span class="n">r</span><span class="p">;</span>
<a id="__codelineno-23-80" name="__codelineno-23-80" href="#__codelineno-23-80"></a>
<a id="__codelineno-23-81" name="__codelineno-23-81" href="#__codelineno-23-81"></a><span class="w">    </span><span class="kt">vec3</span><span class="w"> </span><span class="n">normal</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">texture</span><span class="p">(</span><span class="n">normalMap</span><span class="p">,</span><span class="w"> </span><span class="n">inTexCoord</span><span class="p">).</span><span class="n">xyz</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="mf">2.0</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="mf">1.0</span><span class="p">;</span>
<a id="__codelineno-23-82" name="__codelineno-23-82" href="#__codelineno-23-82"></a><span class="w">    </span><span class="n">normal</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">normalize</span><span class="p">(</span><span class="n">inTBN</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="n">normal</span><span class="p">);</span>
<a id="__codelineno-23-83" name="__codelineno-23-83" href="#__codelineno-23-83"></a>
<a id="__codelineno-23-84" name="__codelineno-23-84" href="#__codelineno-23-84"></a><span class="w">    </span><span class="kt">vec3</span><span class="w"> </span><span class="n">viewDir</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">normalize</span><span class="p">(</span><span class="n">cameraPosition</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="n">inWorldPos</span><span class="p">);</span>
<a id="__codelineno-23-85" name="__codelineno-23-85" href="#__codelineno-23-85"></a>
<a id="__codelineno-23-86" name="__codelineno-23-86" href="#__codelineno-23-86"></a><span class="w">    </span><span class="kt">vec3</span><span class="w"> </span><span class="n">F0</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">mix</span><span class="p">(</span><span class="kt">vec3</span><span class="p">(</span><span class="mf">0.04</span><span class="p">),</span><span class="w"> </span><span class="n">albedo</span><span class="p">,</span><span class="w"> </span><span class="n">metallic</span><span class="p">);</span>
<a id="__codelineno-23-87" name="__codelineno-23-87" href="#__codelineno-23-87"></a>
<a id="__codelineno-23-88" name="__codelineno-23-88" href="#__codelineno-23-88"></a><span class="w">    </span><span class="kt">vec3</span><span class="w"> </span><span class="n">Lo</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="kt">vec3</span><span class="p">(</span><span class="mf">0.0</span><span class="p">);</span>
<a id="__codelineno-23-89" name="__codelineno-23-89" href="#__codelineno-23-89"></a><span class="w">    </span><span class="k">for</span><span class="p">(</span><span class="kt">int</span><span class="w"> </span><span class="n">i</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mo">0</span><span class="p">;</span><span class="w"> </span><span class="n">i</span><span class="w"> </span><span class="o">&lt;</span><span class="w"> </span><span class="n">lightCount</span><span class="p">;</span><span class="w"> </span><span class="o">++</span><span class="n">i</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-23-90" name="__codelineno-23-90" href="#__codelineno-23-90"></a><span class="w">        </span><span class="kt">vec3</span><span class="w"> </span><span class="n">lightDir</span><span class="p">;</span>
<a id="__codelineno-23-91" name="__codelineno-23-91" href="#__codelineno-23-91"></a><span class="w">        </span><span class="kt">float</span><span class="w"> </span><span class="n">attenuation</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mf">1.0</span><span class="p">;</span>
<a id="__codelineno-23-92" name="__codelineno-23-92" href="#__codelineno-23-92"></a>
<a id="__codelineno-23-93" name="__codelineno-23-93" href="#__codelineno-23-93"></a><span class="w">        </span><span class="k">if</span><span class="p">(</span><span class="n">lights</span><span class="p">[</span><span class="n">i</span><span class="p">].</span><span class="n">position</span><span class="p">.</span><span class="n">w</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="mf">0.0</span><span class="p">)</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="c1">// Directional light</span>
<a id="__codelineno-23-94" name="__codelineno-23-94" href="#__codelineno-23-94"></a><span class="w">            </span><span class="n">lightDir</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">normalize</span><span class="p">(</span><span class="o">-</span><span class="n">lights</span><span class="p">[</span><span class="n">i</span><span class="p">].</span><span class="n">position</span><span class="p">.</span><span class="n">xyz</span><span class="p">);</span>
<a id="__codelineno-23-95" name="__codelineno-23-95" href="#__codelineno-23-95"></a><span class="w">        </span><span class="p">}</span><span class="w"> </span><span class="k">else</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="c1">// Point or spot light</span>
<a id="__codelineno-23-96" name="__codelineno-23-96" href="#__codelineno-23-96"></a><span class="w">            </span><span class="n">lightDir</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">normalize</span><span class="p">(</span><span class="n">lights</span><span class="p">[</span><span class="n">i</span><span class="p">].</span><span class="n">position</span><span class="p">.</span><span class="n">xyz</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="n">inWorldPos</span><span class="p">);</span>
<a id="__codelineno-23-97" name="__codelineno-23-97" href="#__codelineno-23-97"></a><span class="w">            </span><span class="kt">float</span><span class="w"> </span><span class="n">distance</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">length</span><span class="p">(</span><span class="n">lights</span><span class="p">[</span><span class="n">i</span><span class="p">].</span><span class="n">position</span><span class="p">.</span><span class="n">xyz</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="n">inWorldPos</span><span class="p">);</span>
<a id="__codelineno-23-98" name="__codelineno-23-98" href="#__codelineno-23-98"></a><span class="w">            </span><span class="n">attenuation</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mf">1.0</span><span class="w"> </span><span class="o">/</span><span class="w"> </span><span class="p">(</span><span class="mf">1.0</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="mf">0.09</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="n">distance</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="mf">0.032</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="n">distance</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="n">distance</span><span class="p">);</span>
<a id="__codelineno-23-99" name="__codelineno-23-99" href="#__codelineno-23-99"></a>
<a id="__codelineno-23-100" name="__codelineno-23-100" href="#__codelineno-23-100"></a><span class="w">            </span><span class="k">if</span><span class="p">(</span><span class="n">lights</span><span class="p">[</span><span class="n">i</span><span class="p">].</span><span class="n">direction</span><span class="p">.</span><span class="n">w</span><span class="w"> </span><span class="o">&gt;</span><span class="w"> </span><span class="mf">0.0</span><span class="p">)</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="c1">// Spot light</span>
<a id="__codelineno-23-101" name="__codelineno-23-101" href="#__codelineno-23-101"></a><span class="w">                </span><span class="kt">float</span><span class="w"> </span><span class="n">spotEffect</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">dot</span><span class="p">(</span><span class="n">normalize</span><span class="p">(</span><span class="n">lights</span><span class="p">[</span><span class="n">i</span><span class="p">].</span><span class="n">direction</span><span class="p">.</span><span class="n">xyz</span><span class="p">),</span><span class="w"> </span><span class="o">-</span><span class="n">lightDir</span><span class="p">);</span>
<a id="__codelineno-23-102" name="__codelineno-23-102" href="#__codelineno-23-102"></a><span class="w">                </span><span class="kt">float</span><span class="w"> </span><span class="n">spotCutoff</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">lights</span><span class="p">[</span><span class="n">i</span><span class="p">].</span><span class="n">direction</span><span class="p">.</span><span class="n">w</span><span class="p">;</span>
<a id="__codelineno-23-103" name="__codelineno-23-103" href="#__codelineno-23-103"></a><span class="w">                </span><span class="k">if</span><span class="p">(</span><span class="n">spotEffect</span><span class="w"> </span><span class="o">&lt;</span><span class="w"> </span><span class="n">spotCutoff</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-23-104" name="__codelineno-23-104" href="#__codelineno-23-104"></a><span class="w">                    </span><span class="n">attenuation</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mf">0.0</span><span class="p">;</span>
<a id="__codelineno-23-105" name="__codelineno-23-105" href="#__codelineno-23-105"></a><span class="w">                </span><span class="p">}</span><span class="w"> </span><span class="k">else</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-23-106" name="__codelineno-23-106" href="#__codelineno-23-106"></a><span class="w">                    </span><span class="n">attenuation</span><span class="w"> </span><span class="o">*=</span><span class="w"> </span><span class="n">smoothstep</span><span class="p">(</span><span class="n">spotCutoff</span><span class="p">,</span><span class="w"> </span><span class="n">spotCutoff</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="mf">0.1</span><span class="p">,</span><span class="w"> </span><span class="n">spotEffect</span><span class="p">);</span>
<a id="__codelineno-23-107" name="__codelineno-23-107" href="#__codelineno-23-107"></a><span class="w">                </span><span class="p">}</span>
<a id="__codelineno-23-108" name="__codelineno-23-108" href="#__codelineno-23-108"></a><span class="w">            </span><span class="p">}</span>
<a id="__codelineno-23-109" name="__codelineno-23-109" href="#__codelineno-23-109"></a><span class="w">        </span><span class="p">}</span>
<a id="__codelineno-23-110" name="__codelineno-23-110" href="#__codelineno-23-110"></a>
<a id="__codelineno-23-111" name="__codelineno-23-111" href="#__codelineno-23-111"></a><span class="w">        </span><span class="kt">vec3</span><span class="w"> </span><span class="n">halfDir</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">normalize</span><span class="p">(</span><span class="n">lightDir</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="n">viewDir</span><span class="p">);</span>
<a id="__codelineno-23-112" name="__codelineno-23-112" href="#__codelineno-23-112"></a><span class="w">        </span><span class="kt">float</span><span class="w"> </span><span class="n">NdotL</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">max</span><span class="p">(</span><span class="n">dot</span><span class="p">(</span><span class="n">normal</span><span class="p">,</span><span class="w"> </span><span class="n">lightDir</span><span class="p">),</span><span class="w"> </span><span class="mf">0.0</span><span class="p">);</span>
<a id="__codelineno-23-113" name="__codelineno-23-113" href="#__codelineno-23-113"></a><span class="w">        </span><span class="kt">float</span><span class="w"> </span><span class="n">NdotH</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">max</span><span class="p">(</span><span class="n">dot</span><span class="p">(</span><span class="n">normal</span><span class="p">,</span><span class="w"> </span><span class="n">halfDir</span><span class="p">),</span><span class="w"> </span><span class="mf">0.0</span><span class="p">);</span>
<a id="__codelineno-23-114" name="__codelineno-23-114" href="#__codelineno-23-114"></a><span class="w">        </span><span class="kt">float</span><span class="w"> </span><span class="n">NdotV</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">max</span><span class="p">(</span><span class="n">dot</span><span class="p">(</span><span class="n">normal</span><span class="p">,</span><span class="w"> </span><span class="n">viewDir</span><span class="p">),</span><span class="w"> </span><span class="mf">0.0</span><span class="p">);</span>
<a id="__codelineno-23-115" name="__codelineno-23-115" href="#__codelineno-23-115"></a><span class="w">        </span><span class="kt">float</span><span class="w"> </span><span class="n">HdotV</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">max</span><span class="p">(</span><span class="n">dot</span><span class="p">(</span><span class="n">halfDir</span><span class="p">,</span><span class="w"> </span><span class="n">viewDir</span><span class="p">),</span><span class="w"> </span><span class="mf">0.0</span><span class="p">);</span>
<a id="__codelineno-23-116" name="__codelineno-23-116" href="#__codelineno-23-116"></a>
<a id="__codelineno-23-117" name="__codelineno-23-117" href="#__codelineno-23-117"></a><span class="w">        </span><span class="kt">float</span><span class="w"> </span><span class="n">D</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="c1">// Distribution term (e.g., GGX)</span>
<a id="__codelineno-23-118" name="__codelineno-23-118" href="#__codelineno-23-118"></a><span class="w">        </span><span class="kt">float</span><span class="w"> </span><span class="n">G</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="c1">// Geometry term</span>
<a id="__codelineno-23-119" name="__codelineno-23-119" href="#__codelineno-23-119"></a><span class="w">        </span><span class="kt">vec3</span><span class="w"> </span><span class="n">F</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">F0</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="p">(</span><span class="mf">1.0</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="n">F0</span><span class="p">)</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="n">pow</span><span class="p">(</span><span class="mf">1.0</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="n">HdotV</span><span class="p">,</span><span class="w"> </span><span class="mf">5.0</span><span class="p">);</span>
<a id="__codelineno-23-120" name="__codelineno-23-120" href="#__codelineno-23-120"></a>
<a id="__codelineno-23-121" name="__codelineno-23-121" href="#__codelineno-23-121"></a><span class="w">        </span><span class="kt">vec3</span><span class="w"> </span><span class="n">specular</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">(</span><span class="n">D</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="n">G</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="n">F</span><span class="p">)</span><span class="w"> </span><span class="o">/</span><span class="w"> </span><span class="p">(</span><span class="mf">4.0</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="n">NdotV</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="n">NdotL</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="mf">0.001</span><span class="p">);</span>
<a id="__codelineno-23-122" name="__codelineno-23-122" href="#__codelineno-23-122"></a><span class="w">        </span><span class="kt">vec3</span><span class="w"> </span><span class="n">kD</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">(</span><span class="kt">vec3</span><span class="p">(</span><span class="mf">1.0</span><span class="p">)</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="n">F</span><span class="p">)</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="p">(</span><span class="mf">1.0</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="n">metallic</span><span class="p">);</span>
<a id="__codelineno-23-123" name="__codelineno-23-123" href="#__codelineno-23-123"></a>
<a id="__codelineno-23-124" name="__codelineno-23-124" href="#__codelineno-23-124"></a><span class="w">        </span><span class="kt">vec3</span><span class="w"> </span><span class="n">radiance</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">lights</span><span class="p">[</span><span class="n">i</span><span class="p">].</span><span class="n">color</span><span class="p">.</span><span class="n">rgb</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="n">lights</span><span class="p">[</span><span class="n">i</span><span class="p">].</span><span class="n">color</span><span class="p">.</span><span class="n">a</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="n">attenuation</span><span class="p">;</span>
<a id="__codelineno-23-125" name="__codelineno-23-125" href="#__codelineno-23-125"></a>
<a id="__codelineno-23-126" name="__codelineno-23-126" href="#__codelineno-23-126"></a><span class="w">        </span><span class="kt">float</span><span class="w"> </span><span class="n">shadow</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mf">1.0</span><span class="p">;</span>
<a id="__codelineno-23-127" name="__codelineno-23-127" href="#__codelineno-23-127"></a><span class="w">        </span><span class="k">if</span><span class="p">(</span><span class="n">lights</span><span class="p">[</span><span class="n">i</span><span class="p">].</span><span class="n">position</span><span class="p">.</span><span class="n">w</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="mf">0.0</span><span class="w"> </span><span class="o">||</span><span class="w"> </span><span class="n">lights</span><span class="p">[</span><span class="n">i</span><span class="p">].</span><span class="n">direction</span><span class="p">.</span><span class="n">w</span><span class="w"> </span><span class="o">&gt;</span><span class="w"> </span><span class="mf">0.0</span><span class="p">)</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="c1">// Apply shadows for directional and spot lights</span>
<a id="__codelineno-23-128" name="__codelineno-23-128" href="#__codelineno-23-128"></a><span class="w">            </span><span class="kt">vec4</span><span class="w"> </span><span class="n">fragPosLightSpace</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">lights</span><span class="p">[</span><span class="n">i</span><span class="p">].</span><span class="n">shadowMatrix</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="kt">vec4</span><span class="p">(</span><span class="n">inWorldPos</span><span class="p">,</span><span class="w"> </span><span class="mf">1.0</span><span class="p">);</span>
<a id="__codelineno-23-129" name="__codelineno-23-129" href="#__codelineno-23-129"></a><span class="w">            </span><span class="n">shadow</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">CalculateShadow</span><span class="p">(</span><span class="n">fragPosLightSpace</span><span class="p">);</span>
<a id="__codelineno-23-130" name="__codelineno-23-130" href="#__codelineno-23-130"></a><span class="w">        </span><span class="p">}</span>
<a id="__codelineno-23-131" name="__codelineno-23-131" href="#__codelineno-23-131"></a>
<a id="__codelineno-23-132" name="__codelineno-23-132" href="#__codelineno-23-132"></a><span class="w">        </span><span class="n">Lo</span><span class="w"> </span><span class="o">+=</span><span class="w"> </span><span class="p">(</span><span class="n">kD</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="n">albedo</span><span class="w"> </span><span class="o">/</span><span class="w"> </span><span class="n">PI</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="n">specular</span><span class="p">)</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="n">radiance</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="n">NdotL</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="n">shadow</span><span class="p">;</span>
<a id="__codelineno-23-133" name="__codelineno-23-133" href="#__codelineno-23-133"></a><span class="w">    </span><span class="p">}</span>
<a id="__codelineno-23-134" name="__codelineno-23-134" href="#__codelineno-23-134"></a>
<a id="__codelineno-23-135" name="__codelineno-23-135" href="#__codelineno-23-135"></a><span class="w">    </span><span class="kt">vec3</span><span class="w"> </span><span class="n">ambient</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="kt">vec3</span><span class="p">(</span><span class="mf">0.03</span><span class="p">)</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="n">albedo</span><span class="p">;</span>
<a id="__codelineno-23-136" name="__codelineno-23-136" href="#__codelineno-23-136"></a><span class="w">    </span><span class="kt">vec3</span><span class="w"> </span><span class="n">color</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">ambient</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="n">Lo</span><span class="p">;</span>
<a id="__codelineno-23-137" name="__codelineno-23-137" href="#__codelineno-23-137"></a>
<a id="__codelineno-23-138" name="__codelineno-23-138" href="#__codelineno-23-138"></a><span class="w">    </span><span class="n">color</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">color</span><span class="w"> </span><span class="o">/</span><span class="w"> </span><span class="p">(</span><span class="n">color</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="kt">vec3</span><span class="p">(</span><span class="mf">1.0</span><span class="p">));</span><span class="w"> </span><span class="c1">// Tone mapping</span>
<a id="__codelineno-23-139" name="__codelineno-23-139" href="#__codelineno-23-139"></a><span class="w">    </span><span class="n">color</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">pow</span><span class="p">(</span><span class="n">color</span><span class="p">,</span><span class="w"> </span><span class="kt">vec3</span><span class="p">(</span><span class="mf">1.0</span><span class="o">/</span><span class="mf">2.2</span><span class="p">));</span><span class="w">   </span><span class="c1">// Gamma correction</span>
<a id="__codelineno-23-140" name="__codelineno-23-140" href="#__codelineno-23-140"></a>
<a id="__codelineno-23-141" name="__codelineno-23-141" href="#__codelineno-23-141"></a><span class="w">    </span><span class="n">outColor</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="kt">vec4</span><span class="p">(</span><span class="n">color</span><span class="p">,</span><span class="w"> </span><span class="mf">1.0</span><span class="p">);</span>
<a id="__codelineno-23-142" name="__codelineno-23-142" href="#__codelineno-23-142"></a><span class="p">}</span>
</code></pre></div>
<h4 id="explanation_3">Explanation</h4>
<ol>
<li>
<p>Single-Pass Rendering:</p>
<ul>
<li>All lighting calculations are performed in a single pass for each object.</li>
<li>This approach is straightforward and works well for scenes with a moderate number of lights.</li>
</ul>
</li>
<li>
<p>Per-Object Lighting:</p>
<ul>
<li>Lighting is calculated for each object as it's rendered.</li>
<li>This allows for easy integration of per-object material properties.</li>
</ul>
</li>
<li>
<p>Multiple Light Types:</p>
<ul>
<li>The shader supports directional, point, and spot lights.</li>
<li>Light properties are passed to the shader in a uniform buffer.</li>
</ul>
</li>
<li>
<p>Shadow Mapping:</p>
<ul>
<li>Basic shadow mapping is integrated for directional and spot lights.</li>
<li>The shadow map is generated in a separate pass before the main rendering.</li>
</ul>
</li>
<li>
<p>PBR Lighting Model:</p>
<ul>
<li>The shader implements a basic physically-based rendering (PBR) lighting model.</li>
<li>It includes terms for diffuse and specular reflection, as well as energy conservation.</li>
</ul>
</li>
<li>
<p>Performance Considerations:</p>
<ul>
<li>Forward rendering can be efficient for scenes with few lights.</li>
<li>Performance may degrade with many lights, as each light is calculated for every pixel.</li>
<li>The number of lights is capped (in this case, to 8) to maintain performance.</li>
</ul>
</li>
<li>
<p>Advantages:</p>
<ul>
<li>Straightforward implementation.</li>
<li>Works well with traditional transparency and anti-aliasing techniques.</li>
<li>Can be more efficient than deferred rendering for scenes with simple lighting.</li>
</ul>
</li>
<li>
<p>Limitations:</p>
<ul>
<li>Can be less efficient for scenes with many lights.</li>
<li>Each object needs to be aware of all lights that might affect it.</li>
</ul>
</li>
</ol>
<p>This implementation provides a solid foundation for a forward rendering system in a professional game engine. Further improvements could include:</p>
<ul>
<li>Forward+ or tiled forward rendering for better performance with many lights</li>
<li>More advanced shadow mapping techniques (e.g., cascaded shadow maps for directional lights)</li>
<li>Screen-space ambient occlusion (SSAO) for improved ambient lighting</li>
<li>Volumetric lighting effects</li>
<li>Advanced material models (e.g., clear coat, subsurface scattering)</li>
</ul>
<h3 id="advanced-techniques">Advanced Techniques</h3>
<ol>
<li><strong>Compute Shaders</strong>: Utilize GPU for general-purpose computations, like particle systems or post-processing effects.</li>
<li><strong>Tessellation</strong>: Dynamically increase mesh detail based on camera distance or other factors.</li>
<li><strong>Geometry Shaders</strong>: Generate geometry on the GPU for effects like fur, grass, or explosions.</li>
<li><strong>Multi-pass Rendering</strong>: Create complex effects by rendering the scene multiple times with different shader passes.</li>
</ol>
<p>Understanding and optimizing each stage of the graphics pipeline is crucial for achieving high performance and visual quality in game development. Profiling tools and graphics debuggers are essential for identifying bottlenecks and optimizing your rendering pipeline.</p>
<h2 id="graphics-transformations">Graphics Transformations</h2>
<p>Graphics transformations are fundamental operations used to manipulate objects in 2D and 3D space. Understanding these transformations is crucial for positioning, scaling, and rotating game objects, as well as for setting up camera views and projections.</p>
<h3 id="types-of-transformations">Types of Transformations</h3>
<p>Sure! Here's how transformations are represented using matrices for both 2D and 3D graphics:</p>
<h4 id="1-translation">1. Translation</h4>
<p><strong>2D Translation Matrix:</strong>
To translate a point <span class="arithmatex">\((x, y)\)</span> by <span class="arithmatex">\((t_x, t_y)\)</span>:</p>
<div class="arithmatex">\[
\begin{bmatrix}
1 &amp; 0 &amp; t_x \\
0 &amp; 1 &amp; t_y \\
0 &amp; 0 &amp; 1
\end{bmatrix}
\begin{bmatrix}
x \\
y \\
1
\end{bmatrix}
=
\begin{bmatrix}
x' \\
y' \\
1
\end{bmatrix}
\]</div>
<p><strong>3D Translation Matrix:</strong>
To translate a point <span class="arithmatex">\((x, y, z)\)</span> by <span class="arithmatex">\((t_x, t_y, t_z)\)</span>:</p>
<div class="arithmatex">\[
\begin{bmatrix}
1 &amp; 0 &amp; 0 &amp; t_x \\
0 &amp; 1 &amp; 0 &amp; t_y \\
0 &amp; 0 &amp; 1 &amp; t_z \\
0 &amp; 0 &amp; 0 &amp; 1
\end{bmatrix}
\begin{bmatrix}
x \\
y \\
z \\
1
\end{bmatrix}
=
\begin{bmatrix}
x' \\
y' \\
z' \\
1
\end{bmatrix}
\]</div>
<h4 id="2-rotation">2. Rotation</h4>
<p><strong>2D Rotation Matrix:</strong>
To rotate a point <span class="arithmatex">\((x, y)\)</span> by an angle <span class="arithmatex">\(\theta\)</span> around the origin:</p>
<div class="arithmatex">\[
\begin{bmatrix}
\cos \theta &amp; -\sin \theta &amp; 0 \\
\sin \theta &amp; \cos \theta &amp; 0 \\
0 &amp; 0 &amp; 1
\end{bmatrix}
\begin{bmatrix}
x \\
y \\
1
\end{bmatrix}
=
\begin{bmatrix}
x' \\
y' \\
1
\end{bmatrix}
\]</div>
<p><strong>3D Rotation Matrices:</strong>
To rotate a point <span class="arithmatex">\((x, y, z)\)</span> around the x, y, and z axes:</p>
<ul>
<li><strong>Around the X-axis by <span class="arithmatex">\(\theta_x\)</span>:</strong></li>
</ul>
<div class="arithmatex">\[
\begin{bmatrix}
1 &amp; 0 &amp; 0 &amp; 0 \\
0 &amp; \cos \theta_x &amp; -\sin \theta_x &amp; 0 \\
0 &amp; \sin \theta_x &amp; \cos \theta_x &amp; 0 \\
0 &amp; 0 &amp; 0 &amp; 1
\end{bmatrix}
\]</div>
<ul>
<li><strong>Around the Y-axis by <span class="arithmatex">\(\theta_y\)</span>:</strong></li>
</ul>
<div class="arithmatex">\[
\begin{bmatrix}
\cos \theta_y &amp; 0 &amp; \sin \theta_y &amp; 0 \\
0 &amp; 1 &amp; 0 &amp; 0 \\
-\sin \theta_y &amp; 0 &amp; \cos \theta_y &amp; 0 \\
0 &amp; 0 &amp; 0 &amp; 1
\end{bmatrix}
\]</div>
<ul>
<li><strong>Around the Z-axis by <span class="arithmatex">\(\theta_z\)</span>:</strong></li>
</ul>
<div class="arithmatex">\[
\begin{bmatrix}
\cos \theta_z &amp; -\sin \theta_z &amp; 0 &amp; 0 \\
\sin \theta_z &amp; \cos \theta_z &amp; 0 &amp; 0 \\
0 &amp; 0 &amp; 1 &amp; 0 \\
0 &amp; 0 &amp; 0 &amp; 1
\end{bmatrix}
\]</div>
<h4 id="3-scaling">3. Scaling</h4>
<p><strong>2D Scaling Matrix:</strong>
To scale a point <span class="arithmatex">\((x, y)\)</span> by <span class="arithmatex">\(s_x\)</span> along the x-axis and <span class="arithmatex">\(s_y\)</span> along the y-axis:</p>
<div class="arithmatex">\[
\begin{bmatrix}
s_x &amp; 0 &amp; 0 \\
0 &amp; s_y &amp; 0 \\
0 &amp; 0 &amp; 1
\end{bmatrix}
\begin{bmatrix}
x \\
y \\
1
\end{bmatrix}
=
\begin{bmatrix}
x' \\
y' \\
1
\end{bmatrix}
\]</div>
<p><strong>3D Scaling Matrix:</strong>
To scale a point <span class="arithmatex">\((x, y, z)\)</span> by <span class="arithmatex">\(s_x\)</span>, <span class="arithmatex">\(s_y\)</span>, and <span class="arithmatex">\(s_z\)</span> along the x, y, and z axes respectively:</p>
<div class="arithmatex">\[
\begin{bmatrix}
s_x &amp; 0 &amp; 0 &amp; 0 \\
0 &amp; s_y &amp; 0 &amp; 0 \\
0 &amp; 0 &amp; s_z &amp; 0 \\
0 &amp; 0 &amp; 0 &amp; 1
\end{bmatrix}
\begin{bmatrix}
x \\
y \\
z \\
1
\end{bmatrix}
=
\begin{bmatrix}
x' \\
y' \\
z' \\
1
\end{bmatrix}
\]</div>
<h4 id="4-shear">4. Shear</h4>
<p><strong>2D Shear Matrix:</strong>
To shear a point <span class="arithmatex">\((x, y)\)</span> by shear factors <span class="arithmatex">\(sh_x\)</span> and <span class="arithmatex">\(sh_y\)</span>:</p>
<div class="arithmatex">\[
\begin{bmatrix}
1 &amp; sh_x &amp; 0 \\
sh_y &amp; 1 &amp; 0 \\
0 &amp; 0 &amp; 1
\end{bmatrix}
\begin{bmatrix}
x \\
y \\
1
\end{bmatrix}
=
\begin{bmatrix}
x' \\
y' \\
1
\end{bmatrix}
\]</div>
<h4 id="5-projection">5. Projection</h4>
<p>Projection matrices are used to map 3D points onto a 2D plane. There are two common types of projections: orthographic and perspective.</p>
<h4 id="orthographic-projection">Orthographic Projection</h4>
<p>Orthographic projection involves projecting points directly onto the 2D plane without accounting for depth. This type of projection is used when objects need to appear the same size regardless of their depth.</p>
<p><strong>3D Orthographic Projection Matrix:</strong></p>
<div class="arithmatex">\[
\begin{bmatrix}
1 &amp; 0 &amp; 0 &amp; 0 \\
0 &amp; 1 &amp; 0 &amp; 0 \\
0 &amp; 0 &amp; 1 &amp; 0 \\
0 &amp; 0 &amp; 0 &amp; 1
\end{bmatrix}
\]</div>
<p>For a specific orthographic projection where the near and far planes, and the dimensions of the view volume are defined, the matrix becomes more complex. Assuming the left, right, bottom, top, near, and far clipping planes are defined as <span class="arithmatex">\(l\)</span>, <span class="arithmatex">\(r\)</span>, <span class="arithmatex">\(b\)</span>, <span class="arithmatex">\(t\)</span>, <span class="arithmatex">\(n\)</span>, and <span class="arithmatex">\(f\)</span> respectively, the matrix is:</p>
<div class="arithmatex">\[
\begin{bmatrix}
\frac{2}{r-l} &amp; 0 &amp; 0 &amp; -\frac{r+l}{r-l} \\
0 &amp; \frac{2}{t-b} &amp; 0 &amp; -\frac{t+b}{t-b} \\
0 &amp; 0 &amp; \frac{-2}{f-n} &amp; -\frac{f+n}{f-n} \\
0 &amp; 0 &amp; 0 &amp; 1
\end{bmatrix}
\]</div>
<h4 id="perspective-projection">Perspective Projection</h4>
<p>Perspective projection simulates the way the human eye perceives the world, where objects farther away appear smaller. The perspective projection matrix transforms a 3D point so that depth is considered, and then applies a perspective divide.</p>
<p><strong>3D Perspective Projection Matrix:</strong></p>
<p>For a standard perspective projection with field of view <span class="arithmatex">\(fov\)</span>, aspect ratio <span class="arithmatex">\(a\)</span>, near <span class="arithmatex">\(n\)</span>, and far <span class="arithmatex">\(f\)</span> clipping planes:</p>
<div class="arithmatex">\[
\begin{bmatrix}
\frac{1}{a \tan(\frac{fov}{2})} &amp; 0 &amp; 0 &amp; 0 \\
0 &amp; \frac{1}{\tan(\frac{fov}{2})} &amp; 0 &amp; 0 \\
0 &amp; 0 &amp; \frac{f + n}{n - f} &amp; \frac{2fn}{n - f} \\
0 &amp; 0 &amp; -1 &amp; 0
\end{bmatrix}
\]</div>
<p>The <span class="arithmatex">\(\frac{1}{\tan(\frac{fov}{2})}\)</span> term corresponds to the cotangent of half the field of view angle and scales the coordinates based on the aspect ratio and field of view.</p>
<h4 id="explanation-of-perspective-projection-matrix">Explanation of Perspective Projection Matrix</h4>
<ul>
<li><strong>Aspect Ratio</strong> (<span class="arithmatex">\(a\)</span>): Ratio of the width to the height of the viewport.</li>
<li><strong>Field of View</strong> (<span class="arithmatex">\(fov\)</span>): Vertical angle of the camera's field of view.</li>
<li><strong>Near Clipping Plane</strong> (<span class="arithmatex">\(n\)</span>): The closest distance from the camera where objects are rendered.</li>
<li><strong>Far Clipping Plane</strong> (<span class="arithmatex">\(f\)</span>): The farthest distance from the camera where objects are rendered.</li>
</ul>
<p>The perspective projection matrix maps a 3D point <span class="arithmatex">\((x, y, z)\)</span> to a 4D point <span class="arithmatex">\((x', y', z', w')\)</span>. The resulting <span class="arithmatex">\(w'\)</span> component is used for perspective divide to convert the homogeneous coordinates back to 3D:</p>
<div class="arithmatex">\[
\left( \frac{x'}{w'}, \frac{y'}{w'}, \frac{z'}{w'} \right)
\]</div>
<p>This division by <span class="arithmatex">\(w'\)</span> is what gives the perspective effect, making distant objects appear smaller.</p>
<p>In summary, projection matrices are crucial in rendering scenes correctly, transforming 3D points into a 2D plane while accounting for depth and perspective.</p>
<p>These matrices form the foundation of transformation operations in computer graphics, enabling the manipulation and rendering of objects in a scene.</p>
<h3 id="coordinate-spaces">Coordinate Spaces</h3>
<p>Before diving into transformations, it's important to understand different coordinate spaces:</p>
<h4 id="1-object-space-model-space">1. Object Space (Model Space)</h4>
<p><strong>Purpose</strong>: The local coordinates of the object relative to its own origin.</p>
<p><strong>Mathematical Representation</strong>: Points in object space are typically defined as <span class="arithmatex">\(\mathbf{P_{model}} = (x, y, z, 1)\)</span>.</p>
<h4 id="2-world-space">2. World Space</h4>
<p><strong>Purpose</strong>: Transform the vertices from the object's local coordinate system to the global game world coordinate system.</p>
<p><strong>Mathematical Transformation</strong>: This is achieved using the model transformation matrix, which includes translation, rotation, and scaling.</p>
<div class="arithmatex">\[ \mathbf{P_{world}} = \mathbf{M_{model}} \cdot \mathbf{P_{model}} \]</div>
<h4 id="3-view-space-camera-space">3. View Space (Camera Space)</h4>
<p><strong>Purpose</strong>: Transform the vertices from world coordinates to the camera's coordinate system.</p>
<p><strong>Mathematical Transformation</strong>: This is done using the view transformation matrix, which is the inverse of the camera's transformation matrix.</p>
<div class="arithmatex">\[ \mathbf{P_{view}} = \mathbf{M_{view}} \cdot \mathbf{P_{world}} \]</div>
<h4 id="4-clip-space">4. Clip Space</h4>
<p><strong>Purpose</strong>: Transform the vertices from camera coordinates to clip coordinates, which are used for clipping against the view frustum.</p>
<p><strong>Mathematical Transformation</strong>: This is achieved using the projection matrix, either orthographic or perspective.</p>
<div class="arithmatex">\[ \mathbf{P_{clip}} = \mathbf{M_{proj}} \cdot \mathbf{P_{view}} \]</div>
<h4 id="5-screen-space">5. Screen Space</h4>
<p><strong>Purpose</strong>: Transform the vertices from normalized device coordinates to 2D screen coordinates for the final rendered image.</p>
<p><strong>Mathematical Transformation</strong>: This is done using the viewport transformation matrix.</p>
<div class="arithmatex">\[ \mathbf{P_{screen}} = \mathbf{M_{viewport}} \cdot \mathbf{P_{ndc}} \]</div>
<p>Where <span class="arithmatex">\(\mathbf{P_{ndc}}\)</span> is obtained by performing perspective divide on <span class="arithmatex">\(\mathbf{P_{clip}}\)</span>.</p>
<h3 id="coordinate-transformations-in-detail">Coordinate Transformations in Detail</h3>
<p>Let's take a vertex point <span class="arithmatex">\(\mathbf{P_{model}} = (x, y, z, 1)\)</span> and transform it through each coordinate space.</p>
<h4 id="1-model-transformation-object-space-to-world-space">1. Model Transformation (Object Space to World Space)</h4>
<div class="arithmatex">\[ \mathbf{P_{world}} = \mathbf{M_{model}} \cdot \mathbf{P_{model}} \]</div>
<p>Example:
- Translation by <span class="arithmatex">\((1, 0, 0)\)</span>
- Rotation around the z-axis by 90 degrees
- Scaling by 2</p>
<div class="arithmatex">\[ \mathbf{M_{model}} = \begin{bmatrix}
2 &amp; 0 &amp; 0 &amp; 1 \\
0 &amp; 2 &amp; 0 &amp; 0 \\
0 &amp; 0 &amp; 2 &amp; 0 \\
0 &amp; 0 &amp; 0 &amp; 1
\end{bmatrix} \cdot \begin{bmatrix}
0 &amp; -1 &amp; 0 &amp; 0 \\
1 &amp; 0 &amp; 0 &amp; 0 \\
0 &amp; 0 &amp; 1 &amp; 0 \\
0 &amp; 0 &amp; 0 &amp; 1
\end{bmatrix} \cdot \begin{bmatrix}
1 &amp; 0 &amp; 0 &amp; 1 \\
0 &amp; 1 &amp; 0 &amp; 0 \\
0 &amp; 0 &amp; 1 &amp; 0 \\
0 &amp; 0 &amp; 0 &amp; 1
\end{bmatrix} \]</div>
<div class="arithmatex">\[ \mathbf{P_{world}} = \mathbf{M_{model}} \cdot \begin{bmatrix} 1 \\ 1 \\ 1 \\ 1 \end{bmatrix} \]</div>
<h4 id="2-view-transformation-world-space-to-view-space">2. View Transformation (World Space to View Space)</h4>
<div class="arithmatex">\[ \mathbf{P_{view}} = \mathbf{M_{view}} \cdot \mathbf{P_{world}} \]</div>
<p>Example:
- Camera at <span class="arithmatex">\((0, 0, 5)\)</span> looking at the origin</p>
<div class="arithmatex">\[ \mathbf{M_{view}} = \begin{bmatrix}
1 &amp; 0 &amp; 0 &amp; 0 \\
0 &amp; 1 &amp; 0 &amp; 0 \\
0 &amp; 0 &amp; 1 &amp; -5 \\
0 &amp; 0 &amp; 0 &amp; 1
\end{bmatrix} \]</div>
<div class="arithmatex">\[ \mathbf{P_{view}} = \mathbf{M_{view}} \cdot \mathbf{P_{world}} \]</div>
<h4 id="3-projection-transformation-view-space-to-clip-space">3. Projection Transformation (View Space to Clip Space)</h4>
<div class="arithmatex">\[ \mathbf{P_{clip}} = \mathbf{M_{proj}} \cdot \mathbf{P_{view}} \]</div>
<p>Example:
- Perspective projection with <span class="arithmatex">\(n = 1, f = 10, r = 1, l = -1, t = 1, b = -1\)</span></p>
<div class="arithmatex">\[ \mathbf{M_{proj}} = \begin{bmatrix}
\frac{2n}{r-l} &amp; 0 &amp; \frac{r+l}{r-l} &amp; 0 \\
0 &amp; \frac{2n}{t-b} &amp; \frac{t+b}{t-b} &amp; 0 \\
0 &amp; 0 &amp; -\frac{f+n}{f-n} &amp; -\frac{2fn}{f-n} \\
0 &amp; 0 &amp; -1 &amp; 0
\end{bmatrix} \]</div>
<div class="arithmatex">\[ \mathbf{P_{clip}} = \mathbf{M_{proj}} \cdot \mathbf{P_{view}} \]</div>
<h4 id="4-normalized-device-coordinates-ndc">4. Normalized Device Coordinates (NDC)</h4>
<p>Perform perspective divide:</p>
<div class="arithmatex">\[ \mathbf{P_{ndc}} = \left( \frac{x_{clip}}{w_{clip}}, \frac{y_{clip}}{w_{clip}}, \frac{z_{clip}}{w_{clip}}, 1 \right) \]</div>
<h4 id="5-viewport-transformation-ndc-to-screen-space">5. Viewport Transformation (NDC to Screen Space)</h4>
<div class="arithmatex">\[ \mathbf{P_{screen}} = \mathbf{M_{viewport}} \cdot \mathbf{P_{ndc}} \]</div>
<h3 id="transformation-matrices">Transformation Matrices</h3>
<p>Transformations are typically represented using 4x4 matrices for 3D graphics (or 3x3 for 2D).</p>
<h4 id="1-translation-matrix">1. Translation Matrix</h4>
<div class="highlight"><pre><span></span><code><a id="__codelineno-24-1" name="__codelineno-24-1" href="#__codelineno-24-1"></a>| 1  0  0  tx |
<a id="__codelineno-24-2" name="__codelineno-24-2" href="#__codelineno-24-2"></a>| 0  1  0  ty |
<a id="__codelineno-24-3" name="__codelineno-24-3" href="#__codelineno-24-3"></a>| 0  0  1  tz |
<a id="__codelineno-24-4" name="__codelineno-24-4" href="#__codelineno-24-4"></a>| 0  0  0  1  |
</code></pre></div>
<h4 id="2-rotation-matrix-around-z-axis">2. Rotation Matrix (around Z-axis)</h4>
<div class="highlight"><pre><span></span><code><a id="__codelineno-25-1" name="__codelineno-25-1" href="#__codelineno-25-1"></a>| cos(θ) -sin(θ)  0  0 |
<a id="__codelineno-25-2" name="__codelineno-25-2" href="#__codelineno-25-2"></a>| sin(θ)  cos(θ)  0  0 |
<a id="__codelineno-25-3" name="__codelineno-25-3" href="#__codelineno-25-3"></a>|   0       0     1  0 |
<a id="__codelineno-25-4" name="__codelineno-25-4" href="#__codelineno-25-4"></a>|   0       0     0  1 |
</code></pre></div>
<h4 id="3-scaling-matrix">3. Scaling Matrix</h4>
<div class="highlight"><pre><span></span><code><a id="__codelineno-26-1" name="__codelineno-26-1" href="#__codelineno-26-1"></a>| sx  0   0  0 |
<a id="__codelineno-26-2" name="__codelineno-26-2" href="#__codelineno-26-2"></a>| 0   sy  0  0 |
<a id="__codelineno-26-3" name="__codelineno-26-3" href="#__codelineno-26-3"></a>| 0   0   sz 0 |
<a id="__codelineno-26-4" name="__codelineno-26-4" href="#__codelineno-26-4"></a>| 0   0   0  1 |
</code></pre></div>
<h3 id="transformation-pipeline">Transformation Pipeline</h3>
<p>The typical transformation pipeline in a game or 3D application:</p>
<ol>
<li>Model Transform (Object Space to World Space)</li>
<li>View Transform (World Space to View Space)</li>
<li>Projection Transform (View Space to Clip Space)</li>
</ol>
<p>Final Vertex Position = Projection * View * Model * VertexPosition</p>
<p>A transformation pipeline in computer graphics is a sequence of steps that transforms the vertices of a 3D model to their final positions on a 2D screen. The main stages in this pipeline are typically:</p>
<ol>
<li><strong>Model Transformation</strong></li>
<li><strong>View Transformation</strong></li>
<li><strong>Projection Transformation</strong></li>
<li><strong>Viewport Transformation</strong></li>
</ol>
<p>I'll explain each step in detail, including the mathematical foundations and a diagram to illustrate the pipeline.</p>
<h4 id="1-model-transformation">1. Model Transformation</h4>
<p><strong>Purpose</strong>: To transform the vertices from the model's local coordinate space to the world coordinate space.</p>
<p><strong>Mathematical Formulation</strong>: This is achieved using a transformation matrix, usually combining translation, rotation, and scaling.</p>
<div class="arithmatex">\[ \mathbf{P_{world}} = \mathbf{M_{model}} \cdot \mathbf{P_{model}} \]</div>
<p>Where:</p>
<ul>
<li><span class="arithmatex">\(\mathbf{P_{model}}\)</span> is the point in model coordinates.</li>
<li><span class="arithmatex">\(\mathbf{M_{model}}\)</span> is the model transformation matrix.</li>
<li><span class="arithmatex">\(\mathbf{P_{world}}\)</span> is the point in world coordinates.</li>
</ul>
<p><strong>Matrix Example</strong>:</p>
<div class="arithmatex">\[ \mathbf{M_{model}} = \mathbf{T} \cdot \mathbf{R} \cdot \mathbf{S} \]</div>
<ul>
<li><span class="arithmatex">\(\mathbf{T}\)</span> is the translation matrix.</li>
<li><span class="arithmatex">\(\mathbf{R}\)</span> is the rotation matrix.</li>
<li><span class="arithmatex">\(\mathbf{S}\)</span> is the scaling matrix.</li>
</ul>
<h4 id="2-view-transformation">2. View Transformation</h4>
<p><strong>Purpose</strong>: To transform the vertices from world coordinates to camera (view) coordinates. This involves positioning and orienting the camera.</p>
<p><strong>Mathematical Formulation</strong>: This is achieved using the view matrix, which is the inverse of the camera's transformation matrix.</p>
<div class="arithmatex">\[ \mathbf{P_{view}} = \mathbf{M_{view}} \cdot \mathbf{P_{world}} \]</div>
<p>Where:</p>
<ul>
<li><span class="arithmatex">\(\mathbf{P_{world}}\)</span> is the point in world coordinates.</li>
<li><span class="arithmatex">\(\mathbf{M_{view}}\)</span> is the view transformation matrix.</li>
<li><span class="arithmatex">\(\mathbf{P_{view}}\)</span> is the point in view coordinates.</li>
</ul>
<p><strong>Matrix Example</strong>:</p>
<div class="arithmatex">\[ \mathbf{M_{view}} = \mathbf{M_{camera}}^{-1} \]</div>
<ul>
<li><span class="arithmatex">\(\mathbf{M_{camera}}\)</span> is the camera's transformation matrix.</li>
</ul>
<h4 id="3-projection-transformation">3. Projection Transformation</h4>
<p><strong>Purpose</strong>: To transform the vertices from view coordinates to normalized device coordinates (NDC), which is a canonical view volume.</p>
<p><strong>Types of Projections</strong>:
- <strong>Orthographic Projection</strong>: Maintains parallel lines and does not distort distances.
- <strong>Perspective Projection</strong>: Mimics the way the human eye perceives depth, where objects further away appear smaller.</p>
<p><strong>Mathematical Formulation</strong>:
- <strong>Orthographic Projection</strong>:</p>
<div class="arithmatex">\[ \mathbf{P_{ndc}} = \mathbf{M_{ortho}} \cdot \mathbf{P_{view}} \]</div>
<div class="arithmatex">\[ \mathbf{M_{ortho}} = \begin{bmatrix} 
\frac{2}{r-l} &amp; 0 &amp; 0 &amp; -\frac{r+l}{r-l} \\
0 &amp; \frac{2}{t-b} &amp; 0 &amp; -\frac{t+b}{t-b} \\
0 &amp; 0 &amp; \frac{-2}{f-n} &amp; -\frac{f+n}{f-n} \\
0 &amp; 0 &amp; 0 &amp; 1 
\end{bmatrix} \]</div>
<ul>
<li><strong>Perspective Projection</strong>:</li>
</ul>
<div class="arithmatex">\[ \mathbf{P_{ndc}} = \mathbf{M_{persp}} \cdot \mathbf{P_{view}} \]</div>
<div class="arithmatex">\[ \mathbf{M_{persp}} = \begin{bmatrix} 
\frac{2n}{r-l} &amp; 0 &amp; \frac{r+l}{r-l} &amp; 0 \\
0 &amp; \frac{2n}{t-b} &amp; \frac{t+b}{t-b} &amp; 0 \\
0 &amp; 0 &amp; -\frac{f+n}{f-n} &amp; -\frac{2fn}{f-n} \\
0 &amp; 0 &amp; -1 &amp; 0 
\end{bmatrix} \]</div>
<p>Where:
- <span class="arithmatex">\(l, r, t, b, n, f\)</span> are the left, right, top, bottom, near, and far clipping planes, respectively.</p>
<h4 id="4-viewport-transformation">4. Viewport Transformation</h4>
<p><strong>Purpose</strong>: To map the normalized device coordinates to screen coordinates.</p>
<p><strong>Mathematical Formulation</strong>: This is achieved using the viewport transformation matrix.</p>
<div class="arithmatex">\[ \mathbf{P_{screen}} = \mathbf{M_{viewport}} \cdot \mathbf{P_{ndc}} \]</div>
<p>Where:
- <span class="arithmatex">\(\mathbf{P_{ndc}}\)</span> is the point in normalized device coordinates.
- <span class="arithmatex">\(\mathbf{M_{viewport}}\)</span> is the viewport transformation matrix.
- <span class="arithmatex">\(\mathbf{P_{screen}}\)</span> is the point in screen coordinates.</p>
<p><strong>Matrix Example</strong>:</p>
<div class="arithmatex">\[ \mathbf{M_{viewport}} = \begin{bmatrix} 
\frac{w}{2} &amp; 0 &amp; 0 &amp; \frac{w}{2} \\
0 &amp; \frac{h}{2} &amp; 0 &amp; \frac{h}{2} \\
0 &amp; 0 &amp; 1 &amp; 0 \\
0 &amp; 0 &amp; 0 &amp; 1 
\end{bmatrix} \]</div>
<p>Where <span class="arithmatex">\(w\)</span> and <span class="arithmatex">\(h\)</span> are the width and height of the viewport.</p>
<h4 id="diagram">Diagram</h4>
<p>Here's a visual representation of the transformation pipeline:</p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-27-1" name="__codelineno-27-1" href="#__codelineno-27-1"></a>+----------------+   +----------------+   +----------------+   +----------------+
<a id="__codelineno-27-2" name="__codelineno-27-2" href="#__codelineno-27-2"></a>| Model          |   | World          |   | Camera/View    |   | Normalized     |
<a id="__codelineno-27-3" name="__codelineno-27-3" href="#__codelineno-27-3"></a>| Coordinates    |   | Coordinates    |   | Coordinates    |   | Device Coord.  |
<a id="__codelineno-27-4" name="__codelineno-27-4" href="#__codelineno-27-4"></a>+----------------+   +----------------+   +----------------+   +----------------+
<a id="__codelineno-27-5" name="__codelineno-27-5" href="#__codelineno-27-5"></a>        |                     |                    |                    |
<a id="__codelineno-27-6" name="__codelineno-27-6" href="#__codelineno-27-6"></a>        V                     V                    V                    V
<a id="__codelineno-27-7" name="__codelineno-27-7" href="#__codelineno-27-7"></a>+----------------+   +----------------+   +----------------+   +----------------+
<a id="__codelineno-27-8" name="__codelineno-27-8" href="#__codelineno-27-8"></a>| Model          |   | View           |   | Projection     |   | Viewport       |
<a id="__codelineno-27-9" name="__codelineno-27-9" href="#__codelineno-27-9"></a>| Transformation |   | Transformation |   | Transformation |   | Transformation |
<a id="__codelineno-27-10" name="__codelineno-27-10" href="#__codelineno-27-10"></a>+----------------+   +----------------+   +----------------+   +----------------+
<a id="__codelineno-27-11" name="__codelineno-27-11" href="#__codelineno-27-11"></a>        |                     |                    |                    |
<a id="__codelineno-27-12" name="__codelineno-27-12" href="#__codelineno-27-12"></a>        V                     V                    V                    V
<a id="__codelineno-27-13" name="__codelineno-27-13" href="#__codelineno-27-13"></a>+----------------+   +----------------+   +----------------+   +----------------+
<a id="__codelineno-27-14" name="__codelineno-27-14" href="#__codelineno-27-14"></a>| World          |   | View           |   | Normalized     |   | Screen         |
<a id="__codelineno-27-15" name="__codelineno-27-15" href="#__codelineno-27-15"></a>| Coordinates    |   | Coordinates    |   | Device Coord.  |   | Coordinates    |
<a id="__codelineno-27-16" name="__codelineno-27-16" href="#__codelineno-27-16"></a>+----------------+   +----------------+   +----------------+   +----------------+
</code></pre></div>
<h4 id="detailed-example">Detailed Example</h4>
<p>Let's go through a step-by-step example using a point <span class="arithmatex">\((1, 1, 1)\)</span> in model coordinates:</p>
<ol>
<li>
<p><strong>Model Transformation</strong>:</p>
<ul>
<li>Translate by <span class="arithmatex">\((1, 0, 0)\)</span>:</li>
</ul>
<div class="arithmatex">\[ \mathbf{T} = \begin{bmatrix}
1 &amp; 0 &amp; 0 &amp; 1 \\
0 &amp; 1 &amp; 0 &amp; 0 \\
0 &amp; 0 &amp; 1 &amp; 0 \\
0 &amp; 0 &amp; 0 &amp; 1
\end{bmatrix} \]</div>
<ul>
<li>Rotate around z-axis by 90 degrees:</li>
</ul>
<div class="arithmatex">\[ \mathbf{R} = \begin{bmatrix}
0 &amp; -1 &amp; 0 &amp; 0 \\
1 &amp; 0 &amp; 0 &amp; 0 \\
0 &amp; 0 &amp; 1 &amp; 0 \\
0 &amp; 0 &amp; 0 &amp; 1
\end{bmatrix} \]</div>
<ul>
<li>Scale by 2:</li>
</ul>
<div class="arithmatex">\[ \mathbf{S} = \begin{bmatrix}
2 &amp; 0 &amp; 0 &amp; 0 \\
0 &amp; 2 &amp; 0 &amp; 0 \\
0 &amp; 0 &amp; 2 &amp; 0 \\
0 &amp; 0 &amp; 0 &amp; 1
\end{bmatrix} \]</div>
<ul>
<li>Combine transformations:</li>
</ul>
<div class="arithmatex">\[ \mathbf{M_{model}} = \mathbf{T} \cdot \mathbf{R} \cdot \mathbf{S} \]</div>
<ul>
<li>Point after transformation:</li>
</ul>
<div class="arithmatex">\[ \mathbf{P_{world}} = \mathbf{M_{model}} \cdot \begin{bmatrix} 1 \\ 1 \\ 1 \\ 1 \end{bmatrix} \]</div>
</li>
<li>
<p><strong>View Transformation</strong>:</p>
<ul>
<li>Camera at <span class="arithmatex">\((0, 0, 5)\)</span> looking at origin:</li>
</ul>
<div class="arithmatex">\[ \mathbf{M_{view}} = \mathbf{T}^{-1} \]</div>
<ul>
<li>Point in view coordinates:</li>
</ul>
<div class="arithmatex">\[ \mathbf{P_{view}} = \mathbf{M_{view}} \cdot \mathbf{P_{world}} \]</div>
</li>
<li>
<p><strong>Projection Transformation</strong>:</p>
<ul>
<li>Perspective projection with <span class="arithmatex">\(n = 1, f = 10, r = 1, l = -1, t = 1, b = -1\)</span>:</li>
</ul>
<div class="arithmatex">\[ \mathbf{P_{ndc}} = \mathbf{M_{persp}} \cdot \mathbf{P_{view}} \]</div>
</li>
<li>
<p><strong>Viewport Transformation</strong>:</p>
<ul>
<li>Viewport width 800, height 600:</li>
</ul>
<div class="arithmatex">\[ \mathbf{P_{screen}} = \mathbf{M_{viewport}} \cdot \mathbf{P_{ndc}} \]</div>
</li>
</ol>
<p>This detailed process transforms a 3D point through various coordinate systems to its final position on the screen.</p>
<h4 id="implementation-in-code">Implementation in Code</h4>
<p>Here's an example of how you might implement these transformations using a math library in C++:</p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-28-1" name="__codelineno-28-1" href="#__codelineno-28-1"></a><span class="cp">#include</span><span class="w"> </span><span class="cpf">&lt;glm/glm.hpp&gt;</span>
<a id="__codelineno-28-2" name="__codelineno-28-2" href="#__codelineno-28-2"></a><span class="cp">#include</span><span class="w"> </span><span class="cpf">&lt;glm/gtc/matrix_transform.hpp&gt;</span>
<a id="__codelineno-28-3" name="__codelineno-28-3" href="#__codelineno-28-3"></a>
<a id="__codelineno-28-4" name="__codelineno-28-4" href="#__codelineno-28-4"></a><span class="k">class</span><span class="w"> </span><span class="nc">GameObject</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-28-5" name="__codelineno-28-5" href="#__codelineno-28-5"></a><span class="w">    </span><span class="n">glm</span><span class="o">::</span><span class="n">vec3</span><span class="w"> </span><span class="n">position</span><span class="p">;</span>
<a id="__codelineno-28-6" name="__codelineno-28-6" href="#__codelineno-28-6"></a><span class="w">    </span><span class="n">glm</span><span class="o">::</span><span class="n">vec3</span><span class="w"> </span><span class="n">rotation</span><span class="p">;</span>
<a id="__codelineno-28-7" name="__codelineno-28-7" href="#__codelineno-28-7"></a><span class="w">    </span><span class="n">glm</span><span class="o">::</span><span class="n">vec3</span><span class="w"> </span><span class="n">scale</span><span class="p">;</span>
<a id="__codelineno-28-8" name="__codelineno-28-8" href="#__codelineno-28-8"></a><span class="w">    </span><span class="n">glm</span><span class="o">::</span><span class="n">mat4</span><span class="w"> </span><span class="n">modelMatrix</span><span class="p">;</span>
<a id="__codelineno-28-9" name="__codelineno-28-9" href="#__codelineno-28-9"></a>
<a id="__codelineno-28-10" name="__codelineno-28-10" href="#__codelineno-28-10"></a><span class="k">public</span><span class="o">:</span>
<a id="__codelineno-28-11" name="__codelineno-28-11" href="#__codelineno-28-11"></a><span class="w">    </span><span class="kt">void</span><span class="w"> </span><span class="n">updateModelMatrix</span><span class="p">()</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-28-12" name="__codelineno-28-12" href="#__codelineno-28-12"></a><span class="w">        </span><span class="n">modelMatrix</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">glm</span><span class="o">::</span><span class="n">mat4</span><span class="p">(</span><span class="mf">1.0f</span><span class="p">);</span><span class="w"> </span><span class="c1">// Identity matrix</span>
<a id="__codelineno-28-13" name="__codelineno-28-13" href="#__codelineno-28-13"></a><span class="w">        </span><span class="n">modelMatrix</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">glm</span><span class="o">::</span><span class="n">translate</span><span class="p">(</span><span class="n">modelMatrix</span><span class="p">,</span><span class="w"> </span><span class="n">position</span><span class="p">);</span>
<a id="__codelineno-28-14" name="__codelineno-28-14" href="#__codelineno-28-14"></a><span class="w">        </span><span class="n">modelMatrix</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">glm</span><span class="o">::</span><span class="n">rotate</span><span class="p">(</span><span class="n">modelMatrix</span><span class="p">,</span><span class="w"> </span><span class="n">glm</span><span class="o">::</span><span class="n">radians</span><span class="p">(</span><span class="n">rotation</span><span class="p">.</span><span class="n">x</span><span class="p">),</span><span class="w"> </span><span class="n">glm</span><span class="o">::</span><span class="n">vec3</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span><span class="w"> </span><span class="mi">0</span><span class="p">,</span><span class="w"> </span><span class="mi">0</span><span class="p">));</span>
<a id="__codelineno-28-15" name="__codelineno-28-15" href="#__codelineno-28-15"></a><span class="w">        </span><span class="n">modelMatrix</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">glm</span><span class="o">::</span><span class="n">rotate</span><span class="p">(</span><span class="n">modelMatrix</span><span class="p">,</span><span class="w"> </span><span class="n">glm</span><span class="o">::</span><span class="n">radians</span><span class="p">(</span><span class="n">rotation</span><span class="p">.</span><span class="n">y</span><span class="p">),</span><span class="w"> </span><span class="n">glm</span><span class="o">::</span><span class="n">vec3</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="w"> </span><span class="mi">1</span><span class="p">,</span><span class="w"> </span><span class="mi">0</span><span class="p">));</span>
<a id="__codelineno-28-16" name="__codelineno-28-16" href="#__codelineno-28-16"></a><span class="w">        </span><span class="n">modelMatrix</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">glm</span><span class="o">::</span><span class="n">rotate</span><span class="p">(</span><span class="n">modelMatrix</span><span class="p">,</span><span class="w"> </span><span class="n">glm</span><span class="o">::</span><span class="n">radians</span><span class="p">(</span><span class="n">rotation</span><span class="p">.</span><span class="n">z</span><span class="p">),</span><span class="w"> </span><span class="n">glm</span><span class="o">::</span><span class="n">vec3</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="w"> </span><span class="mi">0</span><span class="p">,</span><span class="w"> </span><span class="mi">1</span><span class="p">));</span>
<a id="__codelineno-28-17" name="__codelineno-28-17" href="#__codelineno-28-17"></a><span class="w">        </span><span class="n">modelMatrix</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">glm</span><span class="o">::</span><span class="n">scale</span><span class="p">(</span><span class="n">modelMatrix</span><span class="p">,</span><span class="w"> </span><span class="n">scale</span><span class="p">);</span>
<a id="__codelineno-28-18" name="__codelineno-28-18" href="#__codelineno-28-18"></a><span class="w">    </span><span class="p">}</span>
<a id="__codelineno-28-19" name="__codelineno-28-19" href="#__codelineno-28-19"></a><span class="p">};</span>
<a id="__codelineno-28-20" name="__codelineno-28-20" href="#__codelineno-28-20"></a>
<a id="__codelineno-28-21" name="__codelineno-28-21" href="#__codelineno-28-21"></a><span class="k">class</span><span class="w"> </span><span class="nc">Camera</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-28-22" name="__codelineno-28-22" href="#__codelineno-28-22"></a><span class="w">    </span><span class="n">glm</span><span class="o">::</span><span class="n">mat4</span><span class="w"> </span><span class="n">viewMatrix</span><span class="p">;</span>
<a id="__codelineno-28-23" name="__codelineno-28-23" href="#__codelineno-28-23"></a><span class="w">    </span><span class="n">glm</span><span class="o">::</span><span class="n">mat4</span><span class="w"> </span><span class="n">projectionMatrix</span><span class="p">;</span>
<a id="__codelineno-28-24" name="__codelineno-28-24" href="#__codelineno-28-24"></a>
<a id="__codelineno-28-25" name="__codelineno-28-25" href="#__codelineno-28-25"></a><span class="k">public</span><span class="o">:</span>
<a id="__codelineno-28-26" name="__codelineno-28-26" href="#__codelineno-28-26"></a><span class="w">    </span><span class="kt">void</span><span class="w"> </span><span class="n">updateViewMatrix</span><span class="p">(</span><span class="n">glm</span><span class="o">::</span><span class="n">vec3</span><span class="w"> </span><span class="n">position</span><span class="p">,</span><span class="w"> </span><span class="n">glm</span><span class="o">::</span><span class="n">vec3</span><span class="w"> </span><span class="n">target</span><span class="p">,</span><span class="w"> </span><span class="n">glm</span><span class="o">::</span><span class="n">vec3</span><span class="w"> </span><span class="n">up</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-28-27" name="__codelineno-28-27" href="#__codelineno-28-27"></a><span class="w">        </span><span class="n">viewMatrix</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">glm</span><span class="o">::</span><span class="n">lookAt</span><span class="p">(</span><span class="n">position</span><span class="p">,</span><span class="w"> </span><span class="n">target</span><span class="p">,</span><span class="w"> </span><span class="n">up</span><span class="p">);</span>
<a id="__codelineno-28-28" name="__codelineno-28-28" href="#__codelineno-28-28"></a><span class="w">    </span><span class="p">}</span>
<a id="__codelineno-28-29" name="__codelineno-28-29" href="#__codelineno-28-29"></a>
<a id="__codelineno-28-30" name="__codelineno-28-30" href="#__codelineno-28-30"></a><span class="w">    </span><span class="kt">void</span><span class="w"> </span><span class="n">updateProjectionMatrix</span><span class="p">(</span><span class="kt">float</span><span class="w"> </span><span class="n">fov</span><span class="p">,</span><span class="w"> </span><span class="kt">float</span><span class="w"> </span><span class="n">aspect</span><span class="p">,</span><span class="w"> </span><span class="kt">float</span><span class="w"> </span><span class="n">near</span><span class="p">,</span><span class="w"> </span><span class="kt">float</span><span class="w"> </span><span class="n">far</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-28-31" name="__codelineno-28-31" href="#__codelineno-28-31"></a><span class="w">        </span><span class="n">projectionMatrix</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">glm</span><span class="o">::</span><span class="n">perspective</span><span class="p">(</span><span class="n">glm</span><span class="o">::</span><span class="n">radians</span><span class="p">(</span><span class="n">fov</span><span class="p">),</span><span class="w"> </span><span class="n">aspect</span><span class="p">,</span><span class="w"> </span><span class="n">near</span><span class="p">,</span><span class="w"> </span><span class="n">far</span><span class="p">);</span>
<a id="__codelineno-28-32" name="__codelineno-28-32" href="#__codelineno-28-32"></a><span class="w">    </span><span class="p">}</span>
<a id="__codelineno-28-33" name="__codelineno-28-33" href="#__codelineno-28-33"></a><span class="p">};</span>
</code></pre></div>
<h4 id="shader-implementation">Shader Implementation</h4>
<p>In a vertex shader, you would apply these transformations:</p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-29-1" name="__codelineno-29-1" href="#__codelineno-29-1"></a><span class="cp">#version 330 core</span>
<a id="__codelineno-29-2" name="__codelineno-29-2" href="#__codelineno-29-2"></a><span class="k">layout</span><span class="w"> </span><span class="p">(</span><span class="n">location</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mo">0</span><span class="p">)</span><span class="w"> </span><span class="k">in</span><span class="w"> </span><span class="kt">vec3</span><span class="w"> </span><span class="n">aPos</span><span class="p">;</span>
<a id="__codelineno-29-3" name="__codelineno-29-3" href="#__codelineno-29-3"></a>
<a id="__codelineno-29-4" name="__codelineno-29-4" href="#__codelineno-29-4"></a><span class="k">uniform</span><span class="w"> </span><span class="kt">mat4</span><span class="w"> </span><span class="n">model</span><span class="p">;</span>
<a id="__codelineno-29-5" name="__codelineno-29-5" href="#__codelineno-29-5"></a><span class="k">uniform</span><span class="w"> </span><span class="kt">mat4</span><span class="w"> </span><span class="n">view</span><span class="p">;</span>
<a id="__codelineno-29-6" name="__codelineno-29-6" href="#__codelineno-29-6"></a><span class="k">uniform</span><span class="w"> </span><span class="kt">mat4</span><span class="w"> </span><span class="n">projection</span><span class="p">;</span>
<a id="__codelineno-29-7" name="__codelineno-29-7" href="#__codelineno-29-7"></a>
<a id="__codelineno-29-8" name="__codelineno-29-8" href="#__codelineno-29-8"></a><span class="kt">void</span><span class="w"> </span><span class="n">main</span><span class="p">()</span>
<a id="__codelineno-29-9" name="__codelineno-29-9" href="#__codelineno-29-9"></a><span class="p">{</span>
<a id="__codelineno-29-10" name="__codelineno-29-10" href="#__codelineno-29-10"></a><span class="w">    </span><span class="nb">gl_Position</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">projection</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="n">view</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="n">model</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="kt">vec4</span><span class="p">(</span><span class="n">aPos</span><span class="p">,</span><span class="w"> </span><span class="mf">1.0</span><span class="p">);</span>
<a id="__codelineno-29-11" name="__codelineno-29-11" href="#__codelineno-29-11"></a><span class="p">}</span>
</code></pre></div>
<h4 id="advanced-concepts">Advanced Concepts</h4>
<ol>
<li>
<p><strong>Quaternions for Rotation</strong>: Often preferred over Euler angles to avoid gimbal lock.</p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-30-1" name="__codelineno-30-1" href="#__codelineno-30-1"></a><span class="n">glm</span><span class="o">::</span><span class="n">quat</span><span class="w"> </span><span class="n">rotation</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">glm</span><span class="o">::</span><span class="n">quat</span><span class="p">(</span><span class="n">glm</span><span class="o">::</span><span class="n">vec3</span><span class="p">(</span><span class="n">pitch</span><span class="p">,</span><span class="w"> </span><span class="n">yaw</span><span class="p">,</span><span class="w"> </span><span class="n">roll</span><span class="p">));</span>
<a id="__codelineno-30-2" name="__codelineno-30-2" href="#__codelineno-30-2"></a><span class="n">glm</span><span class="o">::</span><span class="n">mat4</span><span class="w"> </span><span class="n">rotationMatrix</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">glm</span><span class="o">::</span><span class="n">mat4_cast</span><span class="p">(</span><span class="n">rotation</span><span class="p">);</span>
</code></pre></div>
</li>
<li>
<p><strong>Hierarchical Transformations</strong>: Used for complex objects or skeletal animations.</p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-31-1" name="__codelineno-31-1" href="#__codelineno-31-1"></a><span class="n">glm</span><span class="o">::</span><span class="n">mat4</span><span class="w"> </span><span class="n">parentTransform</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="cm">/* ... */</span><span class="p">;</span>
<a id="__codelineno-31-2" name="__codelineno-31-2" href="#__codelineno-31-2"></a><span class="n">glm</span><span class="o">::</span><span class="n">mat4</span><span class="w"> </span><span class="n">childLocalTransform</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="cm">/* ... */</span><span class="p">;</span>
<a id="__codelineno-31-3" name="__codelineno-31-3" href="#__codelineno-31-3"></a><span class="n">glm</span><span class="o">::</span><span class="n">mat4</span><span class="w"> </span><span class="n">childWorldTransform</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">parentTransform</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="n">childLocalTransform</span><span class="p">;</span>
</code></pre></div>
</li>
<li>
<p><strong>Inverse Transformations</strong>: Useful for converting back to object space or for camera calculations.</p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-32-1" name="__codelineno-32-1" href="#__codelineno-32-1"></a><span class="n">glm</span><span class="o">::</span><span class="n">mat4</span><span class="w"> </span><span class="n">inverseModelMatrix</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">glm</span><span class="o">::</span><span class="n">inverse</span><span class="p">(</span><span class="n">modelMatrix</span><span class="p">);</span>
</code></pre></div>
</li>
<li>
<p><strong>View Frustum Culling</strong>: Use the camera's projection to determine which objects are visible.</p>
</li>
</ol>
<h4 id="optimization-techniques">Optimization Techniques</h4>
<ol>
<li><strong>Matrix Caching</strong>: Cache matrices that don't change every frame.</li>
<li><strong>SIMD Instructions</strong>: Use SIMD (Single Instruction, Multiple Data) for faster matrix operations.</li>
<li><strong>GPU Instancing</strong>: Send multiple object transforms to the GPU in a single draw call.</li>
</ol>
<p>Understanding and efficiently implementing graphics transformations is crucial for creating a performant and visually correct 3D game. These concepts form the foundation for more advanced graphics techniques and effects.</p>
<h2 id="rendering-techniques">Rendering Techniques</h2>
<h3 id="forward-rendering_1">Forward Rendering</h3>
<p>Forward rendering is a traditional rendering technique where each object in the scene is drawn one at a time, applying all necessary lighting and shading calculations directly within each draw call.</p>
<p><strong>Advantages:</strong></p>
<ul>
<li><strong>Simplicity:</strong> Straightforward implementation and widely supported by most graphics APIs and hardware.</li>
<li><strong>Transparency Support:</strong> Handles transparent objects naturally, as the rendering order can be controlled easily.</li>
</ul>
<p><strong>Disadvantages:</strong></p>
<ul>
<li><strong>Performance:</strong> Less efficient with a high number of lights due to repeated lighting calculations per object.</li>
<li><strong>Overdraw:</strong> Can lead to performance issues due to multiple layers of rendering, especially in complex scenes.</li>
</ul>
<p><strong>Implementation:</strong>
<div class="highlight"><pre><span></span><code><a id="__codelineno-33-1" name="__codelineno-33-1" href="#__codelineno-33-1"></a><span class="c1">// Pseudocode for forward rendering</span>
<a id="__codelineno-33-2" name="__codelineno-33-2" href="#__codelineno-33-2"></a><span class="k">for</span><span class="w"> </span><span class="p">(</span><span class="n">each</span><span class="w"> </span><span class="n">object</span><span class="w"> </span><span class="n">in</span><span class="w"> </span><span class="n">the</span><span class="w"> </span><span class="n">scene</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-33-3" name="__codelineno-33-3" href="#__codelineno-33-3"></a><span class="w">    </span><span class="n">bindObject</span><span class="p">(</span><span class="n">object</span><span class="p">);</span>
<a id="__codelineno-33-4" name="__codelineno-33-4" href="#__codelineno-33-4"></a><span class="w">    </span><span class="k">for</span><span class="w"> </span><span class="p">(</span><span class="n">each</span><span class="w"> </span><span class="n">light</span><span class="w"> </span><span class="n">affecting</span><span class="w"> </span><span class="n">the</span><span class="w"> </span><span class="n">object</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-33-5" name="__codelineno-33-5" href="#__codelineno-33-5"></a><span class="w">        </span><span class="n">calculateLighting</span><span class="p">(</span><span class="n">light</span><span class="p">,</span><span class="w"> </span><span class="n">object</span><span class="p">);</span>
<a id="__codelineno-33-6" name="__codelineno-33-6" href="#__codelineno-33-6"></a><span class="w">    </span><span class="p">}</span>
<a id="__codelineno-33-7" name="__codelineno-33-7" href="#__codelineno-33-7"></a><span class="w">    </span><span class="n">renderObject</span><span class="p">(</span><span class="n">object</span><span class="p">);</span>
<a id="__codelineno-33-8" name="__codelineno-33-8" href="#__codelineno-33-8"></a><span class="p">}</span>
</code></pre></div></p>
<h3 id="deferred-rendering_1">Deferred Rendering</h3>
<p>Deferred rendering is a technique where the scene's geometry is rendered first to a set of intermediate buffers (G-buffer), storing information like positions, normals, and material properties. Lighting calculations are deferred to a second pass that uses this stored data.</p>
<p><strong>Advantages:</strong></p>
<ul>
<li><strong>Efficiency:</strong> Handles scenes with many lights more efficiently since lighting calculations are done per-pixel rather than per-object.</li>
<li><strong>Complex Lighting:</strong> Supports complex lighting models and effects more easily.</li>
</ul>
<p><strong>Disadvantages:</strong></p>
<ul>
<li><strong>Complexity:</strong> More complex to implement compared to forward rendering.</li>
<li><strong>Transparency Issues:</strong> Handling transparent objects is more challenging because the G-buffer cannot easily store multiple layers of transparency.</li>
</ul>
<p><strong>Implementation:</strong>
<div class="highlight"><pre><span></span><code><a id="__codelineno-34-1" name="__codelineno-34-1" href="#__codelineno-34-1"></a><span class="c1">// Geometry pass: render scene to G-buffer</span>
<a id="__codelineno-34-2" name="__codelineno-34-2" href="#__codelineno-34-2"></a><span class="k">for</span><span class="w"> </span><span class="p">(</span><span class="n">each</span><span class="w"> </span><span class="n">object</span><span class="w"> </span><span class="n">in</span><span class="w"> </span><span class="n">the</span><span class="w"> </span><span class="n">scene</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-34-3" name="__codelineno-34-3" href="#__codelineno-34-3"></a><span class="w">    </span><span class="n">bindObject</span><span class="p">(</span><span class="n">object</span><span class="p">);</span>
<a id="__codelineno-34-4" name="__codelineno-34-4" href="#__codelineno-34-4"></a><span class="w">    </span><span class="n">renderToGBuffer</span><span class="p">(</span><span class="n">object</span><span class="p">);</span>
<a id="__codelineno-34-5" name="__codelineno-34-5" href="#__codelineno-34-5"></a><span class="p">}</span>
<a id="__codelineno-34-6" name="__codelineno-34-6" href="#__codelineno-34-6"></a>
<a id="__codelineno-34-7" name="__codelineno-34-7" href="#__codelineno-34-7"></a><span class="c1">// Lighting pass: compute lighting using G-buffer</span>
<a id="__codelineno-34-8" name="__codelineno-34-8" href="#__codelineno-34-8"></a><span class="n">bindGBuffer</span><span class="p">();</span>
<a id="__codelineno-34-9" name="__codelineno-34-9" href="#__codelineno-34-9"></a><span class="k">for</span><span class="w"> </span><span class="p">(</span><span class="n">each</span><span class="w"> </span><span class="n">light</span><span class="w"> </span><span class="n">in</span><span class="w"> </span><span class="n">the</span><span class="w"> </span><span class="n">scene</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-34-10" name="__codelineno-34-10" href="#__codelineno-34-10"></a><span class="w">    </span><span class="n">calculateDeferredLighting</span><span class="p">(</span><span class="n">light</span><span class="p">);</span>
<a id="__codelineno-34-11" name="__codelineno-34-11" href="#__codelineno-34-11"></a><span class="p">}</span>
</code></pre></div></p>
<h3 id="ray-tracing">Ray Tracing</h3>
<p>Ray tracing is a rendering technique that simulates the way light interacts with objects by tracing the paths of rays through the scene, calculating color, shadows, reflections, and refractions based on physical properties.</p>
<p><strong>Advantages:</strong></p>
<ul>
<li><strong>Realism:</strong> Produces highly realistic images with accurate reflections, refractions, and global illumination.</li>
<li><strong>Quality:</strong> Handles complex lighting interactions and effects naturally.</li>
</ul>
<p><strong>Disadvantages:</strong></p>
<ul>
<li><strong>Performance:</strong> Computationally intensive, requiring significant processing power, making real-time applications challenging without specialized hardware like GPUs with ray tracing support.</li>
</ul>
<p><strong>Implementation:</strong>
<div class="highlight"><pre><span></span><code><a id="__codelineno-35-1" name="__codelineno-35-1" href="#__codelineno-35-1"></a><span class="c1">// Pseudocode for basic ray tracing</span>
<a id="__codelineno-35-2" name="__codelineno-35-2" href="#__codelineno-35-2"></a><span class="k">for</span><span class="w"> </span><span class="p">(</span><span class="n">each</span><span class="w"> </span><span class="n">pixel</span><span class="w"> </span><span class="n">in</span><span class="w"> </span><span class="n">the</span><span class="w"> </span><span class="n">image</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-35-3" name="__codelineno-35-3" href="#__codelineno-35-3"></a><span class="w">    </span><span class="n">ray</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">generateRay</span><span class="p">(</span><span class="n">camera</span><span class="p">,</span><span class="w"> </span><span class="n">pixel</span><span class="p">);</span>
<a id="__codelineno-35-4" name="__codelineno-35-4" href="#__codelineno-35-4"></a><span class="w">    </span><span class="n">color</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">traceRay</span><span class="p">(</span><span class="n">ray</span><span class="p">,</span><span class="w"> </span><span class="n">scene</span><span class="p">,</span><span class="w"> </span><span class="n">maxDepth</span><span class="p">);</span>
<a id="__codelineno-35-5" name="__codelineno-35-5" href="#__codelineno-35-5"></a><span class="w">    </span><span class="n">outputColor</span><span class="p">(</span><span class="n">pixel</span><span class="p">,</span><span class="w"> </span><span class="n">color</span><span class="p">);</span>
<a id="__codelineno-35-6" name="__codelineno-35-6" href="#__codelineno-35-6"></a><span class="p">}</span>
<a id="__codelineno-35-7" name="__codelineno-35-7" href="#__codelineno-35-7"></a>
<a id="__codelineno-35-8" name="__codelineno-35-8" href="#__codelineno-35-8"></a><span class="n">vec3</span><span class="w"> </span><span class="n">traceRay</span><span class="p">(</span><span class="n">ray</span><span class="p">,</span><span class="w"> </span><span class="n">scene</span><span class="p">,</span><span class="w"> </span><span class="n">depth</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-35-9" name="__codelineno-35-9" href="#__codelineno-35-9"></a><span class="w">    </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">depth</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="mi">0</span><span class="p">)</span><span class="w"> </span><span class="k">return</span><span class="w"> </span><span class="n">backgroundColor</span><span class="p">;</span>
<a id="__codelineno-35-10" name="__codelineno-35-10" href="#__codelineno-35-10"></a><span class="w">    </span><span class="n">intersection</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">findClosestIntersection</span><span class="p">(</span><span class="n">ray</span><span class="p">,</span><span class="w"> </span><span class="n">scene</span><span class="p">);</span>
<a id="__codelineno-35-11" name="__codelineno-35-11" href="#__codelineno-35-11"></a><span class="w">    </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">intersection</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-35-12" name="__codelineno-35-12" href="#__codelineno-35-12"></a><span class="w">        </span><span class="n">color</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">calculateLighting</span><span class="p">(</span><span class="n">intersection</span><span class="p">);</span>
<a id="__codelineno-35-13" name="__codelineno-35-13" href="#__codelineno-35-13"></a><span class="w">        </span><span class="n">reflectedRay</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">generateReflectedRay</span><span class="p">(</span><span class="n">intersection</span><span class="p">);</span>
<a id="__codelineno-35-14" name="__codelineno-35-14" href="#__codelineno-35-14"></a><span class="w">        </span><span class="n">color</span><span class="w"> </span><span class="o">+=</span><span class="w"> </span><span class="n">traceRay</span><span class="p">(</span><span class="n">reflectedRay</span><span class="p">,</span><span class="w"> </span><span class="n">scene</span><span class="p">,</span><span class="w"> </span><span class="n">depth</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="mi">1</span><span class="p">)</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="n">reflectionFactor</span><span class="p">;</span>
<a id="__codelineno-35-15" name="__codelineno-35-15" href="#__codelineno-35-15"></a><span class="w">        </span><span class="k">return</span><span class="w"> </span><span class="n">color</span><span class="p">;</span>
<a id="__codelineno-35-16" name="__codelineno-35-16" href="#__codelineno-35-16"></a><span class="w">    </span><span class="p">}</span><span class="w"> </span><span class="k">else</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-35-17" name="__codelineno-35-17" href="#__codelineno-35-17"></a><span class="w">        </span><span class="k">return</span><span class="w"> </span><span class="n">backgroundColor</span><span class="p">;</span>
<a id="__codelineno-35-18" name="__codelineno-35-18" href="#__codelineno-35-18"></a><span class="w">    </span><span class="p">}</span>
<a id="__codelineno-35-19" name="__codelineno-35-19" href="#__codelineno-35-19"></a><span class="p">}</span>
</code></pre></div></p>
<h3 id="global-illumination">Global Illumination</h3>
<p>Global illumination (GI) is a set of techniques used to simulate the complex interactions of light in a scene, including indirect lighting, where light bounces off surfaces and illuminates other objects.</p>
<p><strong>Techniques:</strong></p>
<ol>
<li><strong>Radiosity:</strong> Simulates the diffuse transfer of light between surfaces by subdividing the scene into patches and calculating light exchange between them.</li>
<li><strong>Photon Mapping:</strong> Uses particles (photons) to simulate the transport of light in the scene, storing interactions in a photon map for later use in rendering.</li>
<li><strong>Path Tracing:</strong> An extension of ray tracing that traces many paths per pixel, including indirect bounces, to estimate the global illumination.</li>
</ol>
<p><strong>Advantages:</strong></p>
<ul>
<li><strong>Realism:</strong> Produces highly realistic images with natural lighting and color bleeding.</li>
<li><strong>Quality:</strong> Enhances visual fidelity by accurately simulating how light interacts with the environment.</li>
</ul>
<p><strong>Disadvantages:</strong></p>
<ul>
<li><strong>Performance:</strong> Computationally expensive and challenging to achieve real-time performance without approximations or specialized hardware.</li>
</ul>
<p><strong>Implementation:</strong>
<div class="highlight"><pre><span></span><code><a id="__codelineno-36-1" name="__codelineno-36-1" href="#__codelineno-36-1"></a><span class="c1">// Pseudocode for basic path tracing with global illumination</span>
<a id="__codelineno-36-2" name="__codelineno-36-2" href="#__codelineno-36-2"></a><span class="k">for</span><span class="w"> </span><span class="p">(</span><span class="n">each</span><span class="w"> </span><span class="n">pixel</span><span class="w"> </span><span class="n">in</span><span class="w"> </span><span class="n">the</span><span class="w"> </span><span class="n">image</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-36-3" name="__codelineno-36-3" href="#__codelineno-36-3"></a><span class="w">    </span><span class="n">color</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">vec3</span><span class="p">(</span><span class="mi">0</span><span class="p">);</span>
<a id="__codelineno-36-4" name="__codelineno-36-4" href="#__codelineno-36-4"></a><span class="w">    </span><span class="k">for</span><span class="w"> </span><span class="p">(</span><span class="n">each</span><span class="w"> </span><span class="n">sample</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-36-5" name="__codelineno-36-5" href="#__codelineno-36-5"></a><span class="w">        </span><span class="n">ray</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">generateRay</span><span class="p">(</span><span class="n">camera</span><span class="p">,</span><span class="w"> </span><span class="n">pixel</span><span class="p">);</span>
<a id="__codelineno-36-6" name="__codelineno-36-6" href="#__codelineno-36-6"></a><span class="w">        </span><span class="n">color</span><span class="w"> </span><span class="o">+=</span><span class="w"> </span><span class="n">tracePath</span><span class="p">(</span><span class="n">ray</span><span class="p">,</span><span class="w"> </span><span class="n">scene</span><span class="p">,</span><span class="w"> </span><span class="n">maxDepth</span><span class="p">);</span>
<a id="__codelineno-36-7" name="__codelineno-36-7" href="#__codelineno-36-7"></a><span class="w">    </span><span class="p">}</span>
<a id="__codelineno-36-8" name="__codelineno-36-8" href="#__codelineno-36-8"></a><span class="w">    </span><span class="n">color</span><span class="w"> </span><span class="o">/=</span><span class="w"> </span><span class="n">numSamples</span><span class="p">;</span>
<a id="__codelineno-36-9" name="__codelineno-36-9" href="#__codelineno-36-9"></a><span class="w">    </span><span class="n">outputColor</span><span class="p">(</span><span class="n">pixel</span><span class="p">,</span><span class="w"> </span><span class="n">color</span><span class="p">);</span>
<a id="__codelineno-36-10" name="__codelineno-36-10" href="#__codelineno-36-10"></a><span class="p">}</span>
<a id="__codelineno-36-11" name="__codelineno-36-11" href="#__codelineno-36-11"></a>
<a id="__codelineno-36-12" name="__codelineno-36-12" href="#__codelineno-36-12"></a><span class="n">vec3</span><span class="w"> </span><span class="n">tracePath</span><span class="p">(</span><span class="n">ray</span><span class="p">,</span><span class="w"> </span><span class="n">scene</span><span class="p">,</span><span class="w"> </span><span class="n">depth</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-36-13" name="__codelineno-36-13" href="#__codelineno-36-13"></a><span class="w">    </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">depth</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="mi">0</span><span class="p">)</span><span class="w"> </span><span class="k">return</span><span class="w"> </span><span class="n">vec3</span><span class="p">(</span><span class="mi">0</span><span class="p">);</span>
<a id="__codelineno-36-14" name="__codelineno-36-14" href="#__codelineno-36-14"></a><span class="w">    </span><span class="n">intersection</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">findClosestIntersection</span><span class="p">(</span><span class="n">ray</span><span class="p">,</span><span class="w"> </span><span class="n">scene</span><span class="p">);</span>
<a id="__codelineno-36-15" name="__codelineno-36-15" href="#__codelineno-36-15"></a><span class="w">    </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">intersection</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-36-16" name="__codelineno-36-16" href="#__codelineno-36-16"></a><span class="w">        </span><span class="n">directLight</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">calculateDirectLighting</span><span class="p">(</span><span class="n">intersection</span><span class="p">);</span>
<a id="__codelineno-36-17" name="__codelineno-36-17" href="#__codelineno-36-17"></a><span class="w">        </span><span class="n">indirectRay</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">generateRandomBounceRay</span><span class="p">(</span><span class="n">intersection</span><span class="p">);</span>
<a id="__codelineno-36-18" name="__codelineno-36-18" href="#__codelineno-36-18"></a><span class="w">        </span><span class="n">indirectLight</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">tracePath</span><span class="p">(</span><span class="n">indirectRay</span><span class="p">,</span><span class="w"> </span><span class="n">scene</span><span class="p">,</span><span class="w"> </span><span class="n">depth</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="mi">1</span><span class="p">);</span>
<a id="__codelineno-36-19" name="__codelineno-36-19" href="#__codelineno-36-19"></a><span class="w">        </span><span class="k">return</span><span class="w"> </span><span class="n">directLight</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="n">indirectLight</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="n">intersection</span><span class="p">.</span><span class="n">material</span><span class="p">.</span><span class="n">albedo</span><span class="p">;</span>
<a id="__codelineno-36-20" name="__codelineno-36-20" href="#__codelineno-36-20"></a><span class="w">    </span><span class="p">}</span><span class="w"> </span><span class="k">else</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-36-21" name="__codelineno-36-21" href="#__codelineno-36-21"></a><span class="w">        </span><span class="k">return</span><span class="w"> </span><span class="n">vec3</span><span class="p">(</span><span class="mi">0</span><span class="p">);</span>
<a id="__codelineno-36-22" name="__codelineno-36-22" href="#__codelineno-36-22"></a><span class="w">    </span><span class="p">}</span>
<a id="__codelineno-36-23" name="__codelineno-36-23" href="#__codelineno-36-23"></a><span class="p">}</span>
</code></pre></div></p>
<p>By understanding and implementing these rendering techniques, developers can choose the appropriate method for their specific needs, balancing realism and performance to create high-quality 3D graphics in games and other applications.</p>
<h2 id="shaders">Shaders</h2>
<p>Shaders are programs written to run on the GPU, allowing for powerful and flexible manipulation of graphics data. They are crucial in modern graphics programming, enabling various effects and optimizations. Here is an overview of the primary types of shaders:</p>
<h3 id="vertex-shaders">Vertex Shaders</h3>
<p>Vertex shaders process each vertex in a 3D model, performing transformations and lighting calculations. They are the first stage in the graphics pipeline and are responsible for transforming vertex positions from object space to screen space.</p>
<ul>
<li><strong>Purpose:</strong> Transform vertex positions, perform per-vertex lighting, pass data to the next pipeline stage.</li>
<li><strong>Input:</strong> Vertex attributes (position, normal, texture coordinates, etc.).</li>
<li>
<p><strong>Output:</strong> Transformed vertex position and other vertex data to be interpolated.</p>
</li>
<li>
<p><strong>Example:</strong> Simple vertex shader in GLSL.</p>
</li>
</ul>
<div class="highlight"><pre><span></span><code><a id="__codelineno-37-1" name="__codelineno-37-1" href="#__codelineno-37-1"></a><span class="cp">#version 330 core</span>
<a id="__codelineno-37-2" name="__codelineno-37-2" href="#__codelineno-37-2"></a>
<a id="__codelineno-37-3" name="__codelineno-37-3" href="#__codelineno-37-3"></a><span class="k">layout</span><span class="p">(</span><span class="n">location</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mo">0</span><span class="p">)</span><span class="w"> </span><span class="k">in</span><span class="w"> </span><span class="kt">vec3</span><span class="w"> </span><span class="n">aPos</span><span class="p">;</span><span class="w"> </span><span class="c1">// Vertex position</span>
<a id="__codelineno-37-4" name="__codelineno-37-4" href="#__codelineno-37-4"></a><span class="k">layout</span><span class="p">(</span><span class="n">location</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">1</span><span class="p">)</span><span class="w"> </span><span class="k">in</span><span class="w"> </span><span class="kt">vec3</span><span class="w"> </span><span class="n">aNormal</span><span class="p">;</span><span class="w"> </span><span class="c1">// Vertex normal</span>
<a id="__codelineno-37-5" name="__codelineno-37-5" href="#__codelineno-37-5"></a>
<a id="__codelineno-37-6" name="__codelineno-37-6" href="#__codelineno-37-6"></a><span class="k">uniform</span><span class="w"> </span><span class="kt">mat4</span><span class="w"> </span><span class="n">model</span><span class="p">;</span>
<a id="__codelineno-37-7" name="__codelineno-37-7" href="#__codelineno-37-7"></a><span class="k">uniform</span><span class="w"> </span><span class="kt">mat4</span><span class="w"> </span><span class="n">view</span><span class="p">;</span>
<a id="__codelineno-37-8" name="__codelineno-37-8" href="#__codelineno-37-8"></a><span class="k">uniform</span><span class="w"> </span><span class="kt">mat4</span><span class="w"> </span><span class="n">projection</span><span class="p">;</span>
<a id="__codelineno-37-9" name="__codelineno-37-9" href="#__codelineno-37-9"></a>
<a id="__codelineno-37-10" name="__codelineno-37-10" href="#__codelineno-37-10"></a><span class="k">out</span><span class="w"> </span><span class="kt">vec3</span><span class="w"> </span><span class="n">FragPos</span><span class="p">;</span><span class="w"> </span><span class="c1">// Fragment position for the fragment shader</span>
<a id="__codelineno-37-11" name="__codelineno-37-11" href="#__codelineno-37-11"></a><span class="k">out</span><span class="w"> </span><span class="kt">vec3</span><span class="w"> </span><span class="n">Normal</span><span class="p">;</span><span class="w"> </span><span class="c1">// Normal for the fragment shader</span>
<a id="__codelineno-37-12" name="__codelineno-37-12" href="#__codelineno-37-12"></a>
<a id="__codelineno-37-13" name="__codelineno-37-13" href="#__codelineno-37-13"></a><span class="kt">void</span><span class="w"> </span><span class="n">main</span><span class="p">()</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-37-14" name="__codelineno-37-14" href="#__codelineno-37-14"></a><span class="w">    </span><span class="n">FragPos</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="kt">vec3</span><span class="p">(</span><span class="n">model</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="kt">vec4</span><span class="p">(</span><span class="n">aPos</span><span class="p">,</span><span class="w"> </span><span class="mf">1.0</span><span class="p">));</span>
<a id="__codelineno-37-15" name="__codelineno-37-15" href="#__codelineno-37-15"></a><span class="w">    </span><span class="n">Normal</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="kt">mat3</span><span class="p">(</span><span class="n">transpose</span><span class="p">(</span><span class="n">inverse</span><span class="p">(</span><span class="n">model</span><span class="p">)))</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="n">aNormal</span><span class="p">;</span>
<a id="__codelineno-37-16" name="__codelineno-37-16" href="#__codelineno-37-16"></a>
<a id="__codelineno-37-17" name="__codelineno-37-17" href="#__codelineno-37-17"></a><span class="w">    </span><span class="nb">gl_Position</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">projection</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="n">view</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="kt">vec4</span><span class="p">(</span><span class="n">FragPos</span><span class="p">,</span><span class="w"> </span><span class="mf">1.0</span><span class="p">);</span>
<a id="__codelineno-37-18" name="__codelineno-37-18" href="#__codelineno-37-18"></a><span class="p">}</span>
</code></pre></div>
<p>In this example, the vertex shader transforms the vertex positions and normals and passes them to the fragment shader.</p>
<p>Vertex shaders are a crucial component of the graphics pipeline, responsible for processing individual vertices of 3D geometry. They transform vertex data from object space to clip space and can perform additional per-vertex calculations for lighting, skinning, and other effects.</p>
<h4 id="implementation">Implementation</h4>
<p>We'll implement a versatile vertex shader that handles transformation, normal mapping, and skeletal animation. This shader will be designed to work within a modern rendering pipeline and support various material properties.</p>
<p>Key Components:</p>
<ol>
<li>Vertex transformation</li>
<li>Normal and tangent space calculations</li>
<li>Texture coordinate handling</li>
<li>Skeletal animation support</li>
<li>Vertex attribute passing to fragment shader</li>
</ol>
<p>Here's a GLSL implementation of a vertex shader:</p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-38-1" name="__codelineno-38-1" href="#__codelineno-38-1"></a><span class="cp">#version 450</span>
<a id="__codelineno-38-2" name="__codelineno-38-2" href="#__codelineno-38-2"></a>
<a id="__codelineno-38-3" name="__codelineno-38-3" href="#__codelineno-38-3"></a><span class="c1">// Input vertex attributes</span>
<a id="__codelineno-38-4" name="__codelineno-38-4" href="#__codelineno-38-4"></a><span class="k">layout</span><span class="p">(</span><span class="n">location</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mo">0</span><span class="p">)</span><span class="w"> </span><span class="k">in</span><span class="w"> </span><span class="kt">vec3</span><span class="w"> </span><span class="n">inPosition</span><span class="p">;</span>
<a id="__codelineno-38-5" name="__codelineno-38-5" href="#__codelineno-38-5"></a><span class="k">layout</span><span class="p">(</span><span class="n">location</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">1</span><span class="p">)</span><span class="w"> </span><span class="k">in</span><span class="w"> </span><span class="kt">vec3</span><span class="w"> </span><span class="n">inNormal</span><span class="p">;</span>
<a id="__codelineno-38-6" name="__codelineno-38-6" href="#__codelineno-38-6"></a><span class="k">layout</span><span class="p">(</span><span class="n">location</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">2</span><span class="p">)</span><span class="w"> </span><span class="k">in</span><span class="w"> </span><span class="kt">vec2</span><span class="w"> </span><span class="n">inTexCoord</span><span class="p">;</span>
<a id="__codelineno-38-7" name="__codelineno-38-7" href="#__codelineno-38-7"></a><span class="k">layout</span><span class="p">(</span><span class="n">location</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">3</span><span class="p">)</span><span class="w"> </span><span class="k">in</span><span class="w"> </span><span class="kt">vec4</span><span class="w"> </span><span class="n">inTangent</span><span class="p">;</span>
<a id="__codelineno-38-8" name="__codelineno-38-8" href="#__codelineno-38-8"></a><span class="k">layout</span><span class="p">(</span><span class="n">location</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">4</span><span class="p">)</span><span class="w"> </span><span class="k">in</span><span class="w"> </span><span class="kt">ivec4</span><span class="w"> </span><span class="n">inBoneIndices</span><span class="p">;</span>
<a id="__codelineno-38-9" name="__codelineno-38-9" href="#__codelineno-38-9"></a><span class="k">layout</span><span class="p">(</span><span class="n">location</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">5</span><span class="p">)</span><span class="w"> </span><span class="k">in</span><span class="w"> </span><span class="kt">vec4</span><span class="w"> </span><span class="n">inBoneWeights</span><span class="p">;</span>
<a id="__codelineno-38-10" name="__codelineno-38-10" href="#__codelineno-38-10"></a>
<a id="__codelineno-38-11" name="__codelineno-38-11" href="#__codelineno-38-11"></a><span class="c1">// Output to fragment shader</span>
<a id="__codelineno-38-12" name="__codelineno-38-12" href="#__codelineno-38-12"></a><span class="k">layout</span><span class="p">(</span><span class="n">location</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mo">0</span><span class="p">)</span><span class="w"> </span><span class="k">out</span><span class="w"> </span><span class="kt">vec3</span><span class="w"> </span><span class="n">outWorldPos</span><span class="p">;</span>
<a id="__codelineno-38-13" name="__codelineno-38-13" href="#__codelineno-38-13"></a><span class="k">layout</span><span class="p">(</span><span class="n">location</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">1</span><span class="p">)</span><span class="w"> </span><span class="k">out</span><span class="w"> </span><span class="kt">vec2</span><span class="w"> </span><span class="n">outTexCoord</span><span class="p">;</span>
<a id="__codelineno-38-14" name="__codelineno-38-14" href="#__codelineno-38-14"></a><span class="k">layout</span><span class="p">(</span><span class="n">location</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">2</span><span class="p">)</span><span class="w"> </span><span class="k">out</span><span class="w"> </span><span class="kt">mat3</span><span class="w"> </span><span class="n">outTBN</span><span class="p">;</span>
<a id="__codelineno-38-15" name="__codelineno-38-15" href="#__codelineno-38-15"></a><span class="k">layout</span><span class="p">(</span><span class="n">location</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">5</span><span class="p">)</span><span class="w"> </span><span class="k">out</span><span class="w"> </span><span class="kt">vec3</span><span class="w"> </span><span class="n">outViewPos</span><span class="p">;</span>
<a id="__codelineno-38-16" name="__codelineno-38-16" href="#__codelineno-38-16"></a>
<a id="__codelineno-38-17" name="__codelineno-38-17" href="#__codelineno-38-17"></a><span class="c1">// Uniforms</span>
<a id="__codelineno-38-18" name="__codelineno-38-18" href="#__codelineno-38-18"></a><span class="k">layout</span><span class="p">(</span><span class="n">std140</span><span class="p">,</span><span class="w"> </span><span class="n">binding</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mo">0</span><span class="p">)</span><span class="w"> </span><span class="k">uniform</span><span class="w"> </span><span class="n">CameraData</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-38-19" name="__codelineno-38-19" href="#__codelineno-38-19"></a><span class="w">    </span><span class="kt">mat4</span><span class="w"> </span><span class="n">view</span><span class="p">;</span>
<a id="__codelineno-38-20" name="__codelineno-38-20" href="#__codelineno-38-20"></a><span class="w">    </span><span class="kt">mat4</span><span class="w"> </span><span class="n">projection</span><span class="p">;</span>
<a id="__codelineno-38-21" name="__codelineno-38-21" href="#__codelineno-38-21"></a><span class="w">    </span><span class="kt">vec3</span><span class="w"> </span><span class="n">cameraPosition</span><span class="p">;</span>
<a id="__codelineno-38-22" name="__codelineno-38-22" href="#__codelineno-38-22"></a><span class="p">};</span>
<a id="__codelineno-38-23" name="__codelineno-38-23" href="#__codelineno-38-23"></a>
<a id="__codelineno-38-24" name="__codelineno-38-24" href="#__codelineno-38-24"></a><span class="k">layout</span><span class="p">(</span><span class="n">std140</span><span class="p">,</span><span class="w"> </span><span class="n">binding</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">1</span><span class="p">)</span><span class="w"> </span><span class="k">uniform</span><span class="w"> </span><span class="n">ModelData</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-38-25" name="__codelineno-38-25" href="#__codelineno-38-25"></a><span class="w">    </span><span class="kt">mat4</span><span class="w"> </span><span class="n">model</span><span class="p">;</span>
<a id="__codelineno-38-26" name="__codelineno-38-26" href="#__codelineno-38-26"></a><span class="p">};</span>
<a id="__codelineno-38-27" name="__codelineno-38-27" href="#__codelineno-38-27"></a>
<a id="__codelineno-38-28" name="__codelineno-38-28" href="#__codelineno-38-28"></a><span class="k">layout</span><span class="p">(</span><span class="n">std140</span><span class="p">,</span><span class="w"> </span><span class="n">binding</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">2</span><span class="p">)</span><span class="w"> </span><span class="k">uniform</span><span class="w"> </span><span class="n">MaterialData</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-38-29" name="__codelineno-38-29" href="#__codelineno-38-29"></a><span class="w">    </span><span class="kt">vec4</span><span class="w"> </span><span class="n">baseColorFactor</span><span class="p">;</span>
<a id="__codelineno-38-30" name="__codelineno-38-30" href="#__codelineno-38-30"></a><span class="w">    </span><span class="kt">vec3</span><span class="w"> </span><span class="n">emissiveFactor</span><span class="p">;</span>
<a id="__codelineno-38-31" name="__codelineno-38-31" href="#__codelineno-38-31"></a><span class="w">    </span><span class="kt">float</span><span class="w"> </span><span class="n">metallicFactor</span><span class="p">;</span>
<a id="__codelineno-38-32" name="__codelineno-38-32" href="#__codelineno-38-32"></a><span class="w">    </span><span class="kt">float</span><span class="w"> </span><span class="n">roughnessFactor</span><span class="p">;</span>
<a id="__codelineno-38-33" name="__codelineno-38-33" href="#__codelineno-38-33"></a><span class="w">    </span><span class="kt">float</span><span class="w"> </span><span class="n">alphaCutoff</span><span class="p">;</span>
<a id="__codelineno-38-34" name="__codelineno-38-34" href="#__codelineno-38-34"></a><span class="w">    </span><span class="kt">float</span><span class="w"> </span><span class="n">normalScale</span><span class="p">;</span>
<a id="__codelineno-38-35" name="__codelineno-38-35" href="#__codelineno-38-35"></a><span class="p">};</span>
<a id="__codelineno-38-36" name="__codelineno-38-36" href="#__codelineno-38-36"></a>
<a id="__codelineno-38-37" name="__codelineno-38-37" href="#__codelineno-38-37"></a><span class="k">const</span><span class="w"> </span><span class="kt">int</span><span class="w"> </span><span class="n">MAX_BONES</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">100</span><span class="p">;</span>
<a id="__codelineno-38-38" name="__codelineno-38-38" href="#__codelineno-38-38"></a><span class="k">layout</span><span class="p">(</span><span class="n">std140</span><span class="p">,</span><span class="w"> </span><span class="n">binding</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">3</span><span class="p">)</span><span class="w"> </span><span class="k">uniform</span><span class="w"> </span><span class="n">SkinningData</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-38-39" name="__codelineno-38-39" href="#__codelineno-38-39"></a><span class="w">    </span><span class="kt">mat4</span><span class="w"> </span><span class="n">boneMatrices</span><span class="p">[</span><span class="n">MAX_BONES</span><span class="p">];</span>
<a id="__codelineno-38-40" name="__codelineno-38-40" href="#__codelineno-38-40"></a><span class="p">};</span>
<a id="__codelineno-38-41" name="__codelineno-38-41" href="#__codelineno-38-41"></a>
<a id="__codelineno-38-42" name="__codelineno-38-42" href="#__codelineno-38-42"></a><span class="c1">// Function to apply skinning transformation</span>
<a id="__codelineno-38-43" name="__codelineno-38-43" href="#__codelineno-38-43"></a><span class="kt">mat4</span><span class="w"> </span><span class="n">getSkinningMatrix</span><span class="p">()</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-38-44" name="__codelineno-38-44" href="#__codelineno-38-44"></a><span class="w">    </span><span class="kt">mat4</span><span class="w"> </span><span class="n">skinMatrix</span><span class="w"> </span><span class="o">=</span><span class="w"> </span>
<a id="__codelineno-38-45" name="__codelineno-38-45" href="#__codelineno-38-45"></a><span class="w">        </span><span class="n">inBoneWeights</span><span class="p">.</span><span class="n">x</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="n">boneMatrices</span><span class="p">[</span><span class="n">inBoneIndices</span><span class="p">.</span><span class="n">x</span><span class="p">]</span><span class="w"> </span><span class="o">+</span>
<a id="__codelineno-38-46" name="__codelineno-38-46" href="#__codelineno-38-46"></a><span class="w">        </span><span class="n">inBoneWeights</span><span class="p">.</span><span class="n">y</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="n">boneMatrices</span><span class="p">[</span><span class="n">inBoneIndices</span><span class="p">.</span><span class="n">y</span><span class="p">]</span><span class="w"> </span><span class="o">+</span>
<a id="__codelineno-38-47" name="__codelineno-38-47" href="#__codelineno-38-47"></a><span class="w">        </span><span class="n">inBoneWeights</span><span class="p">.</span><span class="n">z</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="n">boneMatrices</span><span class="p">[</span><span class="n">inBoneIndices</span><span class="p">.</span><span class="n">z</span><span class="p">]</span><span class="w"> </span><span class="o">+</span>
<a id="__codelineno-38-48" name="__codelineno-38-48" href="#__codelineno-38-48"></a><span class="w">        </span><span class="n">inBoneWeights</span><span class="p">.</span><span class="n">w</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="n">boneMatrices</span><span class="p">[</span><span class="n">inBoneIndices</span><span class="p">.</span><span class="n">w</span><span class="p">];</span>
<a id="__codelineno-38-49" name="__codelineno-38-49" href="#__codelineno-38-49"></a><span class="w">    </span><span class="k">return</span><span class="w"> </span><span class="n">skinMatrix</span><span class="p">;</span>
<a id="__codelineno-38-50" name="__codelineno-38-50" href="#__codelineno-38-50"></a><span class="p">}</span>
<a id="__codelineno-38-51" name="__codelineno-38-51" href="#__codelineno-38-51"></a>
<a id="__codelineno-38-52" name="__codelineno-38-52" href="#__codelineno-38-52"></a><span class="kt">void</span><span class="w"> </span><span class="n">main</span><span class="p">()</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-38-53" name="__codelineno-38-53" href="#__codelineno-38-53"></a><span class="w">    </span><span class="c1">// Apply skinning if weights are provided</span>
<a id="__codelineno-38-54" name="__codelineno-38-54" href="#__codelineno-38-54"></a><span class="w">    </span><span class="kt">mat4</span><span class="w"> </span><span class="n">skinMat</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">(</span><span class="n">inBoneWeights</span><span class="p">.</span><span class="n">x</span><span class="w"> </span><span class="o">&gt;</span><span class="w"> </span><span class="mf">0.0</span><span class="p">)</span><span class="w"> </span><span class="o">?</span><span class="w"> </span><span class="n">getSkinningMatrix</span><span class="p">()</span><span class="w"> </span><span class="o">:</span><span class="w"> </span><span class="kt">mat4</span><span class="p">(</span><span class="mf">1.0</span><span class="p">);</span>
<a id="__codelineno-38-55" name="__codelineno-38-55" href="#__codelineno-38-55"></a>
<a id="__codelineno-38-56" name="__codelineno-38-56" href="#__codelineno-38-56"></a><span class="w">    </span><span class="c1">// Transform position</span>
<a id="__codelineno-38-57" name="__codelineno-38-57" href="#__codelineno-38-57"></a><span class="w">    </span><span class="kt">vec4</span><span class="w"> </span><span class="n">worldPos</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">model</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="n">skinMat</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="kt">vec4</span><span class="p">(</span><span class="n">inPosition</span><span class="p">,</span><span class="w"> </span><span class="mf">1.0</span><span class="p">);</span>
<a id="__codelineno-38-58" name="__codelineno-38-58" href="#__codelineno-38-58"></a><span class="w">    </span><span class="n">outWorldPos</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">worldPos</span><span class="p">.</span><span class="n">xyz</span><span class="p">;</span>
<a id="__codelineno-38-59" name="__codelineno-38-59" href="#__codelineno-38-59"></a><span class="w">    </span><span class="nb">gl_Position</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">projection</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="n">view</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="n">worldPos</span><span class="p">;</span>
<a id="__codelineno-38-60" name="__codelineno-38-60" href="#__codelineno-38-60"></a>
<a id="__codelineno-38-61" name="__codelineno-38-61" href="#__codelineno-38-61"></a><span class="w">    </span><span class="c1">// Pass texture coordinates</span>
<a id="__codelineno-38-62" name="__codelineno-38-62" href="#__codelineno-38-62"></a><span class="w">    </span><span class="n">outTexCoord</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">inTexCoord</span><span class="p">;</span>
<a id="__codelineno-38-63" name="__codelineno-38-63" href="#__codelineno-38-63"></a>
<a id="__codelineno-38-64" name="__codelineno-38-64" href="#__codelineno-38-64"></a><span class="w">    </span><span class="c1">// Calculate normal in world space</span>
<a id="__codelineno-38-65" name="__codelineno-38-65" href="#__codelineno-38-65"></a><span class="w">    </span><span class="kt">mat3</span><span class="w"> </span><span class="n">normalMatrix</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">transpose</span><span class="p">(</span><span class="n">inverse</span><span class="p">(</span><span class="kt">mat3</span><span class="p">(</span><span class="n">model</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="n">skinMat</span><span class="p">)));</span>
<a id="__codelineno-38-66" name="__codelineno-38-66" href="#__codelineno-38-66"></a><span class="w">    </span><span class="kt">vec3</span><span class="w"> </span><span class="n">N</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">normalize</span><span class="p">(</span><span class="n">normalMatrix</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="n">inNormal</span><span class="p">);</span>
<a id="__codelineno-38-67" name="__codelineno-38-67" href="#__codelineno-38-67"></a>
<a id="__codelineno-38-68" name="__codelineno-38-68" href="#__codelineno-38-68"></a><span class="w">    </span><span class="c1">// Calculate tangent and bitangent</span>
<a id="__codelineno-38-69" name="__codelineno-38-69" href="#__codelineno-38-69"></a><span class="w">    </span><span class="kt">vec3</span><span class="w"> </span><span class="n">T</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">normalize</span><span class="p">(</span><span class="n">normalMatrix</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="n">inTangent</span><span class="p">.</span><span class="n">xyz</span><span class="p">);</span>
<a id="__codelineno-38-70" name="__codelineno-38-70" href="#__codelineno-38-70"></a><span class="w">    </span><span class="kt">vec3</span><span class="w"> </span><span class="n">B</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">cross</span><span class="p">(</span><span class="n">N</span><span class="p">,</span><span class="w"> </span><span class="n">T</span><span class="p">)</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="n">inTangent</span><span class="p">.</span><span class="n">w</span><span class="p">;</span><span class="w"> </span><span class="c1">// inTangent.w is the handedness</span>
<a id="__codelineno-38-71" name="__codelineno-38-71" href="#__codelineno-38-71"></a>
<a id="__codelineno-38-72" name="__codelineno-38-72" href="#__codelineno-38-72"></a><span class="w">    </span><span class="c1">// Output tangent-bitangent-normal matrix</span>
<a id="__codelineno-38-73" name="__codelineno-38-73" href="#__codelineno-38-73"></a><span class="w">    </span><span class="n">outTBN</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="kt">mat3</span><span class="p">(</span><span class="n">T</span><span class="p">,</span><span class="w"> </span><span class="n">B</span><span class="p">,</span><span class="w"> </span><span class="n">N</span><span class="p">);</span>
<a id="__codelineno-38-74" name="__codelineno-38-74" href="#__codelineno-38-74"></a>
<a id="__codelineno-38-75" name="__codelineno-38-75" href="#__codelineno-38-75"></a><span class="w">    </span><span class="c1">// Calculate and output view position</span>
<a id="__codelineno-38-76" name="__codelineno-38-76" href="#__codelineno-38-76"></a><span class="w">    </span><span class="n">outViewPos</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">(</span><span class="n">view</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="n">worldPos</span><span class="p">).</span><span class="n">xyz</span><span class="p">;</span>
<a id="__codelineno-38-77" name="__codelineno-38-77" href="#__codelineno-38-77"></a><span class="p">}</span>
</code></pre></div>
<h4 id="explanation_4">Explanation</h4>
<ol>
<li>
<p>Input Attributes:</p>
<ul>
<li>The shader takes in position, normal, texture coordinates, tangent, and skinning data (bone indices and weights).</li>
<li>These attributes are typically provided per vertex in the mesh data.</li>
</ul>
</li>
<li>
<p>Output to Fragment Shader:</p>
<ul>
<li>World position, texture coordinates, TBN matrix, and view position are output to the fragment shader.</li>
<li>These outputs will be interpolated across the face of each triangle.</li>
</ul>
</li>
<li>
<p>Uniform Buffers:</p>
<ul>
<li>Camera data, model matrix, material properties, and skinning matrices are provided in uniform buffers.</li>
<li>This approach is efficient for updating large blocks of uniform data.</li>
</ul>
</li>
<li>
<p>Vertex Transformation:</p>
<ul>
<li>The vertex position is transformed from object space to world space, then to clip space.</li>
<li>If skinning data is provided, a skinning matrix is applied before the model transformation.</li>
</ul>
</li>
<li>
<p>Normal Mapping Preparation:</p>
<ul>
<li>A TBN (Tangent-Bitangent-Normal) matrix is calculated.</li>
<li>This matrix will be used in the fragment shader for normal mapping.</li>
</ul>
</li>
<li>
<p>Skinning:</p>
<ul>
<li>A <code>getSkinningMatrix()</code> function computes the skinning transformation if bone weights are provided.</li>
<li>This allows for skeletal animation of meshes.</li>
</ul>
</li>
<li>
<p>View Space Calculations:</p>
<ul>
<li>The vertex position in view space is calculated for use in lighting calculations in the fragment shader.</li>
</ul>
</li>
</ol>
<p>Key Features:</p>
<ol>
<li>
<p>Flexibility:</p>
<ul>
<li>The shader supports both static and skinned meshes.</li>
<li>It prepares data for normal mapping, allowing for high-detail surface normals.</li>
</ul>
</li>
<li>
<p>Efficiency:</p>
<ul>
<li>Heavy computations like the inverse of the model matrix are assumed to be done on the CPU.</li>
<li>The use of uniform buffers allows for efficient updating of multiple uniforms at once.</li>
</ul>
</li>
<li>
<p>Precision:</p>
<ul>
<li>The normal matrix is properly calculated to handle non-uniform scaling.</li>
</ul>
</li>
<li>
<p>Animation Support:</p>
<ul>
<li>The inclusion of skinning matrices allows for skeletal animation.</li>
</ul>
</li>
<li>
<p>Material Properties:</p>
<ul>
<li>Material data is passed to be available for use in the fragment shader.</li>
</ul>
</li>
</ol>
<p>This vertex shader provides a solid foundation for rendering in a modern game engine. It can be extended or specialized for different rendering techniques or material types. For example:</p>
<ul>
<li>Adding support for vertex color attributes</li>
<li>Implementing tessellation control and evaluation shaders for dynamic level-of-detail</li>
<li>Adding vegetation-specific attributes for wind animation</li>
<li>Implementing GPU-driven instancing for rendering many similar objects efficiently</li>
</ul>
<p>In professional game development, the calculation of bone transformations is typically not done within the vertex shader. Let's break this down:</p>
<p>Bone Transformation Calculation:</p>
<ol>
<li>
<p>CPU Calculation (Most Common):</p>
<ul>
<li>Bone transformations are usually calculated on the CPU.</li>
<li>This is done per frame or animation update.</li>
<li>Reasons:      <ol>
<li>Complex animation blending and inverse kinematics (IK) are easier to implement on the CPU.</li>
<li>The number of bones is usually small compared to the number of vertices, making CPU calculation efficient.</li>
<li>It allows for animation optimization techniques like key frame reduction and compression.</li>
</ol>
</li>
</ul>
</li>
<li>
<p>GPU Calculation (Less Common):</p>
<ul>
<li>In some advanced scenarios, bone transformations might be calculated on the GPU.</li>
<li>This is typically done using compute shaders, not in the vertex shader.</li>
<li>Use cases:    <ol>
<li>Very large numbers of animated characters (e.g., crowd simulations).</li>
<li>Procedural animation systems that benefit from parallel processing.</li>
</ol>
</li>
</ul>
</li>
</ol>
<p>Typical Workflow:</p>
<ol>
<li>
<p>Animation System (CPU):</p>
<ul>
<li>Interpolates between keyframes.</li>
<li>Applies animation blending (e.g., upper body aiming while legs are walking).</li>
<li>Calculates final bone transformations.</li>
</ul>
</li>
<li>
<p>Memory Transfer:</p>
<ul>
<li>The resulting bone matrices are transferred to the GPU.</li>
<li>Usually stored in a Uniform Buffer Object (UBO) or Shader Storage Buffer Object (SSBO).</li>
</ul>
</li>
<li>
<p>Vertex Shader:</p>
<ul>
<li>Receives the pre-calculated bone matrices.</li>
<li>Applies these matrices to the vertex positions and normals.</li>
</ul>
</li>
</ol>
<p>Example of CPU-side bone calculation (pseudocode):</p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-39-1" name="__codelineno-39-1" href="#__codelineno-39-1"></a><span class="k">class</span><span class="w"> </span><span class="nc">SkeletalMeshComponent</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-39-2" name="__codelineno-39-2" href="#__codelineno-39-2"></a><span class="k">public</span><span class="o">:</span>
<a id="__codelineno-39-3" name="__codelineno-39-3" href="#__codelineno-39-3"></a><span class="w">    </span><span class="kt">void</span><span class="w"> </span><span class="n">UpdateAnimation</span><span class="p">(</span><span class="kt">float</span><span class="w"> </span><span class="n">deltaTime</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-39-4" name="__codelineno-39-4" href="#__codelineno-39-4"></a><span class="w">        </span><span class="c1">// Update animation state</span>
<a id="__codelineno-39-5" name="__codelineno-39-5" href="#__codelineno-39-5"></a><span class="w">        </span><span class="n">m_AnimationState</span><span class="p">.</span><span class="n">Update</span><span class="p">(</span><span class="n">deltaTime</span><span class="p">);</span>
<a id="__codelineno-39-6" name="__codelineno-39-6" href="#__codelineno-39-6"></a>
<a id="__codelineno-39-7" name="__codelineno-39-7" href="#__codelineno-39-7"></a><span class="w">        </span><span class="c1">// Calculate bone transformations</span>
<a id="__codelineno-39-8" name="__codelineno-39-8" href="#__codelineno-39-8"></a><span class="w">        </span><span class="k">for</span><span class="w"> </span><span class="p">(</span><span class="kt">int</span><span class="w"> </span><span class="n">i</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">0</span><span class="p">;</span><span class="w"> </span><span class="n">i</span><span class="w"> </span><span class="o">&lt;</span><span class="w"> </span><span class="n">m_Skeleton</span><span class="p">.</span><span class="n">GetBoneCount</span><span class="p">();</span><span class="w"> </span><span class="o">++</span><span class="n">i</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-39-9" name="__codelineno-39-9" href="#__codelineno-39-9"></a><span class="w">            </span><span class="n">Matrix4x4</span><span class="w"> </span><span class="n">localTransform</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">m_AnimationState</span><span class="p">.</span><span class="n">GetBoneLocalTransform</span><span class="p">(</span><span class="n">i</span><span class="p">);</span>
<a id="__codelineno-39-10" name="__codelineno-39-10" href="#__codelineno-39-10"></a><span class="w">            </span><span class="kt">int</span><span class="w"> </span><span class="n">parentIndex</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">m_Skeleton</span><span class="p">.</span><span class="n">GetParentIndex</span><span class="p">(</span><span class="n">i</span><span class="p">);</span>
<a id="__codelineno-39-11" name="__codelineno-39-11" href="#__codelineno-39-11"></a><span class="w">            </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">parentIndex</span><span class="w"> </span><span class="o">!=</span><span class="w"> </span><span class="mi">-1</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-39-12" name="__codelineno-39-12" href="#__codelineno-39-12"></a><span class="w">                </span><span class="n">m_BoneMatrices</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">m_BoneMatrices</span><span class="p">[</span><span class="n">parentIndex</span><span class="p">]</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="n">localTransform</span><span class="p">;</span>
<a id="__codelineno-39-13" name="__codelineno-39-13" href="#__codelineno-39-13"></a><span class="w">            </span><span class="p">}</span><span class="w"> </span><span class="k">else</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-39-14" name="__codelineno-39-14" href="#__codelineno-39-14"></a><span class="w">                </span><span class="n">m_BoneMatrices</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">localTransform</span><span class="p">;</span>
<a id="__codelineno-39-15" name="__codelineno-39-15" href="#__codelineno-39-15"></a><span class="w">            </span><span class="p">}</span>
<a id="__codelineno-39-16" name="__codelineno-39-16" href="#__codelineno-39-16"></a><span class="w">            </span><span class="c1">// Apply inverse bind pose matrix</span>
<a id="__codelineno-39-17" name="__codelineno-39-17" href="#__codelineno-39-17"></a><span class="w">            </span><span class="n">m_BoneMatrices</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="w"> </span><span class="o">*=</span><span class="w"> </span><span class="n">m_Skeleton</span><span class="p">.</span><span class="n">GetInverseBindPoseMatrix</span><span class="p">(</span><span class="n">i</span><span class="p">);</span>
<a id="__codelineno-39-18" name="__codelineno-39-18" href="#__codelineno-39-18"></a><span class="w">        </span><span class="p">}</span>
<a id="__codelineno-39-19" name="__codelineno-39-19" href="#__codelineno-39-19"></a>
<a id="__codelineno-39-20" name="__codelineno-39-20" href="#__codelineno-39-20"></a><span class="w">        </span><span class="c1">// Update GPU buffer</span>
<a id="__codelineno-39-21" name="__codelineno-39-21" href="#__codelineno-39-21"></a><span class="w">        </span><span class="n">m_BoneMatrixBuffer</span><span class="p">.</span><span class="n">Update</span><span class="p">(</span><span class="n">m_BoneMatrices</span><span class="p">.</span><span class="n">data</span><span class="p">(),</span><span class="w"> </span><span class="n">m_BoneMatrices</span><span class="p">.</span><span class="n">size</span><span class="p">()</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="k">sizeof</span><span class="p">(</span><span class="n">Matrix4x4</span><span class="p">));</span>
<a id="__codelineno-39-22" name="__codelineno-39-22" href="#__codelineno-39-22"></a><span class="w">    </span><span class="p">}</span>
<a id="__codelineno-39-23" name="__codelineno-39-23" href="#__codelineno-39-23"></a>
<a id="__codelineno-39-24" name="__codelineno-39-24" href="#__codelineno-39-24"></a><span class="k">private</span><span class="o">:</span>
<a id="__codelineno-39-25" name="__codelineno-39-25" href="#__codelineno-39-25"></a><span class="w">    </span><span class="n">AnimationState</span><span class="w"> </span><span class="n">m_AnimationState</span><span class="p">;</span>
<a id="__codelineno-39-26" name="__codelineno-39-26" href="#__codelineno-39-26"></a><span class="w">    </span><span class="n">Skeleton</span><span class="w"> </span><span class="n">m_Skeleton</span><span class="p">;</span>
<a id="__codelineno-39-27" name="__codelineno-39-27" href="#__codelineno-39-27"></a><span class="w">    </span><span class="n">std</span><span class="o">::</span><span class="n">vector</span><span class="o">&lt;</span><span class="n">Matrix4x4</span><span class="o">&gt;</span><span class="w"> </span><span class="n">m_BoneMatrices</span><span class="p">;</span>
<a id="__codelineno-39-28" name="__codelineno-39-28" href="#__codelineno-39-28"></a><span class="w">    </span><span class="n">UniformBuffer</span><span class="w"> </span><span class="n">m_BoneMatrixBuffer</span><span class="p">;</span>
<a id="__codelineno-39-29" name="__codelineno-39-29" href="#__codelineno-39-29"></a><span class="p">};</span>
</code></pre></div>
<p>In the vertex shader, you would then use these pre-calculated matrices:</p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-40-1" name="__codelineno-40-1" href="#__codelineno-40-1"></a><span class="c1">// In vertex shader</span>
<a id="__codelineno-40-2" name="__codelineno-40-2" href="#__codelineno-40-2"></a><span class="k">layout</span><span class="p">(</span><span class="n">std140</span><span class="p">,</span><span class="w"> </span><span class="n">binding</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">3</span><span class="p">)</span><span class="w"> </span><span class="k">uniform</span><span class="w"> </span><span class="n">SkinningData</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-40-3" name="__codelineno-40-3" href="#__codelineno-40-3"></a><span class="w">    </span><span class="kt">mat4</span><span class="w"> </span><span class="n">boneMatrices</span><span class="p">[</span><span class="n">MAX_BONES</span><span class="p">];</span>
<a id="__codelineno-40-4" name="__codelineno-40-4" href="#__codelineno-40-4"></a><span class="p">};</span>
<a id="__codelineno-40-5" name="__codelineno-40-5" href="#__codelineno-40-5"></a>
<a id="__codelineno-40-6" name="__codelineno-40-6" href="#__codelineno-40-6"></a><span class="c1">// ... (other shader code)</span>
<a id="__codelineno-40-7" name="__codelineno-40-7" href="#__codelineno-40-7"></a>
<a id="__codelineno-40-8" name="__codelineno-40-8" href="#__codelineno-40-8"></a><span class="kt">mat4</span><span class="w"> </span><span class="n">skinMatrix</span><span class="w"> </span><span class="o">=</span><span class="w"> </span>
<a id="__codelineno-40-9" name="__codelineno-40-9" href="#__codelineno-40-9"></a><span class="w">    </span><span class="n">inBoneWeights</span><span class="p">.</span><span class="n">x</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="n">boneMatrices</span><span class="p">[</span><span class="n">inBoneIndices</span><span class="p">.</span><span class="n">x</span><span class="p">]</span><span class="w"> </span><span class="o">+</span>
<a id="__codelineno-40-10" name="__codelineno-40-10" href="#__codelineno-40-10"></a><span class="w">    </span><span class="n">inBoneWeights</span><span class="p">.</span><span class="n">y</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="n">boneMatrices</span><span class="p">[</span><span class="n">inBoneIndices</span><span class="p">.</span><span class="n">y</span><span class="p">]</span><span class="w"> </span><span class="o">+</span>
<a id="__codelineno-40-11" name="__codelineno-40-11" href="#__codelineno-40-11"></a><span class="w">    </span><span class="n">inBoneWeights</span><span class="p">.</span><span class="n">z</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="n">boneMatrices</span><span class="p">[</span><span class="n">inBoneIndices</span><span class="p">.</span><span class="n">z</span><span class="p">]</span><span class="w"> </span><span class="o">+</span>
<a id="__codelineno-40-12" name="__codelineno-40-12" href="#__codelineno-40-12"></a><span class="w">    </span><span class="n">inBoneWeights</span><span class="p">.</span><span class="n">w</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="n">boneMatrices</span><span class="p">[</span><span class="n">inBoneIndices</span><span class="p">.</span><span class="n">w</span><span class="p">];</span>
<a id="__codelineno-40-13" name="__codelineno-40-13" href="#__codelineno-40-13"></a>
<a id="__codelineno-40-14" name="__codelineno-40-14" href="#__codelineno-40-14"></a><span class="kt">vec4</span><span class="w"> </span><span class="n">skinnedPosition</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">skinMatrix</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="kt">vec4</span><span class="p">(</span><span class="n">inPosition</span><span class="p">,</span><span class="w"> </span><span class="mf">1.0</span><span class="p">);</span>
</code></pre></div>
<p>This approach is more efficient and flexible, allowing for complex animation systems while keeping the vertex shader relatively simple and fast.</p>
<h3 id="fragment-shaders">Fragment Shaders</h3>
<p>Fragment shaders process each pixel fragment generated by rasterizing vertices, determining the final color of each pixel. They are responsible for texture mapping, lighting calculations, and other per-pixel effects.</p>
<ul>
<li><strong>Purpose:</strong> Compute the color and other attributes of each pixel.</li>
<li><strong>Input:</strong> Interpolated vertex data (position, color, texture coordinates, etc.).</li>
<li>
<p><strong>Output:</strong> Final color and possibly other data like depth.</p>
</li>
<li>
<p><strong>Example:</strong> Simple fragment shader in GLSL.</p>
</li>
</ul>
<div class="highlight"><pre><span></span><code><a id="__codelineno-41-1" name="__codelineno-41-1" href="#__codelineno-41-1"></a><span class="cp">#version 330 core</span>
<a id="__codelineno-41-2" name="__codelineno-41-2" href="#__codelineno-41-2"></a>
<a id="__codelineno-41-3" name="__codelineno-41-3" href="#__codelineno-41-3"></a><span class="k">in</span><span class="w"> </span><span class="kt">vec3</span><span class="w"> </span><span class="n">FragPos</span><span class="p">;</span><span class="w"> </span><span class="c1">// Fragment position from the vertex shader</span>
<a id="__codelineno-41-4" name="__codelineno-41-4" href="#__codelineno-41-4"></a><span class="k">in</span><span class="w"> </span><span class="kt">vec3</span><span class="w"> </span><span class="n">Normal</span><span class="p">;</span><span class="w"> </span><span class="c1">// Normal from the vertex shader</span>
<a id="__codelineno-41-5" name="__codelineno-41-5" href="#__codelineno-41-5"></a>
<a id="__codelineno-41-6" name="__codelineno-41-6" href="#__codelineno-41-6"></a><span class="k">uniform</span><span class="w"> </span><span class="kt">vec3</span><span class="w"> </span><span class="n">lightPos</span><span class="p">;</span>
<a id="__codelineno-41-7" name="__codelineno-41-7" href="#__codelineno-41-7"></a><span class="k">uniform</span><span class="w"> </span><span class="kt">vec3</span><span class="w"> </span><span class="n">viewPos</span><span class="p">;</span>
<a id="__codelineno-41-8" name="__codelineno-41-8" href="#__codelineno-41-8"></a><span class="k">uniform</span><span class="w"> </span><span class="kt">vec3</span><span class="w"> </span><span class="n">lightColor</span><span class="p">;</span>
<a id="__codelineno-41-9" name="__codelineno-41-9" href="#__codelineno-41-9"></a><span class="k">uniform</span><span class="w"> </span><span class="kt">vec3</span><span class="w"> </span><span class="n">objectColor</span><span class="p">;</span>
<a id="__codelineno-41-10" name="__codelineno-41-10" href="#__codelineno-41-10"></a>
<a id="__codelineno-41-11" name="__codelineno-41-11" href="#__codelineno-41-11"></a><span class="k">out</span><span class="w"> </span><span class="kt">vec4</span><span class="w"> </span><span class="n">FragColor</span><span class="p">;</span>
<a id="__codelineno-41-12" name="__codelineno-41-12" href="#__codelineno-41-12"></a>
<a id="__codelineno-41-13" name="__codelineno-41-13" href="#__codelineno-41-13"></a><span class="kt">void</span><span class="w"> </span><span class="n">main</span><span class="p">()</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-41-14" name="__codelineno-41-14" href="#__codelineno-41-14"></a><span class="w">    </span><span class="c1">// Ambient</span>
<a id="__codelineno-41-15" name="__codelineno-41-15" href="#__codelineno-41-15"></a><span class="w">    </span><span class="kt">float</span><span class="w"> </span><span class="n">ambientStrength</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mf">0.1</span><span class="p">;</span>
<a id="__codelineno-41-16" name="__codelineno-41-16" href="#__codelineno-41-16"></a><span class="w">    </span><span class="kt">vec3</span><span class="w"> </span><span class="n">ambient</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">ambientStrength</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="n">lightColor</span><span class="p">;</span>
<a id="__codelineno-41-17" name="__codelineno-41-17" href="#__codelineno-41-17"></a>
<a id="__codelineno-41-18" name="__codelineno-41-18" href="#__codelineno-41-18"></a><span class="w">    </span><span class="c1">// Diffuse</span>
<a id="__codelineno-41-19" name="__codelineno-41-19" href="#__codelineno-41-19"></a><span class="w">    </span><span class="kt">vec3</span><span class="w"> </span><span class="n">norm</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">normalize</span><span class="p">(</span><span class="n">Normal</span><span class="p">);</span>
<a id="__codelineno-41-20" name="__codelineno-41-20" href="#__codelineno-41-20"></a><span class="w">    </span><span class="kt">vec3</span><span class="w"> </span><span class="n">lightDir</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">normalize</span><span class="p">(</span><span class="n">lightPos</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="n">FragPos</span><span class="p">);</span>
<a id="__codelineno-41-21" name="__codelineno-41-21" href="#__codelineno-41-21"></a><span class="w">    </span><span class="kt">float</span><span class="w"> </span><span class="n">diff</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">max</span><span class="p">(</span><span class="n">dot</span><span class="p">(</span><span class="n">norm</span><span class="p">,</span><span class="w"> </span><span class="n">lightDir</span><span class="p">),</span><span class="w"> </span><span class="mf">0.0</span><span class="p">);</span>
<a id="__codelineno-41-22" name="__codelineno-41-22" href="#__codelineno-41-22"></a><span class="w">    </span><span class="kt">vec3</span><span class="w"> </span><span class="n">diffuse</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">diff</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="n">lightColor</span><span class="p">;</span>
<a id="__codelineno-41-23" name="__codelineno-41-23" href="#__codelineno-41-23"></a>
<a id="__codelineno-41-24" name="__codelineno-41-24" href="#__codelineno-41-24"></a><span class="w">    </span><span class="c1">// Specular</span>
<a id="__codelineno-41-25" name="__codelineno-41-25" href="#__codelineno-41-25"></a><span class="w">    </span><span class="kt">float</span><span class="w"> </span><span class="n">specularStrength</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mf">0.5</span><span class="p">;</span>
<a id="__codelineno-41-26" name="__codelineno-41-26" href="#__codelineno-41-26"></a><span class="w">    </span><span class="kt">vec3</span><span class="w"> </span><span class="n">viewDir</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">normalize</span><span class="p">(</span><span class="n">viewPos</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="n">FragPos</span><span class="p">);</span>
<a id="__codelineno-41-27" name="__codelineno-41-27" href="#__codelineno-41-27"></a><span class="w">    </span><span class="kt">vec3</span><span class="w"> </span><span class="n">reflectDir</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">reflect</span><span class="p">(</span><span class="o">-</span><span class="n">lightDir</span><span class="p">,</span><span class="w"> </span><span class="n">norm</span><span class="p">);</span>
<a id="__codelineno-41-28" name="__codelineno-41-28" href="#__codelineno-41-28"></a><span class="w">    </span><span class="kt">float</span><span class="w"> </span><span class="n">spec</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">pow</span><span class="p">(</span><span class="n">max</span><span class="p">(</span><span class="n">dot</span><span class="p">(</span><span class="n">viewDir</span><span class="p">,</span><span class="w"> </span><span class="n">reflectDir</span><span class="p">),</span><span class="w"> </span><span class="mf">0.0</span><span class="p">),</span><span class="w"> </span><span class="mi">32</span><span class="p">);</span>
<a id="__codelineno-41-29" name="__codelineno-41-29" href="#__codelineno-41-29"></a><span class="w">    </span><span class="kt">vec3</span><span class="w"> </span><span class="n">specular</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">specularStrength</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="n">spec</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="n">lightColor</span><span class="p">;</span>
<a id="__codelineno-41-30" name="__codelineno-41-30" href="#__codelineno-41-30"></a>
<a id="__codelineno-41-31" name="__codelineno-41-31" href="#__codelineno-41-31"></a><span class="w">    </span><span class="kt">vec3</span><span class="w"> </span><span class="n">result</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">(</span><span class="n">ambient</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="n">diffuse</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="n">specular</span><span class="p">)</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="n">objectColor</span><span class="p">;</span>
<a id="__codelineno-41-32" name="__codelineno-41-32" href="#__codelineno-41-32"></a><span class="w">    </span><span class="n">FragColor</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="kt">vec4</span><span class="p">(</span><span class="n">result</span><span class="p">,</span><span class="w"> </span><span class="mf">1.0</span><span class="p">);</span>
<a id="__codelineno-41-33" name="__codelineno-41-33" href="#__codelineno-41-33"></a><span class="p">}</span>
</code></pre></div>
<p>In this example, the fragment shader computes lighting using the Phong reflection model, combining ambient, diffuse, and specular components.</p>
<p>Fragment shaders, also known as pixel shaders, are crucial components of the graphics pipeline responsible for determining the final color of each pixel drawn to the screen. They process the interpolated data from the vertex shader and apply textures, lighting, and other effects to produce the final rendered image.</p>
<h4 id="implementation_1">Implementation</h4>
<p>We'll implement a comprehensive fragment shader that incorporates physically-based rendering (PBR), normal mapping, and multiple light types. This shader will be designed to work within a modern rendering pipeline and support various material properties.</p>
<p>Key Components:</p>
<ol>
<li>Texture sampling and material property integration</li>
<li>Normal mapping</li>
<li>PBR lighting calculations</li>
<li>Multiple light type support (directional, point, spot)</li>
<li>Shadow mapping</li>
<li>Ambient occlusion</li>
<li>Tone mapping and gamma correction</li>
</ol>
<p>Here's a GLSL implementation of a fragment shader:</p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-42-1" name="__codelineno-42-1" href="#__codelineno-42-1"></a><span class="cp">#version 450</span>
<a id="__codelineno-42-2" name="__codelineno-42-2" href="#__codelineno-42-2"></a>
<a id="__codelineno-42-3" name="__codelineno-42-3" href="#__codelineno-42-3"></a><span class="c1">// Input from vertex shader</span>
<a id="__codelineno-42-4" name="__codelineno-42-4" href="#__codelineno-42-4"></a><span class="k">layout</span><span class="p">(</span><span class="n">location</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mo">0</span><span class="p">)</span><span class="w"> </span><span class="k">in</span><span class="w"> </span><span class="kt">vec3</span><span class="w"> </span><span class="n">inWorldPos</span><span class="p">;</span>
<a id="__codelineno-42-5" name="__codelineno-42-5" href="#__codelineno-42-5"></a><span class="k">layout</span><span class="p">(</span><span class="n">location</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">1</span><span class="p">)</span><span class="w"> </span><span class="k">in</span><span class="w"> </span><span class="kt">vec2</span><span class="w"> </span><span class="n">inTexCoord</span><span class="p">;</span>
<a id="__codelineno-42-6" name="__codelineno-42-6" href="#__codelineno-42-6"></a><span class="k">layout</span><span class="p">(</span><span class="n">location</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">2</span><span class="p">)</span><span class="w"> </span><span class="k">in</span><span class="w"> </span><span class="kt">mat3</span><span class="w"> </span><span class="n">inTBN</span><span class="p">;</span>
<a id="__codelineno-42-7" name="__codelineno-42-7" href="#__codelineno-42-7"></a><span class="k">layout</span><span class="p">(</span><span class="n">location</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">5</span><span class="p">)</span><span class="w"> </span><span class="k">in</span><span class="w"> </span><span class="kt">vec3</span><span class="w"> </span><span class="n">inViewPos</span><span class="p">;</span>
<a id="__codelineno-42-8" name="__codelineno-42-8" href="#__codelineno-42-8"></a>
<a id="__codelineno-42-9" name="__codelineno-42-9" href="#__codelineno-42-9"></a><span class="c1">// Output</span>
<a id="__codelineno-42-10" name="__codelineno-42-10" href="#__codelineno-42-10"></a><span class="k">layout</span><span class="p">(</span><span class="n">location</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mo">0</span><span class="p">)</span><span class="w"> </span><span class="k">out</span><span class="w"> </span><span class="kt">vec4</span><span class="w"> </span><span class="n">outColor</span><span class="p">;</span>
<a id="__codelineno-42-11" name="__codelineno-42-11" href="#__codelineno-42-11"></a>
<a id="__codelineno-42-12" name="__codelineno-42-12" href="#__codelineno-42-12"></a><span class="c1">// Texture samplers</span>
<a id="__codelineno-42-13" name="__codelineno-42-13" href="#__codelineno-42-13"></a><span class="k">layout</span><span class="p">(</span><span class="n">binding</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mo">0</span><span class="p">)</span><span class="w"> </span><span class="k">uniform</span><span class="w"> </span><span class="kt">sampler2D</span><span class="w"> </span><span class="n">albedoMap</span><span class="p">;</span>
<a id="__codelineno-42-14" name="__codelineno-42-14" href="#__codelineno-42-14"></a><span class="k">layout</span><span class="p">(</span><span class="n">binding</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">1</span><span class="p">)</span><span class="w"> </span><span class="k">uniform</span><span class="w"> </span><span class="kt">sampler2D</span><span class="w"> </span><span class="n">normalMap</span><span class="p">;</span>
<a id="__codelineno-42-15" name="__codelineno-42-15" href="#__codelineno-42-15"></a><span class="k">layout</span><span class="p">(</span><span class="n">binding</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">2</span><span class="p">)</span><span class="w"> </span><span class="k">uniform</span><span class="w"> </span><span class="kt">sampler2D</span><span class="w"> </span><span class="n">metallicRoughnessMap</span><span class="p">;</span>
<a id="__codelineno-42-16" name="__codelineno-42-16" href="#__codelineno-42-16"></a><span class="k">layout</span><span class="p">(</span><span class="n">binding</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">3</span><span class="p">)</span><span class="w"> </span><span class="k">uniform</span><span class="w"> </span><span class="kt">sampler2D</span><span class="w"> </span><span class="n">aoMap</span><span class="p">;</span>
<a id="__codelineno-42-17" name="__codelineno-42-17" href="#__codelineno-42-17"></a><span class="k">layout</span><span class="p">(</span><span class="n">binding</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">4</span><span class="p">)</span><span class="w"> </span><span class="k">uniform</span><span class="w"> </span><span class="kt">samplerCube</span><span class="w"> </span><span class="n">irradianceMap</span><span class="p">;</span>
<a id="__codelineno-42-18" name="__codelineno-42-18" href="#__codelineno-42-18"></a><span class="k">layout</span><span class="p">(</span><span class="n">binding</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">5</span><span class="p">)</span><span class="w"> </span><span class="k">uniform</span><span class="w"> </span><span class="kt">samplerCube</span><span class="w"> </span><span class="n">prefilterMap</span><span class="p">;</span>
<a id="__codelineno-42-19" name="__codelineno-42-19" href="#__codelineno-42-19"></a><span class="k">layout</span><span class="p">(</span><span class="n">binding</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">6</span><span class="p">)</span><span class="w"> </span><span class="k">uniform</span><span class="w"> </span><span class="kt">sampler2D</span><span class="w"> </span><span class="n">brdfLUT</span><span class="p">;</span>
<a id="__codelineno-42-20" name="__codelineno-42-20" href="#__codelineno-42-20"></a><span class="k">layout</span><span class="p">(</span><span class="n">binding</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">7</span><span class="p">)</span><span class="w"> </span><span class="k">uniform</span><span class="w"> </span><span class="kt">sampler2D</span><span class="w"> </span><span class="n">shadowMap</span><span class="p">;</span>
<a id="__codelineno-42-21" name="__codelineno-42-21" href="#__codelineno-42-21"></a>
<a id="__codelineno-42-22" name="__codelineno-42-22" href="#__codelineno-42-22"></a><span class="c1">// Uniform buffers</span>
<a id="__codelineno-42-23" name="__codelineno-42-23" href="#__codelineno-42-23"></a><span class="k">layout</span><span class="p">(</span><span class="n">std140</span><span class="p">,</span><span class="w"> </span><span class="n">binding</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mo">0</span><span class="p">)</span><span class="w"> </span><span class="k">uniform</span><span class="w"> </span><span class="n">CameraData</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-42-24" name="__codelineno-42-24" href="#__codelineno-42-24"></a><span class="w">    </span><span class="kt">mat4</span><span class="w"> </span><span class="n">view</span><span class="p">;</span>
<a id="__codelineno-42-25" name="__codelineno-42-25" href="#__codelineno-42-25"></a><span class="w">    </span><span class="kt">mat4</span><span class="w"> </span><span class="n">projection</span><span class="p">;</span>
<a id="__codelineno-42-26" name="__codelineno-42-26" href="#__codelineno-42-26"></a><span class="w">    </span><span class="kt">vec3</span><span class="w"> </span><span class="n">cameraPosition</span><span class="p">;</span>
<a id="__codelineno-42-27" name="__codelineno-42-27" href="#__codelineno-42-27"></a><span class="p">};</span>
<a id="__codelineno-42-28" name="__codelineno-42-28" href="#__codelineno-42-28"></a>
<a id="__codelineno-42-29" name="__codelineno-42-29" href="#__codelineno-42-29"></a><span class="k">layout</span><span class="p">(</span><span class="n">std140</span><span class="p">,</span><span class="w"> </span><span class="n">binding</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">1</span><span class="p">)</span><span class="w"> </span><span class="k">uniform</span><span class="w"> </span><span class="n">MaterialData</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-42-30" name="__codelineno-42-30" href="#__codelineno-42-30"></a><span class="w">    </span><span class="kt">vec4</span><span class="w"> </span><span class="n">baseColorFactor</span><span class="p">;</span>
<a id="__codelineno-42-31" name="__codelineno-42-31" href="#__codelineno-42-31"></a><span class="w">    </span><span class="kt">vec3</span><span class="w"> </span><span class="n">emissiveFactor</span><span class="p">;</span>
<a id="__codelineno-42-32" name="__codelineno-42-32" href="#__codelineno-42-32"></a><span class="w">    </span><span class="kt">float</span><span class="w"> </span><span class="n">metallicFactor</span><span class="p">;</span>
<a id="__codelineno-42-33" name="__codelineno-42-33" href="#__codelineno-42-33"></a><span class="w">    </span><span class="kt">float</span><span class="w"> </span><span class="n">roughnessFactor</span><span class="p">;</span>
<a id="__codelineno-42-34" name="__codelineno-42-34" href="#__codelineno-42-34"></a><span class="w">    </span><span class="kt">float</span><span class="w"> </span><span class="n">alphaCutoff</span><span class="p">;</span>
<a id="__codelineno-42-35" name="__codelineno-42-35" href="#__codelineno-42-35"></a><span class="w">    </span><span class="kt">float</span><span class="w"> </span><span class="n">normalScale</span><span class="p">;</span>
<a id="__codelineno-42-36" name="__codelineno-42-36" href="#__codelineno-42-36"></a><span class="p">};</span>
<a id="__codelineno-42-37" name="__codelineno-42-37" href="#__codelineno-42-37"></a>
<a id="__codelineno-42-38" name="__codelineno-42-38" href="#__codelineno-42-38"></a><span class="cp">#define MAX_LIGHTS 4</span>
<a id="__codelineno-42-39" name="__codelineno-42-39" href="#__codelineno-42-39"></a><span class="k">struct</span><span class="w"> </span><span class="n">Light</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-42-40" name="__codelineno-42-40" href="#__codelineno-42-40"></a><span class="w">    </span><span class="kt">vec4</span><span class="w"> </span><span class="n">position</span><span class="p">;</span><span class="w">  </span><span class="c1">// w=0 for directional, w=1 for point/spot</span>
<a id="__codelineno-42-41" name="__codelineno-42-41" href="#__codelineno-42-41"></a><span class="w">    </span><span class="kt">vec4</span><span class="w"> </span><span class="n">direction</span><span class="p">;</span><span class="w"> </span><span class="c1">// w component is the cone angle for spot lights</span>
<a id="__codelineno-42-42" name="__codelineno-42-42" href="#__codelineno-42-42"></a><span class="w">    </span><span class="kt">vec4</span><span class="w"> </span><span class="n">color</span><span class="p">;</span><span class="w">     </span><span class="c1">// w component is intensity</span>
<a id="__codelineno-42-43" name="__codelineno-42-43" href="#__codelineno-42-43"></a><span class="w">    </span><span class="kt">mat4</span><span class="w"> </span><span class="n">shadowMatrix</span><span class="p">;</span>
<a id="__codelineno-42-44" name="__codelineno-42-44" href="#__codelineno-42-44"></a><span class="p">};</span>
<a id="__codelineno-42-45" name="__codelineno-42-45" href="#__codelineno-42-45"></a>
<a id="__codelineno-42-46" name="__codelineno-42-46" href="#__codelineno-42-46"></a><span class="k">layout</span><span class="p">(</span><span class="n">std140</span><span class="p">,</span><span class="w"> </span><span class="n">binding</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">2</span><span class="p">)</span><span class="w"> </span><span class="k">uniform</span><span class="w"> </span><span class="n">LightData</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-42-47" name="__codelineno-42-47" href="#__codelineno-42-47"></a><span class="w">    </span><span class="n">Light</span><span class="w"> </span><span class="n">lights</span><span class="p">[</span><span class="n">MAX_LIGHTS</span><span class="p">];</span>
<a id="__codelineno-42-48" name="__codelineno-42-48" href="#__codelineno-42-48"></a><span class="w">    </span><span class="kt">int</span><span class="w"> </span><span class="n">lightCount</span><span class="p">;</span>
<a id="__codelineno-42-49" name="__codelineno-42-49" href="#__codelineno-42-49"></a><span class="p">};</span>
<a id="__codelineno-42-50" name="__codelineno-42-50" href="#__codelineno-42-50"></a>
<a id="__codelineno-42-51" name="__codelineno-42-51" href="#__codelineno-42-51"></a><span class="k">const</span><span class="w"> </span><span class="kt">float</span><span class="w"> </span><span class="n">PI</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mf">3.14159265359</span><span class="p">;</span>
<a id="__codelineno-42-52" name="__codelineno-42-52" href="#__codelineno-42-52"></a>
<a id="__codelineno-42-53" name="__codelineno-42-53" href="#__codelineno-42-53"></a><span class="c1">// PBR functions</span>
<a id="__codelineno-42-54" name="__codelineno-42-54" href="#__codelineno-42-54"></a><span class="kt">vec3</span><span class="w"> </span><span class="n">fresnelSchlick</span><span class="p">(</span><span class="kt">float</span><span class="w"> </span><span class="n">cosTheta</span><span class="p">,</span><span class="w"> </span><span class="kt">vec3</span><span class="w"> </span><span class="n">F0</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-42-55" name="__codelineno-42-55" href="#__codelineno-42-55"></a><span class="w">    </span><span class="k">return</span><span class="w"> </span><span class="n">F0</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="p">(</span><span class="mf">1.0</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="n">F0</span><span class="p">)</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="n">pow</span><span class="p">(</span><span class="n">max</span><span class="p">(</span><span class="mf">1.0</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="n">cosTheta</span><span class="p">,</span><span class="w"> </span><span class="mf">0.0</span><span class="p">),</span><span class="w"> </span><span class="mf">5.0</span><span class="p">);</span>
<a id="__codelineno-42-56" name="__codelineno-42-56" href="#__codelineno-42-56"></a><span class="p">}</span>
<a id="__codelineno-42-57" name="__codelineno-42-57" href="#__codelineno-42-57"></a>
<a id="__codelineno-42-58" name="__codelineno-42-58" href="#__codelineno-42-58"></a><span class="kt">float</span><span class="w"> </span><span class="n">DistributionGGX</span><span class="p">(</span><span class="kt">vec3</span><span class="w"> </span><span class="n">N</span><span class="p">,</span><span class="w"> </span><span class="kt">vec3</span><span class="w"> </span><span class="n">H</span><span class="p">,</span><span class="w"> </span><span class="kt">float</span><span class="w"> </span><span class="n">roughness</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-42-59" name="__codelineno-42-59" href="#__codelineno-42-59"></a><span class="w">    </span><span class="kt">float</span><span class="w"> </span><span class="n">a</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">roughness</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="n">roughness</span><span class="p">;</span>
<a id="__codelineno-42-60" name="__codelineno-42-60" href="#__codelineno-42-60"></a><span class="w">    </span><span class="kt">float</span><span class="w"> </span><span class="n">a2</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">a</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="n">a</span><span class="p">;</span>
<a id="__codelineno-42-61" name="__codelineno-42-61" href="#__codelineno-42-61"></a><span class="w">    </span><span class="kt">float</span><span class="w"> </span><span class="n">NdotH</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">max</span><span class="p">(</span><span class="n">dot</span><span class="p">(</span><span class="n">N</span><span class="p">,</span><span class="w"> </span><span class="n">H</span><span class="p">),</span><span class="w"> </span><span class="mf">0.0</span><span class="p">);</span>
<a id="__codelineno-42-62" name="__codelineno-42-62" href="#__codelineno-42-62"></a><span class="w">    </span><span class="kt">float</span><span class="w"> </span><span class="n">NdotH2</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">NdotH</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="n">NdotH</span><span class="p">;</span>
<a id="__codelineno-42-63" name="__codelineno-42-63" href="#__codelineno-42-63"></a>
<a id="__codelineno-42-64" name="__codelineno-42-64" href="#__codelineno-42-64"></a><span class="w">    </span><span class="kt">float</span><span class="w"> </span><span class="n">nom</span><span class="w">   </span><span class="o">=</span><span class="w"> </span><span class="n">a2</span><span class="p">;</span>
<a id="__codelineno-42-65" name="__codelineno-42-65" href="#__codelineno-42-65"></a><span class="w">    </span><span class="kt">float</span><span class="w"> </span><span class="n">denom</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">(</span><span class="n">NdotH2</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="p">(</span><span class="n">a2</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="mf">1.0</span><span class="p">)</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="mf">1.0</span><span class="p">);</span>
<a id="__codelineno-42-66" name="__codelineno-42-66" href="#__codelineno-42-66"></a><span class="w">    </span><span class="n">denom</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">PI</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="n">denom</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="n">denom</span><span class="p">;</span>
<a id="__codelineno-42-67" name="__codelineno-42-67" href="#__codelineno-42-67"></a>
<a id="__codelineno-42-68" name="__codelineno-42-68" href="#__codelineno-42-68"></a><span class="w">    </span><span class="k">return</span><span class="w"> </span><span class="n">nom</span><span class="w"> </span><span class="o">/</span><span class="w"> </span><span class="n">max</span><span class="p">(</span><span class="n">denom</span><span class="p">,</span><span class="w"> </span><span class="mf">0.0000001</span><span class="p">);</span>
<a id="__codelineno-42-69" name="__codelineno-42-69" href="#__codelineno-42-69"></a><span class="p">}</span>
<a id="__codelineno-42-70" name="__codelineno-42-70" href="#__codelineno-42-70"></a>
<a id="__codelineno-42-71" name="__codelineno-42-71" href="#__codelineno-42-71"></a><span class="kt">float</span><span class="w"> </span><span class="n">GeometrySchlickGGX</span><span class="p">(</span><span class="kt">float</span><span class="w"> </span><span class="n">NdotV</span><span class="p">,</span><span class="w"> </span><span class="kt">float</span><span class="w"> </span><span class="n">roughness</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-42-72" name="__codelineno-42-72" href="#__codelineno-42-72"></a><span class="w">    </span><span class="kt">float</span><span class="w"> </span><span class="n">r</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">(</span><span class="n">roughness</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="mf">1.0</span><span class="p">);</span>
<a id="__codelineno-42-73" name="__codelineno-42-73" href="#__codelineno-42-73"></a><span class="w">    </span><span class="kt">float</span><span class="w"> </span><span class="n">k</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">(</span><span class="n">r</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="n">r</span><span class="p">)</span><span class="w"> </span><span class="o">/</span><span class="w"> </span><span class="mf">8.0</span><span class="p">;</span>
<a id="__codelineno-42-74" name="__codelineno-42-74" href="#__codelineno-42-74"></a>
<a id="__codelineno-42-75" name="__codelineno-42-75" href="#__codelineno-42-75"></a><span class="w">    </span><span class="kt">float</span><span class="w"> </span><span class="n">nom</span><span class="w">   </span><span class="o">=</span><span class="w"> </span><span class="n">NdotV</span><span class="p">;</span>
<a id="__codelineno-42-76" name="__codelineno-42-76" href="#__codelineno-42-76"></a><span class="w">    </span><span class="kt">float</span><span class="w"> </span><span class="n">denom</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">NdotV</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="p">(</span><span class="mf">1.0</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="n">k</span><span class="p">)</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="n">k</span><span class="p">;</span>
<a id="__codelineno-42-77" name="__codelineno-42-77" href="#__codelineno-42-77"></a>
<a id="__codelineno-42-78" name="__codelineno-42-78" href="#__codelineno-42-78"></a><span class="w">    </span><span class="k">return</span><span class="w"> </span><span class="n">nom</span><span class="w"> </span><span class="o">/</span><span class="w"> </span><span class="n">denom</span><span class="p">;</span>
<a id="__codelineno-42-79" name="__codelineno-42-79" href="#__codelineno-42-79"></a><span class="p">}</span>
<a id="__codelineno-42-80" name="__codelineno-42-80" href="#__codelineno-42-80"></a>
<a id="__codelineno-42-81" name="__codelineno-42-81" href="#__codelineno-42-81"></a><span class="kt">float</span><span class="w"> </span><span class="n">GeometrySmith</span><span class="p">(</span><span class="kt">vec3</span><span class="w"> </span><span class="n">N</span><span class="p">,</span><span class="w"> </span><span class="kt">vec3</span><span class="w"> </span><span class="n">V</span><span class="p">,</span><span class="w"> </span><span class="kt">vec3</span><span class="w"> </span><span class="n">L</span><span class="p">,</span><span class="w"> </span><span class="kt">float</span><span class="w"> </span><span class="n">roughness</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-42-82" name="__codelineno-42-82" href="#__codelineno-42-82"></a><span class="w">    </span><span class="kt">float</span><span class="w"> </span><span class="n">NdotV</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">max</span><span class="p">(</span><span class="n">dot</span><span class="p">(</span><span class="n">N</span><span class="p">,</span><span class="w"> </span><span class="n">V</span><span class="p">),</span><span class="w"> </span><span class="mf">0.0</span><span class="p">);</span>
<a id="__codelineno-42-83" name="__codelineno-42-83" href="#__codelineno-42-83"></a><span class="w">    </span><span class="kt">float</span><span class="w"> </span><span class="n">NdotL</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">max</span><span class="p">(</span><span class="n">dot</span><span class="p">(</span><span class="n">N</span><span class="p">,</span><span class="w"> </span><span class="n">L</span><span class="p">),</span><span class="w"> </span><span class="mf">0.0</span><span class="p">);</span>
<a id="__codelineno-42-84" name="__codelineno-42-84" href="#__codelineno-42-84"></a><span class="w">    </span><span class="kt">float</span><span class="w"> </span><span class="n">ggx2</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">GeometrySchlickGGX</span><span class="p">(</span><span class="n">NdotV</span><span class="p">,</span><span class="w"> </span><span class="n">roughness</span><span class="p">);</span>
<a id="__codelineno-42-85" name="__codelineno-42-85" href="#__codelineno-42-85"></a><span class="w">    </span><span class="kt">float</span><span class="w"> </span><span class="n">ggx1</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">GeometrySchlickGGX</span><span class="p">(</span><span class="n">NdotL</span><span class="p">,</span><span class="w"> </span><span class="n">roughness</span><span class="p">);</span>
<a id="__codelineno-42-86" name="__codelineno-42-86" href="#__codelineno-42-86"></a>
<a id="__codelineno-42-87" name="__codelineno-42-87" href="#__codelineno-42-87"></a><span class="w">    </span><span class="k">return</span><span class="w"> </span><span class="n">ggx1</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="n">ggx2</span><span class="p">;</span>
<a id="__codelineno-42-88" name="__codelineno-42-88" href="#__codelineno-42-88"></a><span class="p">}</span>
<a id="__codelineno-42-89" name="__codelineno-42-89" href="#__codelineno-42-89"></a>
<a id="__codelineno-42-90" name="__codelineno-42-90" href="#__codelineno-42-90"></a><span class="c1">// Shadow mapping</span>
<a id="__codelineno-42-91" name="__codelineno-42-91" href="#__codelineno-42-91"></a><span class="kt">float</span><span class="w"> </span><span class="n">ShadowCalculation</span><span class="p">(</span><span class="kt">vec4</span><span class="w"> </span><span class="n">fragPosLightSpace</span><span class="p">,</span><span class="w"> </span><span class="kt">sampler2D</span><span class="w"> </span><span class="n">shadowMap</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-42-92" name="__codelineno-42-92" href="#__codelineno-42-92"></a><span class="w">    </span><span class="kt">vec3</span><span class="w"> </span><span class="n">projCoords</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">fragPosLightSpace</span><span class="p">.</span><span class="n">xyz</span><span class="w"> </span><span class="o">/</span><span class="w"> </span><span class="n">fragPosLightSpace</span><span class="p">.</span><span class="n">w</span><span class="p">;</span>
<a id="__codelineno-42-93" name="__codelineno-42-93" href="#__codelineno-42-93"></a><span class="w">    </span><span class="n">projCoords</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">projCoords</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="mf">0.5</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="mf">0.5</span><span class="p">;</span>
<a id="__codelineno-42-94" name="__codelineno-42-94" href="#__codelineno-42-94"></a><span class="w">    </span><span class="kt">float</span><span class="w"> </span><span class="n">closestDepth</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">texture</span><span class="p">(</span><span class="n">shadowMap</span><span class="p">,</span><span class="w"> </span><span class="n">projCoords</span><span class="p">.</span><span class="n">xy</span><span class="p">).</span><span class="n">r</span><span class="p">;</span><span class="w"> </span>
<a id="__codelineno-42-95" name="__codelineno-42-95" href="#__codelineno-42-95"></a><span class="w">    </span><span class="kt">float</span><span class="w"> </span><span class="n">currentDepth</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">projCoords</span><span class="p">.</span><span class="n">z</span><span class="p">;</span>
<a id="__codelineno-42-96" name="__codelineno-42-96" href="#__codelineno-42-96"></a><span class="w">    </span><span class="kt">float</span><span class="w"> </span><span class="n">bias</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mf">0.005</span><span class="p">;</span>
<a id="__codelineno-42-97" name="__codelineno-42-97" href="#__codelineno-42-97"></a><span class="w">    </span><span class="kt">float</span><span class="w"> </span><span class="n">shadow</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">currentDepth</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="n">bias</span><span class="w"> </span><span class="o">&gt;</span><span class="w"> </span><span class="n">closestDepth</span><span class="w"> </span><span class="o">?</span><span class="w"> </span><span class="mf">1.0</span><span class="w"> </span><span class="o">:</span><span class="w"> </span><span class="mf">0.0</span><span class="p">;</span>
<a id="__codelineno-42-98" name="__codelineno-42-98" href="#__codelineno-42-98"></a><span class="w">    </span><span class="k">return</span><span class="w"> </span><span class="n">shadow</span><span class="p">;</span>
<a id="__codelineno-42-99" name="__codelineno-42-99" href="#__codelineno-42-99"></a><span class="p">}</span>
<a id="__codelineno-42-100" name="__codelineno-42-100" href="#__codelineno-42-100"></a>
<a id="__codelineno-42-101" name="__codelineno-42-101" href="#__codelineno-42-101"></a><span class="kt">void</span><span class="w"> </span><span class="n">main</span><span class="p">()</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-42-102" name="__codelineno-42-102" href="#__codelineno-42-102"></a><span class="w">    </span><span class="c1">// Sample textures</span>
<a id="__codelineno-42-103" name="__codelineno-42-103" href="#__codelineno-42-103"></a><span class="w">    </span><span class="kt">vec4</span><span class="w"> </span><span class="n">albedo</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">texture</span><span class="p">(</span><span class="n">albedoMap</span><span class="p">,</span><span class="w"> </span><span class="n">inTexCoord</span><span class="p">)</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="n">baseColorFactor</span><span class="p">;</span>
<a id="__codelineno-42-104" name="__codelineno-42-104" href="#__codelineno-42-104"></a><span class="w">    </span><span class="kt">vec3</span><span class="w"> </span><span class="n">normal</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">texture</span><span class="p">(</span><span class="n">normalMap</span><span class="p">,</span><span class="w"> </span><span class="n">inTexCoord</span><span class="p">).</span><span class="n">rgb</span><span class="p">;</span>
<a id="__codelineno-42-105" name="__codelineno-42-105" href="#__codelineno-42-105"></a><span class="w">    </span><span class="n">normal</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">normalize</span><span class="p">(</span><span class="n">normal</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="mf">2.0</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="mf">1.0</span><span class="p">);</span>
<a id="__codelineno-42-106" name="__codelineno-42-106" href="#__codelineno-42-106"></a><span class="w">    </span><span class="n">normal</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">normalize</span><span class="p">(</span><span class="n">inTBN</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="n">normal</span><span class="p">);</span>
<a id="__codelineno-42-107" name="__codelineno-42-107" href="#__codelineno-42-107"></a><span class="w">    </span><span class="kt">vec2</span><span class="w"> </span><span class="n">metallicRoughness</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">texture</span><span class="p">(</span><span class="n">metallicRoughnessMap</span><span class="p">,</span><span class="w"> </span><span class="n">inTexCoord</span><span class="p">).</span><span class="n">bg</span><span class="p">;</span>
<a id="__codelineno-42-108" name="__codelineno-42-108" href="#__codelineno-42-108"></a><span class="w">    </span><span class="kt">float</span><span class="w"> </span><span class="n">metallic</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">metallicRoughness</span><span class="p">.</span><span class="n">x</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="n">metallicFactor</span><span class="p">;</span>
<a id="__codelineno-42-109" name="__codelineno-42-109" href="#__codelineno-42-109"></a><span class="w">    </span><span class="kt">float</span><span class="w"> </span><span class="n">roughness</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">metallicRoughness</span><span class="p">.</span><span class="n">y</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="n">roughnessFactor</span><span class="p">;</span>
<a id="__codelineno-42-110" name="__codelineno-42-110" href="#__codelineno-42-110"></a><span class="w">    </span><span class="kt">float</span><span class="w"> </span><span class="n">ao</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">texture</span><span class="p">(</span><span class="n">aoMap</span><span class="p">,</span><span class="w"> </span><span class="n">inTexCoord</span><span class="p">).</span><span class="n">r</span><span class="p">;</span>
<a id="__codelineno-42-111" name="__codelineno-42-111" href="#__codelineno-42-111"></a>
<a id="__codelineno-42-112" name="__codelineno-42-112" href="#__codelineno-42-112"></a><span class="w">    </span><span class="kt">vec3</span><span class="w"> </span><span class="n">N</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">normal</span><span class="p">;</span>
<a id="__codelineno-42-113" name="__codelineno-42-113" href="#__codelineno-42-113"></a><span class="w">    </span><span class="kt">vec3</span><span class="w"> </span><span class="n">V</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">normalize</span><span class="p">(</span><span class="n">cameraPosition</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="n">inWorldPos</span><span class="p">);</span>
<a id="__codelineno-42-114" name="__codelineno-42-114" href="#__codelineno-42-114"></a><span class="w">    </span><span class="kt">vec3</span><span class="w"> </span><span class="n">R</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">reflect</span><span class="p">(</span><span class="o">-</span><span class="n">V</span><span class="p">,</span><span class="w"> </span><span class="n">N</span><span class="p">);</span>
<a id="__codelineno-42-115" name="__codelineno-42-115" href="#__codelineno-42-115"></a>
<a id="__codelineno-42-116" name="__codelineno-42-116" href="#__codelineno-42-116"></a><span class="w">    </span><span class="c1">// Calculate reflectance at normal incidence</span>
<a id="__codelineno-42-117" name="__codelineno-42-117" href="#__codelineno-42-117"></a><span class="w">    </span><span class="kt">vec3</span><span class="w"> </span><span class="n">F0</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="kt">vec3</span><span class="p">(</span><span class="mf">0.04</span><span class="p">);</span><span class="w"> </span>
<a id="__codelineno-42-118" name="__codelineno-42-118" href="#__codelineno-42-118"></a><span class="w">    </span><span class="n">F0</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">mix</span><span class="p">(</span><span class="n">F0</span><span class="p">,</span><span class="w"> </span><span class="n">albedo</span><span class="p">.</span><span class="n">rgb</span><span class="p">,</span><span class="w"> </span><span class="n">metallic</span><span class="p">);</span>
<a id="__codelineno-42-119" name="__codelineno-42-119" href="#__codelineno-42-119"></a>
<a id="__codelineno-42-120" name="__codelineno-42-120" href="#__codelineno-42-120"></a><span class="w">    </span><span class="c1">// Lighting calculation</span>
<a id="__codelineno-42-121" name="__codelineno-42-121" href="#__codelineno-42-121"></a><span class="w">    </span><span class="kt">vec3</span><span class="w"> </span><span class="n">Lo</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="kt">vec3</span><span class="p">(</span><span class="mf">0.0</span><span class="p">);</span>
<a id="__codelineno-42-122" name="__codelineno-42-122" href="#__codelineno-42-122"></a><span class="w">    </span><span class="k">for</span><span class="p">(</span><span class="kt">int</span><span class="w"> </span><span class="n">i</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mo">0</span><span class="p">;</span><span class="w"> </span><span class="n">i</span><span class="w"> </span><span class="o">&lt;</span><span class="w"> </span><span class="n">lightCount</span><span class="p">;</span><span class="w"> </span><span class="o">++</span><span class="n">i</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-42-123" name="__codelineno-42-123" href="#__codelineno-42-123"></a><span class="w">        </span><span class="kt">vec3</span><span class="w"> </span><span class="n">L</span><span class="p">;</span>
<a id="__codelineno-42-124" name="__codelineno-42-124" href="#__codelineno-42-124"></a><span class="w">        </span><span class="kt">float</span><span class="w"> </span><span class="n">attenuation</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mf">1.0</span><span class="p">;</span>
<a id="__codelineno-42-125" name="__codelineno-42-125" href="#__codelineno-42-125"></a><span class="w">        </span><span class="k">if</span><span class="p">(</span><span class="n">lights</span><span class="p">[</span><span class="n">i</span><span class="p">].</span><span class="n">position</span><span class="p">.</span><span class="n">w</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="mf">0.0</span><span class="p">)</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="c1">// Directional light</span>
<a id="__codelineno-42-126" name="__codelineno-42-126" href="#__codelineno-42-126"></a><span class="w">            </span><span class="n">L</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">normalize</span><span class="p">(</span><span class="o">-</span><span class="n">lights</span><span class="p">[</span><span class="n">i</span><span class="p">].</span><span class="n">direction</span><span class="p">.</span><span class="n">xyz</span><span class="p">);</span>
<a id="__codelineno-42-127" name="__codelineno-42-127" href="#__codelineno-42-127"></a><span class="w">        </span><span class="p">}</span><span class="w"> </span><span class="k">else</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="c1">// Point or spot light</span>
<a id="__codelineno-42-128" name="__codelineno-42-128" href="#__codelineno-42-128"></a><span class="w">            </span><span class="kt">vec3</span><span class="w"> </span><span class="n">lightVector</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">lights</span><span class="p">[</span><span class="n">i</span><span class="p">].</span><span class="n">position</span><span class="p">.</span><span class="n">xyz</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="n">inWorldPos</span><span class="p">;</span>
<a id="__codelineno-42-129" name="__codelineno-42-129" href="#__codelineno-42-129"></a><span class="w">            </span><span class="kt">float</span><span class="w"> </span><span class="n">distance</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">length</span><span class="p">(</span><span class="n">lightVector</span><span class="p">);</span>
<a id="__codelineno-42-130" name="__codelineno-42-130" href="#__codelineno-42-130"></a><span class="w">            </span><span class="n">L</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">normalize</span><span class="p">(</span><span class="n">lightVector</span><span class="p">);</span>
<a id="__codelineno-42-131" name="__codelineno-42-131" href="#__codelineno-42-131"></a><span class="w">            </span><span class="n">attenuation</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mf">1.0</span><span class="w"> </span><span class="o">/</span><span class="w"> </span><span class="p">(</span><span class="mf">1.0</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="mf">0.09</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="n">distance</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="mf">0.032</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="n">distance</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="n">distance</span><span class="p">);</span>
<a id="__codelineno-42-132" name="__codelineno-42-132" href="#__codelineno-42-132"></a>
<a id="__codelineno-42-133" name="__codelineno-42-133" href="#__codelineno-42-133"></a><span class="w">            </span><span class="k">if</span><span class="p">(</span><span class="n">lights</span><span class="p">[</span><span class="n">i</span><span class="p">].</span><span class="n">direction</span><span class="p">.</span><span class="n">w</span><span class="w"> </span><span class="o">&gt;</span><span class="w"> </span><span class="mf">0.0</span><span class="p">)</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="c1">// Spot light</span>
<a id="__codelineno-42-134" name="__codelineno-42-134" href="#__codelineno-42-134"></a><span class="w">                </span><span class="kt">float</span><span class="w"> </span><span class="n">theta</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">dot</span><span class="p">(</span><span class="n">L</span><span class="p">,</span><span class="w"> </span><span class="n">normalize</span><span class="p">(</span><span class="o">-</span><span class="n">lights</span><span class="p">[</span><span class="n">i</span><span class="p">].</span><span class="n">direction</span><span class="p">.</span><span class="n">xyz</span><span class="p">));</span>
<a id="__codelineno-42-135" name="__codelineno-42-135" href="#__codelineno-42-135"></a><span class="w">                </span><span class="kt">float</span><span class="w"> </span><span class="n">epsilon</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">lights</span><span class="p">[</span><span class="n">i</span><span class="p">].</span><span class="n">direction</span><span class="p">.</span><span class="n">w</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="n">lights</span><span class="p">[</span><span class="n">i</span><span class="p">].</span><span class="n">direction</span><span class="p">.</span><span class="n">w</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="mf">0.9</span><span class="p">;</span>
<a id="__codelineno-42-136" name="__codelineno-42-136" href="#__codelineno-42-136"></a><span class="w">                </span><span class="kt">float</span><span class="w"> </span><span class="n">intensity</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">clamp</span><span class="p">((</span><span class="n">theta</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="n">lights</span><span class="p">[</span><span class="n">i</span><span class="p">].</span><span class="n">direction</span><span class="p">.</span><span class="n">w</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="mf">0.9</span><span class="p">)</span><span class="w"> </span><span class="o">/</span><span class="w"> </span><span class="n">epsilon</span><span class="p">,</span><span class="w"> </span><span class="mf">0.0</span><span class="p">,</span><span class="w"> </span><span class="mf">1.0</span><span class="p">);</span>
<a id="__codelineno-42-137" name="__codelineno-42-137" href="#__codelineno-42-137"></a><span class="w">                </span><span class="n">attenuation</span><span class="w"> </span><span class="o">*=</span><span class="w"> </span><span class="n">intensity</span><span class="p">;</span>
<a id="__codelineno-42-138" name="__codelineno-42-138" href="#__codelineno-42-138"></a><span class="w">            </span><span class="p">}</span>
<a id="__codelineno-42-139" name="__codelineno-42-139" href="#__codelineno-42-139"></a><span class="w">        </span><span class="p">}</span>
<a id="__codelineno-42-140" name="__codelineno-42-140" href="#__codelineno-42-140"></a>
<a id="__codelineno-42-141" name="__codelineno-42-141" href="#__codelineno-42-141"></a><span class="w">        </span><span class="kt">vec3</span><span class="w"> </span><span class="n">H</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">normalize</span><span class="p">(</span><span class="n">V</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="n">L</span><span class="p">);</span>
<a id="__codelineno-42-142" name="__codelineno-42-142" href="#__codelineno-42-142"></a>
<a id="__codelineno-42-143" name="__codelineno-42-143" href="#__codelineno-42-143"></a><span class="w">        </span><span class="c1">// Cook-Torrance BRDF</span>
<a id="__codelineno-42-144" name="__codelineno-42-144" href="#__codelineno-42-144"></a><span class="w">        </span><span class="kt">float</span><span class="w"> </span><span class="n">NDF</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">DistributionGGX</span><span class="p">(</span><span class="n">N</span><span class="p">,</span><span class="w"> </span><span class="n">H</span><span class="p">,</span><span class="w"> </span><span class="n">roughness</span><span class="p">);</span><span class="w">   </span>
<a id="__codelineno-42-145" name="__codelineno-42-145" href="#__codelineno-42-145"></a><span class="w">        </span><span class="kt">float</span><span class="w"> </span><span class="n">G</span><span class="w">   </span><span class="o">=</span><span class="w"> </span><span class="n">GeometrySmith</span><span class="p">(</span><span class="n">N</span><span class="p">,</span><span class="w"> </span><span class="n">V</span><span class="p">,</span><span class="w"> </span><span class="n">L</span><span class="p">,</span><span class="w"> </span><span class="n">roughness</span><span class="p">);</span><span class="w">      </span>
<a id="__codelineno-42-146" name="__codelineno-42-146" href="#__codelineno-42-146"></a><span class="w">        </span><span class="kt">vec3</span><span class="w"> </span><span class="n">F</span><span class="w">    </span><span class="o">=</span><span class="w"> </span><span class="n">fresnelSchlick</span><span class="p">(</span><span class="n">max</span><span class="p">(</span><span class="n">dot</span><span class="p">(</span><span class="n">H</span><span class="p">,</span><span class="w"> </span><span class="n">V</span><span class="p">),</span><span class="w"> </span><span class="mf">0.0</span><span class="p">),</span><span class="w"> </span><span class="n">F0</span><span class="p">);</span>
<a id="__codelineno-42-147" name="__codelineno-42-147" href="#__codelineno-42-147"></a>
<a id="__codelineno-42-148" name="__codelineno-42-148" href="#__codelineno-42-148"></a><span class="w">        </span><span class="kt">vec3</span><span class="w"> </span><span class="n">nominator</span><span class="w">    </span><span class="o">=</span><span class="w"> </span><span class="n">NDF</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="n">G</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="n">F</span><span class="p">;</span><span class="w"> </span>
<a id="__codelineno-42-149" name="__codelineno-42-149" href="#__codelineno-42-149"></a><span class="w">        </span><span class="kt">float</span><span class="w"> </span><span class="n">denominator</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mf">4.0</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="n">max</span><span class="p">(</span><span class="n">dot</span><span class="p">(</span><span class="n">N</span><span class="p">,</span><span class="w"> </span><span class="n">V</span><span class="p">),</span><span class="w"> </span><span class="mf">0.0</span><span class="p">)</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="n">max</span><span class="p">(</span><span class="n">dot</span><span class="p">(</span><span class="n">N</span><span class="p">,</span><span class="w"> </span><span class="n">L</span><span class="p">),</span><span class="w"> </span><span class="mf">0.0</span><span class="p">);</span>
<a id="__codelineno-42-150" name="__codelineno-42-150" href="#__codelineno-42-150"></a><span class="w">        </span><span class="kt">vec3</span><span class="w"> </span><span class="n">specular</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">nominator</span><span class="w"> </span><span class="o">/</span><span class="w"> </span><span class="n">max</span><span class="p">(</span><span class="n">denominator</span><span class="p">,</span><span class="w"> </span><span class="mf">0.001</span><span class="p">);</span>
<a id="__codelineno-42-151" name="__codelineno-42-151" href="#__codelineno-42-151"></a>
<a id="__codelineno-42-152" name="__codelineno-42-152" href="#__codelineno-42-152"></a><span class="w">        </span><span class="kt">vec3</span><span class="w"> </span><span class="n">kS</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">F</span><span class="p">;</span>
<a id="__codelineno-42-153" name="__codelineno-42-153" href="#__codelineno-42-153"></a><span class="w">        </span><span class="kt">vec3</span><span class="w"> </span><span class="n">kD</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="kt">vec3</span><span class="p">(</span><span class="mf">1.0</span><span class="p">)</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="n">kS</span><span class="p">;</span>
<a id="__codelineno-42-154" name="__codelineno-42-154" href="#__codelineno-42-154"></a><span class="w">        </span><span class="n">kD</span><span class="w"> </span><span class="o">*=</span><span class="w"> </span><span class="mf">1.0</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="n">metallic</span><span class="p">;</span><span class="w">     </span>
<a id="__codelineno-42-155" name="__codelineno-42-155" href="#__codelineno-42-155"></a>
<a id="__codelineno-42-156" name="__codelineno-42-156" href="#__codelineno-42-156"></a><span class="w">        </span><span class="kt">float</span><span class="w"> </span><span class="n">NdotL</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">max</span><span class="p">(</span><span class="n">dot</span><span class="p">(</span><span class="n">N</span><span class="p">,</span><span class="w"> </span><span class="n">L</span><span class="p">),</span><span class="w"> </span><span class="mf">0.0</span><span class="p">);</span><span class="w">        </span>
<a id="__codelineno-42-157" name="__codelineno-42-157" href="#__codelineno-42-157"></a>
<a id="__codelineno-42-158" name="__codelineno-42-158" href="#__codelineno-42-158"></a><span class="w">        </span><span class="c1">// Shadow calculation</span>
<a id="__codelineno-42-159" name="__codelineno-42-159" href="#__codelineno-42-159"></a><span class="w">        </span><span class="kt">float</span><span class="w"> </span><span class="n">shadow</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">ShadowCalculation</span><span class="p">(</span><span class="n">lights</span><span class="p">[</span><span class="n">i</span><span class="p">].</span><span class="n">shadowMatrix</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="kt">vec4</span><span class="p">(</span><span class="n">inWorldPos</span><span class="p">,</span><span class="w"> </span><span class="mf">1.0</span><span class="p">),</span><span class="w"> </span><span class="n">shadowMap</span><span class="p">);</span>
<a id="__codelineno-42-160" name="__codelineno-42-160" href="#__codelineno-42-160"></a>
<a id="__codelineno-42-161" name="__codelineno-42-161" href="#__codelineno-42-161"></a><span class="w">        </span><span class="c1">// Combine lighting</span>
<a id="__codelineno-42-162" name="__codelineno-42-162" href="#__codelineno-42-162"></a><span class="w">        </span><span class="kt">vec3</span><span class="w"> </span><span class="n">radiance</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">lights</span><span class="p">[</span><span class="n">i</span><span class="p">].</span><span class="n">color</span><span class="p">.</span><span class="n">rgb</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="n">lights</span><span class="p">[</span><span class="n">i</span><span class="p">].</span><span class="n">color</span><span class="p">.</span><span class="n">a</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="n">attenuation</span><span class="p">;</span>
<a id="__codelineno-42-163" name="__codelineno-42-163" href="#__codelineno-42-163"></a><span class="w">        </span><span class="n">Lo</span><span class="w"> </span><span class="o">+=</span><span class="w"> </span><span class="p">(</span><span class="n">kD</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="n">albedo</span><span class="p">.</span><span class="n">rgb</span><span class="w"> </span><span class="o">/</span><span class="w"> </span><span class="n">PI</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="n">specular</span><span class="p">)</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="n">radiance</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="n">NdotL</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="p">(</span><span class="mf">1.0</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="n">shadow</span><span class="p">);</span>
<a id="__codelineno-42-164" name="__codelineno-42-164" href="#__codelineno-42-164"></a><span class="w">    </span><span class="p">}</span>
<a id="__codelineno-42-165" name="__codelineno-42-165" href="#__codelineno-42-165"></a>
<a id="__codelineno-42-166" name="__codelineno-42-166" href="#__codelineno-42-166"></a><span class="w">    </span><span class="c1">// Ambient lighting (IBL)</span>
<a id="__codelineno-42-167" name="__codelineno-42-167" href="#__codelineno-42-167"></a><span class="w">    </span><span class="kt">vec3</span><span class="w"> </span><span class="n">F</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">fresnelSchlick</span><span class="p">(</span><span class="n">max</span><span class="p">(</span><span class="n">dot</span><span class="p">(</span><span class="n">N</span><span class="p">,</span><span class="w"> </span><span class="n">V</span><span class="p">),</span><span class="w"> </span><span class="mf">0.0</span><span class="p">),</span><span class="w"> </span><span class="n">F0</span><span class="p">);</span>
<a id="__codelineno-42-168" name="__codelineno-42-168" href="#__codelineno-42-168"></a><span class="w">    </span><span class="kt">vec3</span><span class="w"> </span><span class="n">kS</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">F</span><span class="p">;</span>
<a id="__codelineno-42-169" name="__codelineno-42-169" href="#__codelineno-42-169"></a><span class="w">    </span><span class="kt">vec3</span><span class="w"> </span><span class="n">kD</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mf">1.0</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="n">kS</span><span class="p">;</span>
<a id="__codelineno-42-170" name="__codelineno-42-170" href="#__codelineno-42-170"></a><span class="w">    </span><span class="n">kD</span><span class="w"> </span><span class="o">*=</span><span class="w"> </span><span class="mf">1.0</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="n">metallic</span><span class="p">;</span>
<a id="__codelineno-42-171" name="__codelineno-42-171" href="#__codelineno-42-171"></a><span class="w">    </span><span class="kt">vec3</span><span class="w"> </span><span class="n">irradiance</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">texture</span><span class="p">(</span><span class="n">irradianceMap</span><span class="p">,</span><span class="w"> </span><span class="n">N</span><span class="p">).</span><span class="n">rgb</span><span class="p">;</span>
<a id="__codelineno-42-172" name="__codelineno-42-172" href="#__codelineno-42-172"></a><span class="w">    </span><span class="kt">vec3</span><span class="w"> </span><span class="n">diffuse</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">irradiance</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="n">albedo</span><span class="p">.</span><span class="n">rgb</span><span class="p">;</span>
<a id="__codelineno-42-173" name="__codelineno-42-173" href="#__codelineno-42-173"></a><span class="w">    </span><span class="k">const</span><span class="w"> </span><span class="kt">float</span><span class="w"> </span><span class="n">MAX_REFLECTION_LOD</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mf">4.0</span><span class="p">;</span>
<a id="__codelineno-42-174" name="__codelineno-42-174" href="#__codelineno-42-174"></a><span class="w">    </span><span class="kt">vec3</span><span class="w"> </span><span class="n">prefilteredColor</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">textureLod</span><span class="p">(</span><span class="n">prefilterMap</span><span class="p">,</span><span class="w"> </span><span class="n">R</span><span class="p">,</span><span class="w"> </span><span class="n">roughness</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="n">MAX_REFLECTION_LOD</span><span class="p">).</span><span class="n">rgb</span><span class="p">;</span><span class="w">    </span>
<a id="__codelineno-42-175" name="__codelineno-42-175" href="#__codelineno-42-175"></a><span class="w">    </span><span class="kt">vec2</span><span class="w"> </span><span class="n">brdf</span><span class="w">  </span><span class="o">=</span><span class="w"> </span><span class="n">texture</span><span class="p">(</span><span class="n">brdfLUT</span><span class="p">,</span><span class="w"> </span><span class="kt">vec2</span><span class="p">(</span><span class="n">max</span><span class="p">(</span><span class="n">dot</span><span class="p">(</span><span class="n">N</span><span class="p">,</span><span class="w"> </span><span class="n">V</span><span class="p">),</span><span class="w"> </span><span class="mf">0.0</span><span class="p">),</span><span class="w"> </span><span class="n">roughness</span><span class="p">)).</span><span class="n">rg</span><span class="p">;</span>
<a id="__codelineno-42-176" name="__codelineno-42-176" href="#__codelineno-42-176"></a><span class="w">    </span><span class="kt">vec3</span><span class="w"> </span><span class="n">specular</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">prefilteredColor</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="p">(</span><span class="n">F</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="n">brdf</span><span class="p">.</span><span class="n">x</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="n">brdf</span><span class="p">.</span><span class="n">y</span><span class="p">);</span>
<a id="__codelineno-42-177" name="__codelineno-42-177" href="#__codelineno-42-177"></a><span class="w">    </span><span class="kt">vec3</span><span class="w"> </span><span class="n">ambient</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">(</span><span class="n">kD</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="n">diffuse</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="n">specular</span><span class="p">)</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="n">ao</span><span class="p">;</span>
<a id="__codelineno-42-178" name="__codelineno-42-178" href="#__codelineno-42-178"></a>
<a id="__codelineno-42-179" name="__codelineno-42-179" href="#__codelineno-42-179"></a><span class="w">    </span><span class="c1">// Final color</span>
<a id="__codelineno-42-180" name="__codelineno-42-180" href="#__codelineno-42-180"></a><span class="w">    </span><span class="kt">vec3</span><span class="w"> </span><span class="n">color</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">ambient</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="n">Lo</span><span class="p">;</span>
<a id="__codelineno-42-181" name="__codelineno-42-181" href="#__codelineno-42-181"></a>
<a id="__codelineno-42-182" name="__codelineno-42-182" href="#__codelineno-42-182"></a><span class="w">    </span><span class="c1">// Tone mapping</span>
<a id="__codelineno-42-183" name="__codelineno-42-183" href="#__codelineno-42-183"></a><span class="w">    </span><span class="n">color</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">color</span><span class="w"> </span><span class="o">/</span><span class="w"> </span><span class="p">(</span><span class="n">color</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="kt">vec3</span><span class="p">(</span><span class="mf">1.0</span><span class="p">));</span>
<a id="__codelineno-42-184" name="__codelineno-42-184" href="#__codelineno-42-184"></a>
<a id="__codelineno-42-185" name="__codelineno-42-185" href="#__codelineno-42-185"></a><span class="w">    </span><span class="c1">// Gamma correction</span>
<a id="__codelineno-42-186" name="__codelineno-42-186" href="#__codelineno-42-186"></a><span class="w">    </span><span class="n">color</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">pow</span><span class="p">(</span><span class="n">color</span><span class="p">,</span><span class="w"> </span><span class="kt">vec3</span><span class="p">(</span><span class="mf">1.0</span><span class="o">/</span><span class="mf">2.2</span><span class="p">));</span><span class="w">  </span>
<a id="__codelineno-42-187" name="__codelineno-42-187" href="#__codelineno-42-187"></a>
<a id="__codelineno-42-188" name="__codelineno-42-188" href="#__codelineno-42-188"></a><span class="w">    </span><span class="n">outColor</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="kt">vec4</span><span class="p">(</span><span class="n">color</span><span class="p">,</span><span class="w"> </span><span class="n">albedo</span><span class="p">.</span><span class="n">a</span><span class="p">);</span>
<a id="__codelineno-42-189" name="__codelineno-42-189" href="#__codelineno-42-189"></a><span class="p">}</span>
</code></pre></div>
<h4 id="explanation_5">Explanation</h4>
<ol>
<li>
<p>Input and Output:</p>
<ul>
<li>The shader receives interpolated data from the vertex shader, including world position, texture coordinates, and the TBN matrix.</li>
<li>It outputs the final color of the fragment.</li>
</ul>
</li>
<li>
<p>Texture Sampling:</p>
<ul>
<li>Various textures are sampled to determine material properties (albedo, normal, metallic-roughness, ambient occlusion).</li>
<li>Environment maps (irradiance and prefilter) are used for image-based lighting.</li>
</ul>
</li>
<li>
<p>Normal Mapping:</p>
<ul>
<li>The normal from the normal map is transformed to world space using the TBN matrix.</li>
</ul>
</li>
<li>
<p>PBR Calculations:</p>
<ul>
<li>Implements the Cook-Torrance BRDF model.</li>
<li>Includes functions for Fresnel, Normal Distribution Function (GGX), and Geometry Function (Smith).</li>
</ul>
</li>
<li>
<p>Lighting:</p>
<ul>
<li>Supports multiple light types (directional, point, spot).</li>
<li>Calculates attenuation and spot light cones.</li>
<li>Applies shadows using shadow mapping.</li>
</ul>
</li>
<li>
<p>Image-Based Lighting (IBL):</p>
<ul>
<li>Uses precomputed environment maps for ambient lighting.</li>
<li>Applies diffuse and specular IBL contributions.</li>
</ul>
</li>
<li>
<p>Final Color Composition:</p>
<ul>
<li>Combines direct lighting, IBL, and ambient occlusion.</li>
<li>Applies tone mapping and gamma correction.</li>
</ul>
</li>
</ol>
<p>Key Features:</p>
<ol>
<li>
<p>Physically Based:</p>
<ul>
<li>Follows PBR principles for realistic light interaction.</li>
</ul>
</li>
<li>
<p>Flexible:</p>
<ul>
<li>Supports various material types through texture inputs and factors.</li>
</ul>
</li>
<li>
<p>Performance Conscious:</p>
<ul>
<li>Uses uniform buffers for efficient data transfer.</li>
<li>Limits the number of lights to maintain performance.</li>
</ul>
</li>
<li>
<p>Advanced Techniques:</p>
<ul>
<li>Incorporates image-based lighting for realistic environments.</li>
<li>Includes shadow mapping for all light types.</li>
</ul>
</li>
<li>
<p>Post-Processing:</p>
<ul>
<li>Applies basic tone mapping and gamma correction.</li>
</ul>
</li>
</ol>
<p>This fragment shader provides a solid foundation for high-quality rendering in a modern game engine. It can be extended or specialized for different rendering techniques or optimized for specific hardware. Possible extensions include:</p>
<ul>
<li>Subsurface scattering for skin or translucent materials</li>
<li>Clear coat layer for automotive paints</li>
<li>Anisotropic specular reflection for brushed metals</li>
<li>Optimizations like tiled or clustered lighting for better performance with many lights</li>
</ul>
<h3 id="geometry-shaders">Geometry Shaders</h3>
<p>Geometry shaders operate on entire primitives (points, lines, or triangles) and can generate new geometry or modify existing geometry. They sit between the vertex and fragment shaders in the pipeline.</p>
<ul>
<li><strong>Purpose:</strong> Generate new vertices, modify existing vertices, perform geometry-level operations.</li>
<li><strong>Input:</strong> Primitives (points, lines, triangles) from the vertex shader.</li>
<li><strong>Output:</strong> Zero or more primitives to be rasterized.</li>
</ul>
<p>Geometry shaders are a powerful feature in modern graphics programming, often used in game development to enhance visual quality and performance. They operate between the vertex and fragment shaders in the rendering pipeline, allowing for dynamic manipulation of geometry.</p>
<p>They are programmable stages in the graphics pipeline that operate on primitive data (points, lines, or triangles) after vertex processing but before rasterization. They have the unique ability to create, modify, or discard geometry on the GPU, enabling efficient generation of complex effects without additional CPU overhead.</p>
<p>Key capabilities of geometry shaders include:</p>
<ol>
<li>Primitive amplification: Creating new primitives from input data.</li>
<li>Geometry modification: Altering existing primitive attributes or topology.</li>
<li>Culling: Discarding primitives based on custom criteria.</li>
<li>Per-primitive operations: Applying transformations or computations uniformly to primitives.</li>
</ol>
<p>Here's a simple example of a geometry shader in GLSL that generates a triangle from each input point:</p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-43-1" name="__codelineno-43-1" href="#__codelineno-43-1"></a><span class="cp">#version 330 core</span>
<a id="__codelineno-43-2" name="__codelineno-43-2" href="#__codelineno-43-2"></a>
<a id="__codelineno-43-3" name="__codelineno-43-3" href="#__codelineno-43-3"></a><span class="k">layout</span><span class="w"> </span><span class="p">(</span><span class="n">points</span><span class="p">)</span><span class="w"> </span><span class="k">in</span><span class="p">;</span>
<a id="__codelineno-43-4" name="__codelineno-43-4" href="#__codelineno-43-4"></a><span class="k">layout</span><span class="w"> </span><span class="p">(</span><span class="n">triangle_strip</span><span class="p">,</span><span class="w"> </span><span class="n">max_vertices</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">3</span><span class="p">)</span><span class="w"> </span><span class="k">out</span><span class="p">;</span>
<a id="__codelineno-43-5" name="__codelineno-43-5" href="#__codelineno-43-5"></a>
<a id="__codelineno-43-6" name="__codelineno-43-6" href="#__codelineno-43-6"></a><span class="k">uniform</span><span class="w"> </span><span class="kt">mat4</span><span class="w"> </span><span class="n">projection</span><span class="p">;</span>
<a id="__codelineno-43-7" name="__codelineno-43-7" href="#__codelineno-43-7"></a>
<a id="__codelineno-43-8" name="__codelineno-43-8" href="#__codelineno-43-8"></a><span class="kt">void</span><span class="w"> </span><span class="n">main</span><span class="p">()</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-43-9" name="__codelineno-43-9" href="#__codelineno-43-9"></a><span class="w">    </span><span class="kt">vec4</span><span class="w"> </span><span class="n">position</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nb">gl_in</span><span class="p">[</span><span class="mo">0</span><span class="p">].</span><span class="nb">gl_Position</span><span class="p">;</span>
<a id="__codelineno-43-10" name="__codelineno-43-10" href="#__codelineno-43-10"></a>
<a id="__codelineno-43-11" name="__codelineno-43-11" href="#__codelineno-43-11"></a><span class="w">    </span><span class="nb">gl_Position</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">projection</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="p">(</span><span class="n">position</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="kt">vec4</span><span class="p">(</span><span class="o">-</span><span class="mf">0.1</span><span class="p">,</span><span class="w"> </span><span class="o">-</span><span class="mf">0.1</span><span class="p">,</span><span class="w"> </span><span class="mf">0.0</span><span class="p">,</span><span class="w"> </span><span class="mf">0.0</span><span class="p">));</span>
<a id="__codelineno-43-12" name="__codelineno-43-12" href="#__codelineno-43-12"></a><span class="w">    </span><span class="n">EmitVertex</span><span class="p">();</span>
<a id="__codelineno-43-13" name="__codelineno-43-13" href="#__codelineno-43-13"></a>
<a id="__codelineno-43-14" name="__codelineno-43-14" href="#__codelineno-43-14"></a><span class="w">    </span><span class="nb">gl_Position</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">projection</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="p">(</span><span class="n">position</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="kt">vec4</span><span class="p">(</span><span class="mf">0.1</span><span class="p">,</span><span class="w"> </span><span class="o">-</span><span class="mf">0.1</span><span class="p">,</span><span class="w"> </span><span class="mf">0.0</span><span class="p">,</span><span class="w"> </span><span class="mf">0.0</span><span class="p">));</span>
<a id="__codelineno-43-15" name="__codelineno-43-15" href="#__codelineno-43-15"></a><span class="w">    </span><span class="n">EmitVertex</span><span class="p">();</span>
<a id="__codelineno-43-16" name="__codelineno-43-16" href="#__codelineno-43-16"></a>
<a id="__codelineno-43-17" name="__codelineno-43-17" href="#__codelineno-43-17"></a><span class="w">    </span><span class="nb">gl_Position</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">projection</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="p">(</span><span class="n">position</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="kt">vec4</span><span class="p">(</span><span class="mf">0.0</span><span class="p">,</span><span class="w"> </span><span class="mf">0.1</span><span class="p">,</span><span class="w"> </span><span class="mf">0.0</span><span class="p">,</span><span class="w"> </span><span class="mf">0.0</span><span class="p">));</span>
<a id="__codelineno-43-18" name="__codelineno-43-18" href="#__codelineno-43-18"></a><span class="w">    </span><span class="n">EmitVertex</span><span class="p">();</span>
<a id="__codelineno-43-19" name="__codelineno-43-19" href="#__codelineno-43-19"></a>
<a id="__codelineno-43-20" name="__codelineno-43-20" href="#__codelineno-43-20"></a><span class="w">    </span><span class="n">EndPrimitive</span><span class="p">();</span>
<a id="__codelineno-43-21" name="__codelineno-43-21" href="#__codelineno-43-21"></a><span class="p">}</span>
</code></pre></div>
<p>This shader takes a point as input and generates a small triangle around it. The <code>EmitVertex()</code> function outputs a vertex, and <code>EndPrimitive()</code> finalizes the triangle.</p>
<p>Geometry shaders are particularly useful for:</p>
<ol>
<li>Particle systems: Generating billboards or complex particle shapes.</li>
<li>Dynamic level-of-detail: Adjusting mesh complexity based on camera distance.</li>
<li>Shadow volume generation: Creating geometry for shadow calculations.</li>
<li>Fur and grass rendering: Extruding surfaces to create natural-looking coverage.</li>
</ol>
<p>While powerful, geometry shaders should be used judiciously, as they can impact performance if overused. Modern alternatives like tessellation shaders and compute shaders can sometimes offer better performance for certain tasks.</p>
<p>Certainly. Compute shaders are a powerful tool in modern game development, allowing for general-purpose GPU computation. They're widely used for tasks that benefit from massive parallelism, such as particle systems, physics simulations, and post-processing effects.</p>
<p>Here's a professional explanation of compute shaders, followed by a practical example:</p>
<h4 id="overview">Overview</h4>
<p>Compute shaders are programs that run on the GPU outside the traditional graphics pipeline. They leverage the parallel processing power of GPUs for non-graphical tasks, enabling efficient execution of complex algorithms directly on graphics hardware.</p>
<p>Key features of compute shaders include:</p>
<ol>
<li>Flexible workload distribution via dispatch calls</li>
<li>Shared memory for inter-thread communication</li>
<li>Synchronization primitives for coordinated execution</li>
<li>Access to unordered storage and atomic operations</li>
</ol>
<p>Example: Particle System using Compute Shaders</p>
<p>Let's implement a simple particle system using compute shaders, a common technique in modern games. This example will update particle positions and velocities based on a simple physics model.</p>
<p>First, we'll define our particle structure and create buffers:</p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-44-1" name="__codelineno-44-1" href="#__codelineno-44-1"></a><span class="c1">// Particle.h</span>
<a id="__codelineno-44-2" name="__codelineno-44-2" href="#__codelineno-44-2"></a><span class="k">struct</span><span class="w"> </span><span class="nc">Particle</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-44-3" name="__codelineno-44-3" href="#__codelineno-44-3"></a><span class="w">    </span><span class="n">glm</span><span class="o">::</span><span class="n">vec4</span><span class="w"> </span><span class="n">position</span><span class="p">;</span>
<a id="__codelineno-44-4" name="__codelineno-44-4" href="#__codelineno-44-4"></a><span class="w">    </span><span class="n">glm</span><span class="o">::</span><span class="n">vec4</span><span class="w"> </span><span class="n">velocity</span><span class="p">;</span>
<a id="__codelineno-44-5" name="__codelineno-44-5" href="#__codelineno-44-5"></a><span class="w">    </span><span class="n">glm</span><span class="o">::</span><span class="n">vec4</span><span class="w"> </span><span class="n">color</span><span class="p">;</span>
<a id="__codelineno-44-6" name="__codelineno-44-6" href="#__codelineno-44-6"></a><span class="w">    </span><span class="kt">float</span><span class="w"> </span><span class="n">life</span><span class="p">;</span>
<a id="__codelineno-44-7" name="__codelineno-44-7" href="#__codelineno-44-7"></a><span class="p">};</span>
<a id="__codelineno-44-8" name="__codelineno-44-8" href="#__codelineno-44-8"></a>
<a id="__codelineno-44-9" name="__codelineno-44-9" href="#__codelineno-44-9"></a><span class="c1">// ParticleSystem.cpp</span>
<a id="__codelineno-44-10" name="__codelineno-44-10" href="#__codelineno-44-10"></a><span class="k">class</span><span class="w"> </span><span class="nc">ParticleSystem</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-44-11" name="__codelineno-44-11" href="#__codelineno-44-11"></a><span class="k">private</span><span class="o">:</span>
<a id="__codelineno-44-12" name="__codelineno-44-12" href="#__codelineno-44-12"></a><span class="w">    </span><span class="n">GLuint</span><span class="w"> </span><span class="n">particleBuffer</span><span class="p">;</span>
<a id="__codelineno-44-13" name="__codelineno-44-13" href="#__codelineno-44-13"></a><span class="w">    </span><span class="n">GLuint</span><span class="w"> </span><span class="n">computeProgram</span><span class="p">;</span>
<a id="__codelineno-44-14" name="__codelineno-44-14" href="#__codelineno-44-14"></a><span class="w">    </span><span class="k">const</span><span class="w"> </span><span class="kt">int</span><span class="w"> </span><span class="n">PARTICLE_COUNT</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">1000000</span><span class="p">;</span>
<a id="__codelineno-44-15" name="__codelineno-44-15" href="#__codelineno-44-15"></a>
<a id="__codelineno-44-16" name="__codelineno-44-16" href="#__codelineno-44-16"></a><span class="w">    </span><span class="kt">void</span><span class="w"> </span><span class="nf">CreateParticleBuffer</span><span class="p">()</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-44-17" name="__codelineno-44-17" href="#__codelineno-44-17"></a><span class="w">        </span><span class="n">std</span><span class="o">::</span><span class="n">vector</span><span class="o">&lt;</span><span class="n">Particle</span><span class="o">&gt;</span><span class="w"> </span><span class="n">initialParticles</span><span class="p">(</span><span class="n">PARTICLE_COUNT</span><span class="p">);</span>
<a id="__codelineno-44-18" name="__codelineno-44-18" href="#__codelineno-44-18"></a><span class="w">        </span><span class="c1">// Initialize particles...</span>
<a id="__codelineno-44-19" name="__codelineno-44-19" href="#__codelineno-44-19"></a>
<a id="__codelineno-44-20" name="__codelineno-44-20" href="#__codelineno-44-20"></a><span class="w">        </span><span class="n">glGenBuffers</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span><span class="w"> </span><span class="o">&amp;</span><span class="n">particleBuffer</span><span class="p">);</span>
<a id="__codelineno-44-21" name="__codelineno-44-21" href="#__codelineno-44-21"></a><span class="w">        </span><span class="n">glBindBuffer</span><span class="p">(</span><span class="n">GL_SHADER_STORAGE_BUFFER</span><span class="p">,</span><span class="w"> </span><span class="n">particleBuffer</span><span class="p">);</span>
<a id="__codelineno-44-22" name="__codelineno-44-22" href="#__codelineno-44-22"></a><span class="w">        </span><span class="n">glBufferData</span><span class="p">(</span><span class="n">GL_SHADER_STORAGE_BUFFER</span><span class="p">,</span><span class="w"> </span><span class="n">PARTICLE_COUNT</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="k">sizeof</span><span class="p">(</span><span class="n">Particle</span><span class="p">),</span><span class="w"> </span><span class="n">initialParticles</span><span class="p">.</span><span class="n">data</span><span class="p">(),</span><span class="w"> </span><span class="n">GL_DYNAMIC_DRAW</span><span class="p">);</span>
<a id="__codelineno-44-23" name="__codelineno-44-23" href="#__codelineno-44-23"></a><span class="w">        </span><span class="n">glBindBuffer</span><span class="p">(</span><span class="n">GL_SHADER_STORAGE_BUFFER</span><span class="p">,</span><span class="w"> </span><span class="mi">0</span><span class="p">);</span>
<a id="__codelineno-44-24" name="__codelineno-44-24" href="#__codelineno-44-24"></a><span class="w">    </span><span class="p">}</span>
<a id="__codelineno-44-25" name="__codelineno-44-25" href="#__codelineno-44-25"></a>
<a id="__codelineno-44-26" name="__codelineno-44-26" href="#__codelineno-44-26"></a><span class="w">    </span><span class="kt">void</span><span class="w"> </span><span class="nf">CreateComputeShader</span><span class="p">()</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-44-27" name="__codelineno-44-27" href="#__codelineno-44-27"></a><span class="w">        </span><span class="c1">// Compile and link compute shader...</span>
<a id="__codelineno-44-28" name="__codelineno-44-28" href="#__codelineno-44-28"></a><span class="w">    </span><span class="p">}</span>
<a id="__codelineno-44-29" name="__codelineno-44-29" href="#__codelineno-44-29"></a>
<a id="__codelineno-44-30" name="__codelineno-44-30" href="#__codelineno-44-30"></a><span class="k">public</span><span class="o">:</span>
<a id="__codelineno-44-31" name="__codelineno-44-31" href="#__codelineno-44-31"></a><span class="w">    </span><span class="n">ParticleSystem</span><span class="p">()</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-44-32" name="__codelineno-44-32" href="#__codelineno-44-32"></a><span class="w">        </span><span class="n">CreateParticleBuffer</span><span class="p">();</span>
<a id="__codelineno-44-33" name="__codelineno-44-33" href="#__codelineno-44-33"></a><span class="w">        </span><span class="n">CreateComputeShader</span><span class="p">();</span>
<a id="__codelineno-44-34" name="__codelineno-44-34" href="#__codelineno-44-34"></a><span class="w">    </span><span class="p">}</span>
<a id="__codelineno-44-35" name="__codelineno-44-35" href="#__codelineno-44-35"></a>
<a id="__codelineno-44-36" name="__codelineno-44-36" href="#__codelineno-44-36"></a><span class="w">    </span><span class="kt">void</span><span class="w"> </span><span class="n">Update</span><span class="p">(</span><span class="kt">float</span><span class="w"> </span><span class="n">deltaTime</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-44-37" name="__codelineno-44-37" href="#__codelineno-44-37"></a><span class="w">        </span><span class="n">glUseProgram</span><span class="p">(</span><span class="n">computeProgram</span><span class="p">);</span>
<a id="__codelineno-44-38" name="__codelineno-44-38" href="#__codelineno-44-38"></a><span class="w">        </span><span class="n">glBindBufferBase</span><span class="p">(</span><span class="n">GL_SHADER_STORAGE_BUFFER</span><span class="p">,</span><span class="w"> </span><span class="mi">0</span><span class="p">,</span><span class="w"> </span><span class="n">particleBuffer</span><span class="p">);</span>
<a id="__codelineno-44-39" name="__codelineno-44-39" href="#__codelineno-44-39"></a>
<a id="__codelineno-44-40" name="__codelineno-44-40" href="#__codelineno-44-40"></a><span class="w">        </span><span class="n">glUniform1f</span><span class="p">(</span><span class="n">glGetUniformLocation</span><span class="p">(</span><span class="n">computeProgram</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;deltaTime&quot;</span><span class="p">),</span><span class="w"> </span><span class="n">deltaTime</span><span class="p">);</span>
<a id="__codelineno-44-41" name="__codelineno-44-41" href="#__codelineno-44-41"></a>
<a id="__codelineno-44-42" name="__codelineno-44-42" href="#__codelineno-44-42"></a><span class="w">        </span><span class="n">glDispatchCompute</span><span class="p">(</span><span class="n">PARTICLE_COUNT</span><span class="w"> </span><span class="o">/</span><span class="w"> </span><span class="mi">256</span><span class="p">,</span><span class="w"> </span><span class="mi">1</span><span class="p">,</span><span class="w"> </span><span class="mi">1</span><span class="p">);</span>
<a id="__codelineno-44-43" name="__codelineno-44-43" href="#__codelineno-44-43"></a><span class="w">        </span><span class="n">glMemoryBarrier</span><span class="p">(</span><span class="n">GL_SHADER_STORAGE_BARRIER_BIT</span><span class="p">);</span>
<a id="__codelineno-44-44" name="__codelineno-44-44" href="#__codelineno-44-44"></a><span class="w">    </span><span class="p">}</span>
<a id="__codelineno-44-45" name="__codelineno-44-45" href="#__codelineno-44-45"></a>
<a id="__codelineno-44-46" name="__codelineno-44-46" href="#__codelineno-44-46"></a><span class="w">    </span><span class="kt">void</span><span class="w"> </span><span class="n">Render</span><span class="p">()</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-44-47" name="__codelineno-44-47" href="#__codelineno-44-47"></a><span class="w">        </span><span class="c1">// Render particles using instanced rendering...</span>
<a id="__codelineno-44-48" name="__codelineno-44-48" href="#__codelineno-44-48"></a><span class="w">    </span><span class="p">}</span>
<a id="__codelineno-44-49" name="__codelineno-44-49" href="#__codelineno-44-49"></a><span class="p">};</span>
</code></pre></div>
<p>Now, let's implement the compute shader:</p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-45-1" name="__codelineno-45-1" href="#__codelineno-45-1"></a><span class="cp">#version 430 core</span>
<a id="__codelineno-45-2" name="__codelineno-45-2" href="#__codelineno-45-2"></a>
<a id="__codelineno-45-3" name="__codelineno-45-3" href="#__codelineno-45-3"></a><span class="k">struct</span><span class="w"> </span><span class="n">Particle</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-45-4" name="__codelineno-45-4" href="#__codelineno-45-4"></a><span class="w">    </span><span class="kt">vec4</span><span class="w"> </span><span class="n">position</span><span class="p">;</span>
<a id="__codelineno-45-5" name="__codelineno-45-5" href="#__codelineno-45-5"></a><span class="w">    </span><span class="kt">vec4</span><span class="w"> </span><span class="n">velocity</span><span class="p">;</span>
<a id="__codelineno-45-6" name="__codelineno-45-6" href="#__codelineno-45-6"></a><span class="w">    </span><span class="kt">vec4</span><span class="w"> </span><span class="n">color</span><span class="p">;</span>
<a id="__codelineno-45-7" name="__codelineno-45-7" href="#__codelineno-45-7"></a><span class="w">    </span><span class="kt">float</span><span class="w"> </span><span class="n">life</span><span class="p">;</span>
<a id="__codelineno-45-8" name="__codelineno-45-8" href="#__codelineno-45-8"></a><span class="p">};</span>
<a id="__codelineno-45-9" name="__codelineno-45-9" href="#__codelineno-45-9"></a>
<a id="__codelineno-45-10" name="__codelineno-45-10" href="#__codelineno-45-10"></a><span class="k">layout</span><span class="p">(</span><span class="n">std430</span><span class="p">,</span><span class="w"> </span><span class="n">binding</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mo">0</span><span class="p">)</span><span class="w"> </span><span class="k">buffer</span><span class="w"> </span><span class="n">ParticleBuffer</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-45-11" name="__codelineno-45-11" href="#__codelineno-45-11"></a><span class="w">    </span><span class="n">Particle</span><span class="w"> </span><span class="n">particles</span><span class="p">[];</span>
<a id="__codelineno-45-12" name="__codelineno-45-12" href="#__codelineno-45-12"></a><span class="p">};</span>
<a id="__codelineno-45-13" name="__codelineno-45-13" href="#__codelineno-45-13"></a>
<a id="__codelineno-45-14" name="__codelineno-45-14" href="#__codelineno-45-14"></a><span class="k">uniform</span><span class="w"> </span><span class="kt">float</span><span class="w"> </span><span class="n">deltaTime</span><span class="p">;</span>
<a id="__codelineno-45-15" name="__codelineno-45-15" href="#__codelineno-45-15"></a>
<a id="__codelineno-45-16" name="__codelineno-45-16" href="#__codelineno-45-16"></a><span class="k">layout</span><span class="p">(</span><span class="n">local_size_x</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">256</span><span class="p">,</span><span class="w"> </span><span class="n">local_size_y</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">1</span><span class="p">,</span><span class="w"> </span><span class="n">local_size_z</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">1</span><span class="p">)</span><span class="w"> </span><span class="k">in</span><span class="p">;</span>
<a id="__codelineno-45-17" name="__codelineno-45-17" href="#__codelineno-45-17"></a>
<a id="__codelineno-45-18" name="__codelineno-45-18" href="#__codelineno-45-18"></a><span class="kt">void</span><span class="w"> </span><span class="n">main</span><span class="p">()</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-45-19" name="__codelineno-45-19" href="#__codelineno-45-19"></a><span class="w">    </span><span class="kt">uint</span><span class="w"> </span><span class="n">index</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nb">gl_GlobalInvocationID</span><span class="p">.</span><span class="n">x</span><span class="p">;</span>
<a id="__codelineno-45-20" name="__codelineno-45-20" href="#__codelineno-45-20"></a><span class="w">    </span><span class="n">Particle</span><span class="w"> </span><span class="n">particle</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">particles</span><span class="p">[</span><span class="n">index</span><span class="p">];</span>
<a id="__codelineno-45-21" name="__codelineno-45-21" href="#__codelineno-45-21"></a>
<a id="__codelineno-45-22" name="__codelineno-45-22" href="#__codelineno-45-22"></a><span class="w">    </span><span class="c1">// Update position</span>
<a id="__codelineno-45-23" name="__codelineno-45-23" href="#__codelineno-45-23"></a><span class="w">    </span><span class="n">particle</span><span class="p">.</span><span class="n">position</span><span class="p">.</span><span class="n">xyz</span><span class="w"> </span><span class="o">+=</span><span class="w"> </span><span class="n">particle</span><span class="p">.</span><span class="n">velocity</span><span class="p">.</span><span class="n">xyz</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="n">deltaTime</span><span class="p">;</span>
<a id="__codelineno-45-24" name="__codelineno-45-24" href="#__codelineno-45-24"></a>
<a id="__codelineno-45-25" name="__codelineno-45-25" href="#__codelineno-45-25"></a><span class="w">    </span><span class="c1">// Apply gravity</span>
<a id="__codelineno-45-26" name="__codelineno-45-26" href="#__codelineno-45-26"></a><span class="w">    </span><span class="n">particle</span><span class="p">.</span><span class="n">velocity</span><span class="p">.</span><span class="n">y</span><span class="w"> </span><span class="o">-=</span><span class="w"> </span><span class="mf">9.8</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="n">deltaTime</span><span class="p">;</span>
<a id="__codelineno-45-27" name="__codelineno-45-27" href="#__codelineno-45-27"></a>
<a id="__codelineno-45-28" name="__codelineno-45-28" href="#__codelineno-45-28"></a><span class="w">    </span><span class="c1">// Update life</span>
<a id="__codelineno-45-29" name="__codelineno-45-29" href="#__codelineno-45-29"></a><span class="w">    </span><span class="n">particle</span><span class="p">.</span><span class="n">life</span><span class="w"> </span><span class="o">-=</span><span class="w"> </span><span class="n">deltaTime</span><span class="p">;</span>
<a id="__codelineno-45-30" name="__codelineno-45-30" href="#__codelineno-45-30"></a>
<a id="__codelineno-45-31" name="__codelineno-45-31" href="#__codelineno-45-31"></a><span class="w">    </span><span class="c1">// Reset dead particles</span>
<a id="__codelineno-45-32" name="__codelineno-45-32" href="#__codelineno-45-32"></a><span class="w">    </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">particle</span><span class="p">.</span><span class="n">life</span><span class="w"> </span><span class="o">&lt;=</span><span class="w"> </span><span class="mf">0.0</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-45-33" name="__codelineno-45-33" href="#__codelineno-45-33"></a><span class="w">        </span><span class="n">particle</span><span class="p">.</span><span class="n">position</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="kt">vec4</span><span class="p">(</span><span class="mf">0.0</span><span class="p">,</span><span class="w"> </span><span class="mf">0.0</span><span class="p">,</span><span class="w"> </span><span class="mf">0.0</span><span class="p">,</span><span class="w"> </span><span class="mf">1.0</span><span class="p">);</span>
<a id="__codelineno-45-34" name="__codelineno-45-34" href="#__codelineno-45-34"></a><span class="w">        </span><span class="n">particle</span><span class="p">.</span><span class="n">velocity</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="kt">vec4</span><span class="p">(</span>
<a id="__codelineno-45-35" name="__codelineno-45-35" href="#__codelineno-45-35"></a><span class="w">            </span><span class="p">(</span><span class="n">random</span><span class="p">(</span><span class="n">index</span><span class="p">)</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="mf">0.5</span><span class="p">)</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="mf">2.0</span><span class="p">,</span>
<a id="__codelineno-45-36" name="__codelineno-45-36" href="#__codelineno-45-36"></a><span class="w">            </span><span class="n">random</span><span class="p">(</span><span class="n">index</span><span class="p">)</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="mf">5.0</span><span class="p">,</span>
<a id="__codelineno-45-37" name="__codelineno-45-37" href="#__codelineno-45-37"></a><span class="w">            </span><span class="p">(</span><span class="n">random</span><span class="p">(</span><span class="n">index</span><span class="p">)</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="mf">0.5</span><span class="p">)</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="mf">2.0</span><span class="p">,</span>
<a id="__codelineno-45-38" name="__codelineno-45-38" href="#__codelineno-45-38"></a><span class="w">            </span><span class="mf">0.0</span>
<a id="__codelineno-45-39" name="__codelineno-45-39" href="#__codelineno-45-39"></a><span class="w">        </span><span class="p">);</span>
<a id="__codelineno-45-40" name="__codelineno-45-40" href="#__codelineno-45-40"></a><span class="w">        </span><span class="n">particle</span><span class="p">.</span><span class="n">color</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="kt">vec4</span><span class="p">(</span><span class="n">random</span><span class="p">(</span><span class="n">index</span><span class="p">),</span><span class="w"> </span><span class="n">random</span><span class="p">(</span><span class="n">index</span><span class="p">),</span><span class="w"> </span><span class="n">random</span><span class="p">(</span><span class="n">index</span><span class="p">),</span><span class="w"> </span><span class="mf">1.0</span><span class="p">);</span>
<a id="__codelineno-45-41" name="__codelineno-45-41" href="#__codelineno-45-41"></a><span class="w">        </span><span class="n">particle</span><span class="p">.</span><span class="n">life</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mf">5.0</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="n">random</span><span class="p">(</span><span class="n">index</span><span class="p">)</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="mf">5.0</span><span class="p">;</span>
<a id="__codelineno-45-42" name="__codelineno-45-42" href="#__codelineno-45-42"></a><span class="w">    </span><span class="p">}</span>
<a id="__codelineno-45-43" name="__codelineno-45-43" href="#__codelineno-45-43"></a>
<a id="__codelineno-45-44" name="__codelineno-45-44" href="#__codelineno-45-44"></a><span class="w">    </span><span class="n">particles</span><span class="p">[</span><span class="n">index</span><span class="p">]</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">particle</span><span class="p">;</span>
<a id="__codelineno-45-45" name="__codelineno-45-45" href="#__codelineno-45-45"></a><span class="p">}</span>
<a id="__codelineno-45-46" name="__codelineno-45-46" href="#__codelineno-45-46"></a>
<a id="__codelineno-45-47" name="__codelineno-45-47" href="#__codelineno-45-47"></a><span class="kt">float</span><span class="w"> </span><span class="n">random</span><span class="p">(</span><span class="kt">uint</span><span class="w"> </span><span class="n">seed</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-45-48" name="__codelineno-45-48" href="#__codelineno-45-48"></a><span class="w">    </span><span class="k">return</span><span class="w"> </span><span class="n">fract</span><span class="p">(</span><span class="n">sin</span><span class="p">(</span><span class="kt">float</span><span class="p">(</span><span class="n">seed</span><span class="p">)</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="mf">78.233</span><span class="p">)</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="mf">43758.5453</span><span class="p">);</span>
<a id="__codelineno-45-49" name="__codelineno-45-49" href="#__codelineno-45-49"></a><span class="p">}</span>
</code></pre></div>
<p>This compute shader updates each particle's position based on its velocity, applies gravity, and resets particles when their life expires. The <code>random</code> function provides a simple way to generate pseudo-random numbers for particle initialization.</p>
<p>To use this particle system:</p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-46-1" name="__codelineno-46-1" href="#__codelineno-46-1"></a><span class="n">ParticleSystem</span><span class="w"> </span><span class="n">particleSystem</span><span class="p">;</span>
<a id="__codelineno-46-2" name="__codelineno-46-2" href="#__codelineno-46-2"></a>
<a id="__codelineno-46-3" name="__codelineno-46-3" href="#__codelineno-46-3"></a><span class="kt">void</span><span class="w"> </span><span class="nf">GameLoop</span><span class="p">()</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-46-4" name="__codelineno-46-4" href="#__codelineno-46-4"></a><span class="w">    </span><span class="k">while</span><span class="w"> </span><span class="p">(</span><span class="n">running</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-46-5" name="__codelineno-46-5" href="#__codelineno-46-5"></a><span class="w">        </span><span class="kt">float</span><span class="w"> </span><span class="n">deltaTime</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">CalculateDeltaTime</span><span class="p">();</span>
<a id="__codelineno-46-6" name="__codelineno-46-6" href="#__codelineno-46-6"></a><span class="w">        </span><span class="n">particleSystem</span><span class="p">.</span><span class="n">Update</span><span class="p">(</span><span class="n">deltaTime</span><span class="p">);</span>
<a id="__codelineno-46-7" name="__codelineno-46-7" href="#__codelineno-46-7"></a><span class="w">        </span><span class="n">particleSystem</span><span class="p">.</span><span class="n">Render</span><span class="p">();</span>
<a id="__codelineno-46-8" name="__codelineno-46-8" href="#__codelineno-46-8"></a><span class="w">        </span><span class="c1">// Other game logic...</span>
<a id="__codelineno-46-9" name="__codelineno-46-9" href="#__codelineno-46-9"></a><span class="w">    </span><span class="p">}</span>
<a id="__codelineno-46-10" name="__codelineno-46-10" href="#__codelineno-46-10"></a><span class="p">}</span>
</code></pre></div>
<p>This example demonstrates how compute shaders can efficiently manage large numbers of particles, a common requirement in modern games. By offloading particle updates to the GPU, we can handle millions of particles in real-time, creating rich, dynamic visual effects.</p>
<h3 id="compute-shaders">Compute Shaders</h3>
<p>Compute shaders are designed for general-purpose computing on the GPU. They do not operate within the traditional graphics pipeline and can be used for tasks such as physics simulations, image processing, or any parallel computation.</p>
<ul>
<li><strong>Purpose:</strong> Perform general-purpose computations using the GPU's parallel processing power.</li>
<li><strong>Input:</strong> Custom data structures and textures.</li>
<li>
<p><strong>Output:</strong> Custom data structures, textures, or other buffers.</p>
</li>
<li>
<p><strong>Example:</strong> Simple compute shader in GLSL that performs element-wise addition of two arrays.</p>
</li>
</ul>
<div class="highlight"><pre><span></span><code><a id="__codelineno-47-1" name="__codelineno-47-1" href="#__codelineno-47-1"></a><span class="cp">#version 430 core</span>
<a id="__codelineno-47-2" name="__codelineno-47-2" href="#__codelineno-47-2"></a>
<a id="__codelineno-47-3" name="__codelineno-47-3" href="#__codelineno-47-3"></a><span class="k">layout</span><span class="p">(</span><span class="n">local_size_x</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">16</span><span class="p">,</span><span class="w"> </span><span class="n">local_size_y</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">16</span><span class="p">)</span><span class="w"> </span><span class="k">in</span><span class="p">;</span>
<a id="__codelineno-47-4" name="__codelineno-47-4" href="#__codelineno-47-4"></a>
<a id="__codelineno-47-5" name="__codelineno-47-5" href="#__codelineno-47-5"></a><span class="k">layout</span><span class="p">(</span><span class="n">std430</span><span class="p">,</span><span class="w"> </span><span class="n">binding</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mo">0</span><span class="p">)</span><span class="w"> </span><span class="k">buffer</span><span class="w"> </span><span class="n">InputA</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-47-6" name="__codelineno-47-6" href="#__codelineno-47-6"></a><span class="w">    </span><span class="kt">float</span><span class="w"> </span><span class="n">A</span><span class="p">[];</span>
<a id="__codelineno-47-7" name="__codelineno-47-7" href="#__codelineno-47-7"></a><span class="p">};</span>
<a id="__codelineno-47-8" name="__codelineno-47-8" href="#__codelineno-47-8"></a>
<a id="__codelineno-47-9" name="__codelineno-47-9" href="#__codelineno-47-9"></a><span class="k">layout</span><span class="p">(</span><span class="n">std430</span><span class="p">,</span><span class="w"> </span><span class="n">binding</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">1</span><span class="p">)</span><span class="w"> </span><span class="k">buffer</span><span class="w"> </span><span class="n">InputB</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-47-10" name="__codelineno-47-10" href="#__codelineno-47-10"></a><span class="w">    </span><span class="kt">float</span><span class="w"> </span><span class="n">B</span><span class="p">[];</span>
<a id="__codelineno-47-11" name="__codelineno-47-11" href="#__codelineno-47-11"></a><span class="p">};</span>
<a id="__codelineno-47-12" name="__codelineno-47-12" href="#__codelineno-47-12"></a>
<a id="__codelineno-47-13" name="__codelineno-47-13" href="#__codelineno-47-13"></a><span class="k">layout</span><span class="p">(</span><span class="n">std430</span><span class="p">,</span><span class="w"> </span><span class="n">binding</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">2</span><span class="p">)</span><span class="w"> </span><span class="k">buffer</span><span class="w"> </span><span class="n">Output</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-47-14" name="__codelineno-47-14" href="#__codelineno-47-14"></a><span class="w">    </span><span class="kt">float</span><span class="w"> </span><span class="n">C</span><span class="p">[];</span>
<a id="__codelineno-47-15" name="__codelineno-47-15" href="#__codelineno-47-15"></a><span class="p">};</span>
<a id="__codelineno-47-16" name="__codelineno-47-16" href="#__codelineno-47-16"></a>
<a id="__codelineno-47-17" name="__codelineno-47-17" href="#__codelineno-47-17"></a><span class="kt">void</span><span class="w"> </span><span class="n">main</span><span class="p">()</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-47-18" name="__codelineno-47-18" href="#__codelineno-47-18"></a><span class="w">    </span><span class="kt">uint</span><span class="w"> </span><span class="n">index</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nb">gl_GlobalInvocationID</span><span class="p">.</span><span class="n">x</span><span class="p">;</span>
<a id="__codelineno-47-19" name="__codelineno-47-19" href="#__codelineno-47-19"></a><span class="w">    </span><span class="n">C</span><span class="p">[</span><span class="n">index</span><span class="p">]</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">A</span><span class="p">[</span><span class="n">index</span><span class="p">]</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="n">B</span><span class="p">[</span><span class="n">index</span><span class="p">];</span>
<a id="__codelineno-47-20" name="__codelineno-47-20" href="#__codelineno-47-20"></a><span class="p">}</span>
</code></pre></div>
<p>In this example, the compute shader adds corresponding elements of two input arrays and stores the result in an output array.</p>
<p>By understanding and utilizing these various types of shaders, developers can create more advanced and optimized graphics applications, leveraging the full power of modern GPUs.</p>
<h2 id="lighting-and-shadows">Lighting and Shadows</h2>
<h3 id="types-of-lights">Types of Lights</h3>
<p><strong>1. Point Light:</strong></p>
<p>A point light emits light in all directions from a single point in space, similar to how a light bulb works.</p>
<ul>
<li>
<p><strong>Properties:</strong></p>
<ul>
<li><strong>Position:</strong> The location of the light source in 3D space.</li>
<li><strong>Intensity:</strong> The brightness of the light.</li>
<li><strong>Attenuation:</strong> The decrease in intensity over distance, typically defined by constant, linear, and quadratic factors.</li>
<li><strong>Use Cases:</strong> Simulating small, localized light sources such as lamps, candles, or glowing objects.</li>
</ul>
</li>
</ul>
<p><strong>Example:</strong>
<div class="highlight"><pre><span></span><code><a id="__codelineno-48-1" name="__codelineno-48-1" href="#__codelineno-48-1"></a><span class="c1">// GLSL fragment shader example for point light</span>
<a id="__codelineno-48-2" name="__codelineno-48-2" href="#__codelineno-48-2"></a><span class="n">vec3</span><span class="w"> </span><span class="nf">calculatePointLight</span><span class="p">(</span><span class="n">PointLight</span><span class="w"> </span><span class="n">light</span><span class="p">,</span><span class="w"> </span><span class="n">vec3</span><span class="w"> </span><span class="n">normal</span><span class="p">,</span><span class="w"> </span><span class="n">vec3</span><span class="w"> </span><span class="n">fragPos</span><span class="p">,</span><span class="w"> </span><span class="n">vec3</span><span class="w"> </span><span class="n">viewDir</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-48-3" name="__codelineno-48-3" href="#__codelineno-48-3"></a><span class="w">    </span><span class="n">vec3</span><span class="w"> </span><span class="n">lightDir</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">normalize</span><span class="p">(</span><span class="n">light</span><span class="p">.</span><span class="n">position</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="n">fragPos</span><span class="p">);</span>
<a id="__codelineno-48-4" name="__codelineno-48-4" href="#__codelineno-48-4"></a><span class="w">    </span><span class="kt">float</span><span class="w"> </span><span class="n">diff</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">max</span><span class="p">(</span><span class="n">dot</span><span class="p">(</span><span class="n">normal</span><span class="p">,</span><span class="w"> </span><span class="n">lightDir</span><span class="p">),</span><span class="w"> </span><span class="mf">0.0</span><span class="p">);</span>
<a id="__codelineno-48-5" name="__codelineno-48-5" href="#__codelineno-48-5"></a>
<a id="__codelineno-48-6" name="__codelineno-48-6" href="#__codelineno-48-6"></a><span class="w">    </span><span class="n">vec3</span><span class="w"> </span><span class="n">reflectDir</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">reflect</span><span class="p">(</span><span class="o">-</span><span class="n">lightDir</span><span class="p">,</span><span class="w"> </span><span class="n">normal</span><span class="p">);</span>
<a id="__codelineno-48-7" name="__codelineno-48-7" href="#__codelineno-48-7"></a><span class="w">    </span><span class="kt">float</span><span class="w"> </span><span class="n">spec</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">pow</span><span class="p">(</span><span class="n">max</span><span class="p">(</span><span class="n">dot</span><span class="p">(</span><span class="n">viewDir</span><span class="p">,</span><span class="w"> </span><span class="n">reflectDir</span><span class="p">),</span><span class="w"> </span><span class="mf">0.0</span><span class="p">),</span><span class="w"> </span><span class="n">material</span><span class="p">.</span><span class="n">shininess</span><span class="p">);</span>
<a id="__codelineno-48-8" name="__codelineno-48-8" href="#__codelineno-48-8"></a>
<a id="__codelineno-48-9" name="__codelineno-48-9" href="#__codelineno-48-9"></a><span class="w">    </span><span class="kt">float</span><span class="w"> </span><span class="n">distance</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">length</span><span class="p">(</span><span class="n">light</span><span class="p">.</span><span class="n">position</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="n">fragPos</span><span class="p">);</span>
<a id="__codelineno-48-10" name="__codelineno-48-10" href="#__codelineno-48-10"></a><span class="w">    </span><span class="kt">float</span><span class="w"> </span><span class="n">attenuation</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mf">1.0</span><span class="w"> </span><span class="o">/</span><span class="w"> </span><span class="p">(</span><span class="n">light</span><span class="p">.</span><span class="n">constant</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="n">light</span><span class="p">.</span><span class="n">linear</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="n">distance</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="n">light</span><span class="p">.</span><span class="n">quadratic</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="p">(</span><span class="n">distance</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="n">distance</span><span class="p">));</span>
<a id="__codelineno-48-11" name="__codelineno-48-11" href="#__codelineno-48-11"></a>
<a id="__codelineno-48-12" name="__codelineno-48-12" href="#__codelineno-48-12"></a><span class="w">    </span><span class="n">vec3</span><span class="w"> </span><span class="n">ambient</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">light</span><span class="p">.</span><span class="n">ambient</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="n">vec3</span><span class="p">(</span><span class="n">texture</span><span class="p">(</span><span class="n">material</span><span class="p">.</span><span class="n">diffuse</span><span class="p">,</span><span class="w"> </span><span class="n">TexCoords</span><span class="p">));</span>
<a id="__codelineno-48-13" name="__codelineno-48-13" href="#__codelineno-48-13"></a><span class="w">    </span><span class="n">vec3</span><span class="w"> </span><span class="n">diffuse</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">light</span><span class="p">.</span><span class="n">diffuse</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="n">diff</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="n">vec3</span><span class="p">(</span><span class="n">texture</span><span class="p">(</span><span class="n">material</span><span class="p">.</span><span class="n">diffuse</span><span class="p">,</span><span class="w"> </span><span class="n">TexCoords</span><span class="p">));</span>
<a id="__codelineno-48-14" name="__codelineno-48-14" href="#__codelineno-48-14"></a><span class="w">    </span><span class="n">vec3</span><span class="w"> </span><span class="n">specular</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">light</span><span class="p">.</span><span class="n">specular</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="n">spec</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="n">vec3</span><span class="p">(</span><span class="n">texture</span><span class="p">(</span><span class="n">material</span><span class="p">.</span><span class="n">specular</span><span class="p">,</span><span class="w"> </span><span class="n">TexCoords</span><span class="p">));</span>
<a id="__codelineno-48-15" name="__codelineno-48-15" href="#__codelineno-48-15"></a>
<a id="__codelineno-48-16" name="__codelineno-48-16" href="#__codelineno-48-16"></a><span class="w">    </span><span class="n">ambient</span><span class="w"> </span><span class="o">*=</span><span class="w"> </span><span class="n">attenuation</span><span class="p">;</span>
<a id="__codelineno-48-17" name="__codelineno-48-17" href="#__codelineno-48-17"></a><span class="w">    </span><span class="n">diffuse</span><span class="w"> </span><span class="o">*=</span><span class="w"> </span><span class="n">attenuation</span><span class="p">;</span>
<a id="__codelineno-48-18" name="__codelineno-48-18" href="#__codelineno-48-18"></a><span class="w">    </span><span class="n">specular</span><span class="w"> </span><span class="o">*=</span><span class="w"> </span><span class="n">attenuation</span><span class="p">;</span>
<a id="__codelineno-48-19" name="__codelineno-48-19" href="#__codelineno-48-19"></a>
<a id="__codelineno-48-20" name="__codelineno-48-20" href="#__codelineno-48-20"></a><span class="w">    </span><span class="k">return</span><span class="w"> </span><span class="p">(</span><span class="n">ambient</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="n">diffuse</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="n">specular</span><span class="p">);</span>
<a id="__codelineno-48-21" name="__codelineno-48-21" href="#__codelineno-48-21"></a><span class="p">}</span>
</code></pre></div></p>
<p><strong>2. Directional Light:</strong></p>
<p>A directional light emits parallel light rays in a single direction, similar to how sunlight works.</p>
<ul>
<li>
<p><strong>Properties:</strong></p>
<ul>
<li><strong>Direction:</strong> The direction in which the light rays travel.</li>
<li><strong>Intensity:</strong> The brightness of the light.</li>
<li><strong>Use Cases:</strong> Simulating large, distant light sources such as the sun or moon.</li>
</ul>
</li>
</ul>
<p><strong>Example:</strong>
<div class="highlight"><pre><span></span><code><a id="__codelineno-49-1" name="__codelineno-49-1" href="#__codelineno-49-1"></a><span class="c1">// GLSL fragment shader example for directional light</span>
<a id="__codelineno-49-2" name="__codelineno-49-2" href="#__codelineno-49-2"></a><span class="n">vec3</span><span class="w"> </span><span class="nf">calculateDirectionalLight</span><span class="p">(</span><span class="n">DirectionalLight</span><span class="w"> </span><span class="n">light</span><span class="p">,</span><span class="w"> </span><span class="n">vec3</span><span class="w"> </span><span class="n">normal</span><span class="p">,</span><span class="w"> </span><span class="n">vec3</span><span class="w"> </span><span class="n">viewDir</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-49-3" name="__codelineno-49-3" href="#__codelineno-49-3"></a><span class="w">    </span><span class="n">vec3</span><span class="w"> </span><span class="n">lightDir</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">normalize</span><span class="p">(</span><span class="o">-</span><span class="n">light</span><span class="p">.</span><span class="n">direction</span><span class="p">);</span>
<a id="__codelineno-49-4" name="__codelineno-49-4" href="#__codelineno-49-4"></a><span class="w">    </span><span class="kt">float</span><span class="w"> </span><span class="n">diff</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">max</span><span class="p">(</span><span class="n">dot</span><span class="p">(</span><span class="n">normal</span><span class="p">,</span><span class="w"> </span><span class="n">lightDir</span><span class="p">),</span><span class="w"> </span><span class="mf">0.0</span><span class="p">);</span>
<a id="__codelineno-49-5" name="__codelineno-49-5" href="#__codelineno-49-5"></a>
<a id="__codelineno-49-6" name="__codelineno-49-6" href="#__codelineno-49-6"></a><span class="w">    </span><span class="n">vec3</span><span class="w"> </span><span class="n">reflectDir</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">reflect</span><span class="p">(</span><span class="o">-</span><span class="n">lightDir</span><span class="p">,</span><span class="w"> </span><span class="n">normal</span><span class="p">);</span>
<a id="__codelineno-49-7" name="__codelineno-49-7" href="#__codelineno-49-7"></a><span class="w">    </span><span class="kt">float</span><span class="w"> </span><span class="n">spec</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">pow</span><span class="p">(</span><span class="n">max</span><span class="p">(</span><span class="n">dot</span><span class="p">(</span><span class="n">viewDir</span><span class="p">,</span><span class="w"> </span><span class="n">reflectDir</span><span class="p">),</span><span class="w"> </span><span class="mf">0.0</span><span class="p">),</span><span class="w"> </span><span class="n">material</span><span class="p">.</span><span class="n">shininess</span><span class="p">);</span>
<a id="__codelineno-49-8" name="__codelineno-49-8" href="#__codelineno-49-8"></a>
<a id="__codelineno-49-9" name="__codelineno-49-9" href="#__codelineno-49-9"></a><span class="w">    </span><span class="n">vec3</span><span class="w"> </span><span class="n">ambient</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">light</span><span class="p">.</span><span class="n">ambient</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="n">vec3</span><span class="p">(</span><span class="n">texture</span><span class="p">(</span><span class="n">material</span><span class="p">.</span><span class="n">diffuse</span><span class="p">,</span><span class="w"> </span><span class="n">TexCoords</span><span class="p">));</span>
<a id="__codelineno-49-10" name="__codelineno-49-10" href="#__codelineno-49-10"></a><span class="w">    </span><span class="n">vec3</span><span class="w"> </span><span class="n">diffuse</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">light</span><span class="p">.</span><span class="n">diffuse</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="n">diff</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="n">vec3</span><span class="p">(</span><span class="n">texture</span><span class="p">(</span><span class="n">material</span><span class="p">.</span><span class="n">diffuse</span><span class="p">,</span><span class="w"> </span><span class="n">TexCoords</span><span class="p">));</span>
<a id="__codelineno-49-11" name="__codelineno-49-11" href="#__codelineno-49-11"></a><span class="w">    </span><span class="n">vec3</span><span class="w"> </span><span class="n">specular</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">light</span><span class="p">.</span><span class="n">specular</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="n">spec</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="n">vec3</span><span class="p">(</span><span class="n">texture</span><span class="p">(</span><span class="n">material</span><span class="p">.</span><span class="n">specular</span><span class="p">,</span><span class="w"> </span><span class="n">TexCoords</span><span class="p">));</span>
<a id="__codelineno-49-12" name="__codelineno-49-12" href="#__codelineno-49-12"></a>
<a id="__codelineno-49-13" name="__codelineno-49-13" href="#__codelineno-49-13"></a><span class="w">    </span><span class="k">return</span><span class="w"> </span><span class="p">(</span><span class="n">ambient</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="n">diffuse</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="n">specular</span><span class="p">);</span>
<a id="__codelineno-49-14" name="__codelineno-49-14" href="#__codelineno-49-14"></a><span class="p">}</span>
</code></pre></div></p>
<p><strong>3. Spot Light:</strong></p>
<p>A spot light emits light in a cone, similar to how a flashlight works.</p>
<ul>
<li>
<p><strong>Properties:</strong></p>
<ul>
<li><strong>Position:</strong> The location of the light source in 3D space.</li>
<li><strong>Direction:</strong> The direction in which the light is aimed.</li>
<li><strong>Cutoff Angles:</strong> The inner and outer angles that define the cone of light.</li>
<li><strong>Intensity:</strong> The brightness of the light.</li>
<li><strong>Attenuation:</strong> The decrease in intensity over distance.</li>
<li><strong>Use Cases:</strong> Simulating focused light sources such as flashlights, car headlights, or stage spotlights.</li>
</ul>
</li>
</ul>
<p><strong>Example:</strong>
<div class="highlight"><pre><span></span><code><a id="__codelineno-50-1" name="__codelineno-50-1" href="#__codelineno-50-1"></a><span class="c1">// GLSL fragment shader example for spot light</span>
<a id="__codelineno-50-2" name="__codelineno-50-2" href="#__codelineno-50-2"></a><span class="n">vec3</span><span class="w"> </span><span class="nf">calculateSpotLight</span><span class="p">(</span><span class="n">SpotLight</span><span class="w"> </span><span class="n">light</span><span class="p">,</span><span class="w"> </span><span class="n">vec3</span><span class="w"> </span><span class="n">normal</span><span class="p">,</span><span class="w"> </span><span class="n">vec3</span><span class="w"> </span><span class="n">fragPos</span><span class="p">,</span><span class="w"> </span><span class="n">vec3</span><span class="w"> </span><span class="n">viewDir</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-50-3" name="__codelineno-50-3" href="#__codelineno-50-3"></a><span class="w">    </span><span class="n">vec3</span><span class="w"> </span><span class="n">lightDir</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">normalize</span><span class="p">(</span><span class="n">light</span><span class="p">.</span><span class="n">position</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="n">fragPos</span><span class="p">);</span>
<a id="__codelineno-50-4" name="__codelineno-50-4" href="#__codelineno-50-4"></a><span class="w">    </span><span class="kt">float</span><span class="w"> </span><span class="n">diff</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">max</span><span class="p">(</span><span class="n">dot</span><span class="p">(</span><span class="n">normal</span><span class="p">,</span><span class="w"> </span><span class="n">lightDir</span><span class="p">),</span><span class="w"> </span><span class="mf">0.0</span><span class="p">);</span>
<a id="__codelineno-50-5" name="__codelineno-50-5" href="#__codelineno-50-5"></a>
<a id="__codelineno-50-6" name="__codelineno-50-6" href="#__codelineno-50-6"></a><span class="w">    </span><span class="n">vec3</span><span class="w"> </span><span class="n">reflectDir</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">reflect</span><span class="p">(</span><span class="o">-</span><span class="n">lightDir</span><span class="p">,</span><span class="w"> </span><span class="n">normal</span><span class="p">);</span>
<a id="__codelineno-50-7" name="__codelineno-50-7" href="#__codelineno-50-7"></a><span class="w">    </span><span class="kt">float</span><span class="w"> </span><span class="n">spec</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">pow</span><span class="p">(</span><span class="n">max</span><span class="p">(</span><span class="n">dot</span><span class="p">(</span><span class="n">viewDir</span><span class="p">,</span><span class="w"> </span><span class="n">reflectDir</span><span class="p">),</span><span class="w"> </span><span class="mf">0.0</span><span class="p">),</span><span class="w"> </span><span class="n">material</span><span class="p">.</span><span class="n">shininess</span><span class="p">);</span>
<a id="__codelineno-50-8" name="__codelineno-50-8" href="#__codelineno-50-8"></a>
<a id="__codelineno-50-9" name="__codelineno-50-9" href="#__codelineno-50-9"></a><span class="w">    </span><span class="kt">float</span><span class="w"> </span><span class="n">distance</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">length</span><span class="p">(</span><span class="n">light</span><span class="p">.</span><span class="n">position</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="n">fragPos</span><span class="p">);</span>
<a id="__codelineno-50-10" name="__codelineno-50-10" href="#__codelineno-50-10"></a><span class="w">    </span><span class="kt">float</span><span class="w"> </span><span class="n">attenuation</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mf">1.0</span><span class="w"> </span><span class="o">/</span><span class="w"> </span><span class="p">(</span><span class="n">light</span><span class="p">.</span><span class="n">constant</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="n">light</span><span class="p">.</span><span class="n">linear</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="n">distance</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="n">light</span><span class="p">.</span><span class="n">quadratic</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="p">(</span><span class="n">distance</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="n">distance</span><span class="p">));</span>
<a id="__codelineno-50-11" name="__codelineno-50-11" href="#__codelineno-50-11"></a>
<a id="__codelineno-50-12" name="__codelineno-50-12" href="#__codelineno-50-12"></a><span class="w">    </span><span class="kt">float</span><span class="w"> </span><span class="n">theta</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">dot</span><span class="p">(</span><span class="n">lightDir</span><span class="p">,</span><span class="w"> </span><span class="n">normalize</span><span class="p">(</span><span class="o">-</span><span class="n">light</span><span class="p">.</span><span class="n">direction</span><span class="p">));</span>
<a id="__codelineno-50-13" name="__codelineno-50-13" href="#__codelineno-50-13"></a><span class="w">    </span><span class="kt">float</span><span class="w"> </span><span class="n">epsilon</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">light</span><span class="p">.</span><span class="n">cutOff</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="n">light</span><span class="p">.</span><span class="n">outerCutOff</span><span class="p">;</span>
<a id="__codelineno-50-14" name="__codelineno-50-14" href="#__codelineno-50-14"></a><span class="w">    </span><span class="kt">float</span><span class="w"> </span><span class="n">intensity</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">clamp</span><span class="p">((</span><span class="n">theta</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="n">light</span><span class="p">.</span><span class="n">outerCutOff</span><span class="p">)</span><span class="w"> </span><span class="o">/</span><span class="w"> </span><span class="n">epsilon</span><span class="p">,</span><span class="w"> </span><span class="mf">0.0</span><span class="p">,</span><span class="w"> </span><span class="mf">1.0</span><span class="p">);</span>
<a id="__codelineno-50-15" name="__codelineno-50-15" href="#__codelineno-50-15"></a>
<a id="__codelineno-50-16" name="__codelineno-50-16" href="#__codelineno-50-16"></a><span class="w">    </span><span class="n">vec3</span><span class="w"> </span><span class="n">ambient</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">light</span><span class="p">.</span><span class="n">ambient</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="n">vec3</span><span class="p">(</span><span class="n">texture</span><span class="p">(</span><span class="n">material</span><span class="p">.</span><span class="n">diffuse</span><span class="p">,</span><span class="w"> </span><span class="n">TexCoords</span><span class="p">));</span>
<a id="__codelineno-50-17" name="__codelineno-50-17" href="#__codelineno-50-17"></a><span class="w">    </span><span class="n">vec3</span><span class="w"> </span><span class="n">diffuse</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">light</span><span class="p">.</span><span class="n">diffuse</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="n">diff</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="n">vec3</span><span class="p">(</span><span class="n">texture</span><span class="p">(</span><span class="n">material</span><span class="p">.</span><span class="n">diffuse</span><span class="p">,</span><span class="w"> </span><span class="n">TexCoords</span><span class="p">));</span>
<a id="__codelineno-50-18" name="__codelineno-50-18" href="#__codelineno-50-18"></a><span class="w">    </span><span class="n">vec3</span><span class="w"> </span><span class="n">specular</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">light</span><span class="p">.</span><span class="n">specular</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="n">spec</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="n">vec3</span><span class="p">(</span><span class="n">texture</span><span class="p">(</span><span class="n">material</span><span class="p">.</span><span class="n">specular</span><span class="p">,</span><span class="w"> </span><span class="n">TexCoords</span><span class="p">));</span>
<a id="__codelineno-50-19" name="__codelineno-50-19" href="#__codelineno-50-19"></a>
<a id="__codelineno-50-20" name="__codelineno-50-20" href="#__codelineno-50-20"></a><span class="w">    </span><span class="n">ambient</span><span class="w"> </span><span class="o">*=</span><span class="w"> </span><span class="n">attenuation</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="n">intensity</span><span class="p">;</span>
<a id="__codelineno-50-21" name="__codelineno-50-21" href="#__codelineno-50-21"></a><span class="w">    </span><span class="n">diffuse</span><span class="w"> </span><span class="o">*=</span><span class="w"> </span><span class="n">attenuation</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="n">intensity</span><span class="p">;</span>
<a id="__codelineno-50-22" name="__codelineno-50-22" href="#__codelineno-50-22"></a><span class="w">    </span><span class="n">specular</span><span class="w"> </span><span class="o">*=</span><span class="w"> </span><span class="n">attenuation</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="n">intensity</span><span class="p">;</span>
<a id="__codelineno-50-23" name="__codelineno-50-23" href="#__codelineno-50-23"></a>
<a id="__codelineno-50-24" name="__codelineno-50-24" href="#__codelineno-50-24"></a><span class="w">    </span><span class="k">return</span><span class="w"> </span><span class="p">(</span><span class="n">ambient</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="n">diffuse</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="n">specular</span><span class="p">);</span>
<a id="__codelineno-50-25" name="__codelineno-50-25" href="#__codelineno-50-25"></a><span class="p">}</span>
</code></pre></div></p>
<h3 id="shadow-mapping">Shadow Mapping</h3>
<p>Shadow mapping is a crucial technique in real-time rendering that generates dynamic shadows for 3D scenes. It works by rendering the scene from the light's perspective and using that information to determine which areas are in shadow when rendering from the camera's view.</p>
<h4 id="implementation-overview_3">Implementation Overview</h4>
<p>We'll implement a basic shadow mapping system with PCF (Percentage Closer Filtering) for smoother shadow edges. This implementation will use two passes: one for generating the shadow map and another for rendering the scene with shadows.</p>
<p>Key Components:</p>
<ol>
<li>Shadow map generation pass</li>
<li>Scene rendering pass with shadow application</li>
<li>PCF filtering for shadow smoothing</li>
</ol>
<p>Here's a professional-grade C++ implementation using a modern graphics API:</p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-51-1" name="__codelineno-51-1" href="#__codelineno-51-1"></a><span class="c1">// ShadowMapping.h</span>
<a id="__codelineno-51-2" name="__codelineno-51-2" href="#__codelineno-51-2"></a><span class="cp">#pragma once</span>
<a id="__codelineno-51-3" name="__codelineno-51-3" href="#__codelineno-51-3"></a>
<a id="__codelineno-51-4" name="__codelineno-51-4" href="#__codelineno-51-4"></a><span class="cp">#include</span><span class="w"> </span><span class="cpf">&quot;RenderSystem.h&quot;</span>
<a id="__codelineno-51-5" name="__codelineno-51-5" href="#__codelineno-51-5"></a><span class="cp">#include</span><span class="w"> </span><span class="cpf">&quot;Shader.h&quot;</span>
<a id="__codelineno-51-6" name="__codelineno-51-6" href="#__codelineno-51-6"></a><span class="cp">#include</span><span class="w"> </span><span class="cpf">&quot;RenderTexture.h&quot;</span>
<a id="__codelineno-51-7" name="__codelineno-51-7" href="#__codelineno-51-7"></a>
<a id="__codelineno-51-8" name="__codelineno-51-8" href="#__codelineno-51-8"></a><span class="k">class</span><span class="w"> </span><span class="nc">ShadowMapping</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-51-9" name="__codelineno-51-9" href="#__codelineno-51-9"></a><span class="k">public</span><span class="o">:</span>
<a id="__codelineno-51-10" name="__codelineno-51-10" href="#__codelineno-51-10"></a><span class="w">    </span><span class="n">ShadowMapping</span><span class="p">(</span><span class="n">RenderSystem</span><span class="o">*</span><span class="w"> </span><span class="n">renderSystem</span><span class="p">);</span>
<a id="__codelineno-51-11" name="__codelineno-51-11" href="#__codelineno-51-11"></a><span class="w">    </span><span class="o">~</span><span class="n">ShadowMapping</span><span class="p">();</span>
<a id="__codelineno-51-12" name="__codelineno-51-12" href="#__codelineno-51-12"></a>
<a id="__codelineno-51-13" name="__codelineno-51-13" href="#__codelineno-51-13"></a><span class="w">    </span><span class="kt">void</span><span class="w"> </span><span class="nf">RenderShadowMap</span><span class="p">(</span><span class="k">const</span><span class="w"> </span><span class="n">Scene</span><span class="o">&amp;</span><span class="w"> </span><span class="n">scene</span><span class="p">,</span><span class="w"> </span><span class="k">const</span><span class="w"> </span><span class="n">Light</span><span class="o">&amp;</span><span class="w"> </span><span class="n">light</span><span class="p">);</span>
<a id="__codelineno-51-14" name="__codelineno-51-14" href="#__codelineno-51-14"></a><span class="w">    </span><span class="kt">void</span><span class="w"> </span><span class="nf">ApplyShadows</span><span class="p">(</span><span class="k">const</span><span class="w"> </span><span class="n">Scene</span><span class="o">&amp;</span><span class="w"> </span><span class="n">scene</span><span class="p">,</span><span class="w"> </span><span class="k">const</span><span class="w"> </span><span class="n">Camera</span><span class="o">&amp;</span><span class="w"> </span><span class="n">camera</span><span class="p">);</span>
<a id="__codelineno-51-15" name="__codelineno-51-15" href="#__codelineno-51-15"></a>
<a id="__codelineno-51-16" name="__codelineno-51-16" href="#__codelineno-51-16"></a><span class="k">private</span><span class="o">:</span>
<a id="__codelineno-51-17" name="__codelineno-51-17" href="#__codelineno-51-17"></a><span class="w">    </span><span class="kt">void</span><span class="w"> </span><span class="n">InitializeShaders</span><span class="p">();</span>
<a id="__codelineno-51-18" name="__codelineno-51-18" href="#__codelineno-51-18"></a><span class="w">    </span><span class="kt">void</span><span class="w"> </span><span class="nf">CreateShadowMap</span><span class="p">(</span><span class="kt">int</span><span class="w"> </span><span class="n">resolution</span><span class="p">);</span>
<a id="__codelineno-51-19" name="__codelineno-51-19" href="#__codelineno-51-19"></a>
<a id="__codelineno-51-20" name="__codelineno-51-20" href="#__codelineno-51-20"></a><span class="w">    </span><span class="n">RenderSystem</span><span class="o">*</span><span class="w"> </span><span class="n">m_RenderSystem</span><span class="p">;</span>
<a id="__codelineno-51-21" name="__codelineno-51-21" href="#__codelineno-51-21"></a><span class="w">    </span><span class="n">Shader</span><span class="w"> </span><span class="n">m_ShadowMapShader</span><span class="p">;</span>
<a id="__codelineno-51-22" name="__codelineno-51-22" href="#__codelineno-51-22"></a><span class="w">    </span><span class="n">Shader</span><span class="w"> </span><span class="n">m_SceneShader</span><span class="p">;</span>
<a id="__codelineno-51-23" name="__codelineno-51-23" href="#__codelineno-51-23"></a>
<a id="__codelineno-51-24" name="__codelineno-51-24" href="#__codelineno-51-24"></a><span class="w">    </span><span class="n">RenderTexture</span><span class="w"> </span><span class="n">m_ShadowMap</span><span class="p">;</span>
<a id="__codelineno-51-25" name="__codelineno-51-25" href="#__codelineno-51-25"></a>
<a id="__codelineno-51-26" name="__codelineno-51-26" href="#__codelineno-51-26"></a><span class="w">    </span><span class="k">struct</span><span class="w"> </span><span class="nc">ShadowParams</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-51-27" name="__codelineno-51-27" href="#__codelineno-51-27"></a><span class="w">        </span><span class="n">mat4</span><span class="w"> </span><span class="n">LightViewProjection</span><span class="p">;</span>
<a id="__codelineno-51-28" name="__codelineno-51-28" href="#__codelineno-51-28"></a><span class="w">        </span><span class="kt">float</span><span class="w"> </span><span class="n">ShadowBias</span><span class="p">;</span>
<a id="__codelineno-51-29" name="__codelineno-51-29" href="#__codelineno-51-29"></a><span class="w">        </span><span class="kt">float</span><span class="w"> </span><span class="n">PCFRadius</span><span class="p">;</span>
<a id="__codelineno-51-30" name="__codelineno-51-30" href="#__codelineno-51-30"></a><span class="w">    </span><span class="p">}</span><span class="w"> </span><span class="n">m_Params</span><span class="p">;</span>
<a id="__codelineno-51-31" name="__codelineno-51-31" href="#__codelineno-51-31"></a><span class="p">};</span>
<a id="__codelineno-51-32" name="__codelineno-51-32" href="#__codelineno-51-32"></a>
<a id="__codelineno-51-33" name="__codelineno-51-33" href="#__codelineno-51-33"></a><span class="c1">// ShadowMapping.cpp</span>
<a id="__codelineno-51-34" name="__codelineno-51-34" href="#__codelineno-51-34"></a><span class="cp">#include</span><span class="w"> </span><span class="cpf">&quot;ShadowMapping.h&quot;</span>
<a id="__codelineno-51-35" name="__codelineno-51-35" href="#__codelineno-51-35"></a>
<a id="__codelineno-51-36" name="__codelineno-51-36" href="#__codelineno-51-36"></a><span class="n">ShadowMapping</span><span class="o">::</span><span class="n">ShadowMapping</span><span class="p">(</span><span class="n">RenderSystem</span><span class="o">*</span><span class="w"> </span><span class="n">renderSystem</span><span class="p">)</span>
<a id="__codelineno-51-37" name="__codelineno-51-37" href="#__codelineno-51-37"></a><span class="w">    </span><span class="o">:</span><span class="w"> </span><span class="n">m_RenderSystem</span><span class="p">(</span><span class="n">renderSystem</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-51-38" name="__codelineno-51-38" href="#__codelineno-51-38"></a><span class="w">    </span><span class="n">InitializeShaders</span><span class="p">();</span>
<a id="__codelineno-51-39" name="__codelineno-51-39" href="#__codelineno-51-39"></a><span class="w">    </span><span class="n">CreateShadowMap</span><span class="p">(</span><span class="mi">2048</span><span class="p">);</span><span class="w"> </span><span class="c1">// 2048x2048 shadow map resolution</span>
<a id="__codelineno-51-40" name="__codelineno-51-40" href="#__codelineno-51-40"></a><span class="p">}</span>
<a id="__codelineno-51-41" name="__codelineno-51-41" href="#__codelineno-51-41"></a>
<a id="__codelineno-51-42" name="__codelineno-51-42" href="#__codelineno-51-42"></a><span class="kt">void</span><span class="w"> </span><span class="n">ShadowMapping</span><span class="o">::</span><span class="n">InitializeShaders</span><span class="p">()</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-51-43" name="__codelineno-51-43" href="#__codelineno-51-43"></a><span class="w">    </span><span class="n">m_ShadowMapShader</span><span class="p">.</span><span class="n">Initialize</span><span class="p">(</span><span class="n">m_RenderSystem</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;Shaders/ShadowMap.vert&quot;</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;Shaders/ShadowMap.frag&quot;</span><span class="p">);</span>
<a id="__codelineno-51-44" name="__codelineno-51-44" href="#__codelineno-51-44"></a><span class="w">    </span><span class="n">m_SceneShader</span><span class="p">.</span><span class="n">Initialize</span><span class="p">(</span><span class="n">m_RenderSystem</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;Shaders/Scene.vert&quot;</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;Shaders/Scene.frag&quot;</span><span class="p">);</span>
<a id="__codelineno-51-45" name="__codelineno-51-45" href="#__codelineno-51-45"></a><span class="p">}</span>
<a id="__codelineno-51-46" name="__codelineno-51-46" href="#__codelineno-51-46"></a>
<a id="__codelineno-51-47" name="__codelineno-51-47" href="#__codelineno-51-47"></a><span class="kt">void</span><span class="w"> </span><span class="n">ShadowMapping</span><span class="o">::</span><span class="n">CreateShadowMap</span><span class="p">(</span><span class="kt">int</span><span class="w"> </span><span class="n">resolution</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-51-48" name="__codelineno-51-48" href="#__codelineno-51-48"></a><span class="w">    </span><span class="n">m_ShadowMap</span><span class="p">.</span><span class="n">Create</span><span class="p">(</span><span class="n">m_RenderSystem</span><span class="p">,</span><span class="w"> </span><span class="n">resolution</span><span class="p">,</span><span class="w"> </span><span class="n">resolution</span><span class="p">,</span><span class="w"> </span><span class="n">TextureFormat</span><span class="o">::</span><span class="n">DEPTH32F</span><span class="p">);</span>
<a id="__codelineno-51-49" name="__codelineno-51-49" href="#__codelineno-51-49"></a><span class="p">}</span>
<a id="__codelineno-51-50" name="__codelineno-51-50" href="#__codelineno-51-50"></a>
<a id="__codelineno-51-51" name="__codelineno-51-51" href="#__codelineno-51-51"></a><span class="kt">void</span><span class="w"> </span><span class="n">ShadowMapping</span><span class="o">::</span><span class="n">RenderShadowMap</span><span class="p">(</span><span class="k">const</span><span class="w"> </span><span class="n">Scene</span><span class="o">&amp;</span><span class="w"> </span><span class="n">scene</span><span class="p">,</span><span class="w"> </span><span class="k">const</span><span class="w"> </span><span class="n">Light</span><span class="o">&amp;</span><span class="w"> </span><span class="n">light</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-51-52" name="__codelineno-51-52" href="#__codelineno-51-52"></a><span class="w">    </span><span class="n">m_RenderSystem</span><span class="o">-&gt;</span><span class="n">SetRenderTarget</span><span class="p">(</span><span class="n">m_ShadowMap</span><span class="p">);</span>
<a id="__codelineno-51-53" name="__codelineno-51-53" href="#__codelineno-51-53"></a><span class="w">    </span><span class="n">m_RenderSystem</span><span class="o">-&gt;</span><span class="n">Clear</span><span class="p">(</span><span class="n">ClearFlags</span><span class="o">::</span><span class="n">Depth</span><span class="p">);</span>
<a id="__codelineno-51-54" name="__codelineno-51-54" href="#__codelineno-51-54"></a>
<a id="__codelineno-51-55" name="__codelineno-51-55" href="#__codelineno-51-55"></a><span class="w">    </span><span class="n">m_ShadowMapShader</span><span class="p">.</span><span class="n">Bind</span><span class="p">();</span>
<a id="__codelineno-51-56" name="__codelineno-51-56" href="#__codelineno-51-56"></a><span class="w">    </span><span class="n">m_ShadowMapShader</span><span class="p">.</span><span class="n">SetMatrix</span><span class="p">(</span><span class="s">&quot;lightViewProjection&quot;</span><span class="p">,</span><span class="w"> </span><span class="n">light</span><span class="p">.</span><span class="n">GetViewProjectionMatrix</span><span class="p">());</span>
<a id="__codelineno-51-57" name="__codelineno-51-57" href="#__codelineno-51-57"></a>
<a id="__codelineno-51-58" name="__codelineno-51-58" href="#__codelineno-51-58"></a><span class="w">    </span><span class="k">for</span><span class="w"> </span><span class="p">(</span><span class="k">const</span><span class="w"> </span><span class="k">auto</span><span class="o">&amp;</span><span class="w"> </span><span class="n">object</span><span class="w"> </span><span class="o">:</span><span class="w"> </span><span class="n">scene</span><span class="p">.</span><span class="n">GetObjects</span><span class="p">())</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-51-59" name="__codelineno-51-59" href="#__codelineno-51-59"></a><span class="w">        </span><span class="n">m_ShadowMapShader</span><span class="p">.</span><span class="n">SetMatrix</span><span class="p">(</span><span class="s">&quot;model&quot;</span><span class="p">,</span><span class="w"> </span><span class="n">object</span><span class="p">.</span><span class="n">GetTransform</span><span class="p">());</span>
<a id="__codelineno-51-60" name="__codelineno-51-60" href="#__codelineno-51-60"></a><span class="w">        </span><span class="n">object</span><span class="p">.</span><span class="n">Render</span><span class="p">();</span>
<a id="__codelineno-51-61" name="__codelineno-51-61" href="#__codelineno-51-61"></a><span class="w">    </span><span class="p">}</span>
<a id="__codelineno-51-62" name="__codelineno-51-62" href="#__codelineno-51-62"></a><span class="p">}</span>
<a id="__codelineno-51-63" name="__codelineno-51-63" href="#__codelineno-51-63"></a>
<a id="__codelineno-51-64" name="__codelineno-51-64" href="#__codelineno-51-64"></a><span class="kt">void</span><span class="w"> </span><span class="n">ShadowMapping</span><span class="o">::</span><span class="n">ApplyShadows</span><span class="p">(</span><span class="k">const</span><span class="w"> </span><span class="n">Scene</span><span class="o">&amp;</span><span class="w"> </span><span class="n">scene</span><span class="p">,</span><span class="w"> </span><span class="k">const</span><span class="w"> </span><span class="n">Camera</span><span class="o">&amp;</span><span class="w"> </span><span class="n">camera</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-51-65" name="__codelineno-51-65" href="#__codelineno-51-65"></a><span class="w">    </span><span class="n">m_RenderSystem</span><span class="o">-&gt;</span><span class="n">SetRenderTarget</span><span class="p">(</span><span class="n">m_RenderSystem</span><span class="o">-&gt;</span><span class="n">GetBackBuffer</span><span class="p">());</span>
<a id="__codelineno-51-66" name="__codelineno-51-66" href="#__codelineno-51-66"></a><span class="w">    </span><span class="n">m_RenderSystem</span><span class="o">-&gt;</span><span class="n">Clear</span><span class="p">(</span><span class="n">ClearFlags</span><span class="o">::</span><span class="n">Color</span><span class="w"> </span><span class="o">|</span><span class="w"> </span><span class="n">ClearFlags</span><span class="o">::</span><span class="n">Depth</span><span class="p">);</span>
<a id="__codelineno-51-67" name="__codelineno-51-67" href="#__codelineno-51-67"></a>
<a id="__codelineno-51-68" name="__codelineno-51-68" href="#__codelineno-51-68"></a><span class="w">    </span><span class="n">m_SceneShader</span><span class="p">.</span><span class="n">Bind</span><span class="p">();</span>
<a id="__codelineno-51-69" name="__codelineno-51-69" href="#__codelineno-51-69"></a><span class="w">    </span><span class="n">m_SceneShader</span><span class="p">.</span><span class="n">SetMatrix</span><span class="p">(</span><span class="s">&quot;viewProjection&quot;</span><span class="p">,</span><span class="w"> </span><span class="n">camera</span><span class="p">.</span><span class="n">GetViewProjectionMatrix</span><span class="p">());</span>
<a id="__codelineno-51-70" name="__codelineno-51-70" href="#__codelineno-51-70"></a><span class="w">    </span><span class="n">m_SceneShader</span><span class="p">.</span><span class="n">SetMatrix</span><span class="p">(</span><span class="s">&quot;lightViewProjection&quot;</span><span class="p">,</span><span class="w"> </span><span class="n">m_Params</span><span class="p">.</span><span class="n">LightViewProjection</span><span class="p">);</span>
<a id="__codelineno-51-71" name="__codelineno-51-71" href="#__codelineno-51-71"></a><span class="w">    </span><span class="n">m_SceneShader</span><span class="p">.</span><span class="n">SetTexture</span><span class="p">(</span><span class="s">&quot;shadowMap&quot;</span><span class="p">,</span><span class="w"> </span><span class="n">m_ShadowMap</span><span class="p">);</span>
<a id="__codelineno-51-72" name="__codelineno-51-72" href="#__codelineno-51-72"></a><span class="w">    </span><span class="n">m_SceneShader</span><span class="p">.</span><span class="n">SetFloat</span><span class="p">(</span><span class="s">&quot;shadowBias&quot;</span><span class="p">,</span><span class="w"> </span><span class="n">m_Params</span><span class="p">.</span><span class="n">ShadowBias</span><span class="p">);</span>
<a id="__codelineno-51-73" name="__codelineno-51-73" href="#__codelineno-51-73"></a><span class="w">    </span><span class="n">m_SceneShader</span><span class="p">.</span><span class="n">SetFloat</span><span class="p">(</span><span class="s">&quot;pcfRadius&quot;</span><span class="p">,</span><span class="w"> </span><span class="n">m_Params</span><span class="p">.</span><span class="n">PCFRadius</span><span class="p">);</span>
<a id="__codelineno-51-74" name="__codelineno-51-74" href="#__codelineno-51-74"></a>
<a id="__codelineno-51-75" name="__codelineno-51-75" href="#__codelineno-51-75"></a><span class="w">    </span><span class="k">for</span><span class="w"> </span><span class="p">(</span><span class="k">const</span><span class="w"> </span><span class="k">auto</span><span class="o">&amp;</span><span class="w"> </span><span class="n">object</span><span class="w"> </span><span class="o">:</span><span class="w"> </span><span class="n">scene</span><span class="p">.</span><span class="n">GetObjects</span><span class="p">())</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-51-76" name="__codelineno-51-76" href="#__codelineno-51-76"></a><span class="w">        </span><span class="n">m_SceneShader</span><span class="p">.</span><span class="n">SetMatrix</span><span class="p">(</span><span class="s">&quot;model&quot;</span><span class="p">,</span><span class="w"> </span><span class="n">object</span><span class="p">.</span><span class="n">GetTransform</span><span class="p">());</span>
<a id="__codelineno-51-77" name="__codelineno-51-77" href="#__codelineno-51-77"></a><span class="w">        </span><span class="n">object</span><span class="p">.</span><span class="n">Render</span><span class="p">();</span>
<a id="__codelineno-51-78" name="__codelineno-51-78" href="#__codelineno-51-78"></a><span class="w">    </span><span class="p">}</span>
<a id="__codelineno-51-79" name="__codelineno-51-79" href="#__codelineno-51-79"></a><span class="p">}</span>
</code></pre></div>
<p>Now, let's look at the shader code:</p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-52-1" name="__codelineno-52-1" href="#__codelineno-52-1"></a><span class="c1">// ShadowMap.vert</span>
<a id="__codelineno-52-2" name="__codelineno-52-2" href="#__codelineno-52-2"></a><span class="cp">#version 450</span>
<a id="__codelineno-52-3" name="__codelineno-52-3" href="#__codelineno-52-3"></a>
<a id="__codelineno-52-4" name="__codelineno-52-4" href="#__codelineno-52-4"></a><span class="k">layout</span><span class="p">(</span><span class="n">location</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mo">0</span><span class="p">)</span><span class="w"> </span><span class="k">in</span><span class="w"> </span><span class="kt">vec3</span><span class="w"> </span><span class="n">inPosition</span><span class="p">;</span>
<a id="__codelineno-52-5" name="__codelineno-52-5" href="#__codelineno-52-5"></a>
<a id="__codelineno-52-6" name="__codelineno-52-6" href="#__codelineno-52-6"></a><span class="k">layout</span><span class="p">(</span><span class="n">std140</span><span class="p">,</span><span class="w"> </span><span class="n">binding</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mo">0</span><span class="p">)</span><span class="w"> </span><span class="k">uniform</span><span class="w"> </span><span class="n">Matrices</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-52-7" name="__codelineno-52-7" href="#__codelineno-52-7"></a><span class="w">    </span><span class="kt">mat4</span><span class="w"> </span><span class="n">lightViewProjection</span><span class="p">;</span>
<a id="__codelineno-52-8" name="__codelineno-52-8" href="#__codelineno-52-8"></a><span class="w">    </span><span class="kt">mat4</span><span class="w"> </span><span class="n">model</span><span class="p">;</span>
<a id="__codelineno-52-9" name="__codelineno-52-9" href="#__codelineno-52-9"></a><span class="p">};</span>
<a id="__codelineno-52-10" name="__codelineno-52-10" href="#__codelineno-52-10"></a>
<a id="__codelineno-52-11" name="__codelineno-52-11" href="#__codelineno-52-11"></a><span class="kt">void</span><span class="w"> </span><span class="n">main</span><span class="p">()</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-52-12" name="__codelineno-52-12" href="#__codelineno-52-12"></a><span class="w">    </span><span class="nb">gl_Position</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">lightViewProjection</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="n">model</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="kt">vec4</span><span class="p">(</span><span class="n">inPosition</span><span class="p">,</span><span class="w"> </span><span class="mf">1.0</span><span class="p">);</span>
<a id="__codelineno-52-13" name="__codelineno-52-13" href="#__codelineno-52-13"></a><span class="p">}</span>
<a id="__codelineno-52-14" name="__codelineno-52-14" href="#__codelineno-52-14"></a>
<a id="__codelineno-52-15" name="__codelineno-52-15" href="#__codelineno-52-15"></a><span class="c1">// ShadowMap.frag</span>
<a id="__codelineno-52-16" name="__codelineno-52-16" href="#__codelineno-52-16"></a><span class="cp">#version 450</span>
<a id="__codelineno-52-17" name="__codelineno-52-17" href="#__codelineno-52-17"></a>
<a id="__codelineno-52-18" name="__codelineno-52-18" href="#__codelineno-52-18"></a><span class="kt">void</span><span class="w"> </span><span class="n">main</span><span class="p">()</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-52-19" name="__codelineno-52-19" href="#__codelineno-52-19"></a><span class="w">    </span><span class="c1">// Depth will be written automatically</span>
<a id="__codelineno-52-20" name="__codelineno-52-20" href="#__codelineno-52-20"></a><span class="p">}</span>
<a id="__codelineno-52-21" name="__codelineno-52-21" href="#__codelineno-52-21"></a>
<a id="__codelineno-52-22" name="__codelineno-52-22" href="#__codelineno-52-22"></a><span class="c1">// Scene.vert</span>
<a id="__codelineno-52-23" name="__codelineno-52-23" href="#__codelineno-52-23"></a><span class="cp">#version 450</span>
<a id="__codelineno-52-24" name="__codelineno-52-24" href="#__codelineno-52-24"></a>
<a id="__codelineno-52-25" name="__codelineno-52-25" href="#__codelineno-52-25"></a><span class="k">layout</span><span class="p">(</span><span class="n">location</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mo">0</span><span class="p">)</span><span class="w"> </span><span class="k">in</span><span class="w"> </span><span class="kt">vec3</span><span class="w"> </span><span class="n">inPosition</span><span class="p">;</span>
<a id="__codelineno-52-26" name="__codelineno-52-26" href="#__codelineno-52-26"></a><span class="k">layout</span><span class="p">(</span><span class="n">location</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">1</span><span class="p">)</span><span class="w"> </span><span class="k">in</span><span class="w"> </span><span class="kt">vec3</span><span class="w"> </span><span class="n">inNormal</span><span class="p">;</span>
<a id="__codelineno-52-27" name="__codelineno-52-27" href="#__codelineno-52-27"></a>
<a id="__codelineno-52-28" name="__codelineno-52-28" href="#__codelineno-52-28"></a><span class="k">layout</span><span class="p">(</span><span class="n">location</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mo">0</span><span class="p">)</span><span class="w"> </span><span class="k">out</span><span class="w"> </span><span class="kt">vec3</span><span class="w"> </span><span class="n">outWorldPos</span><span class="p">;</span>
<a id="__codelineno-52-29" name="__codelineno-52-29" href="#__codelineno-52-29"></a><span class="k">layout</span><span class="p">(</span><span class="n">location</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">1</span><span class="p">)</span><span class="w"> </span><span class="k">out</span><span class="w"> </span><span class="kt">vec3</span><span class="w"> </span><span class="n">outNormal</span><span class="p">;</span>
<a id="__codelineno-52-30" name="__codelineno-52-30" href="#__codelineno-52-30"></a><span class="k">layout</span><span class="p">(</span><span class="n">location</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">2</span><span class="p">)</span><span class="w"> </span><span class="k">out</span><span class="w"> </span><span class="kt">vec4</span><span class="w"> </span><span class="n">outLightSpacePos</span><span class="p">;</span>
<a id="__codelineno-52-31" name="__codelineno-52-31" href="#__codelineno-52-31"></a>
<a id="__codelineno-52-32" name="__codelineno-52-32" href="#__codelineno-52-32"></a><span class="k">layout</span><span class="p">(</span><span class="n">std140</span><span class="p">,</span><span class="w"> </span><span class="n">binding</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mo">0</span><span class="p">)</span><span class="w"> </span><span class="k">uniform</span><span class="w"> </span><span class="n">Matrices</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-52-33" name="__codelineno-52-33" href="#__codelineno-52-33"></a><span class="w">    </span><span class="kt">mat4</span><span class="w"> </span><span class="n">viewProjection</span><span class="p">;</span>
<a id="__codelineno-52-34" name="__codelineno-52-34" href="#__codelineno-52-34"></a><span class="w">    </span><span class="kt">mat4</span><span class="w"> </span><span class="n">model</span><span class="p">;</span>
<a id="__codelineno-52-35" name="__codelineno-52-35" href="#__codelineno-52-35"></a><span class="w">    </span><span class="kt">mat4</span><span class="w"> </span><span class="n">lightViewProjection</span><span class="p">;</span>
<a id="__codelineno-52-36" name="__codelineno-52-36" href="#__codelineno-52-36"></a><span class="p">};</span>
<a id="__codelineno-52-37" name="__codelineno-52-37" href="#__codelineno-52-37"></a>
<a id="__codelineno-52-38" name="__codelineno-52-38" href="#__codelineno-52-38"></a><span class="kt">void</span><span class="w"> </span><span class="n">main</span><span class="p">()</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-52-39" name="__codelineno-52-39" href="#__codelineno-52-39"></a><span class="w">    </span><span class="kt">vec4</span><span class="w"> </span><span class="n">worldPos</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">model</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="kt">vec4</span><span class="p">(</span><span class="n">inPosition</span><span class="p">,</span><span class="w"> </span><span class="mf">1.0</span><span class="p">);</span>
<a id="__codelineno-52-40" name="__codelineno-52-40" href="#__codelineno-52-40"></a><span class="w">    </span><span class="nb">gl_Position</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">viewProjection</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="n">worldPos</span><span class="p">;</span>
<a id="__codelineno-52-41" name="__codelineno-52-41" href="#__codelineno-52-41"></a><span class="w">    </span><span class="n">outWorldPos</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">worldPos</span><span class="p">.</span><span class="n">xyz</span><span class="p">;</span>
<a id="__codelineno-52-42" name="__codelineno-52-42" href="#__codelineno-52-42"></a><span class="w">    </span><span class="n">outNormal</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="kt">mat3</span><span class="p">(</span><span class="n">model</span><span class="p">)</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="n">inNormal</span><span class="p">;</span>
<a id="__codelineno-52-43" name="__codelineno-52-43" href="#__codelineno-52-43"></a><span class="w">    </span><span class="n">outLightSpacePos</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">lightViewProjection</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="n">worldPos</span><span class="p">;</span>
<a id="__codelineno-52-44" name="__codelineno-52-44" href="#__codelineno-52-44"></a><span class="p">}</span>
<a id="__codelineno-52-45" name="__codelineno-52-45" href="#__codelineno-52-45"></a>
<a id="__codelineno-52-46" name="__codelineno-52-46" href="#__codelineno-52-46"></a><span class="c1">// Scene.frag</span>
<a id="__codelineno-52-47" name="__codelineno-52-47" href="#__codelineno-52-47"></a><span class="cp">#version 450</span>
<a id="__codelineno-52-48" name="__codelineno-52-48" href="#__codelineno-52-48"></a>
<a id="__codelineno-52-49" name="__codelineno-52-49" href="#__codelineno-52-49"></a><span class="k">layout</span><span class="p">(</span><span class="n">location</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mo">0</span><span class="p">)</span><span class="w"> </span><span class="k">in</span><span class="w"> </span><span class="kt">vec3</span><span class="w"> </span><span class="n">inWorldPos</span><span class="p">;</span>
<a id="__codelineno-52-50" name="__codelineno-52-50" href="#__codelineno-52-50"></a><span class="k">layout</span><span class="p">(</span><span class="n">location</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">1</span><span class="p">)</span><span class="w"> </span><span class="k">in</span><span class="w"> </span><span class="kt">vec3</span><span class="w"> </span><span class="n">inNormal</span><span class="p">;</span>
<a id="__codelineno-52-51" name="__codelineno-52-51" href="#__codelineno-52-51"></a><span class="k">layout</span><span class="p">(</span><span class="n">location</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">2</span><span class="p">)</span><span class="w"> </span><span class="k">in</span><span class="w"> </span><span class="kt">vec4</span><span class="w"> </span><span class="n">inLightSpacePos</span><span class="p">;</span>
<a id="__codelineno-52-52" name="__codelineno-52-52" href="#__codelineno-52-52"></a>
<a id="__codelineno-52-53" name="__codelineno-52-53" href="#__codelineno-52-53"></a><span class="k">layout</span><span class="p">(</span><span class="n">location</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mo">0</span><span class="p">)</span><span class="w"> </span><span class="k">out</span><span class="w"> </span><span class="kt">vec4</span><span class="w"> </span><span class="n">outColor</span><span class="p">;</span>
<a id="__codelineno-52-54" name="__codelineno-52-54" href="#__codelineno-52-54"></a>
<a id="__codelineno-52-55" name="__codelineno-52-55" href="#__codelineno-52-55"></a><span class="k">layout</span><span class="p">(</span><span class="n">binding</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">1</span><span class="p">)</span><span class="w"> </span><span class="k">uniform</span><span class="w"> </span><span class="kt">sampler2D</span><span class="w"> </span><span class="n">shadowMap</span><span class="p">;</span>
<a id="__codelineno-52-56" name="__codelineno-52-56" href="#__codelineno-52-56"></a>
<a id="__codelineno-52-57" name="__codelineno-52-57" href="#__codelineno-52-57"></a><span class="k">layout</span><span class="p">(</span><span class="n">std140</span><span class="p">,</span><span class="w"> </span><span class="n">binding</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">2</span><span class="p">)</span><span class="w"> </span><span class="k">uniform</span><span class="w"> </span><span class="n">ShadowParams</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-52-58" name="__codelineno-52-58" href="#__codelineno-52-58"></a><span class="w">    </span><span class="kt">float</span><span class="w"> </span><span class="n">shadowBias</span><span class="p">;</span>
<a id="__codelineno-52-59" name="__codelineno-52-59" href="#__codelineno-52-59"></a><span class="w">    </span><span class="kt">float</span><span class="w"> </span><span class="n">pcfRadius</span><span class="p">;</span>
<a id="__codelineno-52-60" name="__codelineno-52-60" href="#__codelineno-52-60"></a><span class="p">};</span>
<a id="__codelineno-52-61" name="__codelineno-52-61" href="#__codelineno-52-61"></a>
<a id="__codelineno-52-62" name="__codelineno-52-62" href="#__codelineno-52-62"></a><span class="kt">float</span><span class="w"> </span><span class="n">SampleShadowMap</span><span class="p">(</span><span class="kt">vec2</span><span class="w"> </span><span class="n">coords</span><span class="p">,</span><span class="w"> </span><span class="kt">float</span><span class="w"> </span><span class="n">compare</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-52-63" name="__codelineno-52-63" href="#__codelineno-52-63"></a><span class="w">    </span><span class="k">return</span><span class="w"> </span><span class="n">step</span><span class="p">(</span><span class="n">compare</span><span class="p">,</span><span class="w"> </span><span class="n">texture</span><span class="p">(</span><span class="n">shadowMap</span><span class="p">,</span><span class="w"> </span><span class="n">coords</span><span class="p">).</span><span class="n">r</span><span class="p">);</span>
<a id="__codelineno-52-64" name="__codelineno-52-64" href="#__codelineno-52-64"></a><span class="p">}</span>
<a id="__codelineno-52-65" name="__codelineno-52-65" href="#__codelineno-52-65"></a>
<a id="__codelineno-52-66" name="__codelineno-52-66" href="#__codelineno-52-66"></a><span class="kt">float</span><span class="w"> </span><span class="n">PCFShadow</span><span class="p">(</span><span class="kt">vec3</span><span class="w"> </span><span class="n">projCoords</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-52-67" name="__codelineno-52-67" href="#__codelineno-52-67"></a><span class="w">    </span><span class="kt">vec2</span><span class="w"> </span><span class="n">texelSize</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mf">1.0</span><span class="w"> </span><span class="o">/</span><span class="w"> </span><span class="n">textureSize</span><span class="p">(</span><span class="n">shadowMap</span><span class="p">,</span><span class="w"> </span><span class="mo">0</span><span class="p">);</span>
<a id="__codelineno-52-68" name="__codelineno-52-68" href="#__codelineno-52-68"></a><span class="w">    </span><span class="kt">float</span><span class="w"> </span><span class="n">shadowFactor</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mf">0.0</span><span class="p">;</span>
<a id="__codelineno-52-69" name="__codelineno-52-69" href="#__codelineno-52-69"></a>
<a id="__codelineno-52-70" name="__codelineno-52-70" href="#__codelineno-52-70"></a><span class="w">    </span><span class="k">for</span><span class="p">(</span><span class="kt">float</span><span class="w"> </span><span class="n">x</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="o">-</span><span class="n">pcfRadius</span><span class="p">;</span><span class="w"> </span><span class="n">x</span><span class="w"> </span><span class="o">&lt;=</span><span class="w"> </span><span class="n">pcfRadius</span><span class="p">;</span><span class="w"> </span><span class="n">x</span><span class="w"> </span><span class="o">+=</span><span class="w"> </span><span class="mf">1.0</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-52-71" name="__codelineno-52-71" href="#__codelineno-52-71"></a><span class="w">        </span><span class="k">for</span><span class="p">(</span><span class="kt">float</span><span class="w"> </span><span class="n">y</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="o">-</span><span class="n">pcfRadius</span><span class="p">;</span><span class="w"> </span><span class="n">y</span><span class="w"> </span><span class="o">&lt;=</span><span class="w"> </span><span class="n">pcfRadius</span><span class="p">;</span><span class="w"> </span><span class="n">y</span><span class="w"> </span><span class="o">+=</span><span class="w"> </span><span class="mf">1.0</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-52-72" name="__codelineno-52-72" href="#__codelineno-52-72"></a><span class="w">            </span><span class="n">shadowFactor</span><span class="w"> </span><span class="o">+=</span><span class="w"> </span><span class="n">SampleShadowMap</span><span class="p">(</span><span class="n">projCoords</span><span class="p">.</span><span class="n">xy</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="kt">vec2</span><span class="p">(</span><span class="n">x</span><span class="p">,</span><span class="w"> </span><span class="n">y</span><span class="p">)</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="n">texelSize</span><span class="p">,</span><span class="w"> </span><span class="n">projCoords</span><span class="p">.</span><span class="n">z</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="n">shadowBias</span><span class="p">);</span>
<a id="__codelineno-52-73" name="__codelineno-52-73" href="#__codelineno-52-73"></a><span class="w">        </span><span class="p">}</span>
<a id="__codelineno-52-74" name="__codelineno-52-74" href="#__codelineno-52-74"></a><span class="w">    </span><span class="p">}</span>
<a id="__codelineno-52-75" name="__codelineno-52-75" href="#__codelineno-52-75"></a>
<a id="__codelineno-52-76" name="__codelineno-52-76" href="#__codelineno-52-76"></a><span class="w">    </span><span class="n">shadowFactor</span><span class="w"> </span><span class="o">/=</span><span class="w"> </span><span class="p">((</span><span class="n">pcfRadius</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="mi">2</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="mi">1</span><span class="p">)</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="p">(</span><span class="n">pcfRadius</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="mi">2</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="mi">1</span><span class="p">));</span>
<a id="__codelineno-52-77" name="__codelineno-52-77" href="#__codelineno-52-77"></a><span class="w">    </span><span class="k">return</span><span class="w"> </span><span class="n">shadowFactor</span><span class="p">;</span>
<a id="__codelineno-52-78" name="__codelineno-52-78" href="#__codelineno-52-78"></a><span class="p">}</span>
<a id="__codelineno-52-79" name="__codelineno-52-79" href="#__codelineno-52-79"></a>
<a id="__codelineno-52-80" name="__codelineno-52-80" href="#__codelineno-52-80"></a><span class="kt">void</span><span class="w"> </span><span class="n">main</span><span class="p">()</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-52-81" name="__codelineno-52-81" href="#__codelineno-52-81"></a><span class="w">    </span><span class="kt">vec3</span><span class="w"> </span><span class="n">normal</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">normalize</span><span class="p">(</span><span class="n">inNormal</span><span class="p">);</span>
<a id="__codelineno-52-82" name="__codelineno-52-82" href="#__codelineno-52-82"></a><span class="w">    </span><span class="kt">vec3</span><span class="w"> </span><span class="n">lightDir</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">normalize</span><span class="p">(</span><span class="kt">vec3</span><span class="p">(</span><span class="mf">1.0</span><span class="p">,</span><span class="w"> </span><span class="mf">1.0</span><span class="p">,</span><span class="w"> </span><span class="mf">1.0</span><span class="p">));</span><span class="w"> </span><span class="c1">// Directional light</span>
<a id="__codelineno-52-83" name="__codelineno-52-83" href="#__codelineno-52-83"></a>
<a id="__codelineno-52-84" name="__codelineno-52-84" href="#__codelineno-52-84"></a><span class="w">    </span><span class="kt">float</span><span class="w"> </span><span class="n">diffuse</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">max</span><span class="p">(</span><span class="n">dot</span><span class="p">(</span><span class="n">normal</span><span class="p">,</span><span class="w"> </span><span class="n">lightDir</span><span class="p">),</span><span class="w"> </span><span class="mf">0.0</span><span class="p">);</span>
<a id="__codelineno-52-85" name="__codelineno-52-85" href="#__codelineno-52-85"></a>
<a id="__codelineno-52-86" name="__codelineno-52-86" href="#__codelineno-52-86"></a><span class="w">    </span><span class="kt">vec3</span><span class="w"> </span><span class="n">projCoords</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">inLightSpacePos</span><span class="p">.</span><span class="n">xyz</span><span class="w"> </span><span class="o">/</span><span class="w"> </span><span class="n">inLightSpacePos</span><span class="p">.</span><span class="n">w</span><span class="p">;</span>
<a id="__codelineno-52-87" name="__codelineno-52-87" href="#__codelineno-52-87"></a><span class="w">    </span><span class="n">projCoords</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">projCoords</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="mf">0.5</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="mf">0.5</span><span class="p">;</span>
<a id="__codelineno-52-88" name="__codelineno-52-88" href="#__codelineno-52-88"></a>
<a id="__codelineno-52-89" name="__codelineno-52-89" href="#__codelineno-52-89"></a><span class="w">    </span><span class="kt">float</span><span class="w"> </span><span class="n">shadow</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">PCFShadow</span><span class="p">(</span><span class="n">projCoords</span><span class="p">);</span>
<a id="__codelineno-52-90" name="__codelineno-52-90" href="#__codelineno-52-90"></a>
<a id="__codelineno-52-91" name="__codelineno-52-91" href="#__codelineno-52-91"></a><span class="w">    </span><span class="kt">vec3</span><span class="w"> </span><span class="n">lighting</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="kt">vec3</span><span class="p">(</span><span class="mf">0.1</span><span class="p">);</span><span class="w"> </span><span class="c1">// Ambient</span>
<a id="__codelineno-52-92" name="__codelineno-52-92" href="#__codelineno-52-92"></a><span class="w">    </span><span class="n">lighting</span><span class="w"> </span><span class="o">+=</span><span class="w"> </span><span class="n">diffuse</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="n">shadow</span><span class="p">;</span><span class="w"> </span><span class="c1">// Diffuse with shadow</span>
<a id="__codelineno-52-93" name="__codelineno-52-93" href="#__codelineno-52-93"></a>
<a id="__codelineno-52-94" name="__codelineno-52-94" href="#__codelineno-52-94"></a><span class="w">    </span><span class="n">outColor</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="kt">vec4</span><span class="p">(</span><span class="n">lighting</span><span class="p">,</span><span class="w"> </span><span class="mf">1.0</span><span class="p">);</span>
<a id="__codelineno-52-95" name="__codelineno-52-95" href="#__codelineno-52-95"></a><span class="p">}</span>
</code></pre></div>
<h4 id="explanation_6">Explanation</h4>
<ol>
<li>
<p>Shadow Map Generation:</p>
<ul>
<li>We render the scene from the light's perspective, storing only depth information.</li>
<li>The vertex shader transforms vertices to light space.</li>
<li>The fragment shader is empty because we only need depth information.</li>
</ul>
</li>
<li>
<p>Scene Rendering with Shadows:</p>
<ul>
<li>The vertex shader transforms vertices to both camera space and light space.</li>
<li>The fragment shader performs the shadow test and applies lighting.</li>
</ul>
</li>
<li>
<p>Shadow Testing:</p>
<ul>
<li>We transform the fragment's position to light space.</li>
<li>We compare the fragment's depth in light space with the value stored in the shadow map.</li>
<li>If the fragment's depth is greater than the stored depth (plus a bias), it's in shadow.</li>
</ul>
</li>
<li>
<p>PCF (Percentage Closer Filtering):</p>
<ul>
<li>We sample multiple points around the shadow map lookup position.</li>
<li>We average these samples to create softer shadow edges.</li>
<li>The <code>pcfRadius</code> parameter controls the softness of the shadows.</li>
</ul>
</li>
<li>
<p>Shadow Bias:</p>
<ul>
<li>We use a small bias value to prevent shadow acne (self-shadowing artifacts).</li>
<li>The bias is subtracted from the fragment's depth before comparison.</li>
</ul>
</li>
<li>
<p>Lighting Calculation:</p>
<ul>
<li>We calculate basic diffuse lighting.</li>
<li>The shadow factor is multiplied with the diffuse lighting to darken shadowed areas.</li>
<li>We add a small ambient term to prevent completely black shadows.</li>
</ul>
</li>
</ol>
<p>Further improvements could include:</p>
<ul>
<li>Cascaded shadow maps for large outdoor environments</li>
<li>Variance shadow mapping for better quality with fewer samples</li>
<li>
<p>Exponential shadow maps for reducing light bleeding</p>
</li>
<li>
<p>Optimizations like depth clamping and front-face culling for the shadow map pass</p>
</li>
</ul>
<h3 id="ambient-occlusion">Ambient Occlusion</h3>
<p>Ambient occlusion (AO) is a crucial technique in modern game rendering pipelines that approximates how light is radiating in a scene. It darkens areas where light is occluded, such as corners, crevices, and spaces between objects, adding depth and realism to 3D environments.</p>
<p>Implementation Overview:</p>
<p>For high-performance game engines, we'll implement Screen Space Ambient Occlusion (SSAO), which is efficient and widely used in real-time rendering. Our implementation will use compute shaders for optimal performance.</p>
<p>Key Components:</p>
<ol>
<li>Depth and normal buffers generation</li>
<li>SSAO compute shader</li>
<li>Bilateral blur for noise reduction</li>
<li>Final composition</li>
</ol>
<p>Here's a  C++ implementation using a modern graphics API:</p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-53-1" name="__codelineno-53-1" href="#__codelineno-53-1"></a><span class="c1">// AmbientOcclusion.h</span>
<a id="__codelineno-53-2" name="__codelineno-53-2" href="#__codelineno-53-2"></a><span class="cp">#pragma once</span>
<a id="__codelineno-53-3" name="__codelineno-53-3" href="#__codelineno-53-3"></a>
<a id="__codelineno-53-4" name="__codelineno-53-4" href="#__codelineno-53-4"></a><span class="cp">#include</span><span class="w"> </span><span class="cpf">&quot;RenderSystem.h&quot;</span>
<a id="__codelineno-53-5" name="__codelineno-53-5" href="#__codelineno-53-5"></a><span class="cp">#include</span><span class="w"> </span><span class="cpf">&quot;ComputeShader.h&quot;</span>
<a id="__codelineno-53-6" name="__codelineno-53-6" href="#__codelineno-53-6"></a><span class="cp">#include</span><span class="w"> </span><span class="cpf">&quot;RenderTexture.h&quot;</span>
<a id="__codelineno-53-7" name="__codelineno-53-7" href="#__codelineno-53-7"></a>
<a id="__codelineno-53-8" name="__codelineno-53-8" href="#__codelineno-53-8"></a><span class="k">class</span><span class="w"> </span><span class="nc">AmbientOcclusion</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-53-9" name="__codelineno-53-9" href="#__codelineno-53-9"></a><span class="k">public</span><span class="o">:</span>
<a id="__codelineno-53-10" name="__codelineno-53-10" href="#__codelineno-53-10"></a><span class="w">    </span><span class="n">AmbientOcclusion</span><span class="p">(</span><span class="n">RenderSystem</span><span class="o">*</span><span class="w"> </span><span class="n">renderSystem</span><span class="p">);</span>
<a id="__codelineno-53-11" name="__codelineno-53-11" href="#__codelineno-53-11"></a><span class="w">    </span><span class="o">~</span><span class="n">AmbientOcclusion</span><span class="p">();</span>
<a id="__codelineno-53-12" name="__codelineno-53-12" href="#__codelineno-53-12"></a>
<a id="__codelineno-53-13" name="__codelineno-53-13" href="#__codelineno-53-13"></a><span class="w">    </span><span class="kt">void</span><span class="w"> </span><span class="nf">Execute</span><span class="p">(</span><span class="k">const</span><span class="w"> </span><span class="n">RenderTexture</span><span class="o">&amp;</span><span class="w"> </span><span class="n">depthTexture</span><span class="p">,</span><span class="w"> </span><span class="k">const</span><span class="w"> </span><span class="n">RenderTexture</span><span class="o">&amp;</span><span class="w"> </span><span class="n">normalTexture</span><span class="p">);</span>
<a id="__codelineno-53-14" name="__codelineno-53-14" href="#__codelineno-53-14"></a><span class="w">    </span><span class="k">const</span><span class="w"> </span><span class="n">RenderTexture</span><span class="o">&amp;</span><span class="w"> </span><span class="nf">GetResult</span><span class="p">()</span><span class="w"> </span><span class="k">const</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="k">return</span><span class="w"> </span><span class="n">m_ResultTexture</span><span class="p">;</span><span class="w"> </span><span class="p">}</span>
<a id="__codelineno-53-15" name="__codelineno-53-15" href="#__codelineno-53-15"></a>
<a id="__codelineno-53-16" name="__codelineno-53-16" href="#__codelineno-53-16"></a><span class="k">private</span><span class="o">:</span>
<a id="__codelineno-53-17" name="__codelineno-53-17" href="#__codelineno-53-17"></a><span class="w">    </span><span class="kt">void</span><span class="w"> </span><span class="n">InitializeShaders</span><span class="p">();</span>
<a id="__codelineno-53-18" name="__codelineno-53-18" href="#__codelineno-53-18"></a><span class="w">    </span><span class="kt">void</span><span class="w"> </span><span class="nf">CreateTextures</span><span class="p">(</span><span class="kt">int</span><span class="w"> </span><span class="n">width</span><span class="p">,</span><span class="w"> </span><span class="kt">int</span><span class="w"> </span><span class="n">height</span><span class="p">);</span>
<a id="__codelineno-53-19" name="__codelineno-53-19" href="#__codelineno-53-19"></a>
<a id="__codelineno-53-20" name="__codelineno-53-20" href="#__codelineno-53-20"></a><span class="w">    </span><span class="n">RenderSystem</span><span class="o">*</span><span class="w"> </span><span class="n">m_RenderSystem</span><span class="p">;</span>
<a id="__codelineno-53-21" name="__codelineno-53-21" href="#__codelineno-53-21"></a><span class="w">    </span><span class="n">ComputeShader</span><span class="w"> </span><span class="n">m_SSAOShader</span><span class="p">;</span>
<a id="__codelineno-53-22" name="__codelineno-53-22" href="#__codelineno-53-22"></a><span class="w">    </span><span class="n">ComputeShader</span><span class="w"> </span><span class="n">m_BlurShader</span><span class="p">;</span>
<a id="__codelineno-53-23" name="__codelineno-53-23" href="#__codelineno-53-23"></a>
<a id="__codelineno-53-24" name="__codelineno-53-24" href="#__codelineno-53-24"></a><span class="w">    </span><span class="n">RenderTexture</span><span class="w"> </span><span class="n">m_SSAOTexture</span><span class="p">;</span>
<a id="__codelineno-53-25" name="__codelineno-53-25" href="#__codelineno-53-25"></a><span class="w">    </span><span class="n">RenderTexture</span><span class="w"> </span><span class="n">m_BlurTexture</span><span class="p">;</span>
<a id="__codelineno-53-26" name="__codelineno-53-26" href="#__codelineno-53-26"></a><span class="w">    </span><span class="n">RenderTexture</span><span class="w"> </span><span class="n">m_ResultTexture</span><span class="p">;</span>
<a id="__codelineno-53-27" name="__codelineno-53-27" href="#__codelineno-53-27"></a>
<a id="__codelineno-53-28" name="__codelineno-53-28" href="#__codelineno-53-28"></a><span class="w">    </span><span class="k">struct</span><span class="w"> </span><span class="nc">SSAOParams</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-53-29" name="__codelineno-53-29" href="#__codelineno-53-29"></a><span class="w">        </span><span class="kt">float</span><span class="w"> </span><span class="n">Radius</span><span class="p">;</span>
<a id="__codelineno-53-30" name="__codelineno-53-30" href="#__codelineno-53-30"></a><span class="w">        </span><span class="kt">float</span><span class="w"> </span><span class="n">Bias</span><span class="p">;</span>
<a id="__codelineno-53-31" name="__codelineno-53-31" href="#__codelineno-53-31"></a><span class="w">        </span><span class="kt">float</span><span class="w"> </span><span class="n">IntensityMultiplier</span><span class="p">;</span>
<a id="__codelineno-53-32" name="__codelineno-53-32" href="#__codelineno-53-32"></a><span class="w">        </span><span class="kt">int</span><span class="w"> </span><span class="n">KernelSize</span><span class="p">;</span>
<a id="__codelineno-53-33" name="__codelineno-53-33" href="#__codelineno-53-33"></a><span class="w">    </span><span class="p">}</span><span class="w"> </span><span class="n">m_Params</span><span class="p">;</span>
<a id="__codelineno-53-34" name="__codelineno-53-34" href="#__codelineno-53-34"></a>
<a id="__codelineno-53-35" name="__codelineno-53-35" href="#__codelineno-53-35"></a><span class="w">    </span><span class="c1">// ... Additional members for sample kernel and noise texture</span>
<a id="__codelineno-53-36" name="__codelineno-53-36" href="#__codelineno-53-36"></a><span class="p">};</span>
<a id="__codelineno-53-37" name="__codelineno-53-37" href="#__codelineno-53-37"></a>
<a id="__codelineno-53-38" name="__codelineno-53-38" href="#__codelineno-53-38"></a><span class="c1">// AmbientOcclusion.cpp</span>
<a id="__codelineno-53-39" name="__codelineno-53-39" href="#__codelineno-53-39"></a><span class="cp">#include</span><span class="w"> </span><span class="cpf">&quot;AmbientOcclusion.h&quot;</span>
<a id="__codelineno-53-40" name="__codelineno-53-40" href="#__codelineno-53-40"></a>
<a id="__codelineno-53-41" name="__codelineno-53-41" href="#__codelineno-53-41"></a><span class="n">AmbientOcclusion</span><span class="o">::</span><span class="n">AmbientOcclusion</span><span class="p">(</span><span class="n">RenderSystem</span><span class="o">*</span><span class="w"> </span><span class="n">renderSystem</span><span class="p">)</span>
<a id="__codelineno-53-42" name="__codelineno-53-42" href="#__codelineno-53-42"></a><span class="w">    </span><span class="o">:</span><span class="w"> </span><span class="n">m_RenderSystem</span><span class="p">(</span><span class="n">renderSystem</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-53-43" name="__codelineno-53-43" href="#__codelineno-53-43"></a><span class="w">    </span><span class="n">InitializeShaders</span><span class="p">();</span>
<a id="__codelineno-53-44" name="__codelineno-53-44" href="#__codelineno-53-44"></a><span class="w">    </span><span class="c1">// Initialize other members...</span>
<a id="__codelineno-53-45" name="__codelineno-53-45" href="#__codelineno-53-45"></a><span class="p">}</span>
<a id="__codelineno-53-46" name="__codelineno-53-46" href="#__codelineno-53-46"></a>
<a id="__codelineno-53-47" name="__codelineno-53-47" href="#__codelineno-53-47"></a><span class="kt">void</span><span class="w"> </span><span class="n">AmbientOcclusion</span><span class="o">::</span><span class="n">InitializeShaders</span><span class="p">()</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-53-48" name="__codelineno-53-48" href="#__codelineno-53-48"></a><span class="w">    </span><span class="n">m_SSAOShader</span><span class="p">.</span><span class="n">Initialize</span><span class="p">(</span><span class="n">m_RenderSystem</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;Shaders/SSAO.comp&quot;</span><span class="p">);</span>
<a id="__codelineno-53-49" name="__codelineno-53-49" href="#__codelineno-53-49"></a><span class="w">    </span><span class="n">m_BlurShader</span><span class="p">.</span><span class="n">Initialize</span><span class="p">(</span><span class="n">m_RenderSystem</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;Shaders/SSAOBlur.comp&quot;</span><span class="p">);</span>
<a id="__codelineno-53-50" name="__codelineno-53-50" href="#__codelineno-53-50"></a><span class="p">}</span>
<a id="__codelineno-53-51" name="__codelineno-53-51" href="#__codelineno-53-51"></a>
<a id="__codelineno-53-52" name="__codelineno-53-52" href="#__codelineno-53-52"></a><span class="kt">void</span><span class="w"> </span><span class="n">AmbientOcclusion</span><span class="o">::</span><span class="n">CreateTextures</span><span class="p">(</span><span class="kt">int</span><span class="w"> </span><span class="n">width</span><span class="p">,</span><span class="w"> </span><span class="kt">int</span><span class="w"> </span><span class="n">height</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-53-53" name="__codelineno-53-53" href="#__codelineno-53-53"></a><span class="w">    </span><span class="n">m_SSAOTexture</span><span class="p">.</span><span class="n">Create</span><span class="p">(</span><span class="n">m_RenderSystem</span><span class="p">,</span><span class="w"> </span><span class="n">width</span><span class="p">,</span><span class="w"> </span><span class="n">height</span><span class="p">,</span><span class="w"> </span><span class="n">TextureFormat</span><span class="o">::</span><span class="n">R8_UNORM</span><span class="p">);</span>
<a id="__codelineno-53-54" name="__codelineno-53-54" href="#__codelineno-53-54"></a><span class="w">    </span><span class="n">m_BlurTexture</span><span class="p">.</span><span class="n">Create</span><span class="p">(</span><span class="n">m_RenderSystem</span><span class="p">,</span><span class="w"> </span><span class="n">width</span><span class="p">,</span><span class="w"> </span><span class="n">height</span><span class="p">,</span><span class="w"> </span><span class="n">TextureFormat</span><span class="o">::</span><span class="n">R8_UNORM</span><span class="p">);</span>
<a id="__codelineno-53-55" name="__codelineno-53-55" href="#__codelineno-53-55"></a><span class="w">    </span><span class="n">m_ResultTexture</span><span class="p">.</span><span class="n">Create</span><span class="p">(</span><span class="n">m_RenderSystem</span><span class="p">,</span><span class="w"> </span><span class="n">width</span><span class="p">,</span><span class="w"> </span><span class="n">height</span><span class="p">,</span><span class="w"> </span><span class="n">TextureFormat</span><span class="o">::</span><span class="n">R8_UNORM</span><span class="p">);</span>
<a id="__codelineno-53-56" name="__codelineno-53-56" href="#__codelineno-53-56"></a><span class="p">}</span>
<a id="__codelineno-53-57" name="__codelineno-53-57" href="#__codelineno-53-57"></a>
<a id="__codelineno-53-58" name="__codelineno-53-58" href="#__codelineno-53-58"></a><span class="kt">void</span><span class="w"> </span><span class="n">AmbientOcclusion</span><span class="o">::</span><span class="n">Execute</span><span class="p">(</span><span class="k">const</span><span class="w"> </span><span class="n">RenderTexture</span><span class="o">&amp;</span><span class="w"> </span><span class="n">depthTexture</span><span class="p">,</span><span class="w"> </span><span class="k">const</span><span class="w"> </span><span class="n">RenderTexture</span><span class="o">&amp;</span><span class="w"> </span><span class="n">normalTexture</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-53-59" name="__codelineno-53-59" href="#__codelineno-53-59"></a><span class="w">    </span><span class="c1">// Ensure textures are the correct size</span>
<a id="__codelineno-53-60" name="__codelineno-53-60" href="#__codelineno-53-60"></a><span class="w">    </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">m_SSAOTexture</span><span class="p">.</span><span class="n">GetWidth</span><span class="p">()</span><span class="w"> </span><span class="o">!=</span><span class="w"> </span><span class="n">depthTexture</span><span class="p">.</span><span class="n">GetWidth</span><span class="p">()</span><span class="w"> </span><span class="o">||</span>
<a id="__codelineno-53-61" name="__codelineno-53-61" href="#__codelineno-53-61"></a><span class="w">        </span><span class="n">m_SSAOTexture</span><span class="p">.</span><span class="n">GetHeight</span><span class="p">()</span><span class="w"> </span><span class="o">!=</span><span class="w"> </span><span class="n">depthTexture</span><span class="p">.</span><span class="n">GetHeight</span><span class="p">())</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-53-62" name="__codelineno-53-62" href="#__codelineno-53-62"></a><span class="w">        </span><span class="n">CreateTextures</span><span class="p">(</span><span class="n">depthTexture</span><span class="p">.</span><span class="n">GetWidth</span><span class="p">(),</span><span class="w"> </span><span class="n">depthTexture</span><span class="p">.</span><span class="n">GetHeight</span><span class="p">());</span>
<a id="__codelineno-53-63" name="__codelineno-53-63" href="#__codelineno-53-63"></a><span class="w">    </span><span class="p">}</span>
<a id="__codelineno-53-64" name="__codelineno-53-64" href="#__codelineno-53-64"></a>
<a id="__codelineno-53-65" name="__codelineno-53-65" href="#__codelineno-53-65"></a><span class="w">    </span><span class="c1">// Execute SSAO compute shader</span>
<a id="__codelineno-53-66" name="__codelineno-53-66" href="#__codelineno-53-66"></a><span class="w">    </span><span class="n">m_SSAOShader</span><span class="p">.</span><span class="n">SetTexture</span><span class="p">(</span><span class="s">&quot;depthTexture&quot;</span><span class="p">,</span><span class="w"> </span><span class="n">depthTexture</span><span class="p">);</span>
<a id="__codelineno-53-67" name="__codelineno-53-67" href="#__codelineno-53-67"></a><span class="w">    </span><span class="n">m_SSAOShader</span><span class="p">.</span><span class="n">SetTexture</span><span class="p">(</span><span class="s">&quot;normalTexture&quot;</span><span class="p">,</span><span class="w"> </span><span class="n">normalTexture</span><span class="p">);</span>
<a id="__codelineno-53-68" name="__codelineno-53-68" href="#__codelineno-53-68"></a><span class="w">    </span><span class="n">m_SSAOShader</span><span class="p">.</span><span class="n">SetTexture</span><span class="p">(</span><span class="s">&quot;resultTexture&quot;</span><span class="p">,</span><span class="w"> </span><span class="n">m_SSAOTexture</span><span class="p">);</span>
<a id="__codelineno-53-69" name="__codelineno-53-69" href="#__codelineno-53-69"></a><span class="w">    </span><span class="n">m_SSAOShader</span><span class="p">.</span><span class="n">Dispatch</span><span class="p">(</span><span class="n">m_SSAOTexture</span><span class="p">.</span><span class="n">GetWidth</span><span class="p">()</span><span class="w"> </span><span class="o">/</span><span class="w"> </span><span class="mi">8</span><span class="p">,</span><span class="w"> </span><span class="n">m_SSAOTexture</span><span class="p">.</span><span class="n">GetHeight</span><span class="p">()</span><span class="w"> </span><span class="o">/</span><span class="w"> </span><span class="mi">8</span><span class="p">,</span><span class="w"> </span><span class="mi">1</span><span class="p">);</span>
<a id="__codelineno-53-70" name="__codelineno-53-70" href="#__codelineno-53-70"></a>
<a id="__codelineno-53-71" name="__codelineno-53-71" href="#__codelineno-53-71"></a><span class="w">    </span><span class="c1">// Execute blur compute shader</span>
<a id="__codelineno-53-72" name="__codelineno-53-72" href="#__codelineno-53-72"></a><span class="w">    </span><span class="n">m_BlurShader</span><span class="p">.</span><span class="n">SetTexture</span><span class="p">(</span><span class="s">&quot;inputTexture&quot;</span><span class="p">,</span><span class="w"> </span><span class="n">m_SSAOTexture</span><span class="p">);</span>
<a id="__codelineno-53-73" name="__codelineno-53-73" href="#__codelineno-53-73"></a><span class="w">    </span><span class="n">m_BlurShader</span><span class="p">.</span><span class="n">SetTexture</span><span class="p">(</span><span class="s">&quot;resultTexture&quot;</span><span class="p">,</span><span class="w"> </span><span class="n">m_BlurTexture</span><span class="p">);</span>
<a id="__codelineno-53-74" name="__codelineno-53-74" href="#__codelineno-53-74"></a><span class="w">    </span><span class="n">m_BlurShader</span><span class="p">.</span><span class="n">Dispatch</span><span class="p">(</span><span class="n">m_BlurTexture</span><span class="p">.</span><span class="n">GetWidth</span><span class="p">()</span><span class="w"> </span><span class="o">/</span><span class="w"> </span><span class="mi">8</span><span class="p">,</span><span class="w"> </span><span class="n">m_BlurTexture</span><span class="p">.</span><span class="n">GetHeight</span><span class="p">()</span><span class="w"> </span><span class="o">/</span><span class="w"> </span><span class="mi">8</span><span class="p">,</span><span class="w"> </span><span class="mi">1</span><span class="p">);</span>
<a id="__codelineno-53-75" name="__codelineno-53-75" href="#__codelineno-53-75"></a>
<a id="__codelineno-53-76" name="__codelineno-53-76" href="#__codelineno-53-76"></a><span class="w">    </span><span class="c1">// Copy result to final texture</span>
<a id="__codelineno-53-77" name="__codelineno-53-77" href="#__codelineno-53-77"></a><span class="w">    </span><span class="n">m_RenderSystem</span><span class="o">-&gt;</span><span class="n">CopyTexture</span><span class="p">(</span><span class="n">m_BlurTexture</span><span class="p">,</span><span class="w"> </span><span class="n">m_ResultTexture</span><span class="p">);</span>
<a id="__codelineno-53-78" name="__codelineno-53-78" href="#__codelineno-53-78"></a><span class="p">}</span>
<a id="__codelineno-53-79" name="__codelineno-53-79" href="#__codelineno-53-79"></a>
<a id="__codelineno-53-80" name="__codelineno-53-80" href="#__codelineno-53-80"></a><span class="c1">// SSAO.comp</span>
<a id="__codelineno-53-81" name="__codelineno-53-81" href="#__codelineno-53-81"></a><span class="cp">#version 450</span>
<a id="__codelineno-53-82" name="__codelineno-53-82" href="#__codelineno-53-82"></a>
<a id="__codelineno-53-83" name="__codelineno-53-83" href="#__codelineno-53-83"></a><span class="n">layout</span><span class="p">(</span><span class="n">local_size_x</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">8</span><span class="p">,</span><span class="w"> </span><span class="n">local_size_y</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">8</span><span class="p">)</span><span class="w"> </span><span class="n">in</span><span class="p">;</span>
<a id="__codelineno-53-84" name="__codelineno-53-84" href="#__codelineno-53-84"></a>
<a id="__codelineno-53-85" name="__codelineno-53-85" href="#__codelineno-53-85"></a><span class="n">layout</span><span class="p">(</span><span class="n">binding</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">0</span><span class="p">,</span><span class="w"> </span><span class="n">r32f</span><span class="p">)</span><span class="w"> </span><span class="n">uniform</span><span class="w"> </span><span class="n">readonly</span><span class="w"> </span><span class="n">image2D</span><span class="w"> </span><span class="n">depthTexture</span><span class="p">;</span>
<a id="__codelineno-53-86" name="__codelineno-53-86" href="#__codelineno-53-86"></a><span class="n">layout</span><span class="p">(</span><span class="n">binding</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">1</span><span class="p">,</span><span class="w"> </span><span class="n">rgba32f</span><span class="p">)</span><span class="w"> </span><span class="n">uniform</span><span class="w"> </span><span class="n">readonly</span><span class="w"> </span><span class="n">image2D</span><span class="w"> </span><span class="n">normalTexture</span><span class="p">;</span>
<a id="__codelineno-53-87" name="__codelineno-53-87" href="#__codelineno-53-87"></a><span class="n">layout</span><span class="p">(</span><span class="n">binding</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">2</span><span class="p">,</span><span class="w"> </span><span class="n">r8</span><span class="p">)</span><span class="w"> </span><span class="n">uniform</span><span class="w"> </span><span class="n">writeonly</span><span class="w"> </span><span class="n">image2D</span><span class="w"> </span><span class="n">resultTexture</span><span class="p">;</span>
<a id="__codelineno-53-88" name="__codelineno-53-88" href="#__codelineno-53-88"></a>
<a id="__codelineno-53-89" name="__codelineno-53-89" href="#__codelineno-53-89"></a><span class="c1">// ... Uniform buffer for SSAO parameters</span>
<a id="__codelineno-53-90" name="__codelineno-53-90" href="#__codelineno-53-90"></a>
<a id="__codelineno-53-91" name="__codelineno-53-91" href="#__codelineno-53-91"></a><span class="kt">void</span><span class="w"> </span><span class="nf">main</span><span class="p">()</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-53-92" name="__codelineno-53-92" href="#__codelineno-53-92"></a><span class="w">    </span><span class="n">ivec2</span><span class="w"> </span><span class="n">pixelCoords</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">ivec2</span><span class="p">(</span><span class="n">gl_GlobalInvocationID</span><span class="p">.</span><span class="n">xy</span><span class="p">);</span>
<a id="__codelineno-53-93" name="__codelineno-53-93" href="#__codelineno-53-93"></a>
<a id="__codelineno-53-94" name="__codelineno-53-94" href="#__codelineno-53-94"></a><span class="w">    </span><span class="c1">// Sample depth and normal</span>
<a id="__codelineno-53-95" name="__codelineno-53-95" href="#__codelineno-53-95"></a><span class="w">    </span><span class="kt">float</span><span class="w"> </span><span class="n">depth</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">imageLoad</span><span class="p">(</span><span class="n">depthTexture</span><span class="p">,</span><span class="w"> </span><span class="n">pixelCoords</span><span class="p">).</span><span class="n">r</span><span class="p">;</span>
<a id="__codelineno-53-96" name="__codelineno-53-96" href="#__codelineno-53-96"></a><span class="w">    </span><span class="n">vec3</span><span class="w"> </span><span class="n">normal</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">imageLoad</span><span class="p">(</span><span class="n">normalTexture</span><span class="p">,</span><span class="w"> </span><span class="n">pixelCoords</span><span class="p">).</span><span class="n">xyz</span><span class="p">;</span>
<a id="__codelineno-53-97" name="__codelineno-53-97" href="#__codelineno-53-97"></a>
<a id="__codelineno-53-98" name="__codelineno-53-98" href="#__codelineno-53-98"></a><span class="w">    </span><span class="c1">// Perform SSAO calculation</span>
<a id="__codelineno-53-99" name="__codelineno-53-99" href="#__codelineno-53-99"></a><span class="w">    </span><span class="c1">// ... SSAO algorithm implementation</span>
<a id="__codelineno-53-100" name="__codelineno-53-100" href="#__codelineno-53-100"></a>
<a id="__codelineno-53-101" name="__codelineno-53-101" href="#__codelineno-53-101"></a><span class="w">    </span><span class="c1">// Write result</span>
<a id="__codelineno-53-102" name="__codelineno-53-102" href="#__codelineno-53-102"></a><span class="w">    </span><span class="n">imageStore</span><span class="p">(</span><span class="n">resultTexture</span><span class="p">,</span><span class="w"> </span><span class="n">pixelCoords</span><span class="p">,</span><span class="w"> </span><span class="n">vec4</span><span class="p">(</span><span class="n">aoFactor</span><span class="p">));</span>
<a id="__codelineno-53-103" name="__codelineno-53-103" href="#__codelineno-53-103"></a><span class="p">}</span>
<a id="__codelineno-53-104" name="__codelineno-53-104" href="#__codelineno-53-104"></a>
<a id="__codelineno-53-105" name="__codelineno-53-105" href="#__codelineno-53-105"></a><span class="c1">// SSAOBlur.comp</span>
<a id="__codelineno-53-106" name="__codelineno-53-106" href="#__codelineno-53-106"></a><span class="cp">#version 450</span>
<a id="__codelineno-53-107" name="__codelineno-53-107" href="#__codelineno-53-107"></a>
<a id="__codelineno-53-108" name="__codelineno-53-108" href="#__codelineno-53-108"></a><span class="n">layout</span><span class="p">(</span><span class="n">local_size_x</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">8</span><span class="p">,</span><span class="w"> </span><span class="n">local_size_y</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">8</span><span class="p">)</span><span class="w"> </span><span class="n">in</span><span class="p">;</span>
<a id="__codelineno-53-109" name="__codelineno-53-109" href="#__codelineno-53-109"></a>
<a id="__codelineno-53-110" name="__codelineno-53-110" href="#__codelineno-53-110"></a><span class="n">layout</span><span class="p">(</span><span class="n">binding</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">0</span><span class="p">,</span><span class="w"> </span><span class="n">r8</span><span class="p">)</span><span class="w"> </span><span class="n">uniform</span><span class="w"> </span><span class="n">readonly</span><span class="w"> </span><span class="n">image2D</span><span class="w"> </span><span class="n">inputTexture</span><span class="p">;</span>
<a id="__codelineno-53-111" name="__codelineno-53-111" href="#__codelineno-53-111"></a><span class="n">layout</span><span class="p">(</span><span class="n">binding</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">1</span><span class="p">,</span><span class="w"> </span><span class="n">r8</span><span class="p">)</span><span class="w"> </span><span class="n">uniform</span><span class="w"> </span><span class="n">writeonly</span><span class="w"> </span><span class="n">image2D</span><span class="w"> </span><span class="n">resultTexture</span><span class="p">;</span>
<a id="__codelineno-53-112" name="__codelineno-53-112" href="#__codelineno-53-112"></a>
<a id="__codelineno-53-113" name="__codelineno-53-113" href="#__codelineno-53-113"></a><span class="kt">void</span><span class="w"> </span><span class="nf">main</span><span class="p">()</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-53-114" name="__codelineno-53-114" href="#__codelineno-53-114"></a><span class="w">    </span><span class="n">ivec2</span><span class="w"> </span><span class="n">pixelCoords</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">ivec2</span><span class="p">(</span><span class="n">gl_GlobalInvocationID</span><span class="p">.</span><span class="n">xy</span><span class="p">);</span>
<a id="__codelineno-53-115" name="__codelineno-53-115" href="#__codelineno-53-115"></a>
<a id="__codelineno-53-116" name="__codelineno-53-116" href="#__codelineno-53-116"></a><span class="w">    </span><span class="c1">// Perform bilateral blur</span>
<a id="__codelineno-53-117" name="__codelineno-53-117" href="#__codelineno-53-117"></a><span class="w">    </span><span class="c1">// ... Blur algorithm implementation</span>
<a id="__codelineno-53-118" name="__codelineno-53-118" href="#__codelineno-53-118"></a>
<a id="__codelineno-53-119" name="__codelineno-53-119" href="#__codelineno-53-119"></a><span class="w">    </span><span class="c1">// Write result</span>
<a id="__codelineno-53-120" name="__codelineno-53-120" href="#__codelineno-53-120"></a><span class="w">    </span><span class="n">imageStore</span><span class="p">(</span><span class="n">resultTexture</span><span class="p">,</span><span class="w"> </span><span class="n">pixelCoords</span><span class="p">,</span><span class="w"> </span><span class="n">vec4</span><span class="p">(</span><span class="n">blurredValue</span><span class="p">));</span>
<a id="__codelineno-53-121" name="__codelineno-53-121" href="#__codelineno-53-121"></a><span class="p">}</span>
</code></pre></div>
<p>This implementation showcases a professional approach to SSAO in game development:</p>
<ol>
<li>It uses compute shaders for efficient GPU utilization.</li>
<li>The code is structured for easy integration into a larger rendering system.</li>
<li>It includes a bilateral blur pass for noise reduction.</li>
<li>The implementation is flexible, allowing for easy parameter tuning.</li>
</ol>
<p>To use this in a game engine:</p>
<ol>
<li>Initialize the <code>AmbientOcclusion</code> class with your render system.</li>
<li>In your rendering pipeline, after generating depth and normal buffers:
   <div class="highlight"><pre><span></span><code><a id="__codelineno-54-1" name="__codelineno-54-1" href="#__codelineno-54-1"></a><span class="n">ambientOcclusion</span><span class="p">.</span><span class="n">Execute</span><span class="p">(</span><span class="n">depthTexture</span><span class="p">,</span><span class="w"> </span><span class="n">normalTexture</span><span class="p">);</span>
</code></pre></div></li>
<li>Use the result in your final composition pass:
   <div class="highlight"><pre><span></span><code><a id="__codelineno-55-1" name="__codelineno-55-1" href="#__codelineno-55-1"></a><span class="n">finalCompositionShader</span><span class="p">.</span><span class="n">SetTexture</span><span class="p">(</span><span class="s">&quot;aoTexture&quot;</span><span class="p">,</span><span class="w"> </span><span class="n">ambientOcclusion</span><span class="p">.</span><span class="n">GetResult</span><span class="p">());</span>
</code></pre></div></li>
</ol>
<p>This implementation provides a solid foundation for SSAO in a professional game engine. Further optimizations could include:</p>
<ul>
<li>Multi-frame temporal accumulation for improved quality</li>
<li>Adaptive sampling based on scene complexity</li>
<li>Integration with global illumination techniques</li>
</ul>
<h4 id="ssao-compute-shader">SSAO compute shader</h4>
<div class="highlight"><pre><span></span><code><a id="__codelineno-56-1" name="__codelineno-56-1" href="#__codelineno-56-1"></a><span class="c1">// SSAO.comp</span>
<a id="__codelineno-56-2" name="__codelineno-56-2" href="#__codelineno-56-2"></a><span class="cp">#version 450</span>
<a id="__codelineno-56-3" name="__codelineno-56-3" href="#__codelineno-56-3"></a>
<a id="__codelineno-56-4" name="__codelineno-56-4" href="#__codelineno-56-4"></a><span class="k">layout</span><span class="p">(</span><span class="n">local_size_x</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">8</span><span class="p">,</span><span class="w"> </span><span class="n">local_size_y</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">8</span><span class="p">)</span><span class="w"> </span><span class="k">in</span><span class="p">;</span>
<a id="__codelineno-56-5" name="__codelineno-56-5" href="#__codelineno-56-5"></a>
<a id="__codelineno-56-6" name="__codelineno-56-6" href="#__codelineno-56-6"></a><span class="k">layout</span><span class="p">(</span><span class="n">binding</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mo">0</span><span class="p">,</span><span class="w"> </span><span class="n">r32f</span><span class="p">)</span><span class="w"> </span><span class="k">uniform</span><span class="w"> </span><span class="k">readonly</span><span class="w"> </span><span class="kt">image2D</span><span class="w"> </span><span class="n">depthTexture</span><span class="p">;</span>
<a id="__codelineno-56-7" name="__codelineno-56-7" href="#__codelineno-56-7"></a><span class="k">layout</span><span class="p">(</span><span class="n">binding</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">1</span><span class="p">,</span><span class="w"> </span><span class="n">rgba32f</span><span class="p">)</span><span class="w"> </span><span class="k">uniform</span><span class="w"> </span><span class="k">readonly</span><span class="w"> </span><span class="kt">image2D</span><span class="w"> </span><span class="n">normalTexture</span><span class="p">;</span>
<a id="__codelineno-56-8" name="__codelineno-56-8" href="#__codelineno-56-8"></a><span class="k">layout</span><span class="p">(</span><span class="n">binding</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">2</span><span class="p">,</span><span class="w"> </span><span class="n">r8</span><span class="p">)</span><span class="w"> </span><span class="k">uniform</span><span class="w"> </span><span class="k">writeonly</span><span class="w"> </span><span class="kt">image2D</span><span class="w"> </span><span class="n">resultTexture</span><span class="p">;</span>
<a id="__codelineno-56-9" name="__codelineno-56-9" href="#__codelineno-56-9"></a>
<a id="__codelineno-56-10" name="__codelineno-56-10" href="#__codelineno-56-10"></a><span class="k">layout</span><span class="p">(</span><span class="n">std140</span><span class="p">,</span><span class="w"> </span><span class="n">binding</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">3</span><span class="p">)</span><span class="w"> </span><span class="k">uniform</span><span class="w"> </span><span class="n">SSAOParams</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-56-11" name="__codelineno-56-11" href="#__codelineno-56-11"></a><span class="w">    </span><span class="kt">mat4</span><span class="w"> </span><span class="n">projectionMatrix</span><span class="p">;</span>
<a id="__codelineno-56-12" name="__codelineno-56-12" href="#__codelineno-56-12"></a><span class="w">    </span><span class="kt">mat4</span><span class="w"> </span><span class="n">inverseProjectionMatrix</span><span class="p">;</span>
<a id="__codelineno-56-13" name="__codelineno-56-13" href="#__codelineno-56-13"></a><span class="w">    </span><span class="kt">float</span><span class="w"> </span><span class="n">radius</span><span class="p">;</span>
<a id="__codelineno-56-14" name="__codelineno-56-14" href="#__codelineno-56-14"></a><span class="w">    </span><span class="kt">float</span><span class="w"> </span><span class="n">bias</span><span class="p">;</span>
<a id="__codelineno-56-15" name="__codelineno-56-15" href="#__codelineno-56-15"></a><span class="w">    </span><span class="kt">float</span><span class="w"> </span><span class="n">intensityMultiplier</span><span class="p">;</span>
<a id="__codelineno-56-16" name="__codelineno-56-16" href="#__codelineno-56-16"></a><span class="w">    </span><span class="kt">int</span><span class="w"> </span><span class="n">kernelSize</span><span class="p">;</span>
<a id="__codelineno-56-17" name="__codelineno-56-17" href="#__codelineno-56-17"></a><span class="p">};</span>
<a id="__codelineno-56-18" name="__codelineno-56-18" href="#__codelineno-56-18"></a>
<a id="__codelineno-56-19" name="__codelineno-56-19" href="#__codelineno-56-19"></a><span class="k">layout</span><span class="p">(</span><span class="n">std140</span><span class="p">,</span><span class="w"> </span><span class="n">binding</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">4</span><span class="p">)</span><span class="w"> </span><span class="k">uniform</span><span class="w"> </span><span class="n">SSAOKernel</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-56-20" name="__codelineno-56-20" href="#__codelineno-56-20"></a><span class="w">    </span><span class="kt">vec4</span><span class="w"> </span><span class="n">samples</span><span class="p">[</span><span class="mi">64</span><span class="p">];</span><span class="w"> </span><span class="c1">// Up to 64 samples</span>
<a id="__codelineno-56-21" name="__codelineno-56-21" href="#__codelineno-56-21"></a><span class="p">};</span>
<a id="__codelineno-56-22" name="__codelineno-56-22" href="#__codelineno-56-22"></a>
<a id="__codelineno-56-23" name="__codelineno-56-23" href="#__codelineno-56-23"></a><span class="k">layout</span><span class="p">(</span><span class="n">binding</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">5</span><span class="p">)</span><span class="w"> </span><span class="k">uniform</span><span class="w"> </span><span class="kt">sampler2D</span><span class="w"> </span><span class="n">noiseTexture</span><span class="p">;</span>
<a id="__codelineno-56-24" name="__codelineno-56-24" href="#__codelineno-56-24"></a>
<a id="__codelineno-56-25" name="__codelineno-56-25" href="#__codelineno-56-25"></a><span class="k">const</span><span class="w"> </span><span class="kt">vec2</span><span class="w"> </span><span class="n">noiseScale</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="kt">vec2</span><span class="p">(</span><span class="mf">1600.0</span><span class="w"> </span><span class="o">/</span><span class="w"> </span><span class="mf">4.0</span><span class="p">,</span><span class="w"> </span><span class="mf">900.0</span><span class="w"> </span><span class="o">/</span><span class="w"> </span><span class="mf">4.0</span><span class="p">);</span><span class="w"> </span><span class="c1">// Adjust based on your screen resolution</span>
<a id="__codelineno-56-26" name="__codelineno-56-26" href="#__codelineno-56-26"></a>
<a id="__codelineno-56-27" name="__codelineno-56-27" href="#__codelineno-56-27"></a><span class="kt">vec3</span><span class="w"> </span><span class="n">getPositionFromDepth</span><span class="p">(</span><span class="kt">vec2</span><span class="w"> </span><span class="n">uv</span><span class="p">,</span><span class="w"> </span><span class="kt">float</span><span class="w"> </span><span class="n">depth</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-56-28" name="__codelineno-56-28" href="#__codelineno-56-28"></a><span class="w">    </span><span class="kt">vec4</span><span class="w"> </span><span class="n">clipSpacePosition</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="kt">vec4</span><span class="p">(</span><span class="n">uv</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="mf">2.0</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="mf">1.0</span><span class="p">,</span><span class="w"> </span><span class="n">depth</span><span class="p">,</span><span class="w"> </span><span class="mf">1.0</span><span class="p">);</span>
<a id="__codelineno-56-29" name="__codelineno-56-29" href="#__codelineno-56-29"></a><span class="w">    </span><span class="kt">vec4</span><span class="w"> </span><span class="n">viewSpacePosition</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">inverseProjectionMatrix</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="n">clipSpacePosition</span><span class="p">;</span>
<a id="__codelineno-56-30" name="__codelineno-56-30" href="#__codelineno-56-30"></a><span class="w">    </span><span class="k">return</span><span class="w"> </span><span class="n">viewSpacePosition</span><span class="p">.</span><span class="n">xyz</span><span class="w"> </span><span class="o">/</span><span class="w"> </span><span class="n">viewSpacePosition</span><span class="p">.</span><span class="n">w</span><span class="p">;</span>
<a id="__codelineno-56-31" name="__codelineno-56-31" href="#__codelineno-56-31"></a><span class="p">}</span>
<a id="__codelineno-56-32" name="__codelineno-56-32" href="#__codelineno-56-32"></a>
<a id="__codelineno-56-33" name="__codelineno-56-33" href="#__codelineno-56-33"></a><span class="kt">void</span><span class="w"> </span><span class="n">main</span><span class="p">()</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-56-34" name="__codelineno-56-34" href="#__codelineno-56-34"></a><span class="w">    </span><span class="kt">ivec2</span><span class="w"> </span><span class="n">pixelCoords</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="kt">ivec2</span><span class="p">(</span><span class="nb">gl_GlobalInvocationID</span><span class="p">.</span><span class="n">xy</span><span class="p">);</span>
<a id="__codelineno-56-35" name="__codelineno-56-35" href="#__codelineno-56-35"></a><span class="w">    </span><span class="kt">vec2</span><span class="w"> </span><span class="n">texCoords</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="kt">vec2</span><span class="p">(</span><span class="n">pixelCoords</span><span class="p">)</span><span class="w"> </span><span class="o">/</span><span class="w"> </span><span class="kt">vec2</span><span class="p">(</span><span class="n">imageSize</span><span class="p">(</span><span class="n">depthTexture</span><span class="p">));</span>
<a id="__codelineno-56-36" name="__codelineno-56-36" href="#__codelineno-56-36"></a>
<a id="__codelineno-56-37" name="__codelineno-56-37" href="#__codelineno-56-37"></a><span class="w">    </span><span class="kt">float</span><span class="w"> </span><span class="n">depth</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">imageLoad</span><span class="p">(</span><span class="n">depthTexture</span><span class="p">,</span><span class="w"> </span><span class="n">pixelCoords</span><span class="p">).</span><span class="n">r</span><span class="p">;</span>
<a id="__codelineno-56-38" name="__codelineno-56-38" href="#__codelineno-56-38"></a><span class="w">    </span><span class="kt">vec3</span><span class="w"> </span><span class="n">normal</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">normalize</span><span class="p">(</span><span class="n">imageLoad</span><span class="p">(</span><span class="n">normalTexture</span><span class="p">,</span><span class="w"> </span><span class="n">pixelCoords</span><span class="p">).</span><span class="n">xyz</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="mf">2.0</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="mf">1.0</span><span class="p">);</span>
<a id="__codelineno-56-39" name="__codelineno-56-39" href="#__codelineno-56-39"></a><span class="w">    </span><span class="kt">vec3</span><span class="w"> </span><span class="n">position</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">getPositionFromDepth</span><span class="p">(</span><span class="n">texCoords</span><span class="p">,</span><span class="w"> </span><span class="n">depth</span><span class="p">);</span>
<a id="__codelineno-56-40" name="__codelineno-56-40" href="#__codelineno-56-40"></a>
<a id="__codelineno-56-41" name="__codelineno-56-41" href="#__codelineno-56-41"></a><span class="w">    </span><span class="kt">vec3</span><span class="w"> </span><span class="n">randomVec</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">normalize</span><span class="p">(</span><span class="n">texture</span><span class="p">(</span><span class="n">noiseTexture</span><span class="p">,</span><span class="w"> </span><span class="n">texCoords</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="n">noiseScale</span><span class="p">).</span><span class="n">xyz</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="mf">2.0</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="mf">1.0</span><span class="p">);</span>
<a id="__codelineno-56-42" name="__codelineno-56-42" href="#__codelineno-56-42"></a><span class="w">    </span><span class="kt">vec3</span><span class="w"> </span><span class="n">tangent</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">normalize</span><span class="p">(</span><span class="n">randomVec</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="n">normal</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="n">dot</span><span class="p">(</span><span class="n">randomVec</span><span class="p">,</span><span class="w"> </span><span class="n">normal</span><span class="p">));</span>
<a id="__codelineno-56-43" name="__codelineno-56-43" href="#__codelineno-56-43"></a><span class="w">    </span><span class="kt">vec3</span><span class="w"> </span><span class="n">bitangent</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">cross</span><span class="p">(</span><span class="n">normal</span><span class="p">,</span><span class="w"> </span><span class="n">tangent</span><span class="p">);</span>
<a id="__codelineno-56-44" name="__codelineno-56-44" href="#__codelineno-56-44"></a><span class="w">    </span><span class="kt">mat3</span><span class="w"> </span><span class="n">TBN</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="kt">mat3</span><span class="p">(</span><span class="n">tangent</span><span class="p">,</span><span class="w"> </span><span class="n">bitangent</span><span class="p">,</span><span class="w"> </span><span class="n">normal</span><span class="p">);</span>
<a id="__codelineno-56-45" name="__codelineno-56-45" href="#__codelineno-56-45"></a>
<a id="__codelineno-56-46" name="__codelineno-56-46" href="#__codelineno-56-46"></a><span class="w">    </span><span class="kt">float</span><span class="w"> </span><span class="n">occlusion</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mf">0.0</span><span class="p">;</span>
<a id="__codelineno-56-47" name="__codelineno-56-47" href="#__codelineno-56-47"></a><span class="w">    </span><span class="k">for</span><span class="w"> </span><span class="p">(</span><span class="kt">int</span><span class="w"> </span><span class="n">i</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mo">0</span><span class="p">;</span><span class="w"> </span><span class="n">i</span><span class="w"> </span><span class="o">&lt;</span><span class="w"> </span><span class="n">kernelSize</span><span class="p">;</span><span class="w"> </span><span class="o">++</span><span class="n">i</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-56-48" name="__codelineno-56-48" href="#__codelineno-56-48"></a><span class="w">        </span><span class="kt">vec3</span><span class="w"> </span><span class="n">samplePos</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">TBN</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="n">samples</span><span class="p">[</span><span class="n">i</span><span class="p">].</span><span class="n">xyz</span><span class="p">;</span>
<a id="__codelineno-56-49" name="__codelineno-56-49" href="#__codelineno-56-49"></a><span class="w">        </span><span class="n">samplePos</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">position</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="n">samplePos</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="n">radius</span><span class="p">;</span>
<a id="__codelineno-56-50" name="__codelineno-56-50" href="#__codelineno-56-50"></a>
<a id="__codelineno-56-51" name="__codelineno-56-51" href="#__codelineno-56-51"></a><span class="w">        </span><span class="kt">vec4</span><span class="w"> </span><span class="n">offset</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">projectionMatrix</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="kt">vec4</span><span class="p">(</span><span class="n">samplePos</span><span class="p">,</span><span class="w"> </span><span class="mf">1.0</span><span class="p">);</span>
<a id="__codelineno-56-52" name="__codelineno-56-52" href="#__codelineno-56-52"></a><span class="w">        </span><span class="n">offset</span><span class="p">.</span><span class="n">xyz</span><span class="w"> </span><span class="o">/=</span><span class="w"> </span><span class="n">offset</span><span class="p">.</span><span class="n">w</span><span class="p">;</span>
<a id="__codelineno-56-53" name="__codelineno-56-53" href="#__codelineno-56-53"></a><span class="w">        </span><span class="n">offset</span><span class="p">.</span><span class="n">xyz</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">offset</span><span class="p">.</span><span class="n">xyz</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="mf">0.5</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="mf">0.5</span><span class="p">;</span>
<a id="__codelineno-56-54" name="__codelineno-56-54" href="#__codelineno-56-54"></a>
<a id="__codelineno-56-55" name="__codelineno-56-55" href="#__codelineno-56-55"></a><span class="w">        </span><span class="kt">float</span><span class="w"> </span><span class="n">sampleDepth</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">imageLoad</span><span class="p">(</span><span class="n">depthTexture</span><span class="p">,</span><span class="w"> </span><span class="kt">ivec2</span><span class="p">(</span><span class="n">offset</span><span class="p">.</span><span class="n">xy</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="kt">vec2</span><span class="p">(</span><span class="n">imageSize</span><span class="p">(</span><span class="n">depthTexture</span><span class="p">)))).</span><span class="n">r</span><span class="p">;</span>
<a id="__codelineno-56-56" name="__codelineno-56-56" href="#__codelineno-56-56"></a><span class="w">        </span><span class="kt">vec3</span><span class="w"> </span><span class="n">samplePosView</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">getPositionFromDepth</span><span class="p">(</span><span class="n">offset</span><span class="p">.</span><span class="n">xy</span><span class="p">,</span><span class="w"> </span><span class="n">sampleDepth</span><span class="p">);</span>
<a id="__codelineno-56-57" name="__codelineno-56-57" href="#__codelineno-56-57"></a>
<a id="__codelineno-56-58" name="__codelineno-56-58" href="#__codelineno-56-58"></a><span class="w">        </span><span class="kt">float</span><span class="w"> </span><span class="n">rangeCheck</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">smoothstep</span><span class="p">(</span><span class="mf">0.0</span><span class="p">,</span><span class="w"> </span><span class="mf">1.0</span><span class="p">,</span><span class="w"> </span><span class="n">radius</span><span class="w"> </span><span class="o">/</span><span class="w"> </span><span class="n">abs</span><span class="p">(</span><span class="n">position</span><span class="p">.</span><span class="n">z</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="n">samplePosView</span><span class="p">.</span><span class="n">z</span><span class="p">));</span>
<a id="__codelineno-56-59" name="__codelineno-56-59" href="#__codelineno-56-59"></a><span class="w">        </span><span class="n">occlusion</span><span class="w"> </span><span class="o">+=</span><span class="w"> </span><span class="p">(</span><span class="n">samplePosView</span><span class="p">.</span><span class="n">z</span><span class="w"> </span><span class="o">&gt;=</span><span class="w"> </span><span class="n">samplePos</span><span class="p">.</span><span class="n">z</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="n">bias</span><span class="w"> </span><span class="o">?</span><span class="w"> </span><span class="mf">1.0</span><span class="w"> </span><span class="o">:</span><span class="w"> </span><span class="mf">0.0</span><span class="p">)</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="n">rangeCheck</span><span class="p">;</span>
<a id="__codelineno-56-60" name="__codelineno-56-60" href="#__codelineno-56-60"></a><span class="w">    </span><span class="p">}</span>
<a id="__codelineno-56-61" name="__codelineno-56-61" href="#__codelineno-56-61"></a>
<a id="__codelineno-56-62" name="__codelineno-56-62" href="#__codelineno-56-62"></a><span class="w">    </span><span class="n">occlusion</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mf">1.0</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="p">(</span><span class="n">occlusion</span><span class="w"> </span><span class="o">/</span><span class="w"> </span><span class="kt">float</span><span class="p">(</span><span class="n">kernelSize</span><span class="p">));</span>
<a id="__codelineno-56-63" name="__codelineno-56-63" href="#__codelineno-56-63"></a><span class="w">    </span><span class="n">occlusion</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">pow</span><span class="p">(</span><span class="n">occlusion</span><span class="p">,</span><span class="w"> </span><span class="n">intensityMultiplier</span><span class="p">);</span>
<a id="__codelineno-56-64" name="__codelineno-56-64" href="#__codelineno-56-64"></a>
<a id="__codelineno-56-65" name="__codelineno-56-65" href="#__codelineno-56-65"></a><span class="w">    </span><span class="n">imageStore</span><span class="p">(</span><span class="n">resultTexture</span><span class="p">,</span><span class="w"> </span><span class="n">pixelCoords</span><span class="p">,</span><span class="w"> </span><span class="kt">vec4</span><span class="p">(</span><span class="n">occlusion</span><span class="p">));</span>
<a id="__codelineno-56-66" name="__codelineno-56-66" href="#__codelineno-56-66"></a><span class="p">}</span>
</code></pre></div>
<h4 id="blur-compute-shader">Blur Compute Shader</h4>
<p>Now, let's complete the blur compute shader:</p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-57-1" name="__codelineno-57-1" href="#__codelineno-57-1"></a><span class="c1">// SSAOBlur.comp</span>
<a id="__codelineno-57-2" name="__codelineno-57-2" href="#__codelineno-57-2"></a><span class="cp">#version 450</span>
<a id="__codelineno-57-3" name="__codelineno-57-3" href="#__codelineno-57-3"></a>
<a id="__codelineno-57-4" name="__codelineno-57-4" href="#__codelineno-57-4"></a><span class="k">layout</span><span class="p">(</span><span class="n">local_size_x</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">8</span><span class="p">,</span><span class="w"> </span><span class="n">local_size_y</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">8</span><span class="p">)</span><span class="w"> </span><span class="k">in</span><span class="p">;</span>
<a id="__codelineno-57-5" name="__codelineno-57-5" href="#__codelineno-57-5"></a>
<a id="__codelineno-57-6" name="__codelineno-57-6" href="#__codelineno-57-6"></a><span class="k">layout</span><span class="p">(</span><span class="n">binding</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mo">0</span><span class="p">,</span><span class="w"> </span><span class="n">r8</span><span class="p">)</span><span class="w"> </span><span class="k">uniform</span><span class="w"> </span><span class="k">readonly</span><span class="w"> </span><span class="kt">image2D</span><span class="w"> </span><span class="n">inputTexture</span><span class="p">;</span>
<a id="__codelineno-57-7" name="__codelineno-57-7" href="#__codelineno-57-7"></a><span class="k">layout</span><span class="p">(</span><span class="n">binding</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">1</span><span class="p">,</span><span class="w"> </span><span class="n">r8</span><span class="p">)</span><span class="w"> </span><span class="k">uniform</span><span class="w"> </span><span class="k">writeonly</span><span class="w"> </span><span class="kt">image2D</span><span class="w"> </span><span class="n">resultTexture</span><span class="p">;</span>
<a id="__codelineno-57-8" name="__codelineno-57-8" href="#__codelineno-57-8"></a>
<a id="__codelineno-57-9" name="__codelineno-57-9" href="#__codelineno-57-9"></a><span class="k">const</span><span class="w"> </span><span class="kt">float</span><span class="w"> </span><span class="n">BLUR_RADIUS</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mf">2.0</span><span class="p">;</span>
<a id="__codelineno-57-10" name="__codelineno-57-10" href="#__codelineno-57-10"></a><span class="k">const</span><span class="w"> </span><span class="kt">float</span><span class="w"> </span><span class="n">BLUR_SHARPNESS</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mf">40.0</span><span class="p">;</span>
<a id="__codelineno-57-11" name="__codelineno-57-11" href="#__codelineno-57-11"></a>
<a id="__codelineno-57-12" name="__codelineno-57-12" href="#__codelineno-57-12"></a><span class="kt">void</span><span class="w"> </span><span class="n">main</span><span class="p">()</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-57-13" name="__codelineno-57-13" href="#__codelineno-57-13"></a><span class="w">    </span><span class="kt">ivec2</span><span class="w"> </span><span class="n">pixelCoords</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="kt">ivec2</span><span class="p">(</span><span class="nb">gl_GlobalInvocationID</span><span class="p">.</span><span class="n">xy</span><span class="p">);</span>
<a id="__codelineno-57-14" name="__codelineno-57-14" href="#__codelineno-57-14"></a><span class="w">    </span><span class="kt">vec2</span><span class="w"> </span><span class="n">texCoords</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="kt">vec2</span><span class="p">(</span><span class="n">pixelCoords</span><span class="p">)</span><span class="w"> </span><span class="o">/</span><span class="w"> </span><span class="kt">vec2</span><span class="p">(</span><span class="n">imageSize</span><span class="p">(</span><span class="n">inputTexture</span><span class="p">));</span>
<a id="__codelineno-57-15" name="__codelineno-57-15" href="#__codelineno-57-15"></a>
<a id="__codelineno-57-16" name="__codelineno-57-16" href="#__codelineno-57-16"></a><span class="w">    </span><span class="kt">float</span><span class="w"> </span><span class="n">result</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mf">0.0</span><span class="p">;</span>
<a id="__codelineno-57-17" name="__codelineno-57-17" href="#__codelineno-57-17"></a><span class="w">    </span><span class="kt">float</span><span class="w"> </span><span class="n">weightSum</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mf">0.0</span><span class="p">;</span>
<a id="__codelineno-57-18" name="__codelineno-57-18" href="#__codelineno-57-18"></a>
<a id="__codelineno-57-19" name="__codelineno-57-19" href="#__codelineno-57-19"></a><span class="w">    </span><span class="k">for</span><span class="w"> </span><span class="p">(</span><span class="kt">float</span><span class="w"> </span><span class="n">x</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="o">-</span><span class="n">BLUR_RADIUS</span><span class="p">;</span><span class="w"> </span><span class="n">x</span><span class="w"> </span><span class="o">&lt;=</span><span class="w"> </span><span class="n">BLUR_RADIUS</span><span class="p">;</span><span class="w"> </span><span class="n">x</span><span class="w"> </span><span class="o">+=</span><span class="w"> </span><span class="mf">1.0</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-57-20" name="__codelineno-57-20" href="#__codelineno-57-20"></a><span class="w">        </span><span class="k">for</span><span class="w"> </span><span class="p">(</span><span class="kt">float</span><span class="w"> </span><span class="n">y</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="o">-</span><span class="n">BLUR_RADIUS</span><span class="p">;</span><span class="w"> </span><span class="n">y</span><span class="w"> </span><span class="o">&lt;=</span><span class="w"> </span><span class="n">BLUR_RADIUS</span><span class="p">;</span><span class="w"> </span><span class="n">y</span><span class="w"> </span><span class="o">+=</span><span class="w"> </span><span class="mf">1.0</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-57-21" name="__codelineno-57-21" href="#__codelineno-57-21"></a><span class="w">            </span><span class="kt">ivec2</span><span class="w"> </span><span class="n">sampleCoord</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">pixelCoords</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="kt">ivec2</span><span class="p">(</span><span class="n">x</span><span class="p">,</span><span class="w"> </span><span class="n">y</span><span class="p">);</span>
<a id="__codelineno-57-22" name="__codelineno-57-22" href="#__codelineno-57-22"></a><span class="w">            </span><span class="kt">float</span><span class="w"> </span><span class="k">sample</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">imageLoad</span><span class="p">(</span><span class="n">inputTexture</span><span class="p">,</span><span class="w"> </span><span class="n">sampleCoord</span><span class="p">).</span><span class="n">r</span><span class="p">;</span>
<a id="__codelineno-57-23" name="__codelineno-57-23" href="#__codelineno-57-23"></a>
<a id="__codelineno-57-24" name="__codelineno-57-24" href="#__codelineno-57-24"></a><span class="w">            </span><span class="kt">float</span><span class="w"> </span><span class="n">weight</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">exp</span><span class="p">(</span><span class="o">-</span><span class="n">dot</span><span class="p">(</span><span class="kt">vec2</span><span class="p">(</span><span class="n">x</span><span class="p">,</span><span class="w"> </span><span class="n">y</span><span class="p">),</span><span class="w"> </span><span class="kt">vec2</span><span class="p">(</span><span class="n">x</span><span class="p">,</span><span class="w"> </span><span class="n">y</span><span class="p">))</span><span class="w"> </span><span class="o">/</span><span class="w"> </span><span class="p">(</span><span class="mf">2.0</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="n">BLUR_SHARPNESS</span><span class="p">));</span>
<a id="__codelineno-57-25" name="__codelineno-57-25" href="#__codelineno-57-25"></a><span class="w">            </span><span class="n">result</span><span class="w"> </span><span class="o">+=</span><span class="w"> </span><span class="k">sample</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="n">weight</span><span class="p">;</span>
<a id="__codelineno-57-26" name="__codelineno-57-26" href="#__codelineno-57-26"></a><span class="w">            </span><span class="n">weightSum</span><span class="w"> </span><span class="o">+=</span><span class="w"> </span><span class="n">weight</span><span class="p">;</span>
<a id="__codelineno-57-27" name="__codelineno-57-27" href="#__codelineno-57-27"></a><span class="w">        </span><span class="p">}</span>
<a id="__codelineno-57-28" name="__codelineno-57-28" href="#__codelineno-57-28"></a><span class="w">    </span><span class="p">}</span>
<a id="__codelineno-57-29" name="__codelineno-57-29" href="#__codelineno-57-29"></a>
<a id="__codelineno-57-30" name="__codelineno-57-30" href="#__codelineno-57-30"></a><span class="w">    </span><span class="n">result</span><span class="w"> </span><span class="o">/=</span><span class="w"> </span><span class="n">weightSum</span><span class="p">;</span>
<a id="__codelineno-57-31" name="__codelineno-57-31" href="#__codelineno-57-31"></a><span class="w">    </span><span class="n">imageStore</span><span class="p">(</span><span class="n">resultTexture</span><span class="p">,</span><span class="w"> </span><span class="n">pixelCoords</span><span class="p">,</span><span class="w"> </span><span class="kt">vec4</span><span class="p">(</span><span class="n">result</span><span class="p">));</span>
<a id="__codelineno-57-32" name="__codelineno-57-32" href="#__codelineno-57-32"></a><span class="p">}</span>
</code></pre></div>
<p>Now, let's explain these shaders in detail:</p>
<h4 id="ssao-compute-shader-explanation">SSAO Compute Shader Explanation:</h4>
<ol>
<li>
<p>Input and Output:</p>
<ul>
<li>We read from a depth texture and a normal texture.</li>
<li>We write to a result texture that will store the ambient occlusion factor.</li>
</ul>
</li>
<li>
<p>Uniforms:</p>
<ul>
<li>We have a uniform buffer for SSAO parameters, including projection matrices, radius, bias, and kernel size.</li>
<li>Another uniform buffer contains the sample kernel (up to 64 samples).</li>
<li>We use a noise texture for randomization.</li>
</ul>
</li>
<li>
<p>Helper Function:</p>
<ul>
<li><code>getPositionFromDepth</code>: Reconstructs the view-space position from depth and UV coordinates.</li>
</ul>
</li>
<li>
<p>Main Algorithm:</p>
<ol>
<li>We start by getting the depth, normal, and position for the current pixel.</li>
<li>We create a random rotation vector using the noise texture and construct a tangent space basis (TBN matrix).</li>
<li>We iterate through the sample kernel:    <ul>
<li>Transform the sample to tangent space and then to view space.</li>
<li>Project the sample position to get its screen-space coordinates.</li>
<li>Compare the sample's depth with the depth at its projected position.</li>
<li>If the sample is occluded, contribute to the occlusion factor.</li>
</ul>
</li>
<li>We normalize the occlusion factor, apply the intensity multiplier, and store the result.</li>
</ol>
</li>
<li>
<p>Optimizations:</p>
<ul>
<li>We use a range check to reduce the influence of distant samples.</li>
<li>The noise texture helps reduce banding artifacts.</li>
</ul>
</li>
</ol>
<h4 id="blur-compute-shader-explanation">Blur Compute Shader Explanation:</h4>
<ol>
<li>
<p>Input and Output:</p>
<ul>
<li>We read from the SSAO result texture and write to a new texture for the blurred result.</li>
</ul>
</li>
<li>
<p>Algorithm:</p>
<ul>
<li>We implement a bilateral blur, which preserves edges better than a simple Gaussian blur.</li>
<li>We iterate over a small neighborhood (defined by BLUR_RADIUS).</li>
<li>For each sample in the neighborhood, we calculate a weight based on its distance from the center.</li>
<li>We accumulate the weighted samples and normalize by the sum of weights.</li>
</ul>
</li>
<li>
<p>Parameters:</p>
<ul>
<li>BLUR_RADIUS: Determines the size of the blur kernel.</li>
<li>BLUR_SHARPNESS: Controls how quickly the weight falls off with distance.</li>
</ul>
</li>
</ol>
<p>These shaders work together to produce a high-quality SSAO effect:</p>
<ol>
<li>The SSAO shader computes the initial occlusion values by sampling the depth buffer around each pixel.</li>
<li>The blur shader then smooths out the SSAO result, reducing noise while preserving important edges in the scene.</li>
</ol>
<p>This implementation is efficient and produces good results, but there's always room for further optimization and quality improvements, such as:</p>
<ul>
<li>Using interleaved sampling patterns to reduce sample count</li>
<li>Implementing temporal accumulation to improve stability across frames</li>
<li>Adapting sample radius based on scene depth to improve detail preservation</li>
</ul>
<h2 id="texturing">Texturing</h2>
<p>Texturing is a technique used to add detail, color, and texture to 3D models in computer graphics. Various advanced techniques enhance the visual richness and realism of textures. Here are some key concepts:</p>
<h4 id="uv-mapping">UV Mapping</h4>
<p>UV mapping is the process of projecting a 2D texture onto the surface of a 3D model. The UV coordinates determine how the texture is applied to the model's surface.</p>
<ul>
<li><strong>Purpose:</strong> To map a 2D image (texture) onto a 3D model.</li>
<li>
<p><strong>Key Concepts:</strong> UV coordinates, unwrapping, texture space.</p>
</li>
<li>
<p><strong>Example:</strong> Basic UV mapping.</p>
</li>
</ul>
<div class="highlight"><pre><span></span><code><a id="__codelineno-58-1" name="__codelineno-58-1" href="#__codelineno-58-1"></a><span class="cp">#version 330 core</span>
<a id="__codelineno-58-2" name="__codelineno-58-2" href="#__codelineno-58-2"></a>
<a id="__codelineno-58-3" name="__codelineno-58-3" href="#__codelineno-58-3"></a><span class="k">layout</span><span class="p">(</span><span class="n">location</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mo">0</span><span class="p">)</span><span class="w"> </span><span class="k">in</span><span class="w"> </span><span class="kt">vec3</span><span class="w"> </span><span class="n">aPos</span><span class="p">;</span><span class="w"> </span><span class="c1">// Vertex position</span>
<a id="__codelineno-58-4" name="__codelineno-58-4" href="#__codelineno-58-4"></a><span class="k">layout</span><span class="p">(</span><span class="n">location</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">1</span><span class="p">)</span><span class="w"> </span><span class="k">in</span><span class="w"> </span><span class="kt">vec2</span><span class="w"> </span><span class="n">aTexCoords</span><span class="p">;</span><span class="w"> </span><span class="c1">// UV coordinates</span>
<a id="__codelineno-58-5" name="__codelineno-58-5" href="#__codelineno-58-5"></a>
<a id="__codelineno-58-6" name="__codelineno-58-6" href="#__codelineno-58-6"></a><span class="k">uniform</span><span class="w"> </span><span class="kt">mat4</span><span class="w"> </span><span class="n">model</span><span class="p">;</span>
<a id="__codelineno-58-7" name="__codelineno-58-7" href="#__codelineno-58-7"></a><span class="k">uniform</span><span class="w"> </span><span class="kt">mat4</span><span class="w"> </span><span class="n">view</span><span class="p">;</span>
<a id="__codelineno-58-8" name="__codelineno-58-8" href="#__codelineno-58-8"></a><span class="k">uniform</span><span class="w"> </span><span class="kt">mat4</span><span class="w"> </span><span class="n">projection</span><span class="p">;</span>
<a id="__codelineno-58-9" name="__codelineno-58-9" href="#__codelineno-58-9"></a><span class="k">uniform</span><span class="w"> </span><span class="kt">sampler2D</span><span class="w"> </span><span class="n">texture1</span><span class="p">;</span>
<a id="__codelineno-58-10" name="__codelineno-58-10" href="#__codelineno-58-10"></a>
<a id="__codelineno-58-11" name="__codelineno-58-11" href="#__codelineno-58-11"></a><span class="k">out</span><span class="w"> </span><span class="kt">vec2</span><span class="w"> </span><span class="n">TexCoords</span><span class="p">;</span>
<a id="__codelineno-58-12" name="__codelineno-58-12" href="#__codelineno-58-12"></a>
<a id="__codelineno-58-13" name="__codelineno-58-13" href="#__codelineno-58-13"></a><span class="kt">void</span><span class="w"> </span><span class="n">main</span><span class="p">()</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-58-14" name="__codelineno-58-14" href="#__codelineno-58-14"></a><span class="w">    </span><span class="nb">gl_Position</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">projection</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="n">view</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="n">model</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="kt">vec4</span><span class="p">(</span><span class="n">aPos</span><span class="p">,</span><span class="w"> </span><span class="mf">1.0</span><span class="p">);</span>
<a id="__codelineno-58-15" name="__codelineno-58-15" href="#__codelineno-58-15"></a><span class="w">    </span><span class="n">TexCoords</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">aTexCoords</span><span class="p">;</span><span class="w"> </span><span class="c1">// Pass UV coordinates to the fragment shader</span>
<a id="__codelineno-58-16" name="__codelineno-58-16" href="#__codelineno-58-16"></a><span class="p">}</span>
</code></pre></div>
<div class="highlight"><pre><span></span><code><a id="__codelineno-59-1" name="__codelineno-59-1" href="#__codelineno-59-1"></a><span class="cp">#version 330 core</span>
<a id="__codelineno-59-2" name="__codelineno-59-2" href="#__codelineno-59-2"></a>
<a id="__codelineno-59-3" name="__codelineno-59-3" href="#__codelineno-59-3"></a><span class="k">in</span><span class="w"> </span><span class="kt">vec2</span><span class="w"> </span><span class="n">TexCoords</span><span class="p">;</span><span class="w"> </span><span class="c1">// UV coordinates from the vertex shader</span>
<a id="__codelineno-59-4" name="__codelineno-59-4" href="#__codelineno-59-4"></a><span class="k">uniform</span><span class="w"> </span><span class="kt">sampler2D</span><span class="w"> </span><span class="n">texture1</span><span class="p">;</span>
<a id="__codelineno-59-5" name="__codelineno-59-5" href="#__codelineno-59-5"></a><span class="k">out</span><span class="w"> </span><span class="kt">vec4</span><span class="w"> </span><span class="n">FragColor</span><span class="p">;</span>
<a id="__codelineno-59-6" name="__codelineno-59-6" href="#__codelineno-59-6"></a>
<a id="__codelineno-59-7" name="__codelineno-59-7" href="#__codelineno-59-7"></a><span class="kt">void</span><span class="w"> </span><span class="n">main</span><span class="p">()</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-59-8" name="__codelineno-59-8" href="#__codelineno-59-8"></a><span class="w">    </span><span class="n">FragColor</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">texture</span><span class="p">(</span><span class="n">texture1</span><span class="p">,</span><span class="w"> </span><span class="n">TexCoords</span><span class="p">);</span><span class="w"> </span><span class="c1">// Sample the texture</span>
<a id="__codelineno-59-9" name="__codelineno-59-9" href="#__codelineno-59-9"></a><span class="p">}</span>
</code></pre></div>
<p>In this example, the vertex shader passes UV coordinates to the fragment shader, which then samples the texture using those coordinates.</p>
<h4 id="texture-atlases">Texture Atlases</h4>
<p>A texture atlas is a large texture that contains a collection of smaller textures. It allows multiple textures to be combined into a single texture to reduce draw calls and improve performance.</p>
<ul>
<li><strong>Purpose:</strong> Optimize rendering by reducing the number of texture binds and draw calls.</li>
<li>
<p><strong>Key Concepts:</strong> Atlas coordinates, UV offsets.</p>
</li>
<li>
<p><strong>Example:</strong> Using a texture atlas.</p>
</li>
</ul>
<div class="highlight"><pre><span></span><code><a id="__codelineno-60-1" name="__codelineno-60-1" href="#__codelineno-60-1"></a><span class="cp">#version 330 core</span>
<a id="__codelineno-60-2" name="__codelineno-60-2" href="#__codelineno-60-2"></a>
<a id="__codelineno-60-3" name="__codelineno-60-3" href="#__codelineno-60-3"></a><span class="k">layout</span><span class="p">(</span><span class="n">location</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mo">0</span><span class="p">)</span><span class="w"> </span><span class="k">in</span><span class="w"> </span><span class="kt">vec3</span><span class="w"> </span><span class="n">aPos</span><span class="p">;</span><span class="w"> </span><span class="c1">// Vertex position</span>
<a id="__codelineno-60-4" name="__codelineno-60-4" href="#__codelineno-60-4"></a><span class="k">layout</span><span class="p">(</span><span class="n">location</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">1</span><span class="p">)</span><span class="w"> </span><span class="k">in</span><span class="w"> </span><span class="kt">vec2</span><span class="w"> </span><span class="n">aTexCoords</span><span class="p">;</span><span class="w"> </span><span class="c1">// UV coordinates</span>
<a id="__codelineno-60-5" name="__codelineno-60-5" href="#__codelineno-60-5"></a>
<a id="__codelineno-60-6" name="__codelineno-60-6" href="#__codelineno-60-6"></a><span class="k">uniform</span><span class="w"> </span><span class="kt">mat4</span><span class="w"> </span><span class="n">model</span><span class="p">;</span>
<a id="__codelineno-60-7" name="__codelineno-60-7" href="#__codelineno-60-7"></a><span class="k">uniform</span><span class="w"> </span><span class="kt">mat4</span><span class="w"> </span><span class="n">view</span><span class="p">;</span>
<a id="__codelineno-60-8" name="__codelineno-60-8" href="#__codelineno-60-8"></a><span class="k">uniform</span><span class="w"> </span><span class="kt">mat4</span><span class="w"> </span><span class="n">projection</span><span class="p">;</span>
<a id="__codelineno-60-9" name="__codelineno-60-9" href="#__codelineno-60-9"></a><span class="k">uniform</span><span class="w"> </span><span class="kt">sampler2D</span><span class="w"> </span><span class="n">textureAtlas</span><span class="p">;</span>
<a id="__codelineno-60-10" name="__codelineno-60-10" href="#__codelineno-60-10"></a>
<a id="__codelineno-60-11" name="__codelineno-60-11" href="#__codelineno-60-11"></a><span class="k">out</span><span class="w"> </span><span class="kt">vec2</span><span class="w"> </span><span class="n">TexCoords</span><span class="p">;</span>
<a id="__codelineno-60-12" name="__codelineno-60-12" href="#__codelineno-60-12"></a>
<a id="__codelineno-60-13" name="__codelineno-60-13" href="#__codelineno-60-13"></a><span class="kt">void</span><span class="w"> </span><span class="n">main</span><span class="p">()</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-60-14" name="__codelineno-60-14" href="#__codelineno-60-14"></a><span class="w">    </span><span class="nb">gl_Position</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">projection</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="n">view</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="n">model</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="kt">vec4</span><span class="p">(</span><span class="n">aPos</span><span class="p">,</span><span class="w"> </span><span class="mf">1.0</span><span class="p">);</span>
<a id="__codelineno-60-15" name="__codelineno-60-15" href="#__codelineno-60-15"></a><span class="w">    </span><span class="n">TexCoords</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">aTexCoords</span><span class="p">;</span><span class="w"> </span><span class="c1">// Pass UV coordinates to the fragment shader</span>
<a id="__codelineno-60-16" name="__codelineno-60-16" href="#__codelineno-60-16"></a><span class="p">}</span>
</code></pre></div>
<div class="highlight"><pre><span></span><code><a id="__codelineno-61-1" name="__codelineno-61-1" href="#__codelineno-61-1"></a><span class="cp">#version 330 core</span>
<a id="__codelineno-61-2" name="__codelineno-61-2" href="#__codelineno-61-2"></a>
<a id="__codelineno-61-3" name="__codelineno-61-3" href="#__codelineno-61-3"></a><span class="k">in</span><span class="w"> </span><span class="kt">vec2</span><span class="w"> </span><span class="n">TexCoords</span><span class="p">;</span><span class="w"> </span><span class="c1">// UV coordinates from the vertex shader</span>
<a id="__codelineno-61-4" name="__codelineno-61-4" href="#__codelineno-61-4"></a><span class="k">uniform</span><span class="w"> </span><span class="kt">sampler2D</span><span class="w"> </span><span class="n">textureAtlas</span><span class="p">;</span>
<a id="__codelineno-61-5" name="__codelineno-61-5" href="#__codelineno-61-5"></a><span class="k">uniform</span><span class="w"> </span><span class="kt">vec2</span><span class="w"> </span><span class="n">atlasOffset</span><span class="p">;</span><span class="w"> </span><span class="c1">// Offset within the atlas</span>
<a id="__codelineno-61-6" name="__codelineno-61-6" href="#__codelineno-61-6"></a><span class="k">uniform</span><span class="w"> </span><span class="kt">vec2</span><span class="w"> </span><span class="n">atlasScale</span><span class="p">;</span><span class="w"> </span><span class="c1">// Scale of the sub-texture within the atlas</span>
<a id="__codelineno-61-7" name="__codelineno-61-7" href="#__codelineno-61-7"></a>
<a id="__codelineno-61-8" name="__codelineno-61-8" href="#__codelineno-61-8"></a><span class="k">out</span><span class="w"> </span><span class="kt">vec4</span><span class="w"> </span><span class="n">FragColor</span><span class="p">;</span>
<a id="__codelineno-61-9" name="__codelineno-61-9" href="#__codelineno-61-9"></a>
<a id="__codelineno-61-10" name="__codelineno-61-10" href="#__codelineno-61-10"></a><span class="kt">void</span><span class="w"> </span><span class="n">main</span><span class="p">()</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-61-11" name="__codelineno-61-11" href="#__codelineno-61-11"></a><span class="w">    </span><span class="kt">vec2</span><span class="w"> </span><span class="n">atlasCoords</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">atlasOffset</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="n">TexCoords</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="n">atlasScale</span><span class="p">;</span><span class="w"> </span><span class="c1">// Compute atlas coordinates</span>
<a id="__codelineno-61-12" name="__codelineno-61-12" href="#__codelineno-61-12"></a><span class="w">    </span><span class="n">FragColor</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">texture</span><span class="p">(</span><span class="n">textureAtlas</span><span class="p">,</span><span class="w"> </span><span class="n">atlasCoords</span><span class="p">);</span><span class="w"> </span><span class="c1">// Sample the atlas</span>
<a id="__codelineno-61-13" name="__codelineno-61-13" href="#__codelineno-61-13"></a><span class="p">}</span>
</code></pre></div>
<p>In this example, the fragment shader computes the atlas coordinates by combining the UV coordinates with an offset and scale.</p>
<h4 id="normal-mapping">Normal Mapping</h4>
<p>Normal mapping is a technique used to simulate fine surface details by perturbing the normals of a surface. This technique adds realism to textures without increasing the polygon count.</p>
<ul>
<li><strong>Purpose:</strong> Add detailed surface features like bumps and wrinkles.</li>
<li>
<p><strong>Key Concepts:</strong> Normal maps, tangent space.</p>
</li>
<li>
<p><strong>Example:</strong> Using normal mapping.</p>
</li>
</ul>
<div class="highlight"><pre><span></span><code><a id="__codelineno-62-1" name="__codelineno-62-1" href="#__codelineno-62-1"></a><span class="cp">#version 330 core</span>
<a id="__codelineno-62-2" name="__codelineno-62-2" href="#__codelineno-62-2"></a>
<a id="__codelineno-62-3" name="__codelineno-62-3" href="#__codelineno-62-3"></a><span class="k">layout</span><span class="p">(</span><span class="n">location</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mo">0</span><span class="p">)</span><span class="w"> </span><span class="k">in</span><span class="w"> </span><span class="kt">vec3</span><span class="w"> </span><span class="n">aPos</span><span class="p">;</span><span class="w"> </span><span class="c1">// Vertex position</span>
<a id="__codelineno-62-4" name="__codelineno-62-4" href="#__codelineno-62-4"></a><span class="k">layout</span><span class="p">(</span><span class="n">location</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">1</span><span class="p">)</span><span class="w"> </span><span class="k">in</span><span class="w"> </span><span class="kt">vec2</span><span class="w"> </span><span class="n">aTexCoords</span><span class="p">;</span><span class="w"> </span><span class="c1">// UV coordinates</span>
<a id="__codelineno-62-5" name="__codelineno-62-5" href="#__codelineno-62-5"></a><span class="k">layout</span><span class="p">(</span><span class="n">location</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">2</span><span class="p">)</span><span class="w"> </span><span class="k">in</span><span class="w"> </span><span class="kt">vec3</span><span class="w"> </span><span class="n">aNormal</span><span class="p">;</span><span class="w"> </span><span class="c1">// Vertex normal</span>
<a id="__codelineno-62-6" name="__codelineno-62-6" href="#__codelineno-62-6"></a><span class="k">layout</span><span class="p">(</span><span class="n">location</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">3</span><span class="p">)</span><span class="w"> </span><span class="k">in</span><span class="w"> </span><span class="kt">vec3</span><span class="w"> </span><span class="n">aTangent</span><span class="p">;</span><span class="w"> </span><span class="c1">// Vertex tangent</span>
<a id="__codelineno-62-7" name="__codelineno-62-7" href="#__codelineno-62-7"></a><span class="k">layout</span><span class="p">(</span><span class="n">location</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">4</span><span class="p">)</span><span class="w"> </span><span class="k">in</span><span class="w"> </span><span class="kt">vec3</span><span class="w"> </span><span class="n">aBitangent</span><span class="p">;</span><span class="w"> </span><span class="c1">// Vertex bitangent</span>
<a id="__codelineno-62-8" name="__codelineno-62-8" href="#__codelineno-62-8"></a>
<a id="__codelineno-62-9" name="__codelineno-62-9" href="#__codelineno-62-9"></a><span class="k">uniform</span><span class="w"> </span><span class="kt">mat4</span><span class="w"> </span><span class="n">model</span><span class="p">;</span>
<a id="__codelineno-62-10" name="__codelineno-62-10" href="#__codelineno-62-10"></a><span class="k">uniform</span><span class="w"> </span><span class="kt">mat4</span><span class="w"> </span><span class="n">view</span><span class="p">;</span>
<a id="__codelineno-62-11" name="__codelineno-62-11" href="#__codelineno-62-11"></a><span class="k">uniform</span><span class="w"> </span><span class="kt">mat4</span><span class="w"> </span><span class="n">projection</span><span class="p">;</span>
<a id="__codelineno-62-12" name="__codelineno-62-12" href="#__codelineno-62-12"></a>
<a id="__codelineno-62-13" name="__codelineno-62-13" href="#__codelineno-62-13"></a><span class="k">out</span><span class="w"> </span><span class="kt">vec2</span><span class="w"> </span><span class="n">TexCoords</span><span class="p">;</span>
<a id="__codelineno-62-14" name="__codelineno-62-14" href="#__codelineno-62-14"></a><span class="k">out</span><span class="w"> </span><span class="kt">mat3</span><span class="w"> </span><span class="n">TBN</span><span class="p">;</span><span class="w"> </span><span class="c1">// Tangent, bitangent, normal matrix</span>
<a id="__codelineno-62-15" name="__codelineno-62-15" href="#__codelineno-62-15"></a>
<a id="__codelineno-62-16" name="__codelineno-62-16" href="#__codelineno-62-16"></a><span class="kt">void</span><span class="w"> </span><span class="n">main</span><span class="p">()</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-62-17" name="__codelineno-62-17" href="#__codelineno-62-17"></a><span class="w">    </span><span class="nb">gl_Position</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">projection</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="n">view</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="n">model</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="kt">vec4</span><span class="p">(</span><span class="n">aPos</span><span class="p">,</span><span class="w"> </span><span class="mf">1.0</span><span class="p">);</span>
<a id="__codelineno-62-18" name="__codelineno-62-18" href="#__codelineno-62-18"></a><span class="w">    </span><span class="n">TexCoords</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">aTexCoords</span><span class="p">;</span><span class="w"> </span><span class="c1">// Pass UV coordinates to the fragment shader</span>
<a id="__codelineno-62-19" name="__codelineno-62-19" href="#__codelineno-62-19"></a>
<a id="__codelineno-62-20" name="__codelineno-62-20" href="#__codelineno-62-20"></a><span class="w">    </span><span class="kt">mat3</span><span class="w"> </span><span class="n">normalMatrix</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">transpose</span><span class="p">(</span><span class="n">inverse</span><span class="p">(</span><span class="kt">mat3</span><span class="p">(</span><span class="n">model</span><span class="p">)));</span>
<a id="__codelineno-62-21" name="__codelineno-62-21" href="#__codelineno-62-21"></a><span class="w">    </span><span class="kt">vec3</span><span class="w"> </span><span class="n">T</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">normalize</span><span class="p">(</span><span class="n">normalMatrix</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="n">aTangent</span><span class="p">);</span>
<a id="__codelineno-62-22" name="__codelineno-62-22" href="#__codelineno-62-22"></a><span class="w">    </span><span class="kt">vec3</span><span class="w"> </span><span class="n">B</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">normalize</span><span class="p">(</span><span class="n">normalMatrix</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="n">aBitangent</span><span class="p">);</span>
<a id="__codelineno-62-23" name="__codelineno-62-23" href="#__codelineno-62-23"></a><span class="w">    </span><span class="kt">vec3</span><span class="w"> </span><span class="n">N</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">normalize</span><span class="p">(</span><span class="n">normalMatrix</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="n">aNormal</span><span class="p">);</span>
<a id="__codelineno-62-24" name="__codelineno-62-24" href="#__codelineno-62-24"></a><span class="w">    </span><span class="n">TBN</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="kt">mat3</span><span class="p">(</span><span class="n">T</span><span class="p">,</span><span class="w"> </span><span class="n">B</span><span class="p">,</span><span class="w"> </span><span class="n">N</span><span class="p">);</span><span class="w"> </span><span class="c1">// Create TBN matrix for the fragment shader</span>
<a id="__codelineno-62-25" name="__codelineno-62-25" href="#__codelineno-62-25"></a><span class="p">}</span>
</code></pre></div>
<div class="highlight"><pre><span></span><code><a id="__codelineno-63-1" name="__codelineno-63-1" href="#__codelineno-63-1"></a><span class="cp">#version 330 core</span>
<a id="__codelineno-63-2" name="__codelineno-63-2" href="#__codelineno-63-2"></a>
<a id="__codelineno-63-3" name="__codelineno-63-3" href="#__codelineno-63-3"></a><span class="k">in</span><span class="w"> </span><span class="kt">vec2</span><span class="w"> </span><span class="n">TexCoords</span><span class="p">;</span><span class="w"> </span><span class="c1">// UV coordinates from the vertex shader</span>
<a id="__codelineno-63-4" name="__codelineno-63-4" href="#__codelineno-63-4"></a><span class="k">in</span><span class="w"> </span><span class="kt">mat3</span><span class="w"> </span><span class="n">TBN</span><span class="p">;</span><span class="w"> </span><span class="c1">// Tangent, bitangent, normal matrix</span>
<a id="__codelineno-63-5" name="__codelineno-63-5" href="#__codelineno-63-5"></a>
<a id="__codelineno-63-6" name="__codelineno-63-6" href="#__codelineno-63-6"></a><span class="k">uniform</span><span class="w"> </span><span class="kt">sampler2D</span><span class="w"> </span><span class="n">texture1</span><span class="p">;</span>
<a id="__codelineno-63-7" name="__codelineno-63-7" href="#__codelineno-63-7"></a><span class="k">uniform</span><span class="w"> </span><span class="kt">sampler2D</span><span class="w"> </span><span class="n">normalMap</span><span class="p">;</span>
<a id="__codelineno-63-8" name="__codelineno-63-8" href="#__codelineno-63-8"></a>
<a id="__codelineno-63-9" name="__codelineno-63-9" href="#__codelineno-63-9"></a><span class="k">out</span><span class="w"> </span><span class="kt">vec4</span><span class="w"> </span><span class="n">FragColor</span><span class="p">;</span>
<a id="__codelineno-63-10" name="__codelineno-63-10" href="#__codelineno-63-10"></a>
<a id="__codelineno-63-11" name="__codelineno-63-11" href="#__codelineno-63-11"></a><span class="kt">void</span><span class="w"> </span><span class="n">main</span><span class="p">()</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-63-12" name="__codelineno-63-12" href="#__codelineno-63-12"></a><span class="w">    </span><span class="kt">vec3</span><span class="w"> </span><span class="n">normal</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">texture</span><span class="p">(</span><span class="n">normalMap</span><span class="p">,</span><span class="w"> </span><span class="n">TexCoords</span><span class="p">).</span><span class="n">rgb</span><span class="p">;</span>
<a id="__codelineno-63-13" name="__codelineno-63-13" href="#__codelineno-63-13"></a><span class="w">    </span><span class="n">normal</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">normalize</span><span class="p">(</span><span class="n">normal</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="mf">2.0</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="mf">1.0</span><span class="p">);</span><span class="w"> </span><span class="c1">// Convert from [0, 1] range to [-1, 1]</span>
<a id="__codelineno-63-14" name="__codelineno-63-14" href="#__codelineno-63-14"></a><span class="w">    </span><span class="n">normal</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">normalize</span><span class="p">(</span><span class="n">TBN</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="n">normal</span><span class="p">);</span><span class="w"> </span><span class="c1">// Transform to world space</span>
<a id="__codelineno-63-15" name="__codelineno-63-15" href="#__codelineno-63-15"></a>
<a id="__codelineno-63-16" name="__codelineno-63-16" href="#__codelineno-63-16"></a><span class="w">    </span><span class="c1">// Sample the texture and apply lighting</span>
<a id="__codelineno-63-17" name="__codelineno-63-17" href="#__codelineno-63-17"></a><span class="w">    </span><span class="kt">vec3</span><span class="w"> </span><span class="n">color</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">texture</span><span class="p">(</span><span class="n">texture1</span><span class="p">,</span><span class="w"> </span><span class="n">TexCoords</span><span class="p">).</span><span class="n">rgb</span><span class="p">;</span>
<a id="__codelineno-63-18" name="__codelineno-63-18" href="#__codelineno-63-18"></a><span class="w">    </span><span class="kt">vec3</span><span class="w"> </span><span class="n">lightDir</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">normalize</span><span class="p">(</span><span class="kt">vec3</span><span class="p">(</span><span class="mf">0.0</span><span class="p">,</span><span class="w"> </span><span class="mf">0.0</span><span class="p">,</span><span class="w"> </span><span class="mf">1.0</span><span class="p">));</span><span class="w"> </span><span class="c1">// Example light direction</span>
<a id="__codelineno-63-19" name="__codelineno-63-19" href="#__codelineno-63-19"></a><span class="w">    </span><span class="kt">float</span><span class="w"> </span><span class="n">diff</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">max</span><span class="p">(</span><span class="n">dot</span><span class="p">(</span><span class="n">normal</span><span class="p">,</span><span class="w"> </span><span class="n">lightDir</span><span class="p">),</span><span class="w"> </span><span class="mf">0.0</span><span class="p">);</span>
<a id="__codelineno-63-20" name="__codelineno-63-20" href="#__codelineno-63-20"></a><span class="w">    </span><span class="n">FragColor</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="kt">vec4</span><span class="p">(</span><span class="n">color</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="n">diff</span><span class="p">,</span><span class="w"> </span><span class="mf">1.0</span><span class="p">);</span>
<a id="__codelineno-63-21" name="__codelineno-63-21" href="#__codelineno-63-21"></a><span class="p">}</span>
</code></pre></div>
<p>In this example, the fragment shader uses a normal map to perturb the surface normals, creating the illusion of detailed surface features.</p>
<h4 id="parallax-mapping">Parallax Mapping</h4>
<p>Parallax mapping, also known as offset mapping, is an advanced technique that creates the illusion of depth on a textured surface by displacing texture coordinates based on the view angle.</p>
<ul>
<li><strong>Purpose:</strong> Enhance the perception of depth and detail on surfaces.</li>
<li>
<p><strong>Key Concepts:</strong> Height maps, texture coordinate displacement.</p>
</li>
<li>
<p><strong>Example:</strong> Using parallax mapping.</p>
</li>
</ul>
<div class="highlight"><pre><span></span><code><a id="__codelineno-64-1" name="__codelineno-64-1" href="#__codelineno-64-1"></a><span class="cp">#version 330 core</span>
<a id="__codelineno-64-2" name="__codelineno-64-2" href="#__codelineno-64-2"></a>
<a id="__codelineno-64-3" name="__codelineno-64-3" href="#__codelineno-64-3"></a><span class="k">layout</span><span class="p">(</span><span class="n">location</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mo">0</span><span class="p">)</span><span class="w"> </span><span class="k">in</span><span class="w"> </span><span class="kt">vec3</span><span class="w"> </span><span class="n">aPos</span><span class="p">;</span><span class="w"> </span><span class="c1">// Vertex position</span>
<a id="__codelineno-64-4" name="__codelineno-64-4" href="#__codelineno-64-4"></a><span class="k">layout</span><span class="p">(</span><span class="n">location</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">1</span><span class="p">)</span><span class="w"> </span><span class="k">in</span><span class="w"> </span><span class="kt">vec2</span><span class="w"> </span><span class="n">aTexCoords</span><span class="p">;</span><span class="w"> </span><span class="c1">// UV coordinates</span>
<a id="__codelineno-64-5" name="__codelineno-64-5" href="#__codelineno-64-5"></a><span class="k">layout</span><span class="p">(</span><span class="n">location</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">2</span><span class="p">)</span><span class="w"> </span><span class="k">in</span><span class="w"> </span><span class="kt">vec3</span><span class="w"> </span><span class="n">aNormal</span><span class="p">;</span><span class="w"> </span><span class="c1">// Vertex normal</span>
<a id="__codelineno-64-6" name="__codelineno-64-6" href="#__codelineno-64-6"></a><span class="k">layout</span><span class="p">(</span><span class="n">location</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">3</span><span class="p">)</span><span class="w"> </span><span class="k">in</span><span class="w"> </span><span class="kt">vec3</span><span class="w"> </span><span class="n">aTangent</span><span class="p">;</span><span class="w"> </span><span class="c1">// Vertex tangent</span>
<a id="__codelineno-64-7" name="__codelineno-64-7" href="#__codelineno-64-7"></a><span class="k">layout</span><span class="p">(</span><span class="n">location</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">4</span><span class="p">)</span><span class="w"> </span><span class="k">in</span><span class="w"> </span><span class="kt">vec3</span><span class="w"> </span><span class="n">aBitangent</span><span class="p">;</span><span class="w"> </span><span class="c1">// Vertex bitangent</span>
<a id="__codelineno-64-8" name="__codelineno-64-8" href="#__codelineno-64-8"></a>
<a id="__codelineno-64-9" name="__codelineno-64-9" href="#__codelineno-64-9"></a><span class="k">uniform</span><span class="w"> </span><span class="kt">mat4</span><span class="w"> </span><span class="n">model</span><span class="p">;</span>
<a id="__codelineno-64-10" name="__codelineno-64-10" href="#__codelineno-64-10"></a><span class="k">uniform</span><span class="w"> </span><span class="kt">mat4</span><span class="w"> </span><span class="n">view</span><span class="p">;</span>
<a id="__codelineno-64-11" name="__codelineno-64-11" href="#__codelineno-64-11"></a><span class="k">uniform</span><span class="w"> </span><span class="kt">mat4</span><span class="w"> </span><span class="n">projection</span><span class="p">;</span>
<a id="__codelineno-64-12" name="__codelineno-64-12" href="#__codelineno-64-12"></a>
<a id="__codelineno-64-13" name="__codelineno-64-13" href="#__codelineno-64-13"></a><span class="k">out</span><span class="w"> </span><span class="kt">vec2</span><span class="w"> </span><span class="n">TexCoords</span><span class="p">;</span>
<a id="__codelineno-64-14" name="__codelineno-64-14" href="#__codelineno-64-14"></a><span class="k">out</span><span class="w"> </span><span class="kt">vec3</span><span class="w"> </span><span class="n">FragPos</span><span class="p">;</span>
<a id="__codelineno-64-15" name="__codelineno-64-15" href="#__codelineno-64-15"></a><span class="k">out</span><span class="w"> </span><span class="kt">vec3</span><span class="w"> </span><span class="n">ViewDir</span><span class="p">;</span>
<a id="__codelineno-64-16" name="__codelineno-64-16" href="#__codelineno-64-16"></a><span class="k">out</span><span class="w"> </span><span class="kt">mat3</span><span class="w"> </span><span class="n">TBN</span><span class="p">;</span>
<a id="__codelineno-64-17" name="__codelineno-64-17" href="#__codelineno-64-17"></a>
<a id="__codelineno-64-18" name="__codelineno-64-18" href="#__codelineno-64-18"></a><span class="kt">void</span><span class="w"> </span><span class="n">main</span><span class="p">()</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-64-19" name="__codelineno-64-19" href="#__codelineno-64-19"></a><span class="w">    </span><span class="nb">gl_Position</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">projection</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="n">view</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="n">model</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="kt">vec4</span><span class="p">(</span><span class="n">aPos</span><span class="p">,</span><span class="w"> </span><span class="mf">1.0</span><span class="p">);</span>
<a id="__codelineno-64-20" name="__codelineno-64-20" href="#__codelineno-64-20"></a><span class="w">    </span><span class="n">TexCoords</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">aTexCoords</span><span class="p">;</span><span class="w"> </span><span class="c1">// Pass UV coordinates to the fragment shader</span>
<a id="__codelineno-64-21" name="__codelineno-64-21" href="#__codelineno-64-21"></a>
<a id="__codelineno-64-22" name="__codelineno-64-22" href="#__codelineno-64-22"></a><span class="w">    </span><span class="n">FragPos</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="kt">vec3</span><span class="p">(</span><span class="n">model</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="kt">vec4</span><span class="p">(</span><span class="n">aPos</span><span class="p">,</span><span class="w"> </span><span class="mf">1.0</span><span class="p">));</span><span class="w"> </span><span class="c1">// Pass fragment position to the fragment shader</span>
<a id="__codelineno-64-23" name="__codelineno-64-23" href="#__codelineno-64-23"></a><span class="w">    </span><span class="kt">vec3</span><span class="w"> </span><span class="n">viewPos</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="kt">vec3</span><span class="p">(</span><span class="n">inverse</span><span class="p">(</span><span class="n">view</span><span class="p">)[</span><span class="mi">3</span><span class="p">]);</span><span class="w"> </span><span class="c1">// Camera position in world space</span>
<a id="__codelineno-64-24" name="__codelineno-64-24" href="#__codelineno-64-24"></a><span class="w">    </span><span class="n">ViewDir</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">viewPos</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="n">FragPos</span><span class="p">;</span><span class="w"> </span><span class="c1">// Compute view direction</span>
<a id="__codelineno-64-25" name="__codelineno-64-25" href="#__codelineno-64-25"></a>
<a id="__codelineno-64-26" name="__codelineno-64-26" href="#__codelineno-64-26"></a><span class="w">    </span><span class="kt">mat3</span><span class="w"> </span><span class="n">normalMatrix</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">transpose</span><span class="p">(</span><span class="n">inverse</span><span class="p">(</span><span class="kt">mat3</span><span class="p">(</span><span class="n">model</span><span class="p">)));</span>
<a id="__codelineno-64-27" name="__codelineno-64-27" href="#__codelineno-64-27"></a><span class="w">    </span><span class="kt">vec3</span><span class="w"> </span><span class="n">T</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">normalize</span><span class="p">(</span><span class="n">normalMatrix</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="n">aTangent</span><span class="p">);</span>
<a id="__codelineno-64-28" name="__codelineno-64-28" href="#__codelineno-64-28"></a><span class="w">    </span><span class="kt">vec3</span><span class="w"> </span><span class="n">B</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">normalize</span><span class="p">(</span><span class="n">normalMatrix</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="n">aBitangent</span><span class="p">);</span>
<a id="__codelineno-64-29" name="__codelineno-64-29" href="#__codelineno-64-29"></a><span class="w">    </span><span class="kt">vec3</span><span class="w"> </span><span class="n">N</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">normalize</span><span class="p">(</span><span class="n">normalMatrix</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="n">aNormal</span><span class="p">);</span>
<a id="__codelineno-64-30" name="__codelineno-64-30" href="#__codelineno-64-30"></a><span class="w">    </span><span class="n">TBN</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="kt">mat3</span><span class="p">(</span><span class="n">T</span><span class="p">,</span><span class="w"> </span><span class="n">B</span><span class="p">,</span><span class="w"> </span><span class="n">N</span><span class="p">);</span><span class="w"> </span><span class="c1">// Create TBN matrix for the fragment shader</span>
<a id="__codelineno-64-31" name="__codelineno-64-31" href="#__codelineno-64-31"></a><span class="p">}</span>
</code></pre></div>
<div class="highlight"><pre><span></span><code><a id="__codelineno-65-1" name="__codelineno-65-1" href="#__codelineno-65-1"></a><span class="cp">#version 330 core</span>
<a id="__codelineno-65-2" name="__codelineno-65-2" href="#__codelineno-65-2"></a>
<a id="__codelineno-65-3" name="__codelineno-65-3" href="#__codelineno-65-3"></a><span class="k">in</span><span class="w"> </span><span class="kt">vec2</span><span class="w"> </span><span class="n">TexCoords</span><span class="p">;</span><span class="w"> </span><span class="c1">// UV coordinates from the vertex shader</span>
<a id="__codelineno-65-4" name="__codelineno-65-4" href="#__codelineno-65-4"></a><span class="k">in</span><span class="w"> </span><span class="kt">vec3</span><span class="w"> </span><span class="n">FragPos</span><span class="p">;</span><span class="w"> </span><span class="c1">// Fragment position from the vertex shader</span>
<a id="__codelineno-65-5" name="__codelineno-65-5" href="#__codelineno-65-5"></a><span class="k">in</span><span class="w"> </span><span class="kt">vec3</span><span class="w"> </span><span class="n">ViewDir</span><span class="p">;</span><span class="w"> </span><span class="c1">// View direction from the vertex shader</span>
<a id="__codelineno-65-6" name="__codelineno-65-6" href="#__codelineno-65-6"></a><span class="k">in</span><span class="w"> </span><span class="kt">mat3</span><span class="w"> </span><span class="n">TBN</span><span class="p">;</span><span class="w"> </span><span class="c1">// Tangent, bitangent, normal matrix</span>
<a id="__codelineno-65-7" name="__codelineno-65-7" href="#__codelineno-65-7"></a>
<a id="__codelineno-65-8" name="__codelineno-65-8" href="#__codelineno-65-8"></a><span class="k">uniform</span><span class="w"> </span><span class="kt">sampler2D</span><span class="w"> </span><span class="n">texture1</span><span class="p">;</span>
<a id="__codelineno-65-9" name="__codelineno-65-9" href="#__codelineno-65-9"></a><span class="k">uniform</span><span class="w"> </span><span class="kt">sampler2D</span><span class="w"> </span><span class="n">normalMap</span><span class="p">;</span>
<a id="__codelineno-65-10" name="__codelineno-65-10" href="#__codelineno-65-10"></a><span class="k">uniform</span><span class="w"> </span><span class="kt">sampler2D</span><span class="w"> </span><span class="n">heightMap</span><span class="p">;</span>
<a id="__codelineno-65-11" name="__codelineno-65-11" href="#__codelineno-65-11"></a>
<a id="__codelineno-65-12" name="__codelineno-65-12" href="#__codelineno-65-12"></a><span class="k">out</span><span class="w"> </span><span class="kt">vec4</span><span class="w"> </span><span class="n">FragColor</span><span class="p">;</span>
<a id="__codelineno-65-13" name="__codelineno-65-13" href="#__codelineno-65-13"></a>
<a id="__codelineno-65-14" name="__codelineno-65-14" href="#__codelineno-65-14"></a><span class="kt">vec2</span><span class="w"> </span><span class="n">parallaxMapping</span><span class="p">(</span><span class="kt">vec2</span><span class="w"> </span><span class="n">texCoords</span><span class="p">,</span><span class="w"> </span><span class="kt">vec3</span><span class="w"> </span><span class="n">viewDir</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-65-15" name="__codelineno-65-15" href="#__codelineno-65-15"></a><span class="w">    </span><span class="kt">float</span><span class="w"> </span><span class="n">heightScale</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mf">0.1</span><span class="p">;</span><span class="w"> </span><span class="c1">// Adjust this value to control the effect strength</span>
<a id="__codelineno-65-16" name="__codelineno-65-16" href="#__codelineno-65-16"></a><span class="w">    </span><span class="kt">float</span><span class="w"> </span><span class="n">numLayers</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mf">10.0</span><span class="p">;</span>
<a id="__codelineno-65-17" name="__codelineno-65-17" href="#__codelineno-65-17"></a><span class="w">    </span><span class="kt">float</span><span class="w"> </span><span class="n">layerDepth</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mf">1.0</span><span class="w"> </span><span class="o">/</span><span class="w"> </span><span class="n">numLayers</span><span class="p">;</span>
<a id="__codelineno-65-18" name="__codelineno-65-18" href="#__codelineno-65-18"></a><span class="w">    </span><span class="kt">float</span><span class="w"> </span><span class="n">currentLayerDepth</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mf">0.0</span><span class="p">;</span>
<a id="__codelineno-65-19" name="__codelineno-65-19" href="#__codelineno-65-19"></a><span class="w">    </span><span class="kt">vec2</span><span class="w"> </span><span class="n">P</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">viewDir</span><span class="p">.</span><span class="n">xy</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="n">heightScale</span><span class="p">;</span>
<a id="__codelineno-65-20" name="__codelineno-65-20" href="#__codelineno-65-20"></a><span class="w">    </span><span class="kt">vec2</span><span class="w"> </span><span class="n">deltaTexCoords</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">P</span><span class="w"> </span><span class="o">/</span><span class="w"> </span><span class="n">numLayers</span><span class="p">;</span>
<a id="__codelineno-65-21" name="__codelineno-65-21" href="#__codelineno-65-21"></a><span class="w">    </span><span class="kt">vec2</span><span class="w"> </span><span class="n">currentTexCoords</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">texCoords</span><span class="p">;</span>
<a id="__codelineno-65-22" name="__codelineno-65-22" href="#__codelineno-65-22"></a><span class="w">    </span><span class="kt">float</span><span class="w"> </span><span class="n">currentDepth</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">texture</span><span class="p">(</span><span class="n">heightMap</span><span class="p">,</span><span class="w"> </span><span class="n">currentTexCoords</span><span class="p">).</span><span class="n">r</span><span class="p">;</span>
<a id="__codelineno-65-23" name="__codelineno-65-23" href="#__codelineno-65-23"></a>
<a id="__codelineno-65-24" name="__codelineno-65-24" href="#__codelineno-65-24"></a><span class="w">    </span><span class="k">while</span><span class="w"> </span><span class="p">(</span><span class="n">currentLayerDepth</span><span class="w"> </span><span class="o">&lt;</span><span class="w"> </span><span class="n">currentDepth</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-65-25" name="__codelineno-65-25" href="#__codelineno-65-25"></a><span class="w">        </span><span class="n">currentTexCoords</span><span class="w"> </span><span class="o">-=</span><span class="w"> </span><span class="n">deltaTexCoords</span><span class="p">;</span>
<a id="__codelineno-65-26" name="__codelineno-65-26" href="#__codelineno-65-26"></a><span class="w">        </span><span class="n">currentDepth</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">texture</span><span class="p">(</span><span class="n">heightMap</span><span class="p">,</span><span class="w"> </span><span class="n">currentTexCoords</span><span class="p">).</span><span class="n">r</span><span class="p">;</span>
<a id="__codelineno-65-27" name="__codelineno-65-27" href="#__codelineno-65-27"></a><span class="w">        </span><span class="n">currentLayerDepth</span><span class="w"> </span><span class="o">+=</span><span class="w"> </span><span class="n">layerDepth</span><span class="p">;</span>
<a id="__codelineno-65-28" name="__codelineno-65-28" href="#__codelineno-65-28"></a><span class="w">    </span><span class="p">}</span>
<a id="__codelineno-65-29" name="__codelineno-65-29" href="#__codelineno-65-29"></a>
<a id="__codelineno-65-30" name="__codelineno-65-30" href="#__codelineno-65-30"></a><span class="w">    </span><span class="k">return</span><span class="w"> </span><span class="n">currentTexCoords</span><span class="p">;</span>
<a id="__codelineno-65-31" name="__codelineno-65-31" href="#__codelineno-65-31"></a><span class="p">}</span>
<a id="__codelineno-65-32" name="__codelineno-65-32" href="#__codelineno-65-32"></a>
<a id="__codelineno-65-33" name="__codelineno-65-33" href="#__codelineno-65-33"></a><span class="kt">void</span><span class="w"> </span><span class="n">main</span><span class="p">()</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-65-34" name="__codelineno-65-34" href="#__codelineno-65-34"></a><span class="w">    </span><span class="kt">vec3</span><span class="w"> </span><span class="n">viewDir</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">normalize</span><span class="p">(</span><span class="n">TBN</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="n">ViewDir</span><span class="p">);</span><span class="w"> </span><span class="c1">// Transform view direction to tangent space</span>
<a id="__codelineno-65-35" name="__codelineno-65-35" href="#__codelineno-65-35"></a><span class="w">    </span><span class="kt">vec2</span><span class="w"> </span><span class="n">texCoords</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">parallaxMapping</span><span class="p">(</span><span class="n">TexCoords</span><span class="p">,</span><span class="w"> </span><span class="n">viewDir</span><span class="p">);</span><span class="w"> </span><span class="c1">// Apply parallax mapping</span>
<a id="__codelineno-65-36" name="__codelineno-65-36" href="#__codelineno-65-36"></a>
<a id="__codelineno-65-37" name="__codelineno-65-37" href="#__codelineno-65-37"></a><span class="w">    </span><span class="kt">vec3</span><span class="w"> </span><span class="n">normal</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">texture</span><span class="p">(</span><span class="n">normalMap</span><span class="p">,</span><span class="w"> </span><span class="n">texCoords</span><span class="p">).</span><span class="n">rgb</span><span class="p">;</span>
<a id="__codelineno-65-38" name="__codelineno-65-38" href="#__codelineno-65-38"></a><span class="w">    </span><span class="n">normal</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">normalize</span><span class="p">(</span><span class="n">normal</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="mf">2.0</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="mf">1.0</span><span class="p">);</span><span class="w"> </span><span class="c1">// Convert from [0, 1] range to [-1, 1]</span>
<a id="__codelineno-65-39" name="__codelineno-65-39" href="#__codelineno-65-39"></a><span class="w">    </span><span class="n">normal</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">normalize</span><span class="p">(</span><span class="n">TBN</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="n">normal</span><span class="p">);</span><span class="w"> </span><span class="c1">// Transform to world space</span>
<a id="__codelineno-65-40" name="__codelineno-65-40" href="#__codelineno-65-40"></a>
<a id="__codelineno-65-41" name="__codelineno-65-41" href="#__codelineno-65-41"></a><span class="w">    </span><span class="c1">// Sample the texture and apply lighting</span>
<a id="__codelineno-65-42" name="__codelineno-65-42" href="#__codelineno-65-42"></a><span class="w">    </span><span class="kt">vec3</span><span class="w"> </span><span class="n">color</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">texture</span><span class="p">(</span><span class="n">texture1</span><span class="p">,</span><span class="w"> </span><span class="n">texCoords</span><span class="p">).</span><span class="n">rgb</span><span class="p">;</span>
<a id="__codelineno-65-43" name="__codelineno-65-43" href="#__codelineno-65-43"></a><span class="w">    </span><span class="kt">vec3</span><span class="w"> </span><span class="n">lightDir</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">normalize</span><span class="p">(</span><span class="kt">vec3</span><span class="p">(</span><span class="mf">0.0</span><span class="p">,</span><span class="w"> </span><span class="mf">0.0</span><span class="p">,</span><span class="w"> </span><span class="mf">1.0</span><span class="p">));</span><span class="w"> </span><span class="c1">// Example light direction</span>
<a id="__codelineno-65-44" name="__codelineno-65-44" href="#__codelineno-65-44"></a><span class="w">    </span><span class="kt">float</span><span class="w"> </span><span class="n">diff</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">max</span><span class="p">(</span><span class="n">dot</span><span class="p">(</span><span class="n">normal</span><span class="p">,</span><span class="w"> </span><span class="n">lightDir</span><span class="p">),</span><span class="w"> </span><span class="mf">0.0</span><span class="p">);</span>
<a id="__codelineno-65-45" name="__codelineno-65-45" href="#__codelineno-65-45"></a><span class="w">    </span><span class="n">FragColor</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="kt">vec4</span><span class="p">(</span><span class="n">color</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="n">diff</span><span class="p">,</span><span class="w"> </span>
<a id="__codelineno-65-46" name="__codelineno-65-46" href="#__codelineno-65-46"></a>
<a id="__codelineno-65-47" name="__codelineno-65-47" href="#__codelineno-65-47"></a><span class="mf">1.0</span><span class="p">);</span>
<a id="__codelineno-65-48" name="__codelineno-65-48" href="#__codelineno-65-48"></a><span class="p">}</span>
</code></pre></div>
<p>In this example, the fragment shader uses a height map to displace texture coordinates, creating a parallax effect that simulates depth.</p>
<p>By mastering these texturing techniques, you can significantly enhance the visual quality and realism of your 3D models, creating more immersive and detailed graphics in your applications.</p>
<h2 id="animation">Animation</h2>
<p>Animation techniques in computer graphics bring characters and objects to life, making them move and interact in realistic ways. Here are some key concepts in animation:</p>
<h3 id="keyframe-animation">Keyframe Animation</h3>
<p>Keyframe animation involves defining important positions (keyframes) at specific points in time. The computer interpolates between these keyframes to create smooth transitions.</p>
<ul>
<li><strong>Purpose:</strong> To animate objects by specifying key positions and interpolating between them.</li>
<li>
<p><strong>Key Concepts:</strong> Keyframes, interpolation, timelines.</p>
</li>
<li>
<p><strong>Example:</strong> Basic keyframe animation.</p>
</li>
</ul>
<div class="highlight"><pre><span></span><code><a id="__codelineno-66-1" name="__codelineno-66-1" href="#__codelineno-66-1"></a><span class="k">struct</span><span class="w"> </span><span class="nc">Keyframe</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-66-2" name="__codelineno-66-2" href="#__codelineno-66-2"></a><span class="w">    </span><span class="kt">float</span><span class="w"> </span><span class="n">time</span><span class="p">;</span>
<a id="__codelineno-66-3" name="__codelineno-66-3" href="#__codelineno-66-3"></a><span class="w">    </span><span class="n">glm</span><span class="o">::</span><span class="n">vec3</span><span class="w"> </span><span class="n">position</span><span class="p">;</span>
<a id="__codelineno-66-4" name="__codelineno-66-4" href="#__codelineno-66-4"></a><span class="p">};</span>
<a id="__codelineno-66-5" name="__codelineno-66-5" href="#__codelineno-66-5"></a>
<a id="__codelineno-66-6" name="__codelineno-66-6" href="#__codelineno-66-6"></a><span class="k">class</span><span class="w"> </span><span class="nc">Animator</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-66-7" name="__codelineno-66-7" href="#__codelineno-66-7"></a><span class="k">public</span><span class="o">:</span>
<a id="__codelineno-66-8" name="__codelineno-66-8" href="#__codelineno-66-8"></a><span class="w">    </span><span class="n">Animator</span><span class="p">(</span><span class="k">const</span><span class="w"> </span><span class="n">std</span><span class="o">::</span><span class="n">vector</span><span class="o">&lt;</span><span class="n">Keyframe</span><span class="o">&gt;&amp;</span><span class="w"> </span><span class="n">keyframes</span><span class="p">)</span><span class="w"> </span><span class="o">:</span><span class="w"> </span><span class="n">keyframes</span><span class="p">(</span><span class="n">keyframes</span><span class="p">)</span><span class="w"> </span><span class="p">{}</span>
<a id="__codelineno-66-9" name="__codelineno-66-9" href="#__codelineno-66-9"></a>
<a id="__codelineno-66-10" name="__codelineno-66-10" href="#__codelineno-66-10"></a><span class="w">    </span><span class="n">glm</span><span class="o">::</span><span class="n">vec3</span><span class="w"> </span><span class="n">interpolate</span><span class="p">(</span><span class="kt">float</span><span class="w"> </span><span class="n">currentTime</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-66-11" name="__codelineno-66-11" href="#__codelineno-66-11"></a><span class="w">        </span><span class="n">Keyframe</span><span class="w"> </span><span class="n">k1</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">keyframes</span><span class="p">[</span><span class="mi">0</span><span class="p">];</span>
<a id="__codelineno-66-12" name="__codelineno-66-12" href="#__codelineno-66-12"></a><span class="w">        </span><span class="n">Keyframe</span><span class="w"> </span><span class="n">k2</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">keyframes</span><span class="p">[</span><span class="mi">1</span><span class="p">];</span>
<a id="__codelineno-66-13" name="__codelineno-66-13" href="#__codelineno-66-13"></a><span class="w">        </span><span class="k">for</span><span class="w"> </span><span class="p">(</span><span class="kt">size_t</span><span class="w"> </span><span class="n">i</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">1</span><span class="p">;</span><span class="w"> </span><span class="n">i</span><span class="w"> </span><span class="o">&lt;</span><span class="w"> </span><span class="n">keyframes</span><span class="p">.</span><span class="n">size</span><span class="p">();</span><span class="w"> </span><span class="o">++</span><span class="n">i</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-66-14" name="__codelineno-66-14" href="#__codelineno-66-14"></a><span class="w">            </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">keyframes</span><span class="p">[</span><span class="n">i</span><span class="p">].</span><span class="n">time</span><span class="w"> </span><span class="o">&gt;</span><span class="w"> </span><span class="n">currentTime</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-66-15" name="__codelineno-66-15" href="#__codelineno-66-15"></a><span class="w">                </span><span class="n">k2</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">keyframes</span><span class="p">[</span><span class="n">i</span><span class="p">];</span>
<a id="__codelineno-66-16" name="__codelineno-66-16" href="#__codelineno-66-16"></a><span class="w">                </span><span class="n">k1</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">keyframes</span><span class="p">[</span><span class="n">i</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="mi">1</span><span class="p">];</span>
<a id="__codelineno-66-17" name="__codelineno-66-17" href="#__codelineno-66-17"></a><span class="w">                </span><span class="k">break</span><span class="p">;</span>
<a id="__codelineno-66-18" name="__codelineno-66-18" href="#__codelineno-66-18"></a><span class="w">            </span><span class="p">}</span>
<a id="__codelineno-66-19" name="__codelineno-66-19" href="#__codelineno-66-19"></a><span class="w">        </span><span class="p">}</span>
<a id="__codelineno-66-20" name="__codelineno-66-20" href="#__codelineno-66-20"></a>
<a id="__codelineno-66-21" name="__codelineno-66-21" href="#__codelineno-66-21"></a><span class="w">        </span><span class="kt">float</span><span class="w"> </span><span class="n">t</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">(</span><span class="n">currentTime</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="n">k1</span><span class="p">.</span><span class="n">time</span><span class="p">)</span><span class="w"> </span><span class="o">/</span><span class="w"> </span><span class="p">(</span><span class="n">k2</span><span class="p">.</span><span class="n">time</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="n">k1</span><span class="p">.</span><span class="n">time</span><span class="p">);</span>
<a id="__codelineno-66-22" name="__codelineno-66-22" href="#__codelineno-66-22"></a><span class="w">        </span><span class="k">return</span><span class="w"> </span><span class="n">glm</span><span class="o">::</span><span class="n">mix</span><span class="p">(</span><span class="n">k1</span><span class="p">.</span><span class="n">position</span><span class="p">,</span><span class="w"> </span><span class="n">k2</span><span class="p">.</span><span class="n">position</span><span class="p">,</span><span class="w"> </span><span class="n">t</span><span class="p">);</span>
<a id="__codelineno-66-23" name="__codelineno-66-23" href="#__codelineno-66-23"></a><span class="w">    </span><span class="p">}</span>
<a id="__codelineno-66-24" name="__codelineno-66-24" href="#__codelineno-66-24"></a>
<a id="__codelineno-66-25" name="__codelineno-66-25" href="#__codelineno-66-25"></a><span class="k">private</span><span class="o">:</span>
<a id="__codelineno-66-26" name="__codelineno-66-26" href="#__codelineno-66-26"></a><span class="w">    </span><span class="n">std</span><span class="o">::</span><span class="n">vector</span><span class="o">&lt;</span><span class="n">Keyframe</span><span class="o">&gt;</span><span class="w"> </span><span class="n">keyframes</span><span class="p">;</span>
<a id="__codelineno-66-27" name="__codelineno-66-27" href="#__codelineno-66-27"></a><span class="p">};</span>
</code></pre></div>
<p>In this example, <code>Animator</code> interpolates between keyframes to compute the position of an object at a given time.</p>
<h3 id="skeletal-animation">Skeletal Animation</h3>
<p>Skeletal animation uses a skeleton of interconnected bones to animate a mesh. Each bone can be transformed independently, allowing for complex and realistic movements.</p>
<ul>
<li><strong>Purpose:</strong> To animate characters with realistic joint movements.</li>
<li>
<p><strong>Key Concepts:</strong> Bones, skinning, bone hierarchy.</p>
</li>
<li>
<p><strong>Example:</strong> Basic skeletal animation.</p>
</li>
</ul>
<div class="highlight"><pre><span></span><code><a id="__codelineno-67-1" name="__codelineno-67-1" href="#__codelineno-67-1"></a><span class="k">struct</span><span class="w"> </span><span class="nc">Bone</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-67-2" name="__codelineno-67-2" href="#__codelineno-67-2"></a><span class="w">    </span><span class="n">glm</span><span class="o">::</span><span class="n">mat4</span><span class="w"> </span><span class="n">transform</span><span class="p">;</span>
<a id="__codelineno-67-3" name="__codelineno-67-3" href="#__codelineno-67-3"></a><span class="w">    </span><span class="n">std</span><span class="o">::</span><span class="n">vector</span><span class="o">&lt;</span><span class="n">Bone</span><span class="o">&gt;</span><span class="w"> </span><span class="n">children</span><span class="p">;</span>
<a id="__codelineno-67-4" name="__codelineno-67-4" href="#__codelineno-67-4"></a><span class="p">};</span>
<a id="__codelineno-67-5" name="__codelineno-67-5" href="#__codelineno-67-5"></a>
<a id="__codelineno-67-6" name="__codelineno-67-6" href="#__codelineno-67-6"></a><span class="kt">void</span><span class="w"> </span><span class="nf">updateBoneTransforms</span><span class="p">(</span><span class="n">Bone</span><span class="o">&amp;</span><span class="w"> </span><span class="n">bone</span><span class="p">,</span><span class="w"> </span><span class="k">const</span><span class="w"> </span><span class="n">glm</span><span class="o">::</span><span class="n">mat4</span><span class="o">&amp;</span><span class="w"> </span><span class="n">parentTransform</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-67-7" name="__codelineno-67-7" href="#__codelineno-67-7"></a><span class="w">    </span><span class="n">glm</span><span class="o">::</span><span class="n">mat4</span><span class="w"> </span><span class="n">globalTransform</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">parentTransform</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="n">bone</span><span class="p">.</span><span class="n">transform</span><span class="p">;</span>
<a id="__codelineno-67-8" name="__codelineno-67-8" href="#__codelineno-67-8"></a><span class="w">    </span><span class="k">for</span><span class="w"> </span><span class="p">(</span><span class="n">Bone</span><span class="o">&amp;</span><span class="w"> </span><span class="n">child</span><span class="w"> </span><span class="o">:</span><span class="w"> </span><span class="n">bone</span><span class="p">.</span><span class="n">children</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-67-9" name="__codelineno-67-9" href="#__codelineno-67-9"></a><span class="w">        </span><span class="n">updateBoneTransforms</span><span class="p">(</span><span class="n">child</span><span class="p">,</span><span class="w"> </span><span class="n">globalTransform</span><span class="p">);</span>
<a id="__codelineno-67-10" name="__codelineno-67-10" href="#__codelineno-67-10"></a><span class="w">    </span><span class="p">}</span>
<a id="__codelineno-67-11" name="__codelineno-67-11" href="#__codelineno-67-11"></a><span class="p">}</span>
<a id="__codelineno-67-12" name="__codelineno-67-12" href="#__codelineno-67-12"></a>
<a id="__codelineno-67-13" name="__codelineno-67-13" href="#__codelineno-67-13"></a><span class="kt">void</span><span class="w"> </span><span class="nf">applyBoneTransforms</span><span class="p">(</span><span class="n">Mesh</span><span class="o">&amp;</span><span class="w"> </span><span class="n">mesh</span><span class="p">,</span><span class="w"> </span><span class="k">const</span><span class="w"> </span><span class="n">Bone</span><span class="o">&amp;</span><span class="w"> </span><span class="n">rootBone</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-67-14" name="__codelineno-67-14" href="#__codelineno-67-14"></a><span class="w">    </span><span class="n">std</span><span class="o">::</span><span class="n">vector</span><span class="o">&lt;</span><span class="n">glm</span><span class="o">::</span><span class="n">mat4</span><span class="o">&gt;</span><span class="w"> </span><span class="n">boneTransforms</span><span class="p">;</span>
<a id="__codelineno-67-15" name="__codelineno-67-15" href="#__codelineno-67-15"></a><span class="w">    </span><span class="n">collectBoneTransforms</span><span class="p">(</span><span class="n">rootBone</span><span class="p">,</span><span class="w"> </span><span class="n">glm</span><span class="o">::</span><span class="n">mat4</span><span class="p">(</span><span class="mf">1.0f</span><span class="p">),</span><span class="w"> </span><span class="n">boneTransforms</span><span class="p">);</span>
<a id="__codelineno-67-16" name="__codelineno-67-16" href="#__codelineno-67-16"></a><span class="w">    </span><span class="n">mesh</span><span class="p">.</span><span class="n">setBoneTransforms</span><span class="p">(</span><span class="n">boneTransforms</span><span class="p">);</span>
<a id="__codelineno-67-17" name="__codelineno-67-17" href="#__codelineno-67-17"></a><span class="p">}</span>
<a id="__codelineno-67-18" name="__codelineno-67-18" href="#__codelineno-67-18"></a>
<a id="__codelineno-67-19" name="__codelineno-67-19" href="#__codelineno-67-19"></a><span class="kt">void</span><span class="w"> </span><span class="nf">collectBoneTransforms</span><span class="p">(</span><span class="k">const</span><span class="w"> </span><span class="n">Bone</span><span class="o">&amp;</span><span class="w"> </span><span class="n">bone</span><span class="p">,</span><span class="w"> </span><span class="k">const</span><span class="w"> </span><span class="n">glm</span><span class="o">::</span><span class="n">mat4</span><span class="o">&amp;</span><span class="w"> </span><span class="n">parentTransform</span><span class="p">,</span><span class="w"> </span><span class="n">std</span><span class="o">::</span><span class="n">vector</span><span class="o">&lt;</span><span class="n">glm</span><span class="o">::</span><span class="n">mat4</span><span class="o">&gt;&amp;</span><span class="w"> </span><span class="n">transforms</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-67-20" name="__codelineno-67-20" href="#__codelineno-67-20"></a><span class="w">    </span><span class="n">glm</span><span class="o">::</span><span class="n">mat4</span><span class="w"> </span><span class="n">globalTransform</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">parentTransform</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="n">bone</span><span class="p">.</span><span class="n">transform</span><span class="p">;</span>
<a id="__codelineno-67-21" name="__codelineno-67-21" href="#__codelineno-67-21"></a><span class="w">    </span><span class="n">transforms</span><span class="p">.</span><span class="n">push_back</span><span class="p">(</span><span class="n">globalTransform</span><span class="p">);</span>
<a id="__codelineno-67-22" name="__codelineno-67-22" href="#__codelineno-67-22"></a><span class="w">    </span><span class="k">for</span><span class="w"> </span><span class="p">(</span><span class="k">const</span><span class="w"> </span><span class="n">Bone</span><span class="o">&amp;</span><span class="w"> </span><span class="n">child</span><span class="w"> </span><span class="o">:</span><span class="w"> </span><span class="n">bone</span><span class="p">.</span><span class="n">children</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-67-23" name="__codelineno-67-23" href="#__codelineno-67-23"></a><span class="w">        </span><span class="n">collectBoneTransforms</span><span class="p">(</span><span class="n">child</span><span class="p">,</span><span class="w"> </span><span class="n">globalTransform</span><span class="p">,</span><span class="w"> </span><span class="n">transforms</span><span class="p">);</span>
<a id="__codelineno-67-24" name="__codelineno-67-24" href="#__codelineno-67-24"></a><span class="w">    </span><span class="p">}</span>
<a id="__codelineno-67-25" name="__codelineno-67-25" href="#__codelineno-67-25"></a><span class="p">}</span>
</code></pre></div>
<p>In this example, <code>updateBoneTransforms</code> recursively updates the transforms of all bones in the hierarchy.</p>
<h3 id="inverse-kinematics-ik">Inverse Kinematics (IK)</h3>
<p>Inverse kinematics calculates the joint configurations needed to place a part of a character (e.g., a hand or foot) at a specific position. This is often used for realistic limb movements and interactions.</p>
<ul>
<li><strong>Purpose:</strong> To control the end effector's position and orientation by calculating joint angles.</li>
<li>
<p><strong>Key Concepts:</strong> End effectors, joint angles, constraints.</p>
</li>
<li>
<p><strong>Example:</strong> Basic 2D IK solver for a two-segment arm.</p>
</li>
</ul>
<div class="highlight"><pre><span></span><code><a id="__codelineno-68-1" name="__codelineno-68-1" href="#__codelineno-68-1"></a><span class="k">struct</span><span class="w"> </span><span class="nc">Segment</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-68-2" name="__codelineno-68-2" href="#__codelineno-68-2"></a><span class="w">    </span><span class="n">glm</span><span class="o">::</span><span class="n">vec2</span><span class="w"> </span><span class="n">position</span><span class="p">;</span>
<a id="__codelineno-68-3" name="__codelineno-68-3" href="#__codelineno-68-3"></a><span class="w">    </span><span class="kt">float</span><span class="w"> </span><span class="n">length</span><span class="p">;</span>
<a id="__codelineno-68-4" name="__codelineno-68-4" href="#__codelineno-68-4"></a><span class="w">    </span><span class="kt">float</span><span class="w"> </span><span class="n">angle</span><span class="p">;</span>
<a id="__codelineno-68-5" name="__codelineno-68-5" href="#__codelineno-68-5"></a><span class="p">};</span>
<a id="__codelineno-68-6" name="__codelineno-68-6" href="#__codelineno-68-6"></a>
<a id="__codelineno-68-7" name="__codelineno-68-7" href="#__codelineno-68-7"></a><span class="kt">void</span><span class="w"> </span><span class="nf">solveIK</span><span class="p">(</span><span class="n">Segment</span><span class="o">&amp;</span><span class="w"> </span><span class="n">seg1</span><span class="p">,</span><span class="w"> </span><span class="n">Segment</span><span class="o">&amp;</span><span class="w"> </span><span class="n">seg2</span><span class="p">,</span><span class="w"> </span><span class="k">const</span><span class="w"> </span><span class="n">glm</span><span class="o">::</span><span class="n">vec2</span><span class="o">&amp;</span><span class="w"> </span><span class="n">target</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-68-8" name="__codelineno-68-8" href="#__codelineno-68-8"></a><span class="w">    </span><span class="n">glm</span><span class="o">::</span><span class="n">vec2</span><span class="w"> </span><span class="n">delta</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">target</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="n">seg1</span><span class="p">.</span><span class="n">position</span><span class="p">;</span>
<a id="__codelineno-68-9" name="__codelineno-68-9" href="#__codelineno-68-9"></a><span class="w">    </span><span class="kt">float</span><span class="w"> </span><span class="n">distance</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">glm</span><span class="o">::</span><span class="n">length</span><span class="p">(</span><span class="n">delta</span><span class="p">);</span>
<a id="__codelineno-68-10" name="__codelineno-68-10" href="#__codelineno-68-10"></a><span class="w">    </span><span class="kt">float</span><span class="w"> </span><span class="n">angle1</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">atan2</span><span class="p">(</span><span class="n">delta</span><span class="p">.</span><span class="n">y</span><span class="p">,</span><span class="w"> </span><span class="n">delta</span><span class="p">.</span><span class="n">x</span><span class="p">)</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="n">acos</span><span class="p">((</span><span class="n">seg1</span><span class="p">.</span><span class="n">length</span><span class="o">*</span><span class="n">seg1</span><span class="p">.</span><span class="n">length</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="n">distance</span><span class="o">*</span><span class="n">distance</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="n">seg2</span><span class="p">.</span><span class="n">length</span><span class="o">*</span><span class="n">seg2</span><span class="p">.</span><span class="n">length</span><span class="p">)</span><span class="w"> </span><span class="o">/</span><span class="w"> </span><span class="p">(</span><span class="mi">2</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="n">seg1</span><span class="p">.</span><span class="n">length</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="n">distance</span><span class="p">));</span>
<a id="__codelineno-68-11" name="__codelineno-68-11" href="#__codelineno-68-11"></a><span class="w">    </span><span class="kt">float</span><span class="w"> </span><span class="n">angle2</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">acos</span><span class="p">((</span><span class="n">seg1</span><span class="p">.</span><span class="n">length</span><span class="o">*</span><span class="n">seg1</span><span class="p">.</span><span class="n">length</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="n">seg2</span><span class="p">.</span><span class="n">length</span><span class="o">*</span><span class="n">seg2</span><span class="p">.</span><span class="n">length</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="n">distance</span><span class="o">*</span><span class="n">distance</span><span class="p">)</span><span class="w"> </span><span class="o">/</span><span class="w"> </span><span class="p">(</span><span class="mi">2</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="n">seg1</span><span class="p">.</span><span class="n">length</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="n">seg2</span><span class="p">.</span><span class="n">length</span><span class="p">));</span>
<a id="__codelineno-68-12" name="__codelineno-68-12" href="#__codelineno-68-12"></a>
<a id="__codelineno-68-13" name="__codelineno-68-13" href="#__codelineno-68-13"></a><span class="w">    </span><span class="n">seg1</span><span class="p">.</span><span class="n">angle</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">angle1</span><span class="p">;</span>
<a id="__codelineno-68-14" name="__codelineno-68-14" href="#__codelineno-68-14"></a><span class="w">    </span><span class="n">seg2</span><span class="p">.</span><span class="n">angle</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">angle2</span><span class="p">;</span>
<a id="__codelineno-68-15" name="__codelineno-68-15" href="#__codelineno-68-15"></a><span class="p">}</span>
<a id="__codelineno-68-16" name="__codelineno-68-16" href="#__codelineno-68-16"></a>
<a id="__codelineno-68-17" name="__codelineno-68-17" href="#__codelineno-68-17"></a><span class="kt">void</span><span class="w"> </span><span class="nf">updateSegments</span><span class="p">(</span><span class="n">Segment</span><span class="o">&amp;</span><span class="w"> </span><span class="n">seg1</span><span class="p">,</span><span class="w"> </span><span class="n">Segment</span><span class="o">&amp;</span><span class="w"> </span><span class="n">seg2</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-68-18" name="__codelineno-68-18" href="#__codelineno-68-18"></a><span class="w">    </span><span class="n">seg2</span><span class="p">.</span><span class="n">position</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">seg1</span><span class="p">.</span><span class="n">position</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="n">glm</span><span class="o">::</span><span class="n">vec2</span><span class="p">(</span><span class="n">cos</span><span class="p">(</span><span class="n">seg1</span><span class="p">.</span><span class="n">angle</span><span class="p">),</span><span class="w"> </span><span class="n">sin</span><span class="p">(</span><span class="n">seg1</span><span class="p">.</span><span class="n">angle</span><span class="p">))</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="n">seg1</span><span class="p">.</span><span class="n">length</span><span class="p">;</span>
<a id="__codelineno-68-19" name="__codelineno-68-19" href="#__codelineno-68-19"></a><span class="p">}</span>
</code></pre></div>
<p>In this example, <code>solveIK</code> computes the angles for two segments of an arm to reach a target position.</p>
<h3 id="motion-capture">Motion Capture</h3>
<p>Motion capture (mocap) records the movement of objects or people to animate digital character models. This technique is widely used in film and game production for realistic animations.</p>
<ul>
<li><strong>Purpose:</strong> To capture real-world movements and apply them to digital characters.</li>
<li>
<p><strong>Key Concepts:</strong> Sensors, markers, data processing.</p>
</li>
<li>
<p><strong>Example:</strong> Basic motion capture data processing.</p>
</li>
</ul>
<div class="highlight"><pre><span></span><code><a id="__codelineno-69-1" name="__codelineno-69-1" href="#__codelineno-69-1"></a><span class="k">struct</span><span class="w"> </span><span class="nc">MocapData</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-69-2" name="__codelineno-69-2" href="#__codelineno-69-2"></a><span class="w">    </span><span class="n">std</span><span class="o">::</span><span class="n">vector</span><span class="o">&lt;</span><span class="n">glm</span><span class="o">::</span><span class="n">vec3</span><span class="o">&gt;</span><span class="w"> </span><span class="n">positions</span><span class="p">;</span><span class="w"> </span><span class="c1">// Positions of markers</span>
<a id="__codelineno-69-3" name="__codelineno-69-3" href="#__codelineno-69-3"></a><span class="w">    </span><span class="n">std</span><span class="o">::</span><span class="n">vector</span><span class="o">&lt;</span><span class="n">glm</span><span class="o">::</span><span class="n">quat</span><span class="o">&gt;</span><span class="w"> </span><span class="n">orientations</span><span class="p">;</span><span class="w"> </span><span class="c1">// Orientations of markers</span>
<a id="__codelineno-69-4" name="__codelineno-69-4" href="#__codelineno-69-4"></a><span class="p">};</span>
<a id="__codelineno-69-5" name="__codelineno-69-5" href="#__codelineno-69-5"></a>
<a id="__codelineno-69-6" name="__codelineno-69-6" href="#__codelineno-69-6"></a><span class="kt">void</span><span class="w"> </span><span class="nf">applyMocapData</span><span class="p">(</span><span class="n">Mesh</span><span class="o">&amp;</span><span class="w"> </span><span class="n">mesh</span><span class="p">,</span><span class="w"> </span><span class="k">const</span><span class="w"> </span><span class="n">MocapData</span><span class="o">&amp;</span><span class="w"> </span><span class="n">data</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-69-7" name="__codelineno-69-7" href="#__codelineno-69-7"></a><span class="w">    </span><span class="k">for</span><span class="w"> </span><span class="p">(</span><span class="kt">size_t</span><span class="w"> </span><span class="n">i</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">0</span><span class="p">;</span><span class="w"> </span><span class="n">i</span><span class="w"> </span><span class="o">&lt;</span><span class="w"> </span><span class="n">mesh</span><span class="p">.</span><span class="n">bones</span><span class="p">.</span><span class="n">size</span><span class="p">();</span><span class="w"> </span><span class="o">++</span><span class="n">i</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-69-8" name="__codelineno-69-8" href="#__codelineno-69-8"></a><span class="w">        </span><span class="n">mesh</span><span class="p">.</span><span class="n">bones</span><span class="p">[</span><span class="n">i</span><span class="p">].</span><span class="n">position</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">data</span><span class="p">.</span><span class="n">positions</span><span class="p">[</span><span class="n">i</span><span class="p">];</span>
<a id="__codelineno-69-9" name="__codelineno-69-9" href="#__codelineno-69-9"></a><span class="w">        </span><span class="n">mesh</span><span class="p">.</span><span class="n">bones</span><span class="p">[</span><span class="n">i</span><span class="p">].</span><span class="n">orientation</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">data</span><span class="p">.</span><span class="n">orientations</span><span class="p">[</span><span class="n">i</span><span class="p">];</span>
<a id="__codelineno-69-10" name="__codelineno-69-10" href="#__codelineno-69-10"></a><span class="w">    </span><span class="p">}</span>
<a id="__codelineno-69-11" name="__codelineno-69-11" href="#__codelineno-69-11"></a><span class="p">}</span>
</code></pre></div>
<p>In this example, <code>applyMocapData</code> updates the positions and orientations of a mesh's bones using mocap data.</p>
<p>By mastering these animation techniques, you can create lifelike and engaging animations for characters and objects in your graphics projects.</p>
<h2 id="optimization">Optimization</h2>
<h3 id="level-of-detail-lod">Level of Detail (LOD)</h3>
<p>Level of Detail (LOD) is a technique used to manage the complexity of 3D models by using different versions of a model with varying levels of detail. The appropriate version is chosen based on the model's distance from the camera.</p>
<p><strong>Purpose:</strong></p>
<ul>
<li><strong>Performance Optimization:</strong> Reduces the number of polygons rendered, improving performance, especially in scenes with a large number of objects.</li>
<li><strong>Visual Fidelity:</strong> Maintains visual quality by using high-detail models when close to the camera and lower-detail models when further away.</li>
</ul>
<p><strong>Implementation:</strong></p>
<ul>
<li><strong>LOD Models:</strong> Create multiple versions of a model (high, medium, and low detail).</li>
<li><strong>Distance Calculation:</strong> Determine the distance of the model from the camera and switch to the appropriate LOD model.</li>
</ul>
<p><strong>Example:</strong>
<div class="highlight"><pre><span></span><code><a id="__codelineno-70-1" name="__codelineno-70-1" href="#__codelineno-70-1"></a><span class="c1">// Pseudocode for LOD implementation</span>
<a id="__codelineno-70-2" name="__codelineno-70-2" href="#__codelineno-70-2"></a><span class="kt">float</span><span class="w"> </span><span class="n">distance</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">distance</span><span class="p">(</span><span class="n">camera</span><span class="p">.</span><span class="n">position</span><span class="p">,</span><span class="w"> </span><span class="n">model</span><span class="p">.</span><span class="n">position</span><span class="p">);</span>
<a id="__codelineno-70-3" name="__codelineno-70-3" href="#__codelineno-70-3"></a><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">distance</span><span class="w"> </span><span class="o">&lt;</span><span class="w"> </span><span class="n">LOD1_Distance</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-70-4" name="__codelineno-70-4" href="#__codelineno-70-4"></a><span class="w">    </span><span class="n">useModel</span><span class="p">(</span><span class="n">highDetailModel</span><span class="p">);</span>
<a id="__codelineno-70-5" name="__codelineno-70-5" href="#__codelineno-70-5"></a><span class="p">}</span><span class="w"> </span><span class="k">else</span><span class="w"> </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">distance</span><span class="w"> </span><span class="o">&lt;</span><span class="w"> </span><span class="n">LOD2_Distance</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-70-6" name="__codelineno-70-6" href="#__codelineno-70-6"></a><span class="w">    </span><span class="n">useModel</span><span class="p">(</span><span class="n">mediumDetailModel</span><span class="p">);</span>
<a id="__codelineno-70-7" name="__codelineno-70-7" href="#__codelineno-70-7"></a><span class="p">}</span><span class="w"> </span><span class="k">else</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-70-8" name="__codelineno-70-8" href="#__codelineno-70-8"></a><span class="w">    </span><span class="n">useModel</span><span class="p">(</span><span class="n">lowDetailModel</span><span class="p">);</span>
<a id="__codelineno-70-9" name="__codelineno-70-9" href="#__codelineno-70-9"></a><span class="p">}</span>
</code></pre></div></p>
<h3 id="occlusion-culling_1">Occlusion Culling</h3>
<p>Occlusion culling is an optimization technique that prevents objects hidden by other objects from being rendered. It determines which objects are occluded and skips rendering them.</p>
<p><strong>Purpose:</strong></p>
<p><strong>Performance Improvement:</strong> Reduces the number of draw calls and processing required by not rendering objects that are not visible to the camera.</p>
<p><strong>Implementation:</strong></p>
<ul>
<li><strong>Depth Buffer:</strong> Use the depth buffer to determine if an object is occluded by comparing its depth with the depth of the object in front of it.</li>
<li><strong>Hierarchical Z-Buffer (HZB):</strong> A more advanced method that uses a hierarchy of depth buffers to quickly reject large occluded regions.</li>
</ul>
<p><strong>Example:</strong>
<div class="highlight"><pre><span></span><code><a id="__codelineno-71-1" name="__codelineno-71-1" href="#__codelineno-71-1"></a><span class="c1">// Pseudocode for basic occlusion culling</span>
<a id="__codelineno-71-2" name="__codelineno-71-2" href="#__codelineno-71-2"></a><span class="kt">bool</span><span class="w"> </span><span class="n">isOccluded</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">checkOcclusion</span><span class="p">(</span><span class="n">model</span><span class="p">.</span><span class="n">boundingBox</span><span class="p">);</span>
<a id="__codelineno-71-3" name="__codelineno-71-3" href="#__codelineno-71-3"></a><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="o">!</span><span class="n">isOccluded</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-71-4" name="__codelineno-71-4" href="#__codelineno-71-4"></a><span class="w">    </span><span class="n">renderModel</span><span class="p">(</span><span class="n">model</span><span class="p">);</span>
<a id="__codelineno-71-5" name="__codelineno-71-5" href="#__codelineno-71-5"></a><span class="p">}</span>
</code></pre></div></p>
<h4 id="advanced-techniques-in-occlusion-culling">Advanced Techniques in Occlusion Culling</h4>
<p>While the basic implementation of occlusion culling provides a foundation, advanced techniques and optimizations are necessary for handling complex scenes and maximizing performance. Here are some of the sophisticated methods used:</p>
<h5 id="1-hierarchical-z-buffering-hzb">1. Hierarchical Z-Buffering (HZB)</h5>
<p>Hierarchical Z-Buffering is an optimization technique that uses multiple levels of depth buffers, each at a lower resolution than the previous one. This allows quick rejection of large portions of the scene that are occluded.</p>
<ul>
<li>
<p><strong>Process:</strong></p>
<ol>
<li><strong>Create Multiple Levels:</strong> Generate lower resolution versions of the depth buffer by downsampling.</li>
<li><strong>Coarse Testing:</strong> Perform occlusion tests at the coarser levels first. If a region is found to be occluded at a coarser level, it is skipped at finer levels.</li>
<li><strong>Refine Testing:</strong> Perform more precise tests at finer levels only for regions that passed the coarse tests.</li>
</ol>
</li>
</ul>
<h5 id="2-potentially-visible-set-pvs-computation">2. Potentially Visible Set (PVS) Computation</h5>
<p>The PVS technique precomputes the visibility of objects in a scene from various viewpoints, allowing quick determination of which objects are potentially visible from the current camera position.</p>
<ul>
<li>
<p><strong>Process:</strong></p>
<ol>
<li><strong>Precomputation:</strong> Divide the scene into cells and precompute the visible objects for each cell.</li>
<li><strong>Runtime:</strong> At runtime, determine which cell the camera is in and fetch the precomputed list of potentially visible objects for that cell.</li>
<li><strong>Rendering:</strong> Only the objects in the PVS are considered for rendering, significantly reducing the number of occlusion tests.</li>
</ol>
</li>
</ul>
<h5 id="3-hardware-occlusion-queries">3. Hardware Occlusion Queries</h5>
<p>Modern GPUs provide hardware support for occlusion queries, allowing efficient determination of whether objects are visible or occluded.</p>
<ul>
<li>
<p><strong>Process:</strong></p>
<ol>
<li><strong>Issue Queries:</strong> Render bounding volumes of objects to an off-screen buffer using occlusion queries.</li>
<li><strong>Query Results:</strong> Retrieve the results of the queries to determine which objects passed the occlusion test.</li>
<li><strong>Conditional Rendering:</strong> Render only the objects that passed the occlusion queries.</li>
</ol>
</li>
</ul>
<h5 id="implementation-of-hierarchical-z-buffering-in-c">Implementation of Hierarchical Z-Buffering in C++</h5>
<p>Below is an example of how you might implement Hierarchical Z-Buffering in C++:</p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-72-1" name="__codelineno-72-1" href="#__codelineno-72-1"></a><span class="cp">#include</span><span class="w"> </span><span class="cpf">&lt;iostream&gt;</span>
<a id="__codelineno-72-2" name="__codelineno-72-2" href="#__codelineno-72-2"></a><span class="cp">#include</span><span class="w"> </span><span class="cpf">&lt;vector&gt;</span>
<a id="__codelineno-72-3" name="__codelineno-72-3" href="#__codelineno-72-3"></a><span class="cp">#include</span><span class="w"> </span><span class="cpf">&lt;glm/glm.hpp&gt;</span>
<a id="__codelineno-72-4" name="__codelineno-72-4" href="#__codelineno-72-4"></a><span class="cp">#include</span><span class="w"> </span><span class="cpf">&lt;glm/gtc/matrix_transform.hpp&gt;</span>
<a id="__codelineno-72-5" name="__codelineno-72-5" href="#__codelineno-72-5"></a><span class="cp">#include</span><span class="w"> </span><span class="cpf">&lt;glm/gtc/type_ptr.hpp&gt;</span>
<a id="__codelineno-72-6" name="__codelineno-72-6" href="#__codelineno-72-6"></a><span class="cp">#include</span><span class="w"> </span><span class="cpf">&lt;algorithm&gt;</span>
<a id="__codelineno-72-7" name="__codelineno-72-7" href="#__codelineno-72-7"></a>
<a id="__codelineno-72-8" name="__codelineno-72-8" href="#__codelineno-72-8"></a><span class="k">class</span><span class="w"> </span><span class="nc">HierarchicalZBuffer</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-72-9" name="__codelineno-72-9" href="#__codelineno-72-9"></a><span class="k">public</span><span class="o">:</span>
<a id="__codelineno-72-10" name="__codelineno-72-10" href="#__codelineno-72-10"></a><span class="w">    </span><span class="n">HierarchicalZBuffer</span><span class="p">(</span><span class="kt">int</span><span class="w"> </span><span class="n">width</span><span class="p">,</span><span class="w"> </span><span class="kt">int</span><span class="w"> </span><span class="n">height</span><span class="p">)</span><span class="w"> </span>
<a id="__codelineno-72-11" name="__codelineno-72-11" href="#__codelineno-72-11"></a><span class="w">        </span><span class="o">:</span><span class="w"> </span><span class="n">width</span><span class="p">(</span><span class="n">width</span><span class="p">),</span><span class="w"> </span><span class="n">height</span><span class="p">(</span><span class="n">height</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-72-12" name="__codelineno-72-12" href="#__codelineno-72-12"></a><span class="w">        </span><span class="kt">int</span><span class="w"> </span><span class="n">levelWidth</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">width</span><span class="p">;</span>
<a id="__codelineno-72-13" name="__codelineno-72-13" href="#__codelineno-72-13"></a><span class="w">        </span><span class="kt">int</span><span class="w"> </span><span class="n">levelHeight</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">height</span><span class="p">;</span>
<a id="__codelineno-72-14" name="__codelineno-72-14" href="#__codelineno-72-14"></a><span class="w">        </span><span class="k">while</span><span class="w"> </span><span class="p">(</span><span class="n">levelWidth</span><span class="w"> </span><span class="o">&gt;</span><span class="w"> </span><span class="mi">1</span><span class="w"> </span><span class="o">&amp;&amp;</span><span class="w"> </span><span class="n">levelHeight</span><span class="w"> </span><span class="o">&gt;</span><span class="w"> </span><span class="mi">1</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-72-15" name="__codelineno-72-15" href="#__codelineno-72-15"></a><span class="w">            </span><span class="n">depthBuffers</span><span class="p">.</span><span class="n">push_back</span><span class="p">(</span><span class="n">std</span><span class="o">::</span><span class="n">vector</span><span class="o">&lt;</span><span class="kt">float</span><span class="o">&gt;</span><span class="p">(</span><span class="n">levelWidth</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="n">levelHeight</span><span class="p">,</span><span class="w"> </span><span class="n">std</span><span class="o">::</span><span class="n">numeric_limits</span><span class="o">&lt;</span><span class="kt">float</span><span class="o">&gt;::</span><span class="n">max</span><span class="p">()));</span>
<a id="__codelineno-72-16" name="__codelineno-72-16" href="#__codelineno-72-16"></a><span class="w">            </span><span class="n">levelWidth</span><span class="w"> </span><span class="o">/=</span><span class="w"> </span><span class="mi">2</span><span class="p">;</span>
<a id="__codelineno-72-17" name="__codelineno-72-17" href="#__codelineno-72-17"></a><span class="w">            </span><span class="n">levelHeight</span><span class="w"> </span><span class="o">/=</span><span class="w"> </span><span class="mi">2</span><span class="p">;</span>
<a id="__codelineno-72-18" name="__codelineno-72-18" href="#__codelineno-72-18"></a><span class="w">        </span><span class="p">}</span>
<a id="__codelineno-72-19" name="__codelineno-72-19" href="#__codelineno-72-19"></a><span class="w">    </span><span class="p">}</span>
<a id="__codelineno-72-20" name="__codelineno-72-20" href="#__codelineno-72-20"></a>
<a id="__codelineno-72-21" name="__codelineno-72-21" href="#__codelineno-72-21"></a><span class="w">    </span><span class="kt">void</span><span class="w"> </span><span class="n">clear</span><span class="p">()</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-72-22" name="__codelineno-72-22" href="#__codelineno-72-22"></a><span class="w">        </span><span class="k">for</span><span class="w"> </span><span class="p">(</span><span class="k">auto</span><span class="o">&amp;</span><span class="w"> </span><span class="n">buffer</span><span class="w"> </span><span class="o">:</span><span class="w"> </span><span class="n">depthBuffers</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-72-23" name="__codelineno-72-23" href="#__codelineno-72-23"></a><span class="w">            </span><span class="n">std</span><span class="o">::</span><span class="n">fill</span><span class="p">(</span><span class="n">buffer</span><span class="p">.</span><span class="n">begin</span><span class="p">(),</span><span class="w"> </span><span class="n">buffer</span><span class="p">.</span><span class="n">end</span><span class="p">(),</span><span class="w"> </span><span class="n">std</span><span class="o">::</span><span class="n">numeric_limits</span><span class="o">&lt;</span><span class="kt">float</span><span class="o">&gt;::</span><span class="n">max</span><span class="p">());</span>
<a id="__codelineno-72-24" name="__codelineno-72-24" href="#__codelineno-72-24"></a><span class="w">        </span><span class="p">}</span>
<a id="__codelineno-72-25" name="__codelineno-72-25" href="#__codelineno-72-25"></a><span class="w">    </span><span class="p">}</span>
<a id="__codelineno-72-26" name="__codelineno-72-26" href="#__codelineno-72-26"></a>
<a id="__codelineno-72-27" name="__codelineno-72-27" href="#__codelineno-72-27"></a><span class="w">    </span><span class="kt">void</span><span class="w"> </span><span class="n">updateDepthBuffer</span><span class="p">(</span><span class="k">const</span><span class="w"> </span><span class="n">glm</span><span class="o">::</span><span class="n">mat4</span><span class="o">&amp;</span><span class="w"> </span><span class="n">viewProjMatrix</span><span class="p">,</span><span class="w"> </span><span class="k">const</span><span class="w"> </span><span class="n">std</span><span class="o">::</span><span class="n">vector</span><span class="o">&lt;</span><span class="n">glm</span><span class="o">::</span><span class="n">vec3</span><span class="o">&gt;&amp;</span><span class="w"> </span><span class="n">objectVertices</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-72-28" name="__codelineno-72-28" href="#__codelineno-72-28"></a><span class="w">        </span><span class="c1">// Update the finest level depth buffer with object vertices</span>
<a id="__codelineno-72-29" name="__codelineno-72-29" href="#__codelineno-72-29"></a><span class="w">        </span><span class="k">auto</span><span class="o">&amp;</span><span class="w"> </span><span class="n">fineDepthBuffer</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">depthBuffers</span><span class="p">[</span><span class="mi">0</span><span class="p">];</span>
<a id="__codelineno-72-30" name="__codelineno-72-30" href="#__codelineno-72-30"></a><span class="w">        </span><span class="k">for</span><span class="w"> </span><span class="p">(</span><span class="k">const</span><span class="w"> </span><span class="k">auto</span><span class="o">&amp;</span><span class="w"> </span><span class="n">vertex</span><span class="w"> </span><span class="o">:</span><span class="w"> </span><span class="n">objectVertices</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-72-31" name="__codelineno-72-31" href="#__codelineno-72-31"></a><span class="w">            </span><span class="n">glm</span><span class="o">::</span><span class="n">vec4</span><span class="w"> </span><span class="n">screenSpaceVertex</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">viewProjMatrix</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="n">glm</span><span class="o">::</span><span class="n">vec4</span><span class="p">(</span><span class="n">vertex</span><span class="p">,</span><span class="w"> </span><span class="mf">1.0f</span><span class="p">);</span>
<a id="__codelineno-72-32" name="__codelineno-72-32" href="#__codelineno-72-32"></a><span class="w">            </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">screenSpaceVertex</span><span class="p">.</span><span class="n">w</span><span class="w"> </span><span class="o">&gt;</span><span class="w"> </span><span class="mf">0.0f</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-72-33" name="__codelineno-72-33" href="#__codelineno-72-33"></a><span class="w">                </span><span class="n">screenSpaceVertex</span><span class="w"> </span><span class="o">/=</span><span class="w"> </span><span class="n">screenSpaceVertex</span><span class="p">.</span><span class="n">w</span><span class="p">;</span>
<a id="__codelineno-72-34" name="__codelineno-72-34" href="#__codelineno-72-34"></a><span class="w">                </span><span class="kt">int</span><span class="w"> </span><span class="n">x</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">static_cast</span><span class="o">&lt;</span><span class="kt">int</span><span class="o">&gt;</span><span class="p">((</span><span class="n">screenSpaceVertex</span><span class="p">.</span><span class="n">x</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="mf">0.5f</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="mf">0.5f</span><span class="p">)</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="n">width</span><span class="p">);</span>
<a id="__codelineno-72-35" name="__codelineno-72-35" href="#__codelineno-72-35"></a><span class="w">                </span><span class="kt">int</span><span class="w"> </span><span class="n">y</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">static_cast</span><span class="o">&lt;</span><span class="kt">int</span><span class="o">&gt;</span><span class="p">((</span><span class="n">screenSpaceVertex</span><span class="p">.</span><span class="n">y</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="mf">0.5f</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="mf">0.5f</span><span class="p">)</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="n">height</span><span class="p">);</span>
<a id="__codelineno-72-36" name="__codelineno-72-36" href="#__codelineno-72-36"></a><span class="w">                </span><span class="kt">float</span><span class="w"> </span><span class="n">depth</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">screenSpaceVertex</span><span class="p">.</span><span class="n">z</span><span class="p">;</span>
<a id="__codelineno-72-37" name="__codelineno-72-37" href="#__codelineno-72-37"></a>
<a id="__codelineno-72-38" name="__codelineno-72-38" href="#__codelineno-72-38"></a><span class="w">                </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">x</span><span class="w"> </span><span class="o">&gt;=</span><span class="w"> </span><span class="mi">0</span><span class="w"> </span><span class="o">&amp;&amp;</span><span class="w"> </span><span class="n">x</span><span class="w"> </span><span class="o">&lt;</span><span class="w"> </span><span class="n">width</span><span class="w"> </span><span class="o">&amp;&amp;</span><span class="w"> </span><span class="n">y</span><span class="w"> </span><span class="o">&gt;=</span><span class="w"> </span><span class="mi">0</span><span class="w"> </span><span class="o">&amp;&amp;</span><span class="w"> </span><span class="n">y</span><span class="w"> </span><span class="o">&lt;</span><span class="w"> </span><span class="n">height</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-72-39" name="__codelineno-72-39" href="#__codelineno-72-39"></a><span class="w">                    </span><span class="kt">int</span><span class="w"> </span><span class="n">index</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">y</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="n">width</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="n">x</span><span class="p">;</span>
<a id="__codelineno-72-40" name="__codelineno-72-40" href="#__codelineno-72-40"></a><span class="w">                    </span><span class="n">fineDepthBuffer</span><span class="p">[</span><span class="n">index</span><span class="p">]</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">std</span><span class="o">::</span><span class="n">min</span><span class="p">(</span><span class="n">fineDepthBuffer</span><span class="p">[</span><span class="n">index</span><span class="p">],</span><span class="w"> </span><span class="n">depth</span><span class="p">);</span>
<a id="__codelineno-72-41" name="__codelineno-72-41" href="#__codelineno-72-41"></a><span class="w">                </span><span class="p">}</span>
<a id="__codelineno-72-42" name="__codelineno-72-42" href="#__codelineno-72-42"></a><span class="w">            </span><span class="p">}</span>
<a id="__codelineno-72-43" name="__codelineno-72-43" href="#__codelineno-72-43"></a><span class="w">        </span><span class="p">}</span>
<a id="__codelineno-72-44" name="__codelineno-72-44" href="#__codelineno-72-44"></a>
<a id="__codelineno-72-45" name="__codelineno-72-45" href="#__codelineno-72-45"></a><span class="w">        </span><span class="c1">// Generate coarser levels of depth buffer</span>
<a id="__codelineno-72-46" name="__codelineno-72-46" href="#__codelineno-72-46"></a><span class="w">        </span><span class="kt">int</span><span class="w"> </span><span class="n">levelWidth</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">width</span><span class="p">;</span>
<a id="__codelineno-72-47" name="__codelineno-72-47" href="#__codelineno-72-47"></a><span class="w">        </span><span class="kt">int</span><span class="w"> </span><span class="n">levelHeight</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">height</span><span class="p">;</span>
<a id="__codelineno-72-48" name="__codelineno-72-48" href="#__codelineno-72-48"></a><span class="w">        </span><span class="k">for</span><span class="w"> </span><span class="p">(</span><span class="kt">size_t</span><span class="w"> </span><span class="n">i</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">1</span><span class="p">;</span><span class="w"> </span><span class="n">i</span><span class="w"> </span><span class="o">&lt;</span><span class="w"> </span><span class="n">depthBuffers</span><span class="p">.</span><span class="n">size</span><span class="p">();</span><span class="w"> </span><span class="o">++</span><span class="n">i</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-72-49" name="__codelineno-72-49" href="#__codelineno-72-49"></a><span class="w">            </span><span class="k">auto</span><span class="o">&amp;</span><span class="w"> </span><span class="n">prevBuffer</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">depthBuffers</span><span class="p">[</span><span class="n">i</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="mi">1</span><span class="p">];</span>
<a id="__codelineno-72-50" name="__codelineno-72-50" href="#__codelineno-72-50"></a><span class="w">            </span><span class="k">auto</span><span class="o">&amp;</span><span class="w"> </span><span class="n">currBuffer</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">depthBuffers</span><span class="p">[</span><span class="n">i</span><span class="p">];</span>
<a id="__codelineno-72-51" name="__codelineno-72-51" href="#__codelineno-72-51"></a><span class="w">            </span><span class="n">levelWidth</span><span class="w"> </span><span class="o">/=</span><span class="w"> </span><span class="mi">2</span><span class="p">;</span>
<a id="__codelineno-72-52" name="__codelineno-72-52" href="#__codelineno-72-52"></a><span class="w">            </span><span class="n">levelHeight</span><span class="w"> </span><span class="o">/=</span><span class="w"> </span><span class="mi">2</span><span class="p">;</span>
<a id="__codelineno-72-53" name="__codelineno-72-53" href="#__codelineno-72-53"></a><span class="w">            </span><span class="k">for</span><span class="w"> </span><span class="p">(</span><span class="kt">int</span><span class="w"> </span><span class="n">y</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">0</span><span class="p">;</span><span class="w"> </span><span class="n">y</span><span class="w"> </span><span class="o">&lt;</span><span class="w"> </span><span class="n">levelHeight</span><span class="p">;</span><span class="w"> </span><span class="o">++</span><span class="n">y</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-72-54" name="__codelineno-72-54" href="#__codelineno-72-54"></a><span class="w">                </span><span class="k">for</span><span class="w"> </span><span class="p">(</span><span class="kt">int</span><span class="w"> </span><span class="n">x</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">0</span><span class="p">;</span><span class="w"> </span><span class="n">x</span><span class="w"> </span><span class="o">&lt;</span><span class="w"> </span><span class="n">levelWidth</span><span class="p">;</span><span class="w"> </span><span class="o">++</span><span class="n">x</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-72-55" name="__codelineno-72-55" href="#__codelineno-72-55"></a><span class="w">                    </span><span class="kt">int</span><span class="w"> </span><span class="n">index</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">y</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="n">levelWidth</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="n">x</span><span class="p">;</span>
<a id="__codelineno-72-56" name="__codelineno-72-56" href="#__codelineno-72-56"></a><span class="w">                    </span><span class="kt">int</span><span class="w"> </span><span class="n">prevIndex</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">(</span><span class="n">y</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="mi">2</span><span class="p">)</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="p">(</span><span class="n">levelWidth</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="mi">2</span><span class="p">)</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="p">(</span><span class="n">x</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="mi">2</span><span class="p">);</span>
<a id="__codelineno-72-57" name="__codelineno-72-57" href="#__codelineno-72-57"></a><span class="w">                    </span><span class="kt">float</span><span class="w"> </span><span class="n">minDepth</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">prevBuffer</span><span class="p">[</span><span class="n">prevIndex</span><span class="p">];</span>
<a id="__codelineno-72-58" name="__codelineno-72-58" href="#__codelineno-72-58"></a><span class="w">                    </span><span class="n">minDepth</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">std</span><span class="o">::</span><span class="n">min</span><span class="p">(</span><span class="n">minDepth</span><span class="p">,</span><span class="w"> </span><span class="n">prevBuffer</span><span class="p">[</span><span class="n">prevIndex</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="mi">1</span><span class="p">]);</span>
<a id="__codelineno-72-59" name="__codelineno-72-59" href="#__codelineno-72-59"></a><span class="w">                    </span><span class="n">minDepth</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">std</span><span class="o">::</span><span class="n">min</span><span class="p">(</span><span class="n">minDepth</span><span class="p">,</span><span class="w"> </span><span class="n">prevBuffer</span><span class="p">[</span><span class="n">prevIndex</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="p">(</span><span class="n">levelWidth</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="mi">2</span><span class="p">)]);</span>
<a id="__codelineno-72-60" name="__codelineno-72-60" href="#__codelineno-72-60"></a><span class="w">                    </span><span class="n">minDepth</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">std</span><span class="o">::</span><span class="n">min</span><span class="p">(</span><span class="n">minDepth</span><span class="p">,</span><span class="w"> </span><span class="n">prevBuffer</span><span class="p">[</span><span class="n">prevIndex</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="p">(</span><span class="n">levelWidth</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="mi">2</span><span class="p">)</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="mi">1</span><span class="p">]);</span>
<a id="__codelineno-72-61" name="__codelineno-72-61" href="#__codelineno-72-61"></a><span class="w">                    </span><span class="n">currBuffer</span><span class="p">[</span><span class="n">index</span><span class="p">]</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">minDepth</span><span class="p">;</span>
<a id="__codelineno-72-62" name="__codelineno-72-62" href="#__codelineno-72-62"></a><span class="w">                </span><span class="p">}</span>
<a id="__codelineno-72-63" name="__codelineno-72-63" href="#__codelineno-72-63"></a><span class="w">            </span><span class="p">}</span>
<a id="__codelineno-72-64" name="__codelineno-72-64" href="#__codelineno-72-64"></a><span class="w">        </span><span class="p">}</span>
<a id="__codelineno-72-65" name="__codelineno-72-65" href="#__codelineno-72-65"></a><span class="w">    </span><span class="p">}</span>
<a id="__codelineno-72-66" name="__codelineno-72-66" href="#__codelineno-72-66"></a>
<a id="__codelineno-72-67" name="__codelineno-72-67" href="#__codelineno-72-67"></a><span class="w">    </span><span class="kt">bool</span><span class="w"> </span><span class="n">isOccluded</span><span class="p">(</span><span class="k">const</span><span class="w"> </span><span class="n">glm</span><span class="o">::</span><span class="n">mat4</span><span class="o">&amp;</span><span class="w"> </span><span class="n">viewProjMatrix</span><span class="p">,</span><span class="w"> </span><span class="k">const</span><span class="w"> </span><span class="n">std</span><span class="o">::</span><span class="n">vector</span><span class="o">&lt;</span><span class="n">glm</span><span class="o">::</span><span class="n">vec3</span><span class="o">&gt;&amp;</span><span class="w"> </span><span class="n">objectVertices</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-72-68" name="__codelineno-72-68" href="#__codelineno-72-68"></a><span class="w">        </span><span class="c1">// Perform hierarchical Z-buffer test</span>
<a id="__codelineno-72-69" name="__codelineno-72-69" href="#__codelineno-72-69"></a><span class="w">        </span><span class="k">for</span><span class="w"> </span><span class="p">(</span><span class="k">const</span><span class="w"> </span><span class="k">auto</span><span class="o">&amp;</span><span class="w"> </span><span class="n">vertex</span><span class="w"> </span><span class="o">:</span><span class="w"> </span><span class="n">objectVertices</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-72-70" name="__codelineno-72-70" href="#__codelineno-72-70"></a><span class="w">            </span><span class="n">glm</span><span class="o">::</span><span class="n">vec4</span><span class="w"> </span><span class="n">screenSpaceVertex</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">viewProjMatrix</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="n">glm</span><span class="o">::</span><span class="n">vec4</span><span class="p">(</span><span class="n">vertex</span><span class="p">,</span><span class="w"> </span><span class="mf">1.0f</span><span class="p">);</span>
<a id="__codelineno-72-71" name="__codelineno-72-71" href="#__codelineno-72-71"></a><span class="w">            </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">screenSpaceVertex</span><span class="p">.</span><span class="n">w</span><span class="w"> </span><span class="o">&gt;</span><span class="w"> </span><span class="mf">0.0f</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-72-72" name="__codelineno-72-72" href="#__codelineno-72-72"></a><span class="w">                </span><span class="n">screenSpaceVertex</span><span class="w"> </span><span class="o">/=</span><span class="w"> </span><span class="n">screenSpaceVertex</span><span class="p">.</span><span class="n">w</span><span class="p">;</span>
<a id="__codelineno-72-73" name="__codelineno-72-73" href="#__codelineno-72-73"></a><span class="w">                </span><span class="kt">int</span><span class="w"> </span><span class="n">x</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">static_cast</span><span class="o">&lt;</span><span class="kt">int</span><span class="o">&gt;</span><span class="p">((</span><span class="n">screenSpaceVertex</span><span class="p">.</span><span class="n">x</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="mf">0.5f</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="mf">0.5f</span><span class="p">)</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="n">width</span><span class="p">);</span>
<a id="__codelineno-72-74" name="__codelineno-72-74" href="#__codelineno-72-74"></a><span class="w">                </span><span class="kt">int</span><span class="w"> </span><span class="n">y</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">static_cast</span><span class="o">&lt;</span><span class="kt">int</span><span class="o">&gt;</span><span class="p">((</span><span class="n">screenSpaceVertex</span><span class="p">.</span><span class="n">y</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="mf">0.5f</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="mf">0.5f</span><span class="p">)</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="n">height</span><span class="p">);</span>
<a id="__codelineno-72-75" name="__codelineno-72-75" href="#__codelineno-72-75"></a><span class="w">                </span><span class="kt">float</span><span class="w"> </span><span class="n">depth</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">screenSpaceVertex</span><span class="p">.</span><span class="n">z</span><span class="p">;</span>
<a id="__codelineno-72-76" name="__codelineno-72-76" href="#__codelineno-72-76"></a>
<a id="__codelineno-72-77" name="__codelineno-72-77" href="#__codelineno-72-77"></a><span class="w">                </span><span class="k">for</span><span class="w"> </span><span class="p">(</span><span class="kt">size_t</span><span class="w"> </span><span class="n">i</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">0</span><span class="p">;</span><span class="w"> </span><span class="n">i</span><span class="w"> </span><span class="o">&lt;</span><span class="w"> </span><span class="n">depthBuffers</span><span class="p">.</span><span class="n">size</span><span class="p">();</span><span class="w"> </span><span class="o">++</span><span class="n">i</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-72-78" name="__codelineno-72-78" href="#__codelineno-72-78"></a><span class="w">                    </span><span class="kt">int</span><span class="w"> </span><span class="n">levelWidth</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">width</span><span class="w"> </span><span class="o">&gt;&gt;</span><span class="w"> </span><span class="n">i</span><span class="p">;</span>
<a id="__codelineno-72-79" name="__codelineno-72-79" href="#__codelineno-72-79"></a><span class="w">                    </span><span class="kt">int</span><span class="w"> </span><span class="n">levelHeight</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">height</span><span class="w"> </span><span class="o">&gt;&gt;</span><span class="w"> </span><span class="n">i</span><span class="p">;</span>
<a id="__codelineno-72-80" name="__codelineno-72-80" href="#__codelineno-72-80"></a><span class="w">                    </span><span class="kt">int</span><span class="w"> </span><span class="n">levelX</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">x</span><span class="w"> </span><span class="o">&gt;&gt;</span><span class="w"> </span><span class="n">i</span><span class="p">;</span>
<a id="__codelineno-72-81" name="__codelineno-72-81" href="#__codelineno-72-81"></a><span class="w">                    </span><span class="kt">int</span><span class="w"> </span><span class="n">levelY</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">y</span><span class="w"> </span><span class="o">&gt;&gt;</span><span class="w"> </span><span class="n">i</span><span class="p">;</span>
<a id="__codelineno-72-82" name="__codelineno-72-82" href="#__codelineno-72-82"></a><span class="w">                    </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">levelX</span><span class="w"> </span><span class="o">&gt;=</span><span class="w"> </span><span class="mi">0</span><span class="w"> </span><span class="o">&amp;&amp;</span><span class="w"> </span><span class="n">levelX</span><span class="w"> </span><span class="o">&lt;</span><span class="w"> </span><span class="n">levelWidth</span><span class="w"> </span><span class="o">&amp;&amp;</span><span class="w"> </span><span class="n">levelY</span><span class="w"> </span><span class="o">&gt;=</span><span class="w"> </span><span class="mi">0</span><span class="w"> </span><span class="o">&amp;&amp;</span><span class="w"> </span><span class="n">levelY</span><span class="w"> </span><span class="o">&lt;</span><span class="w"> </span><span class="n">levelHeight</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-72-83" name="__codelineno-72-83" href="#__codelineno-72-83"></a><span class="w">                        </span><span class="kt">int</span><span class="w"> </span><span class="n">index</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">levelY</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="n">levelWidth</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="n">levelX</span><span class="p">;</span>
<a id="__codelineno-72-84" name="__codelineno-72-84" href="#__codelineno-72-84"></a><span class="w">                        </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">depth</span><span class="w"> </span><span class="o">&lt;</span><span class="w"> </span><span class="n">depthBuffers</span><span class="p">[</span><span class="n">i</span><span class="p">][</span><span class="n">index</span><span class="p">])</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-72-85" name="__codelineno-72-85" href="#__codelineno-72-85"></a><span class="w">                            </span><span class="k">return</span><span class="w"> </span><span class="nb">false</span><span class="p">;</span><span class="w"> </span><span class="c1">// Not occluded</span>
<a id="__codelineno-72-86" name="__codelineno-72-86" href="#__codelineno-72-86"></a><span class="w">                        </span><span class="p">}</span>
<a id="__codelineno-72-87" name="__codelineno-72-87" href="#__codelineno-72-87"></a><span class="w">                    </span><span class="p">}</span>
<a id="__codelineno-72-88" name="__codelineno-72-88" href="#__codelineno-72-88"></a><span class="w">                </span><span class="p">}</span>
<a id="__codelineno-72-89" name="__codelineno-72-89" href="#__codelineno-72-89"></a><span class="w">            </span><span class="p">}</span>
<a id="__codelineno-72-90" name="__codelineno-72-90" href="#__codelineno-72-90"></a><span class="w">        </span><span class="p">}</span>
<a id="__codelineno-72-91" name="__codelineno-72-91" href="#__codelineno-72-91"></a><span class="w">        </span><span class="k">return</span><span class="w"> </span><span class="nb">true</span><span class="p">;</span><span class="w"> </span><span class="c1">// Occluded</span>
<a id="__codelineno-72-92" name="__codelineno-72-92" href="#__codelineno-72-92"></a><span class="w">    </span><span class="p">}</span>
<a id="__codelineno-72-93" name="__codelineno-72-93" href="#__codelineno-72-93"></a>
<a id="__codelineno-72-94" name="__codelineno-72-94" href="#__codelineno-72-94"></a><span class="k">private</span><span class="o">:</span>
<a id="__codelineno-72-95" name="__codelineno-72-95" href="#__codelineno-72-95"></a><span class="w">    </span><span class="kt">int</span><span class="w"> </span><span class="n">width</span><span class="p">,</span><span class="w"> </span><span class="n">height</span><span class="p">;</span>
<a id="__codelineno-72-96" name="__codelineno-72-96" href="#__codelineno-72-96"></a><span class="w">    </span><span class="n">std</span><span class="o">::</span><span class="n">vector</span><span class="o">&lt;</span><span class="n">std</span><span class="o">::</span><span class="n">vector</span><span class="o">&lt;</span><span class="kt">float</span><span class="o">&gt;&gt;</span><span class="w"> </span><span class="n">depthBuffers</span><span class="p">;</span>
<a id="__codelineno-72-97" name="__codelineno-72-97" href="#__codelineno-72-97"></a><span class="p">};</span>
<a id="__codelineno-72-98" name="__codelineno-72-98" href="#__codelineno-72-98"></a>
<a id="__codelineno-72-99" name="__codelineno-72-99" href="#__codelineno-72-99"></a><span class="kt">int</span><span class="w"> </span><span class="nf">main</span><span class="p">()</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-72-100" name="__codelineno-72-100" href="#__codelineno-72-100"></a><span class="w">    </span><span class="kt">int</span><span class="w"> </span><span class="n">width</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">800</span><span class="p">;</span>
<a id="__codelineno-72-101" name="__codelineno-72-101" href="#__codelineno-72-101"></a><span class="w">    </span><span class="kt">int</span><span class="w"> </span><span class="n">height</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">600</span><span class="p">;</span>
<a id="__codelineno-72-102" name="__codelineno-72-102" href="#__codelineno-72-102"></a><span class="w">    </span><span class="n">HierarchicalZBuffer</span><span class="w"> </span><span class="n">hzb</span><span class="p">(</span><span class="n">width</span><span class="p">,</span><span class="w"> </span><span class="n">height</span><span class="p">);</span>
<a id="__codelineno-72-103" name="__codelineno-72-103" href="#__codelineno-72-103"></a>
<a id="__codelineno-72-104" name="__codelineno-72-104" href="#__codelineno-72-104"></a><span class="w">    </span><span class="n">glm</span><span class="o">::</span><span class="n">mat4</span><span class="w"> </span><span class="n">viewMatrix</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">glm</span><span class="o">::</span><span class="n">lookAt</span><span class="p">(</span><span class="n">glm</span><span class="o">::</span><span class="n">vec3</span><span class="p">(</span><span class="mf">0.0f</span><span class="p">,</span><span class="w"> </span><span class="mf">0.0f</span><span class="p">,</span><span class="w"> </span><span class="mf">5.0f</span><span class="p">),</span><span class="w"> </span><span class="n">glm</span><span class="o">::</span><span class="n">vec3</span><span class="p">(</span><span class="mf">0.0f</span><span class="p">),</span><span class="w"> </span><span class="n">glm</span><span class="o">::</span><span class="n">vec3</span><span class="p">(</span><span class="mf">0.0f</span><span class="p">,</span><span class="w"> </span><span class="mf">1.0f</span><span class="p">,</span><span class="w"> </span><span class="mf">0.0f</span><span class="p">));</span>
<a id="__codelineno-72-105" name="__codelineno-72-105" href="#__codelineno-72-105"></a><span class="w">    </span><span class="n">glm</span><span class="o">::</span><span class="n">mat4</span><span class="w"> </span><span class="n">projectionMatrix</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">glm</span><span class="o">::</span><span class="n">perspective</span><span class="p">(</span><span class="n">glm</span><span class="o">::</span><span class="n">radians</span><span class="p">(</span><span class="mf">45.0f</span><span class="p">),</span><span class="w"> </span><span class="mf">4.0f</span><span class="w"> </span><span class="o">/</span><span class="w"> </span><span class="mf">3.0f</span><span class="p">,</span><span class="w"> </span><span class="mf">0.1f</span><span class="p">,</span><span class="w"> </span><span class="mf">100.0f</span><span class="p">);</span>
<a id="__codelineno-72-106" name="__codelineno-72-106" href="#__codelineno-72-106"></a><span class="w">    </span><span class="n">glm</span><span class="o">::</span><span class="n">mat4</span><span class="w"> </span><span class="n">viewProjMatrix</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">projectionMatrix</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="n">viewMatrix</span><span class="p">;</span>
<a id="__codelineno-72-107" name="__codelineno-72-107" href="#__codelineno-72-107"></a>
<a id="__codelineno-72-108" name="__codelineno-72-108" href="#__codelineno-72-108"></a><span class="w">    </span><span class="n">std</span><span class="o">::</span><span class="n">vector</span><span class="o">&lt;</span><span class="n">glm</span><span class="o">::</span><span class="n">vec3</span><span class="o">&gt;</span><span class="w"> </span><span class="n">occluderVertices</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-72-109" name="__codelineno-72-109" href="#__codelineno-72-109"></a><span class="w">        </span><span class="n">glm</span><span class="o">::</span><span class="n">vec3</span><span class="p">(</span><span class="mf">-1.0f</span><span class="p">,</span><span class="w"> </span><span class="mf">-1.0f</span><span class="p">,</span><span class="w"> </span><span class="mf">-1.0f</span><span class="p">),</span><span class="w"> </span><span class="n">glm</span><span class="o">::</span><span class="n">vec3</span><span class="p">(</span><span class="mf">1.0f</span><span class="p">,</span><span class="w"> </span><span class="mf">-1.0f</span><span class="p">,</span><span class="w"> </span><span class="mf">-1.0f</span><span class="p">),</span>
<a id="__codelineno-72-110" name="__codelineno-72-110" href="#__codelineno-72-110"></a><span class="w">        </span><span class="n">glm</span><span class="o">::</span><span class="n">vec3</span><span class="p">(</span><span class="mf">-1.0f</span><span class="p">,</span><span class="w">  </span><span class="mf">1.0f</span><span class="p">,</span><span class="w"> </span><span class="mf">-1.0f</span><span class="p">),</span><span class="w"> </span><span class="n">glm</span><span class="o">::</span><span class="n">vec3</span><span class="p">(</span><span class="mf">1.0f</span><span class="p">,</span><span class="w">  </span><span class="mf">1.0f</span><span class="p">,</span><span class="w"> </span><span class="mf">-1.0f</span><span class="p">),</span>
<a id="__codelineno-72-111" name="__codelineno-72-111" href="#__codelineno-72-111"></a><span class="w">        </span><span class="n">glm</span><span class="o">::</span><span class="n">vec3</span><span class="p">(</span><span class="mf">-1.0f</span><span class="p">,</span><span class="w"> </span><span class="mf">-1.0f</span><span class="p">,</span><span class="w">  </span><span class="mf">1.0f</span><span class="p">),</span><span class="w"> </span><span class="n">glm</span><span class="o">::</span><span class="n">vec3</span><span class="p">(</span><span class="mf">1.0f</span><span class="p">,</span><span class="w"> </span><span class="mf">-1.0f</span><span class="p">,</span><span class="w">  </span><span class="mf">1.0f</span><span class="p">),</span>
<a id="__codelineno-72-112" name="__codelineno-72-112" href="#__codelineno-72-112"></a><span class="w">        </span><span class="n">glm</span><span class="o">::</span><span class="n">vec3</span><span class="p">(</span><span class="mf">-1.0f</span><span class="p">,</span><span class="w">  </span><span class="mf">1.0f</span><span class="p">,</span><span class="w">  </span><span class="mf">1.0f</span><span class="p">),</span><span class="w"> </span><span class="n">glm</span><span class="o">::</span><span class="n">vec3</span><span class="p">(</span><span class="mf">1.0f</span><span class="p">,</span><span class="w">  </span><span class="mf">1.0f</span><span class="p">,</span><span class="w">  </span><span class="mf">1.0f</span><span class="p">)</span>
<a id="__codelineno-72-113" name="__codelineno-72-113" href="#__codelineno-72-113"></a><span class="w">    </span><span class="p">};</span>
<a id="__codelineno-72-114" name="__codelineno-72-114" href="#__codelineno-72-114"></a>
<a id="__codelineno-72-115" name="__codelineno-72-115" href="#__codelineno-72-115"></a><span class="w">    </span><span class="n">std</span><span class="o">::</span><span class="n">vector</span><span class="o">&lt;</span><span class="n">glm</span><span class="o">::</span><span class="n">vec3</span><span class="o">&gt;</span><span class="w"> </span><span class="n">occludeeVertices</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-72-116" name="__codelineno-72-116" href="#__codelineno-72-116"></a><span class="w">        </span><span class="n">glm</span><span class="o">::</span><span class="n">vec3</span><span class="p">(</span><span class="mf">-0.5f</span><span class="p">,</span><span class="w"> </span><span class="mf">-0.5f</span><span class="p">,</span><span class="w"> </span><span class="mf">-0.5f</span><span class="p">),</span><span class="w"> </span><span class="n">glm</span><span class="o">::</span><span class="n">vec3</span><span class="p">(</span><span class="mf">0.5f</span><span class="p">,</span><span class="w"> </span><span class="mf">-0.5f</span><span class="p">,</span><span class="w"> </span><span class="mf">-0.5f</span><span class="p">),</span>
<a id="__codelineno-72-117" name="__codelineno-72-117" href="#__codelineno-72-117"></a><span class="w">        </span><span class="n">glm</span><span class="o">::</span><span class="n">vec3</span><span class="p">(</span><span class="mf">-0.5f</span><span class="p">,</span><span class="w">  </span><span class="mf">0.5f</span><span class="p">,</span><span class="w"> </span><span class="mf">-0.5f</span><span class="p">),</span><span class="w"> </span><span class="n">glm</span><span class="o">::</span><span class="n">vec3</span><span class="p">(</span><span class="mf">0.5f</span><span class="p">,</span><span class="w">  </span><span class="mf">0.5f</span><span class="p">,</span><span class="w"> </span><span class="mf">-0.5f</span><span class="p">),</span>
<a id="__codelineno-72-118" name="__codelineno-72-118" href="#__codelineno-72-118"></a><span class="w">        </span><span class="n">glm</span><span class="o">::</span><span class="n">vec3</span><span class="p">(</span><span class="mf">-0.5f</span><span class="p">,</span><span class="w"> </span><span class="mf">-0.5f</span><span class="p">,</span><span class="w">  </span><span class="mf">0.5f</span><span class="p">),</span><span class="w"> </span><span class="n">glm</span><span class="o">::</span><span class="n">vec3</span><span class="p">(</span><span class="mf">0.5f</span><span class="p">,</span><span class="w"> </span><span class="mf">-0.5f</span><span class="p">,</span><span class="w">  </span><span class="mf">0.5f</span><span class="p">),</span>
<a id="__codelineno-72-119" name="__codelineno-72-119" href="#__codelineno-72-119"></a><span class="w">        </span><span class="n">glm</span><span class="o">::</span><span class="n">vec3</span><span class="p">(</span><span class="mf">-0.5f</span><span class="p">,</span><span class="w">  </span><span class="mf">0.5f</span><span class="p">,</span><span class="w">  </span><span class="mf">0.5f</span><span class="p">),</span><span class="w"> </span><span class="n">glm</span><span class="o">::</span><span class="n">vec3</span><span class="p">(</span><span class="mf">0.5f</span><span class="p">,</span><span class="w">  </span><span class="mf">0.5f</span><span class="p">,</span><span class="w">  </span><span class="mf">0.5f</span><span class="p">)</span>
<a id="__codelineno-72-120" name="__codelineno-72-120" href="#__codelineno-72-120"></a><span class="w">    </span><span class="p">};</span>
<a id="__codelineno-72-121" name="__codelineno-72-121" href="#__codelineno-72-121"></a>
<a id="__codelineno-72-122" name="__codelineno-72-122" href="#__codelineno-72-122"></a><span class="w">    </span><span class="n">hzb</span><span class="p">.</span><span class="n">clear</span><span class="p">();</span>
<a id="__codelineno-72-123" name="__codelineno-72-123" href="#__codelineno-72-123"></a><span class="w">    </span><span class="n">hzb</span><span class="p">.</span><span class="n">updateDepthBuffer</span><span class="p">(</span><span class="n">viewProjMatrix</span><span class="p">,</span><span class="w"> </span><span class="n">occluderVertices</span>
<a id="__codelineno-72-124" name="__codelineno-72-124" href="#__codelineno-72-124"></a>
<a id="__codelineno-72-125" name="__codelineno-72-125" href="#__codelineno-72-125"></a><span class="p">);</span>
<a id="__codelineno-72-126" name="__codelineno-72-126" href="#__codelineno-72-126"></a>
<a id="__codelineno-72-127" name="__codelineno-72-127" href="#__codelineno-72-127"></a><span class="w">    </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">hzb</span><span class="p">.</span><span class="n">isOccluded</span><span class="p">(</span><span class="n">viewProjMatrix</span><span class="p">,</span><span class="w"> </span><span class="n">occludeeVertices</span><span class="p">))</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-72-128" name="__codelineno-72-128" href="#__codelineno-72-128"></a><span class="w">        </span><span class="n">std</span><span class="o">::</span><span class="n">cout</span><span class="w"> </span><span class="o">&lt;&lt;</span><span class="w"> </span><span class="s">&quot;Occludee is occluded.&quot;</span><span class="w"> </span><span class="o">&lt;&lt;</span><span class="w"> </span><span class="n">std</span><span class="o">::</span><span class="n">endl</span><span class="p">;</span>
<a id="__codelineno-72-129" name="__codelineno-72-129" href="#__codelineno-72-129"></a><span class="w">    </span><span class="p">}</span><span class="w"> </span><span class="k">else</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-72-130" name="__codelineno-72-130" href="#__codelineno-72-130"></a><span class="w">        </span><span class="n">std</span><span class="o">::</span><span class="n">cout</span><span class="w"> </span><span class="o">&lt;&lt;</span><span class="w"> </span><span class="s">&quot;Occludee is visible.&quot;</span><span class="w"> </span><span class="o">&lt;&lt;</span><span class="w"> </span><span class="n">std</span><span class="o">::</span><span class="n">endl</span><span class="p">;</span>
<a id="__codelineno-72-131" name="__codelineno-72-131" href="#__codelineno-72-131"></a><span class="w">    </span><span class="p">}</span>
<a id="__codelineno-72-132" name="__codelineno-72-132" href="#__codelineno-72-132"></a>
<a id="__codelineno-72-133" name="__codelineno-72-133" href="#__codelineno-72-133"></a><span class="w">    </span><span class="k">return</span><span class="w"> </span><span class="mi">0</span><span class="p">;</span>
<a id="__codelineno-72-134" name="__codelineno-72-134" href="#__codelineno-72-134"></a><span class="p">}</span>
</code></pre></div>
<h5 id="explanation_7">Explanation</h5>
<ol>
<li>
<p><strong>HierarchicalZBuffer Class:</strong></p>
<ul>
<li><strong>Constructor:</strong> Initializes multiple levels of depth buffers.</li>
<li><strong>clear:</strong> Clears all depth buffers.</li>
<li><strong>updateDepthBuffer:</strong> Updates the finest level depth buffer with object vertices and generates coarser levels by downsampling.</li>
<li><strong>isOccluded:</strong> Checks if the object vertices are occluded using the hierarchical depth buffers.</li>
</ul>
</li>
<li>
<p><strong>Main Function:</strong></p>
<ul>
<li><strong>View and Projection Matrices:</strong> Set up the view and projection matrices.</li>
<li><strong>Occluder and Occludee Vertices:</strong> Define vertices for occluder and occludee objects.</li>
<li><strong>Depth Buffer Update:</strong> Update the depth buffer with occluder vertices.</li>
<li><strong>Occlusion Test:</strong> Check if the occludee vertices are occluded.</li>
</ul>
</li>
</ol>
<h5 id="potentially-visible-set-pvs-computation">Potentially Visible Set (PVS) Computation</h5>
<p>PVS computation is typically done during the pre-processing stage of game development. Tools like 3D content creation software (e.g., Unity, Unreal Engine) can precompute the visibility for each region of the scene and store the results.</p>
<h5 id="hardware-occlusion-queries">Hardware Occlusion Queries</h5>
<p>Most modern graphics APIs like DirectX and OpenGL provide functions for hardware occlusion queries. These queries allow the GPU to test for occlusion without requiring data to be sent back to the CPU, thus minimizing performance overhead.</p>
<h5 id="summary">Summary</h5>
<p>Advanced occlusion culling techniques like Hierarchical Z-Buffering, PVS computation, and hardware occlusion queries are crucial for optimizing rendering in complex scenes. Implementing these techniques can significantly improve rendering performance by ensuring that only visible objects are processed and rendered.</p>
<h3 id="frustum-culling">Frustum Culling</h3>
<p>Frustum culling is a technique that excludes objects outside the camera's view frustum (the pyramidal volume that defines the visible space) from rendering.</p>
<p><strong>Purpose:</strong></p>
<p><strong>Performance Optimization:</strong> Avoids rendering objects that are outside the camera's field of view, thus saving processing time and resources.</p>
<p><strong>Implementation:</strong></p>
<ul>
<li><strong>View Frustum:</strong> Calculate the camera's view frustum using the near and far planes, and the field of view.</li>
<li><strong>Bounding Volumes:</strong> Use bounding volumes (bounding boxes or spheres) to quickly test if objects intersect the frustum.</li>
</ul>
<p><strong>Example:</strong>
<div class="highlight"><pre><span></span><code><a id="__codelineno-73-1" name="__codelineno-73-1" href="#__codelineno-73-1"></a><span class="c1">// Pseudocode for frustum culling</span>
<a id="__codelineno-73-2" name="__codelineno-73-2" href="#__codelineno-73-2"></a><span class="kt">bool</span><span class="w"> </span><span class="n">isInsideFrustum</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">checkFrustumIntersection</span><span class="p">(</span><span class="n">model</span><span class="p">.</span><span class="n">boundingBox</span><span class="p">,</span><span class="w"> </span><span class="n">camera</span><span class="p">.</span><span class="n">frustum</span><span class="p">);</span>
<a id="__codelineno-73-3" name="__codelineno-73-3" href="#__codelineno-73-3"></a><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">isInsideFrustum</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-73-4" name="__codelineno-73-4" href="#__codelineno-73-4"></a><span class="w">    </span><span class="n">renderModel</span><span class="p">(</span><span class="n">model</span><span class="p">);</span>
<a id="__codelineno-73-5" name="__codelineno-73-5" href="#__codelineno-73-5"></a><span class="p">}</span>
</code></pre></div></p>
<h4 id="explanation_8">Explanation</h4>
<p>Frustum culling is an optimization technique used in computer graphics to improve rendering performance. It involves eliminating objects that are outside the camera's view frustum, ensuring only visible objects are processed and rendered. The view frustum is a truncated pyramid representing the volume of space visible to the camera.</p>
<h4 id="steps-in-frustum-culling">Steps in Frustum Culling</h4>
<ol>
<li>
<p><strong>Define the View Frustum:</strong>
   The view frustum is defined by six planes: left, right, top, bottom, near, and far. These planes can be derived from the camera's projection matrix and view matrix.</p>
</li>
<li>
<p><strong>Extract the Frustum Planes:</strong>
   Extract the frustum planes from the combined view-projection matrix.</p>
</li>
<li>
<p><strong>Test Objects Against the Frustum Planes:</strong>
   For each object (or bounding volume of the object), test whether it is inside, outside, or intersecting the frustum. If an object is completely outside any of the frustum planes, it is culled (i.e., not rendered).</p>
</li>
</ol>
<h4 id="implementing-frustum-culling-in-c">Implementing Frustum Culling in C++</h4>
<p>Below is a simplified implementation of frustum culling in C++. It includes the extraction of frustum planes and a basic test for bounding spheres.</p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-74-1" name="__codelineno-74-1" href="#__codelineno-74-1"></a><span class="cp">#include</span><span class="w"> </span><span class="cpf">&lt;iostream&gt;</span>
<a id="__codelineno-74-2" name="__codelineno-74-2" href="#__codelineno-74-2"></a><span class="cp">#include</span><span class="w"> </span><span class="cpf">&lt;glm/glm.hpp&gt;</span>
<a id="__codelineno-74-3" name="__codelineno-74-3" href="#__codelineno-74-3"></a><span class="cp">#include</span><span class="w"> </span><span class="cpf">&lt;glm/gtc/matrix_transform.hpp&gt;</span>
<a id="__codelineno-74-4" name="__codelineno-74-4" href="#__codelineno-74-4"></a><span class="cp">#include</span><span class="w"> </span><span class="cpf">&lt;glm/gtc/type_ptr.hpp&gt;</span>
<a id="__codelineno-74-5" name="__codelineno-74-5" href="#__codelineno-74-5"></a>
<a id="__codelineno-74-6" name="__codelineno-74-6" href="#__codelineno-74-6"></a><span class="k">class</span><span class="w"> </span><span class="nc">Frustum</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-74-7" name="__codelineno-74-7" href="#__codelineno-74-7"></a><span class="k">public</span><span class="o">:</span>
<a id="__codelineno-74-8" name="__codelineno-74-8" href="#__codelineno-74-8"></a><span class="w">    </span><span class="k">enum</span><span class="w"> </span><span class="nc">Plane</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="n">Near</span><span class="p">,</span><span class="w"> </span><span class="n">Far</span><span class="p">,</span><span class="w"> </span><span class="n">Left</span><span class="p">,</span><span class="w"> </span><span class="n">Right</span><span class="p">,</span><span class="w"> </span><span class="n">Top</span><span class="p">,</span><span class="w"> </span><span class="n">Bottom</span><span class="w"> </span><span class="p">};</span>
<a id="__codelineno-74-9" name="__codelineno-74-9" href="#__codelineno-74-9"></a>
<a id="__codelineno-74-10" name="__codelineno-74-10" href="#__codelineno-74-10"></a><span class="w">    </span><span class="c1">// Planes are stored in this order</span>
<a id="__codelineno-74-11" name="__codelineno-74-11" href="#__codelineno-74-11"></a><span class="w">    </span><span class="n">glm</span><span class="o">::</span><span class="n">vec4</span><span class="w"> </span><span class="n">planes</span><span class="p">[</span><span class="mi">6</span><span class="p">];</span>
<a id="__codelineno-74-12" name="__codelineno-74-12" href="#__codelineno-74-12"></a>
<a id="__codelineno-74-13" name="__codelineno-74-13" href="#__codelineno-74-13"></a><span class="w">    </span><span class="c1">// Extract the frustum planes from the view-projection matrix</span>
<a id="__codelineno-74-14" name="__codelineno-74-14" href="#__codelineno-74-14"></a><span class="w">    </span><span class="kt">void</span><span class="w"> </span><span class="nf">extractPlanes</span><span class="p">(</span><span class="k">const</span><span class="w"> </span><span class="n">glm</span><span class="o">::</span><span class="n">mat4</span><span class="o">&amp;</span><span class="w"> </span><span class="n">viewProjMatrix</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-74-15" name="__codelineno-74-15" href="#__codelineno-74-15"></a><span class="w">        </span><span class="c1">// Left plane</span>
<a id="__codelineno-74-16" name="__codelineno-74-16" href="#__codelineno-74-16"></a><span class="w">        </span><span class="n">planes</span><span class="p">[</span><span class="n">Left</span><span class="p">].</span><span class="n">x</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">viewProjMatrix</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="mi">3</span><span class="p">]</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="n">viewProjMatrix</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="mi">0</span><span class="p">];</span>
<a id="__codelineno-74-17" name="__codelineno-74-17" href="#__codelineno-74-17"></a><span class="w">        </span><span class="n">planes</span><span class="p">[</span><span class="n">Left</span><span class="p">].</span><span class="n">y</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">viewProjMatrix</span><span class="p">[</span><span class="mi">1</span><span class="p">][</span><span class="mi">3</span><span class="p">]</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="n">viewProjMatrix</span><span class="p">[</span><span class="mi">1</span><span class="p">][</span><span class="mi">0</span><span class="p">];</span>
<a id="__codelineno-74-18" name="__codelineno-74-18" href="#__codelineno-74-18"></a><span class="w">        </span><span class="n">planes</span><span class="p">[</span><span class="n">Left</span><span class="p">].</span><span class="n">z</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">viewProjMatrix</span><span class="p">[</span><span class="mi">2</span><span class="p">][</span><span class="mi">3</span><span class="p">]</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="n">viewProjMatrix</span><span class="p">[</span><span class="mi">2</span><span class="p">][</span><span class="mi">0</span><span class="p">];</span>
<a id="__codelineno-74-19" name="__codelineno-74-19" href="#__codelineno-74-19"></a><span class="w">        </span><span class="n">planes</span><span class="p">[</span><span class="n">Left</span><span class="p">].</span><span class="n">w</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">viewProjMatrix</span><span class="p">[</span><span class="mi">3</span><span class="p">][</span><span class="mi">3</span><span class="p">]</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="n">viewProjMatrix</span><span class="p">[</span><span class="mi">3</span><span class="p">][</span><span class="mi">0</span><span class="p">];</span>
<a id="__codelineno-74-20" name="__codelineno-74-20" href="#__codelineno-74-20"></a>
<a id="__codelineno-74-21" name="__codelineno-74-21" href="#__codelineno-74-21"></a><span class="w">        </span><span class="c1">// Right plane</span>
<a id="__codelineno-74-22" name="__codelineno-74-22" href="#__codelineno-74-22"></a><span class="w">        </span><span class="n">planes</span><span class="p">[</span><span class="n">Right</span><span class="p">].</span><span class="n">x</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">viewProjMatrix</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="mi">3</span><span class="p">]</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="n">viewProjMatrix</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="mi">0</span><span class="p">];</span>
<a id="__codelineno-74-23" name="__codelineno-74-23" href="#__codelineno-74-23"></a><span class="w">        </span><span class="n">planes</span><span class="p">[</span><span class="n">Right</span><span class="p">].</span><span class="n">y</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">viewProjMatrix</span><span class="p">[</span><span class="mi">1</span><span class="p">][</span><span class="mi">3</span><span class="p">]</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="n">viewProjMatrix</span><span class="p">[</span><span class="mi">1</span><span class="p">][</span><span class="mi">0</span><span class="p">];</span>
<a id="__codelineno-74-24" name="__codelineno-74-24" href="#__codelineno-74-24"></a><span class="w">        </span><span class="n">planes</span><span class="p">[</span><span class="n">Right</span><span class="p">].</span><span class="n">z</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">viewProjMatrix</span><span class="p">[</span><span class="mi">2</span><span class="p">][</span><span class="mi">3</span><span class="p">]</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="n">viewProjMatrix</span><span class="p">[</span><span class="mi">2</span><span class="p">][</span><span class="mi">0</span><span class="p">];</span>
<a id="__codelineno-74-25" name="__codelineno-74-25" href="#__codelineno-74-25"></a><span class="w">        </span><span class="n">planes</span><span class="p">[</span><span class="n">Right</span><span class="p">].</span><span class="n">w</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">viewProjMatrix</span><span class="p">[</span><span class="mi">3</span><span class="p">][</span><span class="mi">3</span><span class="p">]</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="n">viewProjMatrix</span><span class="p">[</span><span class="mi">3</span><span class="p">][</span><span class="mi">0</span><span class="p">];</span>
<a id="__codelineno-74-26" name="__codelineno-74-26" href="#__codelineno-74-26"></a>
<a id="__codelineno-74-27" name="__codelineno-74-27" href="#__codelineno-74-27"></a><span class="w">        </span><span class="c1">// Bottom plane</span>
<a id="__codelineno-74-28" name="__codelineno-74-28" href="#__codelineno-74-28"></a><span class="w">        </span><span class="n">planes</span><span class="p">[</span><span class="n">Bottom</span><span class="p">].</span><span class="n">x</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">viewProjMatrix</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="mi">3</span><span class="p">]</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="n">viewProjMatrix</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="mi">1</span><span class="p">];</span>
<a id="__codelineno-74-29" name="__codelineno-74-29" href="#__codelineno-74-29"></a><span class="w">        </span><span class="n">planes</span><span class="p">[</span><span class="n">Bottom</span><span class="p">].</span><span class="n">y</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">viewProjMatrix</span><span class="p">[</span><span class="mi">1</span><span class="p">][</span><span class="mi">3</span><span class="p">]</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="n">viewProjMatrix</span><span class="p">[</span><span class="mi">1</span><span class="p">][</span><span class="mi">1</span><span class="p">];</span>
<a id="__codelineno-74-30" name="__codelineno-74-30" href="#__codelineno-74-30"></a><span class="w">        </span><span class="n">planes</span><span class="p">[</span><span class="n">Bottom</span><span class="p">].</span><span class="n">z</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">viewProjMatrix</span><span class="p">[</span><span class="mi">2</span><span class="p">][</span><span class="mi">3</span><span class="p">]</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="n">viewProjMatrix</span><span class="p">[</span><span class="mi">2</span><span class="p">][</span><span class="mi">1</span><span class="p">];</span>
<a id="__codelineno-74-31" name="__codelineno-74-31" href="#__codelineno-74-31"></a><span class="w">        </span><span class="n">planes</span><span class="p">[</span><span class="n">Bottom</span><span class="p">].</span><span class="n">w</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">viewProjMatrix</span><span class="p">[</span><span class="mi">3</span><span class="p">][</span><span class="mi">3</span><span class="p">]</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="n">viewProjMatrix</span><span class="p">[</span><span class="mi">3</span><span class="p">][</span><span class="mi">1</span><span class="p">];</span>
<a id="__codelineno-74-32" name="__codelineno-74-32" href="#__codelineno-74-32"></a>
<a id="__codelineno-74-33" name="__codelineno-74-33" href="#__codelineno-74-33"></a><span class="w">        </span><span class="c1">// Top plane</span>
<a id="__codelineno-74-34" name="__codelineno-74-34" href="#__codelineno-74-34"></a><span class="w">        </span><span class="n">planes</span><span class="p">[</span><span class="n">Top</span><span class="p">].</span><span class="n">x</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">viewProjMatrix</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="mi">3</span><span class="p">]</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="n">viewProjMatrix</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="mi">1</span><span class="p">];</span>
<a id="__codelineno-74-35" name="__codelineno-74-35" href="#__codelineno-74-35"></a><span class="w">        </span><span class="n">planes</span><span class="p">[</span><span class="n">Top</span><span class="p">].</span><span class="n">y</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">viewProjMatrix</span><span class="p">[</span><span class="mi">1</span><span class="p">][</span><span class="mi">3</span><span class="p">]</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="n">viewProjMatrix</span><span class="p">[</span><span class="mi">1</span><span class="p">][</span><span class="mi">1</span><span class="p">];</span>
<a id="__codelineno-74-36" name="__codelineno-74-36" href="#__codelineno-74-36"></a><span class="w">        </span><span class="n">planes</span><span class="p">[</span><span class="n">Top</span><span class="p">].</span><span class="n">z</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">viewProjMatrix</span><span class="p">[</span><span class="mi">2</span><span class="p">][</span><span class="mi">3</span><span class="p">]</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="n">viewProjMatrix</span><span class="p">[</span><span class="mi">2</span><span class="p">][</span><span class="mi">1</span><span class="p">];</span>
<a id="__codelineno-74-37" name="__codelineno-74-37" href="#__codelineno-74-37"></a><span class="w">        </span><span class="n">planes</span><span class="p">[</span><span class="n">Top</span><span class="p">].</span><span class="n">w</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">viewProjMatrix</span><span class="p">[</span><span class="mi">3</span><span class="p">][</span><span class="mi">3</span><span class="p">]</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="n">viewProjMatrix</span><span class="p">[</span><span class="mi">3</span><span class="p">][</span><span class="mi">1</span><span class="p">];</span>
<a id="__codelineno-74-38" name="__codelineno-74-38" href="#__codelineno-74-38"></a>
<a id="__codelineno-74-39" name="__codelineno-74-39" href="#__codelineno-74-39"></a><span class="w">        </span><span class="c1">// Near plane</span>
<a id="__codelineno-74-40" name="__codelineno-74-40" href="#__codelineno-74-40"></a><span class="w">        </span><span class="n">planes</span><span class="p">[</span><span class="n">Near</span><span class="p">].</span><span class="n">x</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">viewProjMatrix</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="mi">3</span><span class="p">]</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="n">viewProjMatrix</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="mi">2</span><span class="p">];</span>
<a id="__codelineno-74-41" name="__codelineno-74-41" href="#__codelineno-74-41"></a><span class="w">        </span><span class="n">planes</span><span class="p">[</span><span class="n">Near</span><span class="p">].</span><span class="n">y</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">viewProjMatrix</span><span class="p">[</span><span class="mi">1</span><span class="p">][</span><span class="mi">3</span><span class="p">]</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="n">viewProjMatrix</span><span class="p">[</span><span class="mi">1</span><span class="p">][</span><span class="mi">2</span><span class="p">];</span>
<a id="__codelineno-74-42" name="__codelineno-74-42" href="#__codelineno-74-42"></a><span class="w">        </span><span class="n">planes</span><span class="p">[</span><span class="n">Near</span><span class="p">].</span><span class="n">z</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">viewProjMatrix</span><span class="p">[</span><span class="mi">2</span><span class="p">][</span><span class="mi">3</span><span class="p">]</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="n">viewProjMatrix</span><span class="p">[</span><span class="mi">2</span><span class="p">][</span><span class="mi">2</span><span class="p">];</span>
<a id="__codelineno-74-43" name="__codelineno-74-43" href="#__codelineno-74-43"></a><span class="w">        </span><span class="n">planes</span><span class="p">[</span><span class="n">Near</span><span class="p">].</span><span class="n">w</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">viewProjMatrix</span><span class="p">[</span><span class="mi">3</span><span class="p">][</span><span class="mi">3</span><span class="p">]</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="n">viewProjMatrix</span><span class="p">[</span><span class="mi">3</span><span class="p">][</span><span class="mi">2</span><span class="p">];</span>
<a id="__codelineno-74-44" name="__codelineno-74-44" href="#__codelineno-74-44"></a>
<a id="__codelineno-74-45" name="__codelineno-74-45" href="#__codelineno-74-45"></a><span class="w">        </span><span class="c1">// Far plane</span>
<a id="__codelineno-74-46" name="__codelineno-74-46" href="#__codelineno-74-46"></a><span class="w">        </span><span class="n">planes</span><span class="p">[</span><span class="n">Far</span><span class="p">].</span><span class="n">x</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">viewProjMatrix</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="mi">3</span><span class="p">]</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="n">viewProjMatrix</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="mi">2</span><span class="p">];</span>
<a id="__codelineno-74-47" name="__codelineno-74-47" href="#__codelineno-74-47"></a><span class="w">        </span><span class="n">planes</span><span class="p">[</span><span class="n">Far</span><span class="p">].</span><span class="n">y</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">viewProjMatrix</span><span class="p">[</span><span class="mi">1</span><span class="p">][</span><span class="mi">3</span><span class="p">]</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="n">viewProjMatrix</span><span class="p">[</span><span class="mi">1</span><span class="p">][</span><span class="mi">2</span><span class="p">];</span>
<a id="__codelineno-74-48" name="__codelineno-74-48" href="#__codelineno-74-48"></a><span class="w">        </span><span class="n">planes</span><span class="p">[</span><span class="n">Far</span><span class="p">].</span><span class="n">z</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">viewProjMatrix</span><span class="p">[</span><span class="mi">2</span><span class="p">][</span><span class="mi">3</span><span class="p">]</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="n">viewProjMatrix</span><span class="p">[</span><span class="mi">2</span><span class="p">][</span><span class="mi">2</span><span class="p">];</span>
<a id="__codelineno-74-49" name="__codelineno-74-49" href="#__codelineno-74-49"></a><span class="w">        </span><span class="n">planes</span><span class="p">[</span><span class="n">Far</span><span class="p">].</span><span class="n">w</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">viewProjMatrix</span><span class="p">[</span><span class="mi">3</span><span class="p">][</span><span class="mi">3</span><span class="p">]</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="n">viewProjMatrix</span><span class="p">[</span><span class="mi">3</span><span class="p">][</span><span class="mi">2</span><span class="p">];</span>
<a id="__codelineno-74-50" name="__codelineno-74-50" href="#__codelineno-74-50"></a>
<a id="__codelineno-74-51" name="__codelineno-74-51" href="#__codelineno-74-51"></a><span class="w">        </span><span class="c1">// Normalize the planes</span>
<a id="__codelineno-74-52" name="__codelineno-74-52" href="#__codelineno-74-52"></a><span class="w">        </span><span class="k">for</span><span class="w"> </span><span class="p">(</span><span class="kt">int</span><span class="w"> </span><span class="n">i</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">0</span><span class="p">;</span><span class="w"> </span><span class="n">i</span><span class="w"> </span><span class="o">&lt;</span><span class="w"> </span><span class="mi">6</span><span class="p">;</span><span class="w"> </span><span class="n">i</span><span class="o">++</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-74-53" name="__codelineno-74-53" href="#__codelineno-74-53"></a><span class="w">            </span><span class="kt">float</span><span class="w"> </span><span class="n">length</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">glm</span><span class="o">::</span><span class="n">length</span><span class="p">(</span><span class="n">glm</span><span class="o">::</span><span class="n">vec3</span><span class="p">(</span><span class="n">planes</span><span class="p">[</span><span class="n">i</span><span class="p">]));</span>
<a id="__codelineno-74-54" name="__codelineno-74-54" href="#__codelineno-74-54"></a><span class="w">            </span><span class="n">planes</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="w"> </span><span class="o">/=</span><span class="w"> </span><span class="n">length</span><span class="p">;</span>
<a id="__codelineno-74-55" name="__codelineno-74-55" href="#__codelineno-74-55"></a><span class="w">        </span><span class="p">}</span>
<a id="__codelineno-74-56" name="__codelineno-74-56" href="#__codelineno-74-56"></a><span class="w">    </span><span class="p">}</span>
<a id="__codelineno-74-57" name="__codelineno-74-57" href="#__codelineno-74-57"></a>
<a id="__codelineno-74-58" name="__codelineno-74-58" href="#__codelineno-74-58"></a><span class="w">    </span><span class="c1">// Check if a bounding sphere is within the frustum</span>
<a id="__codelineno-74-59" name="__codelineno-74-59" href="#__codelineno-74-59"></a><span class="w">    </span><span class="kt">bool</span><span class="w"> </span><span class="nf">isSphereInFrustum</span><span class="p">(</span><span class="k">const</span><span class="w"> </span><span class="n">glm</span><span class="o">::</span><span class="n">vec3</span><span class="o">&amp;</span><span class="w"> </span><span class="n">center</span><span class="p">,</span><span class="w"> </span><span class="kt">float</span><span class="w"> </span><span class="n">radius</span><span class="p">)</span><span class="w"> </span><span class="k">const</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-74-60" name="__codelineno-74-60" href="#__codelineno-74-60"></a><span class="w">        </span><span class="k">for</span><span class="w"> </span><span class="p">(</span><span class="kt">int</span><span class="w"> </span><span class="n">i</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">0</span><span class="p">;</span><span class="w"> </span><span class="n">i</span><span class="w"> </span><span class="o">&lt;</span><span class="w"> </span><span class="mi">6</span><span class="p">;</span><span class="w"> </span><span class="n">i</span><span class="o">++</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-74-61" name="__codelineno-74-61" href="#__codelineno-74-61"></a><span class="w">            </span><span class="kt">float</span><span class="w"> </span><span class="n">distance</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">glm</span><span class="o">::</span><span class="n">dot</span><span class="p">(</span><span class="n">glm</span><span class="o">::</span><span class="n">vec3</span><span class="p">(</span><span class="n">planes</span><span class="p">[</span><span class="n">i</span><span class="p">]),</span><span class="w"> </span><span class="n">center</span><span class="p">)</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="n">planes</span><span class="p">[</span><span class="n">i</span><span class="p">].</span><span class="n">w</span><span class="p">;</span>
<a id="__codelineno-74-62" name="__codelineno-74-62" href="#__codelineno-74-62"></a><span class="w">            </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">distance</span><span class="w"> </span><span class="o">&lt;</span><span class="w"> </span><span class="o">-</span><span class="n">radius</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-74-63" name="__codelineno-74-63" href="#__codelineno-74-63"></a><span class="w">                </span><span class="k">return</span><span class="w"> </span><span class="nb">false</span><span class="p">;</span><span class="w"> </span><span class="c1">// Outside the frustum</span>
<a id="__codelineno-74-64" name="__codelineno-74-64" href="#__codelineno-74-64"></a><span class="w">            </span><span class="p">}</span>
<a id="__codelineno-74-65" name="__codelineno-74-65" href="#__codelineno-74-65"></a><span class="w">        </span><span class="p">}</span>
<a id="__codelineno-74-66" name="__codelineno-74-66" href="#__codelineno-74-66"></a><span class="w">        </span><span class="k">return</span><span class="w"> </span><span class="nb">true</span><span class="p">;</span><span class="w"> </span><span class="c1">// Inside or intersecting the frustum</span>
<a id="__codelineno-74-67" name="__codelineno-74-67" href="#__codelineno-74-67"></a><span class="w">    </span><span class="p">}</span>
<a id="__codelineno-74-68" name="__codelineno-74-68" href="#__codelineno-74-68"></a><span class="p">};</span>
<a id="__codelineno-74-69" name="__codelineno-74-69" href="#__codelineno-74-69"></a>
<a id="__codelineno-74-70" name="__codelineno-74-70" href="#__codelineno-74-70"></a><span class="kt">int</span><span class="w"> </span><span class="nf">main</span><span class="p">()</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-74-71" name="__codelineno-74-71" href="#__codelineno-74-71"></a><span class="w">    </span><span class="c1">// Example usage</span>
<a id="__codelineno-74-72" name="__codelineno-74-72" href="#__codelineno-74-72"></a><span class="w">    </span><span class="n">glm</span><span class="o">::</span><span class="n">mat4</span><span class="w"> </span><span class="n">viewMatrix</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">glm</span><span class="o">::</span><span class="n">lookAt</span><span class="p">(</span><span class="n">glm</span><span class="o">::</span><span class="n">vec3</span><span class="p">(</span><span class="mf">0.0f</span><span class="p">,</span><span class="w"> </span><span class="mf">0.0f</span><span class="p">,</span><span class="w"> </span><span class="mf">5.0f</span><span class="p">),</span><span class="w"> </span><span class="n">glm</span><span class="o">::</span><span class="n">vec3</span><span class="p">(</span><span class="mf">0.0f</span><span class="p">),</span><span class="w"> </span><span class="n">glm</span><span class="o">::</span><span class="n">vec3</span><span class="p">(</span><span class="mf">0.0f</span><span class="p">,</span><span class="w"> </span><span class="mf">1.0f</span><span class="p">,</span><span class="w"> </span><span class="mf">0.0f</span><span class="p">));</span>
<a id="__codelineno-74-73" name="__codelineno-74-73" href="#__codelineno-74-73"></a><span class="w">    </span><span class="n">glm</span><span class="o">::</span><span class="n">mat4</span><span class="w"> </span><span class="n">projectionMatrix</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">glm</span><span class="o">::</span><span class="n">perspective</span><span class="p">(</span><span class="n">glm</span><span class="o">::</span><span class="n">radians</span><span class="p">(</span><span class="mf">45.0f</span><span class="p">),</span><span class="w"> </span><span class="mf">4.0f</span><span class="w"> </span><span class="o">/</span><span class="w"> </span><span class="mf">3.0f</span><span class="p">,</span><span class="w"> </span><span class="mf">0.1f</span><span class="p">,</span><span class="w"> </span><span class="mf">100.0f</span><span class="p">);</span>
<a id="__codelineno-74-74" name="__codelineno-74-74" href="#__codelineno-74-74"></a><span class="w">    </span><span class="n">glm</span><span class="o">::</span><span class="n">mat4</span><span class="w"> </span><span class="n">viewProjMatrix</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">projectionMatrix</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="n">viewMatrix</span><span class="p">;</span>
<a id="__codelineno-74-75" name="__codelineno-74-75" href="#__codelineno-74-75"></a>
<a id="__codelineno-74-76" name="__codelineno-74-76" href="#__codelineno-74-76"></a><span class="w">    </span><span class="n">Frustum</span><span class="w"> </span><span class="n">frustum</span><span class="p">;</span>
<a id="__codelineno-74-77" name="__codelineno-74-77" href="#__codelineno-74-77"></a><span class="w">    </span><span class="n">frustum</span><span class="p">.</span><span class="n">extractPlanes</span><span class="p">(</span><span class="n">viewProjMatrix</span><span class="p">);</span>
<a id="__codelineno-74-78" name="__codelineno-74-78" href="#__codelineno-74-78"></a>
<a id="__codelineno-74-79" name="__codelineno-74-79" href="#__codelineno-74-79"></a><span class="w">    </span><span class="n">glm</span><span class="o">::</span><span class="n">vec3</span><span class="w"> </span><span class="n">sphereCenter</span><span class="p">(</span><span class="mf">0.0f</span><span class="p">,</span><span class="w"> </span><span class="mf">0.0f</span><span class="p">,</span><span class="w"> </span><span class="mf">0.0f</span><span class="p">);</span>
<a id="__codelineno-74-80" name="__codelineno-74-80" href="#__codelineno-74-80"></a><span class="w">    </span><span class="kt">float</span><span class="w"> </span><span class="n">sphereRadius</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mf">1.0f</span><span class="p">;</span>
<a id="__codelineno-74-81" name="__codelineno-74-81" href="#__codelineno-74-81"></a>
<a id="__codelineno-74-82" name="__codelineno-74-82" href="#__codelineno-74-82"></a><span class="w">    </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">frustum</span><span class="p">.</span><span class="n">isSphereInFrustum</span><span class="p">(</span><span class="n">sphereCenter</span><span class="p">,</span><span class="w"> </span><span class="n">sphereRadius</span><span class="p">))</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-74-83" name="__codelineno-74-83" href="#__codelineno-74-83"></a><span class="w">        </span><span class="n">std</span><span class="o">::</span><span class="n">cout</span><span class="w"> </span><span class="o">&lt;&lt;</span><span class="w"> </span><span class="s">&quot;Sphere is inside or intersecting the frustum.&quot;</span><span class="w"> </span><span class="o">&lt;&lt;</span><span class="w"> </span><span class="n">std</span><span class="o">::</span><span class="n">endl</span><span class="p">;</span>
<a id="__codelineno-74-84" name="__codelineno-74-84" href="#__codelineno-74-84"></a><span class="w">    </span><span class="p">}</span><span class="w"> </span><span class="k">else</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-74-85" name="__codelineno-74-85" href="#__codelineno-74-85"></a><span class="w">        </span><span class="n">std</span><span class="o">::</span><span class="n">cout</span><span class="w"> </span><span class="o">&lt;&lt;</span><span class="w"> </span><span class="s">&quot;Sphere is outside the frustum.&quot;</span><span class="w"> </span><span class="o">&lt;&lt;</span><span class="w"> </span><span class="n">std</span><span class="o">::</span><span class="n">endl</span><span class="p">;</span>
<a id="__codelineno-74-86" name="__codelineno-74-86" href="#__codelineno-74-86"></a><span class="w">    </span><span class="p">}</span>
<a id="__codelineno-74-87" name="__codelineno-74-87" href="#__codelineno-74-87"></a>
<a id="__codelineno-74-88" name="__codelineno-74-88" href="#__codelineno-74-88"></a><span class="w">    </span><span class="k">return</span><span class="w"> </span><span class="mi">0</span><span class="p">;</span>
<a id="__codelineno-74-89" name="__codelineno-74-89" href="#__codelineno-74-89"></a><span class="p">}</span>
</code></pre></div>
<h4 id="explanation_9">Explanation</h4>
<ol>
<li>
<p><strong>Frustum Class:</strong></p>
<ul>
<li><strong>extractPlanes:</strong> This function extracts the six frustum planes from the view-projection matrix. Each plane equation is normalized to ensure accurate distance calculations.</li>
<li><strong>isSphereInFrustum:</strong> This function checks whether a given bounding sphere (defined by its center and radius) is inside or intersecting the frustum.</li>
</ul>
</li>
<li>
<p><strong>Main Function:</strong></p>
<ul>
<li><strong>View and Projection Matrices:</strong> Set up the view and projection matrices using <code>glm::lookAt</code> and <code>glm::perspective</code>.</li>
<li><strong>Frustum Extraction:</strong> Extract the frustum planes using the combined view-projection matrix.</li>
<li><strong>Sphere Frustum Test:</strong> Check if a bounding sphere is within the frustum.</li>
</ul>
</li>
</ol>
<p>This implementation can be extended to include other types of bounding volumes, such as axis-aligned bounding boxes (AABBs) or oriented bounding boxes (OBBs).</p>
<h3 id="instancing">Instancing</h3>
<p>Instancing is a technique used to draw multiple instances of the same geometry efficiently. It allows rendering many copies of an object with a single draw call, each with different transformations and properties.</p>
<p><strong>Purpose:</strong></p>
<p><strong>Performance Enhancement:</strong> Reduces the number of draw calls, which is crucial for rendering large numbers of identical objects, such as in crowds, forests, or particle systems.</p>
<p><strong>Implementation:</strong></p>
<ul>
<li><strong>Instance Data:</strong> Store per-instance data (e.g., position, scale, rotation) in a buffer.</li>
<li><strong>Shader Support:</strong> Use shaders to apply the instance transformations and properties during rendering.</li>
</ul>
<p><strong>Example:</strong>
<div class="highlight"><pre><span></span><code><a id="__codelineno-75-1" name="__codelineno-75-1" href="#__codelineno-75-1"></a><span class="c1">// Pseudocode for instancing in OpenGL</span>
<a id="__codelineno-75-2" name="__codelineno-75-2" href="#__codelineno-75-2"></a><span class="n">glBindVertexArray</span><span class="p">(</span><span class="n">VAO</span><span class="p">);</span>
<a id="__codelineno-75-3" name="__codelineno-75-3" href="#__codelineno-75-3"></a><span class="n">glBindBuffer</span><span class="p">(</span><span class="n">GL_ARRAY_BUFFER</span><span class="p">,</span><span class="w"> </span><span class="n">instanceBuffer</span><span class="p">);</span>
<a id="__codelineno-75-4" name="__codelineno-75-4" href="#__codelineno-75-4"></a><span class="n">glBufferData</span><span class="p">(</span><span class="n">GL_ARRAY_BUFFER</span><span class="p">,</span><span class="w"> </span><span class="k">sizeof</span><span class="p">(</span><span class="n">instanceData</span><span class="p">),</span><span class="w"> </span><span class="n">instanceData</span><span class="p">,</span><span class="w"> </span><span class="n">GL_STATIC_DRAW</span><span class="p">);</span>
<a id="__codelineno-75-5" name="__codelineno-75-5" href="#__codelineno-75-5"></a>
<a id="__codelineno-75-6" name="__codelineno-75-6" href="#__codelineno-75-6"></a><span class="c1">// Setup instance attribute pointers</span>
<a id="__codelineno-75-7" name="__codelineno-75-7" href="#__codelineno-75-7"></a><span class="n">glVertexAttribPointer</span><span class="p">(</span><span class="mi">2</span><span class="p">,</span><span class="w"> </span><span class="mi">3</span><span class="p">,</span><span class="w"> </span><span class="n">GL_FLOAT</span><span class="p">,</span><span class="w"> </span><span class="n">GL_FALSE</span><span class="p">,</span><span class="w"> </span><span class="k">sizeof</span><span class="p">(</span><span class="n">InstanceData</span><span class="p">),</span><span class="w"> </span><span class="p">(</span><span class="kt">void</span><span class="o">*</span><span class="p">)</span><span class="mi">0</span><span class="p">);</span>
<a id="__codelineno-75-8" name="__codelineno-75-8" href="#__codelineno-75-8"></a><span class="n">glEnableVertexAttribArray</span><span class="p">(</span><span class="mi">2</span><span class="p">);</span>
<a id="__codelineno-75-9" name="__codelineno-75-9" href="#__codelineno-75-9"></a><span class="n">glVertexAttribDivisor</span><span class="p">(</span><span class="mi">2</span><span class="p">,</span><span class="w"> </span><span class="mi">1</span><span class="p">);</span><span class="w"> </span><span class="c1">// Tell OpenGL this is an instanced vertex attribute</span>
<a id="__codelineno-75-10" name="__codelineno-75-10" href="#__codelineno-75-10"></a>
<a id="__codelineno-75-11" name="__codelineno-75-11" href="#__codelineno-75-11"></a><span class="c1">// Render instanced objects</span>
<a id="__codelineno-75-12" name="__codelineno-75-12" href="#__codelineno-75-12"></a><span class="n">glDrawArraysInstanced</span><span class="p">(</span><span class="n">GL_TRIANGLES</span><span class="p">,</span><span class="w"> </span><span class="mi">0</span><span class="p">,</span><span class="w"> </span><span class="n">vertexCount</span><span class="p">,</span><span class="w"> </span><span class="n">instanceCount</span><span class="p">);</span>
</code></pre></div></p>
<p>By implementing these optimization techniques, developers can significantly improve the performance and efficiency of 3D applications. Proper use of LOD, occlusion culling, frustum culling, and instancing ensures that only necessary and visible details are processed, enhancing both the performance and visual quality of the rendered scenes.</p>
<h2 id="post-processing">Post-Processing</h2>
<p>Post-processing effects are graphical operations applied after the rendering of a scene, enhancing visual quality and creating various visual effects. A robust and flexible post-processing pipeline is crucial for achieving high-quality graphics. </p>
<h3 id="common-post-processing-effects">Common Post-Processing Effects</h3>
<ol>
<li><strong>Bloom</strong></li>
<li><strong>Depth of Field</strong></li>
<li><strong>Motion Blur</strong></li>
<li><strong>Color Grading</strong></li>
<li><strong>Tonemapping</strong></li>
<li><strong>Vignette</strong></li>
<li><strong>Chromatic Aberration</strong></li>
<li><strong>Lens Flare</strong></li>
<li><strong>Ambient Occlusion</strong></li>
<li><strong>Anti-Aliasing</strong></li>
<li><strong>Screen Space Reflections</strong></li>
<li><strong>God Rays</strong></li>
</ol>
<h3 id="implementation-framework">Implementation Framework</h3>
<p>We'll create a modular post-processing system where each effect can be easily added, removed, or modified. The system will use shaders to apply effects to the rendered scene.</p>
<h3 id="shader-management">Shader Management</h3>
<p>We assume the existence of a <code>Shader</code> class that handles shader loading and usage.</p>
<h3 id="effecth">Effect.h</h3>
<div class="highlight"><pre><span></span><code><a id="__codelineno-76-1" name="__codelineno-76-1" href="#__codelineno-76-1"></a><span class="cp">#ifndef EFFECT_H</span>
<a id="__codelineno-76-2" name="__codelineno-76-2" href="#__codelineno-76-2"></a><span class="cp">#define EFFECT_H</span>
<a id="__codelineno-76-3" name="__codelineno-76-3" href="#__codelineno-76-3"></a>
<a id="__codelineno-76-4" name="__codelineno-76-4" href="#__codelineno-76-4"></a><span class="cp">#include</span><span class="w"> </span><span class="cpf">&quot;Shader.h&quot;</span>
<a id="__codelineno-76-5" name="__codelineno-76-5" href="#__codelineno-76-5"></a><span class="cp">#include</span><span class="w"> </span><span class="cpf">&lt;string&gt;</span>
<a id="__codelineno-76-6" name="__codelineno-76-6" href="#__codelineno-76-6"></a>
<a id="__codelineno-76-7" name="__codelineno-76-7" href="#__codelineno-76-7"></a><span class="k">class</span><span class="w"> </span><span class="nc">Effect</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-76-8" name="__codelineno-76-8" href="#__codelineno-76-8"></a><span class="k">public</span><span class="o">:</span>
<a id="__codelineno-76-9" name="__codelineno-76-9" href="#__codelineno-76-9"></a><span class="w">    </span><span class="k">virtual</span><span class="w"> </span><span class="o">~</span><span class="n">Effect</span><span class="p">()</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">default</span><span class="p">;</span>
<a id="__codelineno-76-10" name="__codelineno-76-10" href="#__codelineno-76-10"></a><span class="w">    </span><span class="k">virtual</span><span class="w"> </span><span class="kt">void</span><span class="w"> </span><span class="nf">Apply</span><span class="p">(</span><span class="n">GLuint</span><span class="w"> </span><span class="n">inputTexture</span><span class="p">,</span><span class="w"> </span><span class="n">GLuint</span><span class="w"> </span><span class="n">outputFBO</span><span class="p">)</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">0</span><span class="p">;</span>
<a id="__codelineno-76-11" name="__codelineno-76-11" href="#__codelineno-76-11"></a>
<a id="__codelineno-76-12" name="__codelineno-76-12" href="#__codelineno-76-12"></a><span class="k">protected</span><span class="o">:</span>
<a id="__codelineno-76-13" name="__codelineno-76-13" href="#__codelineno-76-13"></a><span class="w">    </span><span class="n">Shader</span><span class="w"> </span><span class="n">shader</span><span class="p">;</span>
<a id="__codelineno-76-14" name="__codelineno-76-14" href="#__codelineno-76-14"></a>
<a id="__codelineno-76-15" name="__codelineno-76-15" href="#__codelineno-76-15"></a><span class="w">    </span><span class="kt">void</span><span class="w"> </span><span class="nf">BindTexture</span><span class="p">(</span><span class="n">GLuint</span><span class="w"> </span><span class="n">texture</span><span class="p">,</span><span class="w"> </span><span class="k">const</span><span class="w"> </span><span class="n">std</span><span class="o">::</span><span class="n">string</span><span class="o">&amp;</span><span class="w"> </span><span class="n">uniformName</span><span class="p">,</span><span class="w"> </span><span class="kt">int</span><span class="w"> </span><span class="n">unit</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-76-16" name="__codelineno-76-16" href="#__codelineno-76-16"></a><span class="w">        </span><span class="n">glActiveTexture</span><span class="p">(</span><span class="n">GL_TEXTURE0</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="n">unit</span><span class="p">);</span>
<a id="__codelineno-76-17" name="__codelineno-76-17" href="#__codelineno-76-17"></a><span class="w">        </span><span class="n">glBindTexture</span><span class="p">(</span><span class="n">GL_TEXTURE_2D</span><span class="p">,</span><span class="w"> </span><span class="n">texture</span><span class="p">);</span>
<a id="__codelineno-76-18" name="__codelineno-76-18" href="#__codelineno-76-18"></a><span class="w">        </span><span class="n">shader</span><span class="p">.</span><span class="n">setInt</span><span class="p">(</span><span class="n">uniformName</span><span class="p">,</span><span class="w"> </span><span class="n">unit</span><span class="p">);</span>
<a id="__codelineno-76-19" name="__codelineno-76-19" href="#__codelineno-76-19"></a><span class="w">    </span><span class="p">}</span>
<a id="__codelineno-76-20" name="__codelineno-76-20" href="#__codelineno-76-20"></a><span class="p">};</span>
<a id="__codelineno-76-21" name="__codelineno-76-21" href="#__codelineno-76-21"></a>
<a id="__codelineno-76-22" name="__codelineno-76-22" href="#__codelineno-76-22"></a><span class="cp">#endif </span><span class="c1">// EFFECT_H</span>
</code></pre></div>
<h3 id="bloomeffecth">BloomEffect.h</h3>
<div class="highlight"><pre><span></span><code><a id="__codelineno-77-1" name="__codelineno-77-1" href="#__codelineno-77-1"></a><span class="cp">#ifndef BLOOMEFFECT_H</span>
<a id="__codelineno-77-2" name="__codelineno-77-2" href="#__codelineno-77-2"></a><span class="cp">#define BLOOMEFFECT_H</span>
<a id="__codelineno-77-3" name="__codelineno-77-3" href="#__codelineno-77-3"></a>
<a id="__codelineno-77-4" name="__codelineno-77-4" href="#__codelineno-77-4"></a><span class="cp">#include</span><span class="w"> </span><span class="cpf">&quot;Effect.h&quot;</span>
<a id="__codelineno-77-5" name="__codelineno-77-5" href="#__codelineno-77-5"></a>
<a id="__codelineno-77-6" name="__codelineno-77-6" href="#__codelineno-77-6"></a><span class="k">class</span><span class="w"> </span><span class="nc">BloomEffect</span><span class="w"> </span><span class="o">:</span><span class="w"> </span><span class="k">public</span><span class="w"> </span><span class="n">Effect</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-77-7" name="__codelineno-77-7" href="#__codelineno-77-7"></a><span class="k">public</span><span class="o">:</span>
<a id="__codelineno-77-8" name="__codelineno-77-8" href="#__codelineno-77-8"></a><span class="w">    </span><span class="n">BloomEffect</span><span class="p">()</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-77-9" name="__codelineno-77-9" href="#__codelineno-77-9"></a><span class="w">        </span><span class="n">shader</span><span class="p">.</span><span class="n">load</span><span class="p">(</span><span class="s">&quot;shaders/bloom.vert&quot;</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;shaders/bloom.frag&quot;</span><span class="p">);</span>
<a id="__codelineno-77-10" name="__codelineno-77-10" href="#__codelineno-77-10"></a><span class="w">    </span><span class="p">}</span>
<a id="__codelineno-77-11" name="__codelineno-77-11" href="#__codelineno-77-11"></a>
<a id="__codelineno-77-12" name="__codelineno-77-12" href="#__codelineno-77-12"></a><span class="w">    </span><span class="kt">void</span><span class="w"> </span><span class="n">Apply</span><span class="p">(</span><span class="n">GLuint</span><span class="w"> </span><span class="n">inputTexture</span><span class="p">,</span><span class="w"> </span><span class="n">GLuint</span><span class="w"> </span><span class="n">outputFBO</span><span class="p">)</span><span class="w"> </span><span class="k">override</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-77-13" name="__codelineno-77-13" href="#__codelineno-77-13"></a><span class="w">        </span><span class="n">glBindFramebuffer</span><span class="p">(</span><span class="n">GL_FRAMEBUFFER</span><span class="p">,</span><span class="w"> </span><span class="n">outputFBO</span><span class="p">);</span>
<a id="__codelineno-77-14" name="__codelineno-77-14" href="#__codelineno-77-14"></a><span class="w">        </span><span class="n">shader</span><span class="p">.</span><span class="n">use</span><span class="p">();</span>
<a id="__codelineno-77-15" name="__codelineno-77-15" href="#__codelineno-77-15"></a><span class="w">        </span><span class="n">BindTexture</span><span class="p">(</span><span class="n">inputTexture</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;scene&quot;</span><span class="p">,</span><span class="w"> </span><span class="mi">0</span><span class="p">);</span>
<a id="__codelineno-77-16" name="__codelineno-77-16" href="#__codelineno-77-16"></a><span class="w">        </span><span class="c1">// Additional bloom-specific setup...</span>
<a id="__codelineno-77-17" name="__codelineno-77-17" href="#__codelineno-77-17"></a><span class="w">        </span><span class="c1">// Render a quad...</span>
<a id="__codelineno-77-18" name="__codelineno-77-18" href="#__codelineno-77-18"></a><span class="w">    </span><span class="p">}</span>
<a id="__codelineno-77-19" name="__codelineno-77-19" href="#__codelineno-77-19"></a><span class="p">};</span>
<a id="__codelineno-77-20" name="__codelineno-77-20" href="#__codelineno-77-20"></a>
<a id="__codelineno-77-21" name="__codelineno-77-21" href="#__codelineno-77-21"></a><span class="cp">#endif </span><span class="c1">// BLOOMEFFECT_H</span>
</code></pre></div>
<h3 id="postprocessingpipelineh">PostProcessingPipeline.h</h3>
<div class="highlight"><pre><span></span><code><a id="__codelineno-78-1" name="__codelineno-78-1" href="#__codelineno-78-1"></a><span class="cp">#ifndef POSTPROCESSINGPIPELINE_H</span>
<a id="__codelineno-78-2" name="__codelineno-78-2" href="#__codelineno-78-2"></a><span class="cp">#define POSTPROCESSINGPIPELINE_H</span>
<a id="__codelineno-78-3" name="__codelineno-78-3" href="#__codelineno-78-3"></a>
<a id="__codelineno-78-4" name="__codelineno-78-4" href="#__codelineno-78-4"></a><span class="cp">#include</span><span class="w"> </span><span class="cpf">&lt;vector&gt;</span>
<a id="__codelineno-78-5" name="__codelineno-78-5" href="#__codelineno-78-5"></a><span class="cp">#include</span><span class="w"> </span><span class="cpf">&lt;memory&gt;</span>
<a id="__codelineno-78-6" name="__codelineno-78-6" href="#__codelineno-78-6"></a><span class="cp">#include</span><span class="w"> </span><span class="cpf">&quot;Effect.h&quot;</span>
<a id="__codelineno-78-7" name="__codelineno-78-7" href="#__codelineno-78-7"></a>
<a id="__codelineno-78-8" name="__codelineno-78-8" href="#__codelineno-78-8"></a><span class="k">class</span><span class="w"> </span><span class="nc">PostProcessingPipeline</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-78-9" name="__codelineno-78-9" href="#__codelineno-78-9"></a><span class="k">public</span><span class="o">:</span>
<a id="__codelineno-78-10" name="__codelineno-78-10" href="#__codelineno-78-10"></a><span class="w">    </span><span class="kt">void</span><span class="w"> </span><span class="n">AddEffect</span><span class="p">(</span><span class="n">std</span><span class="o">::</span><span class="n">unique_ptr</span><span class="o">&lt;</span><span class="n">Effect</span><span class="o">&gt;</span><span class="w"> </span><span class="n">effect</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-78-11" name="__codelineno-78-11" href="#__codelineno-78-11"></a><span class="w">        </span><span class="n">effects</span><span class="p">.</span><span class="n">push_back</span><span class="p">(</span><span class="n">std</span><span class="o">::</span><span class="n">move</span><span class="p">(</span><span class="n">effect</span><span class="p">));</span>
<a id="__codelineno-78-12" name="__codelineno-78-12" href="#__codelineno-78-12"></a><span class="w">    </span><span class="p">}</span>
<a id="__codelineno-78-13" name="__codelineno-78-13" href="#__codelineno-78-13"></a>
<a id="__codelineno-78-14" name="__codelineno-78-14" href="#__codelineno-78-14"></a><span class="w">    </span><span class="kt">void</span><span class="w"> </span><span class="n">ApplyEffects</span><span class="p">(</span><span class="n">GLuint</span><span class="w"> </span><span class="n">inputTexture</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-78-15" name="__codelineno-78-15" href="#__codelineno-78-15"></a><span class="w">        </span><span class="n">GLuint</span><span class="w"> </span><span class="n">pingpongFBO</span><span class="p">[</span><span class="mi">2</span><span class="p">];</span>
<a id="__codelineno-78-16" name="__codelineno-78-16" href="#__codelineno-78-16"></a><span class="w">        </span><span class="n">glGenFramebuffers</span><span class="p">(</span><span class="mi">2</span><span class="p">,</span><span class="w"> </span><span class="n">pingpongFBO</span><span class="p">);</span>
<a id="__codelineno-78-17" name="__codelineno-78-17" href="#__codelineno-78-17"></a><span class="w">        </span><span class="n">GLuint</span><span class="w"> </span><span class="n">pingpongColorbuffers</span><span class="p">[</span><span class="mi">2</span><span class="p">];</span>
<a id="__codelineno-78-18" name="__codelineno-78-18" href="#__codelineno-78-18"></a><span class="w">        </span><span class="n">glGenTextures</span><span class="p">(</span><span class="mi">2</span><span class="p">,</span><span class="w"> </span><span class="n">pingpongColorbuffers</span><span class="p">);</span>
<a id="__codelineno-78-19" name="__codelineno-78-19" href="#__codelineno-78-19"></a>
<a id="__codelineno-78-20" name="__codelineno-78-20" href="#__codelineno-78-20"></a><span class="w">        </span><span class="k">for</span><span class="w"> </span><span class="p">(</span><span class="kt">unsigned</span><span class="w"> </span><span class="kt">int</span><span class="w"> </span><span class="n">i</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">0</span><span class="p">;</span><span class="w"> </span><span class="n">i</span><span class="w"> </span><span class="o">&lt;</span><span class="w"> </span><span class="mi">2</span><span class="p">;</span><span class="w"> </span><span class="n">i</span><span class="o">++</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-78-21" name="__codelineno-78-21" href="#__codelineno-78-21"></a><span class="w">            </span><span class="n">glBindFramebuffer</span><span class="p">(</span><span class="n">GL_FRAMEBUFFER</span><span class="p">,</span><span class="w"> </span><span class="n">pingpongFBO</span><span class="p">[</span><span class="n">i</span><span class="p">]);</span>
<a id="__codelineno-78-22" name="__codelineno-78-22" href="#__codelineno-78-22"></a><span class="w">            </span><span class="n">glBindTexture</span><span class="p">(</span><span class="n">GL_TEXTURE_2D</span><span class="p">,</span><span class="w"> </span><span class="n">pingpongColorbuffers</span><span class="p">[</span><span class="n">i</span><span class="p">]);</span>
<a id="__codelineno-78-23" name="__codelineno-78-23" href="#__codelineno-78-23"></a><span class="w">            </span><span class="n">glTexImage2D</span><span class="p">(</span><span class="n">GL_TEXTURE_2D</span><span class="p">,</span><span class="w"> </span><span class="mi">0</span><span class="p">,</span><span class="w"> </span><span class="n">GL_RGBA16F</span><span class="p">,</span><span class="w"> </span><span class="n">width</span><span class="p">,</span><span class="w"> </span><span class="n">height</span><span class="p">,</span><span class="w"> </span><span class="mi">0</span><span class="p">,</span><span class="w"> </span><span class="n">GL_RGBA</span><span class="p">,</span><span class="w"> </span><span class="n">GL_FLOAT</span><span class="p">,</span><span class="w"> </span><span class="k">nullptr</span><span class="p">);</span>
<a id="__codelineno-78-24" name="__codelineno-78-24" href="#__codelineno-78-24"></a><span class="w">            </span><span class="n">glTexParameteri</span><span class="p">(</span><span class="n">GL_TEXTURE_2D</span><span class="p">,</span><span class="w"> </span><span class="n">GL_TEXTURE_MIN_FILTER</span><span class="p">,</span><span class="w"> </span><span class="n">GL_LINEAR</span><span class="p">);</span>
<a id="__codelineno-78-25" name="__codelineno-78-25" href="#__codelineno-78-25"></a><span class="w">            </span><span class="n">glTexParameteri</span><span class="p">(</span><span class="n">GL_TEXTURE_2D</span><span class="p">,</span><span class="w"> </span><span class="n">GL_TEXTURE_MAG_FILTER</span><span class="p">,</span><span class="w"> </span><span class="n">GL_LINEAR</span><span class="p">);</span>
<a id="__codelineno-78-26" name="__codelineno-78-26" href="#__codelineno-78-26"></a><span class="w">            </span><span class="n">glFramebufferTexture2D</span><span class="p">(</span><span class="n">GL_FRAMEBUFFER</span><span class="p">,</span><span class="w"> </span><span class="n">GL_COLOR_ATTACHMENT0</span><span class="p">,</span><span class="w"> </span><span class="n">GL_TEXTURE_2D</span><span class="p">,</span><span class="w"> </span><span class="n">pingpongColorbuffers</span><span class="p">[</span><span class="n">i</span><span class="p">],</span><span class="w"> </span><span class="mi">0</span><span class="p">);</span>
<a id="__codelineno-78-27" name="__codelineno-78-27" href="#__codelineno-78-27"></a><span class="w">        </span><span class="p">}</span>
<a id="__codelineno-78-28" name="__codelineno-78-28" href="#__codelineno-78-28"></a>
<a id="__codelineno-78-29" name="__codelineno-78-29" href="#__codelineno-78-29"></a><span class="w">        </span><span class="kt">bool</span><span class="w"> </span><span class="n">horizontal</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nb">true</span><span class="p">,</span><span class="w"> </span><span class="n">firstIteration</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nb">true</span><span class="p">;</span>
<a id="__codelineno-78-30" name="__codelineno-78-30" href="#__codelineno-78-30"></a><span class="w">        </span><span class="k">for</span><span class="w"> </span><span class="p">(</span><span class="kt">unsigned</span><span class="w"> </span><span class="kt">int</span><span class="w"> </span><span class="n">i</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">0</span><span class="p">;</span><span class="w"> </span><span class="n">i</span><span class="w"> </span><span class="o">&lt;</span><span class="w"> </span><span class="n">effects</span><span class="p">.</span><span class="n">size</span><span class="p">();</span><span class="w"> </span><span class="n">i</span><span class="o">++</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-78-31" name="__codelineno-78-31" href="#__codelineno-78-31"></a><span class="w">            </span><span class="n">glBindFramebuffer</span><span class="p">(</span><span class="n">GL_FRAMEBUFFER</span><span class="p">,</span><span class="w"> </span><span class="n">pingpongFBO</span><span class="p">[</span><span class="n">horizontal</span><span class="p">]);</span>
<a id="__codelineno-78-32" name="__codelineno-78-32" href="#__codelineno-78-32"></a><span class="w">            </span><span class="n">effects</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="o">-&gt;</span><span class="n">Apply</span><span class="p">(</span><span class="n">firstIteration</span><span class="w"> </span><span class="o">?</span><span class="w"> </span><span class="n">inputTexture</span><span class="w"> </span><span class="o">:</span><span class="w"> </span><span class="n">pingpongColorbuffers</span><span class="p">[</span><span class="o">!</span><span class="n">horizontal</span><span class="p">],</span><span class="w"> </span><span class="n">pingpongFBO</span><span class="p">[</span><span class="n">horizontal</span><span class="p">]);</span>
<a id="__codelineno-78-33" name="__codelineno-78-33" href="#__codelineno-78-33"></a><span class="w">            </span><span class="n">horizontal</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="o">!</span><span class="n">horizontal</span><span class="p">;</span>
<a id="__codelineno-78-34" name="__codelineno-78-34" href="#__codelineno-78-34"></a><span class="w">            </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">firstIteration</span><span class="p">)</span><span class="w"> </span><span class="n">firstIteration</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nb">false</span><span class="p">;</span>
<a id="__codelineno-78-35" name="__codelineno-78-35" href="#__codelineno-78-35"></a><span class="w">        </span><span class="p">}</span>
<a id="__codelineno-78-36" name="__codelineno-78-36" href="#__codelineno-78-36"></a>
<a id="__codelineno-78-37" name="__codelineno-78-37" href="#__codelineno-78-37"></a><span class="w">        </span><span class="n">glBindFramebuffer</span><span class="p">(</span><span class="n">GL_FRAMEBUFFER</span><span class="p">,</span><span class="w"> </span><span class="mi">0</span><span class="p">);</span>
<a id="__codelineno-78-38" name="__codelineno-78-38" href="#__codelineno-78-38"></a><span class="w">        </span><span class="n">glDeleteFramebuffers</span><span class="p">(</span><span class="mi">2</span><span class="p">,</span><span class="w"> </span><span class="n">pingpongFBO</span><span class="p">);</span>
<a id="__codelineno-78-39" name="__codelineno-78-39" href="#__codelineno-78-39"></a><span class="w">        </span><span class="n">glDeleteTextures</span><span class="p">(</span><span class="mi">2</span><span class="p">,</span><span class="w"> </span><span class="n">pingpongColorbuffers</span><span class="p">);</span>
<a id="__codelineno-78-40" name="__codelineno-78-40" href="#__codelineno-78-40"></a><span class="w">    </span><span class="p">}</span>
<a id="__codelineno-78-41" name="__codelineno-78-41" href="#__codelineno-78-41"></a>
<a id="__codelineno-78-42" name="__codelineno-78-42" href="#__codelineno-78-42"></a><span class="k">private</span><span class="o">:</span>
<a id="__codelineno-78-43" name="__codelineno-78-43" href="#__codelineno-78-43"></a><span class="w">    </span><span class="n">std</span><span class="o">::</span><span class="n">vector</span><span class="o">&lt;</span><span class="n">std</span><span class="o">::</span><span class="n">unique_ptr</span><span class="o">&lt;</span><span class="n">Effect</span><span class="o">&gt;&gt;</span><span class="w"> </span><span class="n">effects</span><span class="p">;</span>
<a id="__codelineno-78-44" name="__codelineno-78-44" href="#__codelineno-78-44"></a><span class="w">    </span><span class="kt">int</span><span class="w"> </span><span class="n">width</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">800</span><span class="p">;</span><span class="w"> </span><span class="c1">// Example width</span>
<a id="__codelineno-78-45" name="__codelineno-78-45" href="#__codelineno-78-45"></a><span class="w">    </span><span class="kt">int</span><span class="w"> </span><span class="n">height</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">600</span><span class="p">;</span><span class="w"> </span><span class="c1">// Example height</span>
<a id="__codelineno-78-46" name="__codelineno-78-46" href="#__codelineno-78-46"></a><span class="p">};</span>
<a id="__codelineno-78-47" name="__codelineno-78-47" href="#__codelineno-78-47"></a>
<a id="__codelineno-78-48" name="__codelineno-78-48" href="#__codelineno-78-48"></a><span class="cp">#endif </span><span class="c1">// POSTPROCESSINGPIPELINE_H</span>
</code></pre></div>
<h3 id="maincpp">Main.cpp</h3>
<div class="highlight"><pre><span></span><code><a id="__codelineno-79-1" name="__codelineno-79-1" href="#__codelineno-79-1"></a><span class="cp">#include</span><span class="w"> </span><span class="cpf">&lt;GL/glew.h&gt;</span>
<a id="__codelineno-79-2" name="__codelineno-79-2" href="#__codelineno-79-2"></a><span class="cp">#include</span><span class="w"> </span><span class="cpf">&lt;GLFW/glfw3.h&gt;</span>
<a id="__codelineno-79-3" name="__codelineno-79-3" href="#__codelineno-79-3"></a><span class="cp">#include</span><span class="w"> </span><span class="cpf">&quot;PostProcessingPipeline.h&quot;</span>
<a id="__codelineno-79-4" name="__codelineno-79-4" href="#__codelineno-79-4"></a><span class="cp">#include</span><span class="w"> </span><span class="cpf">&quot;BloomEffect.h&quot;</span>
<a id="__codelineno-79-5" name="__codelineno-79-5" href="#__codelineno-79-5"></a>
<a id="__codelineno-79-6" name="__codelineno-79-6" href="#__codelineno-79-6"></a><span class="kt">int</span><span class="w"> </span><span class="nf">main</span><span class="p">()</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-79-7" name="__codelineno-79-7" href="#__codelineno-79-7"></a><span class="w">    </span><span class="c1">// Initialize GLFW and create window...</span>
<a id="__codelineno-79-8" name="__codelineno-79-8" href="#__codelineno-79-8"></a>
<a id="__codelineno-79-9" name="__codelineno-79-9" href="#__codelineno-79-9"></a><span class="w">    </span><span class="n">glewInit</span><span class="p">();</span>
<a id="__codelineno-79-10" name="__codelineno-79-10" href="#__codelineno-79-10"></a>
<a id="__codelineno-79-11" name="__codelineno-79-11" href="#__codelineno-79-11"></a><span class="w">    </span><span class="n">GLuint</span><span class="w"> </span><span class="n">inputTexture</span><span class="p">;</span><span class="w"> </span><span class="c1">// Assume this is your rendered scene texture</span>
<a id="__codelineno-79-12" name="__codelineno-79-12" href="#__codelineno-79-12"></a><span class="w">    </span><span class="n">PostProcessingPipeline</span><span class="w"> </span><span class="n">pipeline</span><span class="p">;</span>
<a id="__codelineno-79-13" name="__codelineno-79-13" href="#__codelineno-79-13"></a><span class="w">    </span><span class="n">pipeline</span><span class="p">.</span><span class="n">AddEffect</span><span class="p">(</span><span class="n">std</span><span class="o">::</span><span class="n">make_unique</span><span class="o">&lt;</span><span class="n">BloomEffect</span><span class="o">&gt;</span><span class="p">());</span>
<a id="__codelineno-79-14" name="__codelineno-79-14" href="#__codelineno-79-14"></a>
<a id="__codelineno-79-15" name="__codelineno-79-15" href="#__codelineno-79-15"></a><span class="w">    </span><span class="k">while</span><span class="w"> </span><span class="p">(</span><span class="o">!</span><span class="n">glfwWindowShouldClose</span><span class="p">(</span><span class="n">window</span><span class="p">))</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-79-16" name="__codelineno-79-16" href="#__codelineno-79-16"></a><span class="w">        </span><span class="c1">// Render scene...</span>
<a id="__codelineno-79-17" name="__codelineno-79-17" href="#__codelineno-79-17"></a>
<a id="__codelineno-79-18" name="__codelineno-79-18" href="#__codelineno-79-18"></a><span class="w">        </span><span class="n">pipeline</span><span class="p">.</span><span class="n">ApplyEffects</span><span class="p">(</span><span class="n">inputTexture</span><span class="p">);</span>
<a id="__codelineno-79-19" name="__codelineno-79-19" href="#__codelineno-79-19"></a>
<a id="__codelineno-79-20" name="__codelineno-79-20" href="#__codelineno-79-20"></a><span class="w">        </span><span class="c1">// Swap buffers and poll events...</span>
<a id="__codelineno-79-21" name="__codelineno-79-21" href="#__codelineno-79-21"></a><span class="w">    </span><span class="p">}</span>
<a id="__codelineno-79-22" name="__codelineno-79-22" href="#__codelineno-79-22"></a>
<a id="__codelineno-79-23" name="__codelineno-79-23" href="#__codelineno-79-23"></a><span class="w">    </span><span class="n">glfwTerminate</span><span class="p">();</span>
<a id="__codelineno-79-24" name="__codelineno-79-24" href="#__codelineno-79-24"></a><span class="w">    </span><span class="k">return</span><span class="w"> </span><span class="mi">0</span><span class="p">;</span>
<a id="__codelineno-79-25" name="__codelineno-79-25" href="#__codelineno-79-25"></a><span class="p">}</span>
</code></pre></div>
<h3 id="explanation_10">Explanation</h3>
<ol>
<li><strong>Effect.h</strong>: Defines a base <code>Effect</code> class with a virtual <code>Apply</code> method. The <code>BindTexture</code> method binds a texture to a specific texture unit and sets the corresponding uniform in the shader.</li>
<li><strong>BloomEffect.h</strong>: Implements the <code>BloomEffect</code> class, which applies the bloom effect using a specific shader.</li>
<li><strong>PostProcessingPipeline.h</strong>: Manages a list of effects and applies them in sequence. Uses ping-pong framebuffers for intermediate rendering.</li>
<li><strong>Main.cpp</strong>: Demonstrates how to set up the post-processing pipeline and apply effects to the rendered scene.</li>
</ol>
<h3 id="shaders_1">Shaders</h3>
<h4 id="bloomvert">bloom.vert</h4>
<div class="highlight"><pre><span></span><code><a id="__codelineno-80-1" name="__codelineno-80-1" href="#__codelineno-80-1"></a><span class="cp">#version 330 core</span>
<a id="__codelineno-80-2" name="__codelineno-80-2" href="#__codelineno-80-2"></a><span class="k">layout</span><span class="p">(</span><span class="n">location</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mo">0</span><span class="p">)</span><span class="w"> </span><span class="k">in</span><span class="w"> </span><span class="kt">vec2</span><span class="w"> </span><span class="n">aPos</span><span class="p">;</span>
<a id="__codelineno-80-3" name="__codelineno-80-3" href="#__codelineno-80-3"></a><span class="k">layout</span><span class="p">(</span><span class="n">location</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">1</span><span class="p">)</span><span class="w"> </span><span class="k">in</span><span class="w"> </span><span class="kt">vec2</span><span class="w"> </span><span class="n">aTexCoords</span><span class="p">;</span>
<a id="__codelineno-80-4" name="__codelineno-80-4" href="#__codelineno-80-4"></a>
<a id="__codelineno-80-5" name="__codelineno-80-5" href="#__codelineno-80-5"></a><span class="k">out</span><span class="w"> </span><span class="kt">vec2</span><span class="w"> </span><span class="n">TexCoords</span><span class="p">;</span>
<a id="__codelineno-80-6" name="__codelineno-80-6" href="#__codelineno-80-6"></a>
<a id="__codelineno-80-7" name="__codelineno-80-7" href="#__codelineno-80-7"></a><span class="kt">void</span><span class="w"> </span><span class="n">main</span><span class="p">()</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-80-8" name="__codelineno-80-8" href="#__codelineno-80-8"></a><span class="w">    </span><span class="n">TexCoords</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">aTexCoords</span><span class="p">;</span>
<a id="__codelineno-80-9" name="__codelineno-80-9" href="#__codelineno-80-9"></a><span class="w">    </span><span class="nb">gl_Position</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="kt">vec4</span><span class="p">(</span><span class="n">aPos</span><span class="p">,</span><span class="w"> </span><span class="mf">0.0</span><span class="p">,</span><span class="w"> </span><span class="mf">1.0</span><span class="p">);</span>
<a id="__codelineno-80-10" name="__codelineno-80-10" href="#__codelineno-80-10"></a><span class="p">}</span>
</code></pre></div>
<h4 id="bloomfrag">bloom.frag</h4>
<div class="highlight"><pre><span></span><code><a id="__codelineno-81-1" name="__codelineno-81-1" href="#__codelineno-81-1"></a><span class="cp">#version 330 core</span>
<a id="__codelineno-81-2" name="__codelineno-81-2" href="#__codelineno-81-2"></a><span class="k">out</span><span class="w"> </span><span class="kt">vec4</span><span class="w"> </span><span class="n">FragColor</span><span class="p">;</span>
<a id="__codelineno-81-3" name="__codelineno-81-3" href="#__codelineno-81-3"></a>
<a id="__codelineno-81-4" name="__codelineno-81-4" href="#__codelineno-81-4"></a><span class="k">in</span><span class="w"> </span><span class="kt">vec2</span><span class="w"> </span><span class="n">TexCoords</span><span class="p">;</span>
<a id="__codelineno-81-5" name="__codelineno-81-5" href="#__codelineno-81-5"></a>
<a id="__codelineno-81-6" name="__codelineno-81-6" href="#__codelineno-81-6"></a><span class="k">uniform</span><span class="w"> </span><span class="kt">sampler2D</span><span class="w"> </span><span class="n">scene</span><span class="p">;</span>
<a id="__codelineno-81-7" name="__codelineno-81-7" href="#__codelineno-81-7"></a>
<a id="__codelineno-81-8" name="__codelineno-81-8" href="#__codelineno-81-8"></a><span class="kt">void</span><span class="w"> </span><span class="n">main</span><span class="p">()</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-81-9" name="__codelineno-81-9" href="#__codelineno-81-9"></a><span class="w">    </span><span class="kt">vec3</span><span class="w"> </span><span class="n">color</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">texture</span><span class="p">(</span><span class="n">scene</span><span class="p">,</span><span class="w"> </span><span class="n">TexCoords</span><span class="p">).</span><span class="n">rgb</span><span class="p">;</span>
<a id="__codelineno-81-10" name="__codelineno-81-10" href="#__codelineno-81-10"></a><span class="w">    </span><span class="c1">// Apply bloom logic...</span>
<a id="__codelineno-81-11" name="__codelineno-81-11" href="#__codelineno-81-11"></a><span class="w">    </span><span class="n">FragColor</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="kt">vec4</span><span class="p">(</span><span class="n">color</span><span class="p">,</span><span class="w"> </span><span class="mf">1.0</span><span class="p">);</span>
<a id="__codelineno-81-12" name="__codelineno-81-12" href="#__codelineno-81-12"></a><span class="p">}</span>
</code></pre></div>
<p>This implementation provides a robust and flexible post-processing pipeline suitable for games. Each effect is modular, allowing easy addition or modification of effects. The system uses shaders to achieve high performance and visual quality.</p>
<h2 id="bloom-effect">Bloom Effect</h2>
<h3 id="key-steps">Key Steps</h3>
<p>The bloom effect usually involves a few key steps:</p>
<ol>
<li><strong>Extract bright areas</strong>: Identify the bright parts of the scene.</li>
<li><strong>Blur</strong>: Apply a Gaussian blur to the bright areas.</li>
<li><strong>Combine</strong>: Combine the blurred bright areas back with the original scene.</li>
</ol>
<h3 id="bloomvert_1">bloom.vert</h3>
<p>The vertex shader for the bloom effect is quite simple. It just passes the texture coordinates through to the fragment shader.</p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-82-1" name="__codelineno-82-1" href="#__codelineno-82-1"></a><span class="cp">#version 330 core</span>
<a id="__codelineno-82-2" name="__codelineno-82-2" href="#__codelineno-82-2"></a><span class="k">layout</span><span class="p">(</span><span class="n">location</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mo">0</span><span class="p">)</span><span class="w"> </span><span class="k">in</span><span class="w"> </span><span class="kt">vec2</span><span class="w"> </span><span class="n">aPos</span><span class="p">;</span>
<a id="__codelineno-82-3" name="__codelineno-82-3" href="#__codelineno-82-3"></a><span class="k">layout</span><span class="p">(</span><span class="n">location</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">1</span><span class="p">)</span><span class="w"> </span><span class="k">in</span><span class="w"> </span><span class="kt">vec2</span><span class="w"> </span><span class="n">aTexCoords</span><span class="p">;</span>
<a id="__codelineno-82-4" name="__codelineno-82-4" href="#__codelineno-82-4"></a>
<a id="__codelineno-82-5" name="__codelineno-82-5" href="#__codelineno-82-5"></a><span class="k">out</span><span class="w"> </span><span class="kt">vec2</span><span class="w"> </span><span class="n">TexCoords</span><span class="p">;</span>
<a id="__codelineno-82-6" name="__codelineno-82-6" href="#__codelineno-82-6"></a>
<a id="__codelineno-82-7" name="__codelineno-82-7" href="#__codelineno-82-7"></a><span class="kt">void</span><span class="w"> </span><span class="n">main</span><span class="p">()</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-82-8" name="__codelineno-82-8" href="#__codelineno-82-8"></a><span class="w">    </span><span class="n">TexCoords</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">aTexCoords</span><span class="p">;</span>
<a id="__codelineno-82-9" name="__codelineno-82-9" href="#__codelineno-82-9"></a><span class="w">    </span><span class="nb">gl_Position</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="kt">vec4</span><span class="p">(</span><span class="n">aPos</span><span class="p">,</span><span class="w"> </span><span class="mf">0.0</span><span class="p">,</span><span class="w"> </span><span class="mf">1.0</span><span class="p">);</span>
<a id="__codelineno-82-10" name="__codelineno-82-10" href="#__codelineno-82-10"></a><span class="p">}</span>
</code></pre></div>
<h3 id="bloomfrag_1">bloom.frag</h3>
<p>The fragment shader for the bloom effect consists of two stages: bright pass and Gaussian blur.</p>
<h4 id="bright-pass-extract-bright-areas">Bright Pass (extract bright areas)</h4>
<div class="highlight"><pre><span></span><code><a id="__codelineno-83-1" name="__codelineno-83-1" href="#__codelineno-83-1"></a><span class="cp">#version 330 core</span>
<a id="__codelineno-83-2" name="__codelineno-83-2" href="#__codelineno-83-2"></a><span class="k">out</span><span class="w"> </span><span class="kt">vec4</span><span class="w"> </span><span class="n">FragColor</span><span class="p">;</span>
<a id="__codelineno-83-3" name="__codelineno-83-3" href="#__codelineno-83-3"></a>
<a id="__codelineno-83-4" name="__codelineno-83-4" href="#__codelineno-83-4"></a><span class="k">in</span><span class="w"> </span><span class="kt">vec2</span><span class="w"> </span><span class="n">TexCoords</span><span class="p">;</span>
<a id="__codelineno-83-5" name="__codelineno-83-5" href="#__codelineno-83-5"></a>
<a id="__codelineno-83-6" name="__codelineno-83-6" href="#__codelineno-83-6"></a><span class="k">uniform</span><span class="w"> </span><span class="kt">sampler2D</span><span class="w"> </span><span class="n">scene</span><span class="p">;</span>
<a id="__codelineno-83-7" name="__codelineno-83-7" href="#__codelineno-83-7"></a><span class="k">uniform</span><span class="w"> </span><span class="kt">bool</span><span class="w"> </span><span class="n">horizontal</span><span class="p">;</span>
<a id="__codelineno-83-8" name="__codelineno-83-8" href="#__codelineno-83-8"></a><span class="k">uniform</span><span class="w"> </span><span class="kt">float</span><span class="w"> </span><span class="n">weight</span><span class="p">[</span><span class="mi">5</span><span class="p">];</span>
<a id="__codelineno-83-9" name="__codelineno-83-9" href="#__codelineno-83-9"></a>
<a id="__codelineno-83-10" name="__codelineno-83-10" href="#__codelineno-83-10"></a><span class="kt">void</span><span class="w"> </span><span class="n">main</span><span class="p">()</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-83-11" name="__codelineno-83-11" href="#__codelineno-83-11"></a><span class="w">    </span><span class="kt">vec3</span><span class="w"> </span><span class="n">color</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">texture</span><span class="p">(</span><span class="n">scene</span><span class="p">,</span><span class="w"> </span><span class="n">TexCoords</span><span class="p">).</span><span class="n">rgb</span><span class="p">;</span>
<a id="__codelineno-83-12" name="__codelineno-83-12" href="#__codelineno-83-12"></a>
<a id="__codelineno-83-13" name="__codelineno-83-13" href="#__codelineno-83-13"></a><span class="w">    </span><span class="c1">// Bright pass threshold (you may adjust this threshold based on your scene)</span>
<a id="__codelineno-83-14" name="__codelineno-83-14" href="#__codelineno-83-14"></a><span class="w">    </span><span class="kt">float</span><span class="w"> </span><span class="n">brightness</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">dot</span><span class="p">(</span><span class="n">color</span><span class="p">,</span><span class="w"> </span><span class="kt">vec3</span><span class="p">(</span><span class="mf">0.2126</span><span class="p">,</span><span class="w"> </span><span class="mf">0.7152</span><span class="p">,</span><span class="w"> </span><span class="mf">0.0722</span><span class="p">));</span>
<a id="__codelineno-83-15" name="__codelineno-83-15" href="#__codelineno-83-15"></a><span class="w">    </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">brightness</span><span class="w"> </span><span class="o">&gt;</span><span class="w"> </span><span class="mf">1.0</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-83-16" name="__codelineno-83-16" href="#__codelineno-83-16"></a><span class="w">        </span><span class="n">FragColor</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="kt">vec4</span><span class="p">(</span><span class="n">color</span><span class="p">,</span><span class="w"> </span><span class="mf">1.0</span><span class="p">);</span>
<a id="__codelineno-83-17" name="__codelineno-83-17" href="#__codelineno-83-17"></a><span class="w">    </span><span class="p">}</span><span class="w"> </span><span class="k">else</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-83-18" name="__codelineno-83-18" href="#__codelineno-83-18"></a><span class="w">        </span><span class="n">FragColor</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="kt">vec4</span><span class="p">(</span><span class="mf">0.0</span><span class="p">,</span><span class="w"> </span><span class="mf">0.0</span><span class="p">,</span><span class="w"> </span><span class="mf">0.0</span><span class="p">,</span><span class="w"> </span><span class="mf">1.0</span><span class="p">);</span>
<a id="__codelineno-83-19" name="__codelineno-83-19" href="#__codelineno-83-19"></a><span class="w">    </span><span class="p">}</span>
<a id="__codelineno-83-20" name="__codelineno-83-20" href="#__codelineno-83-20"></a><span class="p">}</span>
</code></pre></div>
<h4 id="gaussian-blur-horizontal-and-vertical-passes">Gaussian Blur (horizontal and vertical passes)</h4>
<div class="highlight"><pre><span></span><code><a id="__codelineno-84-1" name="__codelineno-84-1" href="#__codelineno-84-1"></a><span class="cp">#version 330 core</span>
<a id="__codelineno-84-2" name="__codelineno-84-2" href="#__codelineno-84-2"></a><span class="k">out</span><span class="w"> </span><span class="kt">vec4</span><span class="w"> </span><span class="n">FragColor</span><span class="p">;</span>
<a id="__codelineno-84-3" name="__codelineno-84-3" href="#__codelineno-84-3"></a>
<a id="__codelineno-84-4" name="__codelineno-84-4" href="#__codelineno-84-4"></a><span class="k">in</span><span class="w"> </span><span class="kt">vec2</span><span class="w"> </span><span class="n">TexCoords</span><span class="p">;</span>
<a id="__codelineno-84-5" name="__codelineno-84-5" href="#__codelineno-84-5"></a>
<a id="__codelineno-84-6" name="__codelineno-84-6" href="#__codelineno-84-6"></a><span class="k">uniform</span><span class="w"> </span><span class="kt">sampler2D</span><span class="w"> </span><span class="n">image</span><span class="p">;</span>
<a id="__codelineno-84-7" name="__codelineno-84-7" href="#__codelineno-84-7"></a><span class="k">uniform</span><span class="w"> </span><span class="kt">bool</span><span class="w"> </span><span class="n">horizontal</span><span class="p">;</span>
<a id="__codelineno-84-8" name="__codelineno-84-8" href="#__codelineno-84-8"></a><span class="k">uniform</span><span class="w"> </span><span class="kt">float</span><span class="w"> </span><span class="n">weight</span><span class="p">[</span><span class="mi">5</span><span class="p">];</span>
<a id="__codelineno-84-9" name="__codelineno-84-9" href="#__codelineno-84-9"></a>
<a id="__codelineno-84-10" name="__codelineno-84-10" href="#__codelineno-84-10"></a><span class="kt">void</span><span class="w"> </span><span class="n">main</span><span class="p">()</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-84-11" name="__codelineno-84-11" href="#__codelineno-84-11"></a><span class="w">    </span><span class="kt">vec2</span><span class="w"> </span><span class="n">tex_offset</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mf">1.0</span><span class="w"> </span><span class="o">/</span><span class="w"> </span><span class="n">textureSize</span><span class="p">(</span><span class="n">image</span><span class="p">,</span><span class="w"> </span><span class="mo">0</span><span class="p">);</span><span class="w"> </span><span class="c1">// gets size of single texel</span>
<a id="__codelineno-84-12" name="__codelineno-84-12" href="#__codelineno-84-12"></a><span class="w">    </span><span class="kt">vec3</span><span class="w"> </span><span class="n">result</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">texture</span><span class="p">(</span><span class="n">image</span><span class="p">,</span><span class="w"> </span><span class="n">TexCoords</span><span class="p">).</span><span class="n">rgb</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="n">weight</span><span class="p">[</span><span class="mo">0</span><span class="p">];</span>
<a id="__codelineno-84-13" name="__codelineno-84-13" href="#__codelineno-84-13"></a>
<a id="__codelineno-84-14" name="__codelineno-84-14" href="#__codelineno-84-14"></a><span class="w">    </span><span class="k">for</span><span class="w"> </span><span class="p">(</span><span class="kt">int</span><span class="w"> </span><span class="n">i</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">1</span><span class="p">;</span><span class="w"> </span><span class="n">i</span><span class="w"> </span><span class="o">&lt;</span><span class="w"> </span><span class="mi">5</span><span class="p">;</span><span class="w"> </span><span class="o">++</span><span class="n">i</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-84-15" name="__codelineno-84-15" href="#__codelineno-84-15"></a><span class="w">        </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">horizontal</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-84-16" name="__codelineno-84-16" href="#__codelineno-84-16"></a><span class="w">            </span><span class="n">result</span><span class="w"> </span><span class="o">+=</span><span class="w"> </span><span class="n">texture</span><span class="p">(</span><span class="n">image</span><span class="p">,</span><span class="w"> </span><span class="n">TexCoords</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="kt">vec2</span><span class="p">(</span><span class="n">tex_offset</span><span class="p">.</span><span class="n">x</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="n">i</span><span class="p">,</span><span class="w"> </span><span class="mf">0.0</span><span class="p">)).</span><span class="n">rgb</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="n">weight</span><span class="p">[</span><span class="n">i</span><span class="p">];</span>
<a id="__codelineno-84-17" name="__codelineno-84-17" href="#__codelineno-84-17"></a><span class="w">            </span><span class="n">result</span><span class="w"> </span><span class="o">+=</span><span class="w"> </span><span class="n">texture</span><span class="p">(</span><span class="n">image</span><span class="p">,</span><span class="w"> </span><span class="n">TexCoords</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="kt">vec2</span><span class="p">(</span><span class="n">tex_offset</span><span class="p">.</span><span class="n">x</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="n">i</span><span class="p">,</span><span class="w"> </span><span class="mf">0.0</span><span class="p">)).</span><span class="n">rgb</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="n">weight</span><span class="p">[</span><span class="n">i</span><span class="p">];</span>
<a id="__codelineno-84-18" name="__codelineno-84-18" href="#__codelineno-84-18"></a><span class="w">        </span><span class="p">}</span><span class="w"> </span><span class="k">else</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-84-19" name="__codelineno-84-19" href="#__codelineno-84-19"></a><span class="w">            </span><span class="n">result</span><span class="w"> </span><span class="o">+=</span><span class="w"> </span><span class="n">texture</span><span class="p">(</span><span class="n">image</span><span class="p">,</span><span class="w"> </span><span class="n">TexCoords</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="kt">vec2</span><span class="p">(</span><span class="mf">0.0</span><span class="p">,</span><span class="w"> </span><span class="n">tex_offset</span><span class="p">.</span><span class="n">y</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="n">i</span><span class="p">)).</span><span class="n">rgb</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="n">weight</span><span class="p">[</span><span class="n">i</span><span class="p">];</span>
<a id="__codelineno-84-20" name="__codelineno-84-20" href="#__codelineno-84-20"></a><span class="w">            </span><span class="n">result</span><span class="w"> </span><span class="o">+=</span><span class="w"> </span><span class="n">texture</span><span class="p">(</span><span class="n">image</span><span class="p">,</span><span class="w"> </span><span class="n">TexCoords</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="kt">vec2</span><span class="p">(</span><span class="mf">0.0</span><span class="p">,</span><span class="w"> </span><span class="n">tex_offset</span><span class="p">.</span><span class="n">y</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="n">i</span><span class="p">)).</span><span class="n">rgb</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="n">weight</span><span class="p">[</span><span class="n">i</span><span class="p">];</span>
<a id="__codelineno-84-21" name="__codelineno-84-21" href="#__codelineno-84-21"></a><span class="w">        </span><span class="p">}</span>
<a id="__codelineno-84-22" name="__codelineno-84-22" href="#__codelineno-84-22"></a><span class="w">    </span><span class="p">}</span>
<a id="__codelineno-84-23" name="__codelineno-84-23" href="#__codelineno-84-23"></a><span class="w">    </span><span class="n">FragColor</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="kt">vec4</span><span class="p">(</span><span class="n">result</span><span class="p">,</span><span class="w"> </span><span class="mf">1.0</span><span class="p">);</span>
<a id="__codelineno-84-24" name="__codelineno-84-24" href="#__codelineno-84-24"></a><span class="p">}</span>
</code></pre></div>
<h3 id="bloomeffecth_1">BloomEffect.h</h3>
<div class="highlight"><pre><span></span><code><a id="__codelineno-85-1" name="__codelineno-85-1" href="#__codelineno-85-1"></a><span class="cp">#ifndef BLOOMEFFECT_H</span>
<a id="__codelineno-85-2" name="__codelineno-85-2" href="#__codelineno-85-2"></a><span class="cp">#define BLOOMEFFECT_H</span>
<a id="__codelineno-85-3" name="__codelineno-85-3" href="#__codelineno-85-3"></a>
<a id="__codelineno-85-4" name="__codelineno-85-4" href="#__codelineno-85-4"></a><span class="cp">#include</span><span class="w"> </span><span class="cpf">&quot;Effect.h&quot;</span>
<a id="__codelineno-85-5" name="__codelineno-85-5" href="#__codelineno-85-5"></a><span class="cp">#include</span><span class="w"> </span><span class="cpf">&lt;GL/glew.h&gt;</span>
<a id="__codelineno-85-6" name="__codelineno-85-6" href="#__codelineno-85-6"></a>
<a id="__codelineno-85-7" name="__codelineno-85-7" href="#__codelineno-85-7"></a><span class="k">class</span><span class="w"> </span><span class="nc">BloomEffect</span><span class="w"> </span><span class="o">:</span><span class="w"> </span><span class="k">public</span><span class="w"> </span><span class="n">Effect</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-85-8" name="__codelineno-85-8" href="#__codelineno-85-8"></a><span class="k">public</span><span class="o">:</span>
<a id="__codelineno-85-9" name="__codelineno-85-9" href="#__codelineno-85-9"></a><span class="w">    </span><span class="n">BloomEffect</span><span class="p">()</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-85-10" name="__codelineno-85-10" href="#__codelineno-85-10"></a><span class="w">        </span><span class="c1">// Load the bright pass and blur shaders</span>
<a id="__codelineno-85-11" name="__codelineno-85-11" href="#__codelineno-85-11"></a><span class="w">        </span><span class="n">brightPassShader</span><span class="p">.</span><span class="n">load</span><span class="p">(</span><span class="s">&quot;shaders/bloom.vert&quot;</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;shaders/bright_pass.frag&quot;</span><span class="p">);</span>
<a id="__codelineno-85-12" name="__codelineno-85-12" href="#__codelineno-85-12"></a><span class="w">        </span><span class="n">blurShader</span><span class="p">.</span><span class="n">load</span><span class="p">(</span><span class="s">&quot;shaders/bloom.vert&quot;</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;shaders/blur.frag&quot;</span><span class="p">);</span>
<a id="__codelineno-85-13" name="__codelineno-85-13" href="#__codelineno-85-13"></a>
<a id="__codelineno-85-14" name="__codelineno-85-14" href="#__codelineno-85-14"></a><span class="w">        </span><span class="c1">// Initialize weights for Gaussian blur</span>
<a id="__codelineno-85-15" name="__codelineno-85-15" href="#__codelineno-85-15"></a><span class="w">        </span><span class="n">weights</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mf">0.227027</span><span class="p">;</span>
<a id="__codelineno-85-16" name="__codelineno-85-16" href="#__codelineno-85-16"></a><span class="w">        </span><span class="n">weights</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mf">0.1945946</span><span class="p">;</span>
<a id="__codelineno-85-17" name="__codelineno-85-17" href="#__codelineno-85-17"></a><span class="w">        </span><span class="n">weights</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mf">0.1216216</span><span class="p">;</span>
<a id="__codelineno-85-18" name="__codelineno-85-18" href="#__codelineno-85-18"></a><span class="w">        </span><span class="n">weights</span><span class="p">[</span><span class="mi">3</span><span class="p">]</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mf">0.054054</span><span class="p">;</span>
<a id="__codelineno-85-19" name="__codelineno-85-19" href="#__codelineno-85-19"></a><span class="w">        </span><span class="n">weights</span><span class="p">[</span><span class="mi">4</span><span class="p">]</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mf">0.016216</span><span class="p">;</span>
<a id="__codelineno-85-20" name="__codelineno-85-20" href="#__codelineno-85-20"></a><span class="w">    </span><span class="p">}</span>
<a id="__codelineno-85-21" name="__codelineno-85-21" href="#__codelineno-85-21"></a>
<a id="__codelineno-85-22" name="__codelineno-85-22" href="#__codelineno-85-22"></a><span class="w">    </span><span class="kt">void</span><span class="w"> </span><span class="n">Apply</span><span class="p">(</span><span class="n">GLuint</span><span class="w"> </span><span class="n">inputTexture</span><span class="p">,</span><span class="w"> </span><span class="n">GLuint</span><span class="w"> </span><span class="n">outputFBO</span><span class="p">)</span><span class="w"> </span><span class="k">override</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-85-23" name="__codelineno-85-23" href="#__codelineno-85-23"></a><span class="w">        </span><span class="c1">// Step 1: Bright pass</span>
<a id="__codelineno-85-24" name="__codelineno-85-24" href="#__codelineno-85-24"></a><span class="w">        </span><span class="n">glBindFramebuffer</span><span class="p">(</span><span class="n">GL_FRAMEBUFFER</span><span class="p">,</span><span class="w"> </span><span class="n">pingpongFBO</span><span class="p">[</span><span class="mi">0</span><span class="p">]);</span>
<a id="__codelineno-85-25" name="__codelineno-85-25" href="#__codelineno-85-25"></a><span class="w">        </span><span class="n">brightPassShader</span><span class="p">.</span><span class="n">use</span><span class="p">();</span>
<a id="__codelineno-85-26" name="__codelineno-85-26" href="#__codelineno-85-26"></a><span class="w">        </span><span class="n">BindTexture</span><span class="p">(</span><span class="n">inputTexture</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;scene&quot;</span><span class="p">,</span><span class="w"> </span><span class="mi">0</span><span class="p">);</span>
<a id="__codelineno-85-27" name="__codelineno-85-27" href="#__codelineno-85-27"></a><span class="w">        </span><span class="n">RenderQuad</span><span class="p">();</span>
<a id="__codelineno-85-28" name="__codelineno-85-28" href="#__codelineno-85-28"></a>
<a id="__codelineno-85-29" name="__codelineno-85-29" href="#__codelineno-85-29"></a><span class="w">        </span><span class="c1">// Step 2: Gaussian blur</span>
<a id="__codelineno-85-30" name="__codelineno-85-30" href="#__codelineno-85-30"></a><span class="w">        </span><span class="kt">bool</span><span class="w"> </span><span class="n">horizontal</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nb">true</span><span class="p">,</span><span class="w"> </span><span class="n">firstIteration</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nb">true</span><span class="p">;</span>
<a id="__codelineno-85-31" name="__codelineno-85-31" href="#__codelineno-85-31"></a><span class="w">        </span><span class="n">blurShader</span><span class="p">.</span><span class="n">use</span><span class="p">();</span>
<a id="__codelineno-85-32" name="__codelineno-85-32" href="#__codelineno-85-32"></a><span class="w">        </span><span class="k">for</span><span class="w"> </span><span class="p">(</span><span class="kt">unsigned</span><span class="w"> </span><span class="kt">int</span><span class="w"> </span><span class="n">i</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">0</span><span class="p">;</span><span class="w"> </span><span class="n">i</span><span class="w"> </span><span class="o">&lt;</span><span class="w"> </span><span class="mi">10</span><span class="p">;</span><span class="w"> </span><span class="o">++</span><span class="n">i</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-85-33" name="__codelineno-85-33" href="#__codelineno-85-33"></a><span class="w">            </span><span class="n">glBindFramebuffer</span><span class="p">(</span><span class="n">GL_FRAMEBUFFER</span><span class="p">,</span><span class="w"> </span><span class="n">pingpongFBO</span><span class="p">[</span><span class="n">horizontal</span><span class="p">]);</span>
<a id="__codelineno-85-34" name="__codelineno-85-34" href="#__codelineno-85-34"></a><span class="w">            </span><span class="n">blurShader</span><span class="p">.</span><span class="n">setInt</span><span class="p">(</span><span class="s">&quot;horizontal&quot;</span><span class="p">,</span><span class="w"> </span><span class="n">horizontal</span><span class="p">);</span>
<a id="__codelineno-85-35" name="__codelineno-85-35" href="#__codelineno-85-35"></a><span class="w">            </span><span class="n">BindTexture</span><span class="p">(</span><span class="n">firstIteration</span><span class="w"> </span><span class="o">?</span><span class="w"> </span><span class="n">pingpongColorbuffers</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="w"> </span><span class="o">:</span><span class="w"> </span><span class="n">pingpongColorbuffers</span><span class="p">[</span><span class="o">!</span><span class="n">horizontal</span><span class="p">],</span><span class="w"> </span><span class="s">&quot;image&quot;</span><span class="p">,</span><span class="w"> </span><span class="mi">0</span><span class="p">);</span>
<a id="__codelineno-85-36" name="__codelineno-85-36" href="#__codelineno-85-36"></a><span class="w">            </span><span class="n">RenderQuad</span><span class="p">();</span>
<a id="__codelineno-85-37" name="__codelineno-85-37" href="#__codelineno-85-37"></a><span class="w">            </span><span class="n">horizontal</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="o">!</span><span class="n">horizontal</span><span class="p">;</span>
<a id="__codelineno-85-38" name="__codelineno-85-38" href="#__codelineno-85-38"></a><span class="w">            </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">firstIteration</span><span class="p">)</span><span class="w"> </span><span class="n">firstIteration</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nb">false</span><span class="p">;</span>
<a id="__codelineno-85-39" name="__codelineno-85-39" href="#__codelineno-85-39"></a><span class="w">        </span><span class="p">}</span>
<a id="__codelineno-85-40" name="__codelineno-85-40" href="#__codelineno-85-40"></a>
<a id="__codelineno-85-41" name="__codelineno-85-41" href="#__codelineno-85-41"></a><span class="w">        </span><span class="c1">// Combine blurred texture with the original scene</span>
<a id="__codelineno-85-42" name="__codelineno-85-42" href="#__codelineno-85-42"></a><span class="w">        </span><span class="n">glBindFramebuffer</span><span class="p">(</span><span class="n">GL_FRAMEBUFFER</span><span class="p">,</span><span class="w"> </span><span class="n">outputFBO</span><span class="p">);</span>
<a id="__codelineno-85-43" name="__codelineno-85-43" href="#__codelineno-85-43"></a><span class="w">        </span><span class="n">shader</span><span class="p">.</span><span class="n">use</span><span class="p">();</span>
<a id="__codelineno-85-44" name="__codelineno-85-44" href="#__codelineno-85-44"></a><span class="w">        </span><span class="n">BindTexture</span><span class="p">(</span><span class="n">inputTexture</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;scene&quot;</span><span class="p">,</span><span class="w"> </span><span class="mi">0</span><span class="p">);</span>
<a id="__codelineno-85-45" name="__codelineno-85-45" href="#__codelineno-85-45"></a><span class="w">        </span><span class="n">BindTexture</span><span class="p">(</span><span class="n">pingpongColorbuffers</span><span class="p">[</span><span class="o">!</span><span class="n">horizontal</span><span class="p">],</span><span class="w"> </span><span class="s">&quot;bloomBlur&quot;</span><span class="p">,</span><span class="w"> </span><span class="mi">1</span><span class="p">);</span>
<a id="__codelineno-85-46" name="__codelineno-85-46" href="#__codelineno-85-46"></a><span class="w">        </span><span class="n">RenderQuad</span><span class="p">();</span>
<a id="__codelineno-85-47" name="__codelineno-85-47" href="#__codelineno-85-47"></a><span class="w">    </span><span class="p">}</span>
<a id="__codelineno-85-48" name="__codelineno-85-48" href="#__codelineno-85-48"></a>
<a id="__codelineno-85-49" name="__codelineno-85-49" href="#__codelineno-85-49"></a><span class="k">private</span><span class="o">:</span>
<a id="__codelineno-85-50" name="__codelineno-85-50" href="#__codelineno-85-50"></a><span class="w">    </span><span class="n">Shader</span><span class="w"> </span><span class="n">brightPassShader</span><span class="p">;</span>
<a id="__codelineno-85-51" name="__codelineno-85-51" href="#__codelineno-85-51"></a><span class="w">    </span><span class="n">Shader</span><span class="w"> </span><span class="n">blurShader</span><span class="p">;</span>
<a id="__codelineno-85-52" name="__codelineno-85-52" href="#__codelineno-85-52"></a><span class="w">    </span><span class="n">GLuint</span><span class="w"> </span><span class="n">pingpongFBO</span><span class="p">[</span><span class="mi">2</span><span class="p">];</span>
<a id="__codelineno-85-53" name="__codelineno-85-53" href="#__codelineno-85-53"></a><span class="w">    </span><span class="n">GLuint</span><span class="w"> </span><span class="n">pingpongColorbuffers</span><span class="p">[</span><span class="mi">2</span><span class="p">];</span>
<a id="__codelineno-85-54" name="__codelineno-85-54" href="#__codelineno-85-54"></a><span class="w">    </span><span class="kt">float</span><span class="w"> </span><span class="n">weights</span><span class="p">[</span><span class="mi">5</span><span class="p">];</span>
<a id="__codelineno-85-55" name="__codelineno-85-55" href="#__codelineno-85-55"></a>
<a id="__codelineno-85-56" name="__codelineno-85-56" href="#__codelineno-85-56"></a><span class="w">    </span><span class="kt">void</span><span class="w"> </span><span class="nf">RenderQuad</span><span class="p">()</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-85-57" name="__codelineno-85-57" href="#__codelineno-85-57"></a><span class="w">        </span><span class="k">static</span><span class="w"> </span><span class="n">GLuint</span><span class="w"> </span><span class="n">quadVAO</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">0</span><span class="p">;</span>
<a id="__codelineno-85-58" name="__codelineno-85-58" href="#__codelineno-85-58"></a><span class="w">        </span><span class="k">static</span><span class="w"> </span><span class="n">GLuint</span><span class="w"> </span><span class="n">quadVBO</span><span class="p">;</span>
<a id="__codelineno-85-59" name="__codelineno-85-59" href="#__codelineno-85-59"></a><span class="w">        </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">quadVAO</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="mi">0</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-85-60" name="__codelineno-85-60" href="#__codelineno-85-60"></a><span class="w">            </span><span class="n">GLfloat</span><span class="w"> </span><span class="n">quadVertices</span><span class="p">[]</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-85-61" name="__codelineno-85-61" href="#__codelineno-85-61"></a><span class="w">                </span><span class="c1">// Positions        // Texture Coords</span>
<a id="__codelineno-85-62" name="__codelineno-85-62" href="#__codelineno-85-62"></a><span class="w">                </span><span class="mf">-1.0f</span><span class="p">,</span><span class="w">  </span><span class="mf">1.0f</span><span class="p">,</span><span class="w"> </span><span class="mf">0.0f</span><span class="p">,</span><span class="w">  </span><span class="mf">0.0f</span><span class="p">,</span><span class="w"> </span><span class="mf">1.0f</span><span class="p">,</span>
<a id="__codelineno-85-63" name="__codelineno-85-63" href="#__codelineno-85-63"></a><span class="w">                </span><span class="mf">-1.0f</span><span class="p">,</span><span class="w"> </span><span class="mf">-1.0f</span><span class="p">,</span><span class="w"> </span><span class="mf">0.0f</span><span class="p">,</span><span class="w">  </span><span class="mf">0.0f</span><span class="p">,</span><span class="w"> </span><span class="mf">0.0f</span><span class="p">,</span>
<a id="__codelineno-85-64" name="__codelineno-85-64" href="#__codelineno-85-64"></a><span class="w">                 </span><span class="mf">1.0f</span><span class="p">,</span><span class="w"> </span><span class="mf">-1.0f</span><span class="p">,</span><span class="w"> </span><span class="mf">0.0f</span><span class="p">,</span><span class="w">  </span><span class="mf">1.0f</span><span class="p">,</span><span class="w"> </span><span class="mf">0.0f</span><span class="p">,</span>
<a id="__codelineno-85-65" name="__codelineno-85-65" href="#__codelineno-85-65"></a>
<a id="__codelineno-85-66" name="__codelineno-85-66" href="#__codelineno-85-66"></a><span class="w">                </span><span class="mf">-1.0f</span><span class="p">,</span><span class="w">  </span><span class="mf">1.0f</span><span class="p">,</span><span class="w"> </span><span class="mf">0.0f</span><span class="p">,</span><span class="w">  </span><span class="mf">0.0f</span><span class="p">,</span><span class="w"> </span><span class="mf">1.0f</span><span class="p">,</span>
<a id="__codelineno-85-67" name="__codelineno-85-67" href="#__codelineno-85-67"></a><span class="w">                 </span><span class="mf">1.0f</span><span class="p">,</span><span class="w"> </span><span class="mf">-1.0f</span><span class="p">,</span><span class="w"> </span><span class="mf">0.0f</span><span class="p">,</span><span class="w">  </span><span class="mf">1.0f</span><span class="p">,</span><span class="w"> </span><span class="mf">0.0f</span><span class="p">,</span>
<a id="__codelineno-85-68" name="__codelineno-85-68" href="#__codelineno-85-68"></a><span class="w">                 </span><span class="mf">1.0f</span><span class="p">,</span><span class="w">  </span><span class="mf">1.0f</span><span class="p">,</span><span class="w"> </span><span class="mf">0.0f</span><span class="p">,</span><span class="w">  </span><span class="mf">1.0f</span><span class="p">,</span><span class="w"> </span><span class="mf">1.0f</span>
<a id="__codelineno-85-69" name="__codelineno-85-69" href="#__codelineno-85-69"></a><span class="w">            </span><span class="p">};</span>
<a id="__codelineno-85-70" name="__codelineno-85-70" href="#__codelineno-85-70"></a><span class="w">            </span><span class="n">glGenVertexArrays</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span><span class="w"> </span><span class="o">&amp;</span><span class="n">quadVAO</span><span class="p">);</span>
<a id="__codelineno-85-71" name="__codelineno-85-71" href="#__codelineno-85-71"></a><span class="w">            </span><span class="n">glGenBuffers</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span><span class="w"> </span><span class="o">&amp;</span><span class="n">quadVBO</span><span class="p">);</span>
<a id="__codelineno-85-72" name="__codelineno-85-72" href="#__codelineno-85-72"></a><span class="w">            </span><span class="n">glBindVertexArray</span><span class="p">(</span><span class="n">quadVAO</span><span class="p">);</span>
<a id="__codelineno-85-73" name="__codelineno-85-73" href="#__codelineno-85-73"></a><span class="w">            </span><span class="n">glBindBuffer</span><span class="p">(</span><span class="n">GL_ARRAY_BUFFER</span><span class="p">,</span><span class="w"> </span><span class="n">quadVBO</span><span class="p">);</span>
<a id="__codelineno-85-74" name="__codelineno-85-74" href="#__codelineno-85-74"></a><span class="w">            </span><span class="n">glBufferData</span><span class="p">(</span><span class="n">GL_ARRAY_BUFFER</span><span class="p">,</span><span class="w"> </span><span class="k">sizeof</span><span class="p">(</span><span class="n">quadVertices</span><span class="p">),</span><span class="w"> </span><span class="o">&amp;</span><span class="n">quadVertices</span><span class="p">,</span><span class="w"> </span><span class="n">GL_STATIC_DRAW</span><span class="p">);</span>
<a id="__codelineno-85-75" name="__codelineno-85-75" href="#__codelineno-85-75"></a><span class="w">            </span><span class="n">glEnableVertexAttribArray</span><span class="p">(</span><span class="mi">0</span><span class="p">);</span>
<a id="__codelineno-85-76" name="__codelineno-85-76" href="#__codelineno-85-76"></a><span class="w">            </span><span class="n">glVertexAttribPointer</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="w"> </span><span class="mi">3</span><span class="p">,</span><span class="w"> </span><span class="n">GL_FLOAT</span><span class="p">,</span><span class="w"> </span><span class="n">GL_FALSE</span><span class="p">,</span><span class="w"> </span><span class="mi">5</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="k">sizeof</span><span class="p">(</span><span class="n">GLfloat</span><span class="p">),</span><span class="w"> </span><span class="p">(</span><span class="n">GLvoid</span><span class="o">*</span><span class="p">)</span><span class="mi">0</span><span class="p">);</span>
<a id="__codelineno-85-77" name="__codelineno-85-77" href="#__codelineno-85-77"></a><span class="w">            </span><span class="n">glEnableVertexAttribArray</span><span class="p">(</span><span class="mi">1</span><span class="p">);</span>
<a id="__codelineno-85-78" name="__codelineno-85-78" href="#__codelineno-85-78"></a><span class="w">            </span><span class="n">glVertexAttribPointer</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span><span class="w"> </span><span class="mi">2</span><span class="p">,</span><span class="w"> </span><span class="n">GL_FLOAT</span><span class="p">,</span><span class="w"> </span><span class="n">GL_FALSE</span><span class="p">,</span><span class="w"> </span><span class="mi">5</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="k">sizeof</span><span class="p">(</span><span class="n">GLfloat</span><span class="p">),</span><span class="w"> </span><span class="p">(</span><span class="n">GLvoid</span><span class="o">*</span><span class="p">)(</span><span class="mi">3</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="k">sizeof</span><span class="p">(</span><span class="n">GLfloat</span><span class="p">)));</span>
<a id="__codelineno-85-79" name="__codelineno-85-79" href="#__codelineno-85-79"></a><span class="w">        </span><span class="p">}</span>
<a id="__codelineno-85-80" name="__codelineno-85-80" href="#__codelineno-85-80"></a><span class="w">        </span><span class="n">glBindVertexArray</span><span class="p">(</span><span class="n">quadVAO</span><span class="p">);</span>
<a id="__codelineno-85-81" name="__codelineno-85-81" href="#__codelineno-85-81"></a><span class="w">        </span><span class="n">glDrawArrays</span><span class="p">(</span><span class="n">GL_TRIANGLES</span><span class="p">,</span><span class="w"> </span><span class="mi">0</span><span class="p">,</span><span class="w"> </span><span class="mi">6</span><span class="p">);</span>
<a id="__codelineno-85-82" name="__codelineno-85-82" href="#__codelineno-85-82"></a><span class="w">        </span><span class="n">glBindVertexArray</span><span class="p">(</span><span class="mi">0</span><span class="p">);</span>
<a id="__codelineno-85-83" name="__codelineno-85-83" href="#__codelineno-85-83"></a><span class="w">    </span><span class="p">}</span>
<a id="__codelineno-85-84" name="__codelineno-85-84" href="#__codelineno-85-84"></a><span class="p">};</span>
<a id="__codelineno-85-85" name="__codelineno-85-85" href="#__codelineno-85-85"></a>
<a id="__codelineno-85-86" name="__codelineno-85-86" href="#__codelineno-85-86"></a><span class="cp">#endif </span><span class="c1">// BLOOMEFFECT_H</span>
</code></pre></div>
<h3 id="bloomeffectcpp">BloomEffect.cpp</h3>
<div class="highlight"><pre><span></span><code><a id="__codelineno-86-1" name="__codelineno-86-1" href="#__codelineno-86-1"></a><span class="cp">#include</span><span class="w"> </span><span class="cpf">&quot;BloomEffect.h&quot;</span>
<a id="__codelineno-86-2" name="__codelineno-86-2" href="#__codelineno-86-2"></a>
<a id="__codelineno-86-3" name="__codelineno-86-3" href="#__codelineno-86-3"></a><span class="n">BloomEffect</span><span class="o">::</span><span class="n">BloomEffect</span><span class="p">()</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-86-4" name="__codelineno-86-4" href="#__codelineno-86-4"></a><span class="w">    </span><span class="c1">// Load shaders</span>
<a id="__codelineno-86-5" name="__codelineno-86-5" href="#__codelineno-86-5"></a><span class="w">    </span><span class="n">brightPassShader</span><span class="p">.</span><span class="n">load</span><span class="p">(</span><span class="s">&quot;shaders/bloom.vert&quot;</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;shaders/bright_pass.frag&quot;</span><span class="p">);</span>
<a id="__codelineno-86-6" name="__codelineno-86-6" href="#__codelineno-86-6"></a><span class="w">    </span><span class="n">blurShader</span><span class="p">.</span><span class="n">load</span><span class="p">(</span><span class="s">&quot;shaders/bloom.vert&quot;</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;shaders/blur.frag&quot;</span><span class="p">);</span>
<a id="__codelineno-86-7" name="__codelineno-86-7" href="#__codelineno-86-7"></a>
<a id="__codelineno-86-8" name="__codelineno-86-8" href="#__codelineno-86-8"></a><span class="w">    </span><span class="c1">// Initialize weights for Gaussian blur</span>
<a id="__codelineno-86-9" name="__codelineno-86-9" href="#__codelineno-86-9"></a><span class="w">    </span><span class="n">weights</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mf">0.227027</span><span class="p">;</span>
<a id="__codelineno-86-10" name="__codelineno-86-10" href="#__codelineno-86-10"></a><span class="w">    </span><span class="n">weights</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mf">0.1945946</span><span class="p">;</span>
<a id="__codelineno-86-11" name="__codelineno-86-11" href="#__codelineno-86-11"></a><span class="w">    </span><span class="n">weights</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mf">0.1216216</span><span class="p">;</span>
<a id="__codelineno-86-12" name="__codelineno-86-12" href="#__codelineno-86-12"></a><span class="w">    </span><span class="n">weights</span><span class="p">[</span><span class="mi">3</span><span class="p">]</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mf">0.054054</span><span class="p">;</span>
<a id="__codelineno-86-13" name="__codelineno-86-13" href="#__codelineno-86-13"></a><span class="w">    </span><span class="n">weights</span><span class="p">[</span><span class="mi">4</span><span class="p">]</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mf">0.016216</span><span class="p">;</span>
<a id="__codelineno-86-14" name="__codelineno-86-14" href="#__codelineno-86-14"></a>
<a id="__codelineno-86-15" name="__codelineno-86-15" href="#__codelineno-86-15"></a><span class="w">    </span><span class="c1">// Generate framebuffers and textures for pingponging</span>
<a id="__codelineno-86-16" name="__codelineno-86-16" href="#__codelineno-86-16"></a><span class="w">    </span><span class="n">glGenFramebuffers</span><span class="p">(</span><span class="mi">2</span><span class="p">,</span><span class="w"> </span><span class="n">pingpongFBO</span><span class="p">);</span>
<a id="__codelineno-86-17" name="__codelineno-86-17" href="#__codelineno-86-17"></a><span class="w">    </span><span class="n">glGenTextures</span><span class="p">(</span><span class="mi">2</span><span class="p">,</span><span class="w"> </span><span class="n">pingpongColorbuffers</span><span class="p">);</span>
<a id="__codelineno-86-18" name="__codelineno-86-18" href="#__codelineno-86-18"></a><span class="w">    </span><span class="k">for</span><span class="w"> </span><span class="p">(</span><span class="kt">unsigned</span><span class="w"> </span><span class="kt">int</span><span class="w"> </span><span class="n">i</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">0</span><span class="p">;</span><span class="w"> </span><span class="n">i</span><span class="w"> </span><span class="o">&lt;</span><span class="w"> </span><span class="mi">2</span><span class="p">;</span><span class="w"> </span><span class="o">++</span><span class="n">i</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-86-19" name="__codelineno-86-19" href="#__codelineno-86-19"></a><span class="w">        </span><span class="n">glBindFramebuffer</span><span class="p">(</span><span class="n">GL_FRAMEBUFFER</span><span class="p">,</span><span class="w"> </span><span class="n">pingpongFBO</span><span class="p">[</span><span class="n">i</span><span class="p">]);</span>
<a id="__codelineno-86-20" name="__codelineno-86-20" href="#__codelineno-86-20"></a><span class="w">        </span><span class="n">glBindTexture</span><span class="p">(</span><span class="n">GL_TEXTURE_2D</span><span class="p">,</span><span class="w"> </span><span class="n">pingpongColorbuffers</span><span class="p">[</span><span class="n">i</span><span class="p">]);</span>
<a id="__codelineno-86-21" name="__codelineno-86-21" href="#__codelineno-86-21"></a><span class="w">        </span><span class="n">glTexImage2D</span><span class="p">(</span><span class="n">GL_TEXTURE_2D</span><span class="p">,</span><span class="w"> </span><span class="mi">0</span><span class="p">,</span><span class="w"> </span><span class="n">GL_RGBA16F</span><span class="p">,</span><span class="w"> </span><span class="mi">800</span><span class="p">,</span><span class="w"> </span><span class="mi">600</span><span class="p">,</span><span class="w"> </span><span class="mi">0</span><span class="p">,</span><span class="w"> </span><span class="n">GL_RGBA</span><span class="p">,</span><span class="w"> </span><span class="n">GL_FLOAT</span><span class="p">,</span><span class="w"> </span><span class="k">nullptr</span><span class="p">);</span>
<a id="__codelineno-86-22" name="__codelineno-86-22" href="#__codelineno-86-22"></a><span class="w">        </span><span class="n">glTexParameteri</span><span class="p">(</span><span class="n">GL_TEXTURE_2D</span><span class="p">,</span><span class="w"> </span><span class="n">GL_TEXTURE_MIN_FILTER</span><span class="p">,</span><span class="w"> </span><span class="n">GL_LINEAR</span><span class="p">);</span>
<a id="__codelineno-86-23" name="__codelineno-86-23" href="#__codelineno-86-23"></a><span class="w">        </span><span class="n">glTexParameteri</span><span class="p">(</span><span class="n">GL_TEXTURE_2D</span><span class="p">,</span><span class="w"> </span><span class="n">GL_TEXTURE_MAG_FILTER</span><span class="p">,</span><span class="w"> </span><span class="n">GL_LINEAR</span><span class="p">);</span>
<a id="__codelineno-86-24" name="__codelineno-86-24" href="#__codelineno-86-24"></a><span class="w">        </span><span class="n">glFramebufferTexture2D</span><span class="p">(</span><span class="n">GL_FRAMEBUFFER</span><span class="p">,</span><span class="w"> </span><span class="n">GL_COLOR_ATTACHMENT0</span><span class="p">,</span><span class="w"> </span><span class="n">GL_TEXTURE_2D</span><span class="p">,</span><span class="w"> </span><span class="n">pingpongColorbuffers</span><span class="p">[</span><span class="n">i</span><span class="p">],</span><span class="w"> </span><span class="mi">0</span><span class="p">);</span>
<a id="__codelineno-86-25" name="__codelineno-86-25" href="#__codelineno-86-25"></a><span class="w">        </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">glCheckFramebufferStatus</span><span class="p">(</span><span class="n">GL_FRAMEBUFFER</span><span class="p">)</span><span class="w"> </span><span class="o">!=</span><span class="w"> </span><span class="n">GL_FRAMEBUFFER_COMPLETE</span><span class="p">)</span>
<a id="__codelineno-86-26" name="__codelineno-86-26" href="#__codelineno-86-26"></a><span class="w">            </span><span class="n">std</span><span class="o">::</span><span class="n">cout</span><span class="w"> </span><span class="o">&lt;&lt;</span><span class="w"> </span><span class="s">&quot;Framebuffer not complete!&quot;</span><span class="w"> </span><span class="o">&lt;&lt;</span><span class="w"> </span><span class="n">std</span><span class="o">::</span><span class="n">endl</span><span class="p">;</span>
<a id="__codelineno-86-27" name="__codelineno-86-27" href="#__codelineno-86-27"></a><span class="w">    </span><span class="p">}</span>
<a id="__codelineno-86-28" name="__codelineno-86-28" href="#__codelineno-86-28"></a><span class="p">}</span>
<a id="__codelineno-86-29" name="__codelineno-86-29" href="#__codelineno-86-29"></a>
<a id="__codelineno-86-30" name="__codelineno-86-30" href="#__codelineno-86-30"></a><span class="kt">void</span><span class="w"> </span><span class="n">BloomEffect</span><span class="o">::</span><span class="n">Apply</span><span class="p">(</span><span class="n">GLuint</span><span class="w"> </span><span class="n">inputTexture</span><span class="p">,</span><span class="w"> </span><span class="n">GLuint</span><span class="w"> </span><span class="n">outputFBO</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-86-31" name="__codelineno-86-31" href="#__codelineno-86-31"></a><span class="w">    </span><span class="c1">// Step 1: Bright pass</span>
<a id="__codelineno-86-32" name="__codelineno-86-32" href="#__codelineno-86-32"></a><span class="w">    </span><span class="n">glBindFramebuffer</span><span class="p">(</span><span class="n">GL_FRAMEBUFFER</span><span class="p">,</span><span class="w"> </span><span class="n">pingpongFBO</span><span class="p">[</span><span class="mi">0</span><span class="p">]);</span>
<a id="__codelineno-86-33" name="__codelineno-86-33" href="#__codelineno-86-33"></a><span class="w">    </span><span class="n">brightPassShader</span><span class="p">.</span><span class="n">use</span><span class="p">();</span>
<a id="__codelineno-86-34" name="__codelineno-86-34" href="#__codelineno-86-34"></a><span class="w">    </span><span class="n">BindTexture</span><span class="p">(</span><span class="n">inputTexture</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;scene&quot;</span><span class="p">,</span><span class="w"> </span><span class="mi">0</span><span class="p">);</span>
<a id="__codelineno-86-35" name="__codelineno-86-35" href="#__codelineno-86-35"></a><span class="w">    </span><span class="n">RenderQuad</span><span class="p">();</span>
<a id="__codelineno-86-36" name="__codelineno-86-36" href="#__codelineno-86-36"></a>
<a id="__codelineno-86-37" name="__codelineno-86-37" href="#__codelineno-86-37"></a><span class="w">    </span><span class="c1">// Step 2: Gaussian blur</span>
<a id="__codelineno-86-38" name="__codelineno-86-38" href="#__codelineno-86-38"></a><span class="w">    </span><span class="kt">bool</span><span class="w"> </span><span class="n">horizontal</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nb">true</span><span class="p">,</span><span class="w"> </span><span class="n">firstIteration</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nb">true</span><span class="p">;</span>
<a id="__codelineno-86-39" name="__codelineno-86-39" href="#__codelineno-86-39"></a><span class="w">    </span><span class="n">blurShader</span><span class="p">.</span><span class="n">use</span><span class="p">();</span>
<a id="__codelineno-86-40" name="__codelineno-86-40" href="#__codelineno-86-40"></a><span class="w">    </span><span class="k">for</span><span class="w"> </span><span class="p">(</span><span class="kt">unsigned</span><span class="w"> </span><span class="kt">int</span><span class="w"> </span><span class="n">i</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">0</span><span class="p">;</span><span class="w"> </span><span class="n">i</span><span class="w"> </span><span class="o">&lt;</span><span class="w"> </span><span class="mi">10</span><span class="p">;</span><span class="w"> </span><span class="o">++</span><span class="n">i</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-86-41" name="__codelineno-86-41" href="#__codelineno-86-41"></a><span class="w">        </span><span class="n">glBindFramebuffer</span><span class="p">(</span><span class="n">GL_FRAMEBUFFER</span><span class="p">,</span><span class="w"> </span><span class="n">pingpongFBO</span><span class="p">[</span><span class="n">horizontal</span><span class="p">]);</span>
<a id="__codelineno-86-42" name="__codelineno-86-42" href="#__codelineno-86-42"></a><span class="w">        </span><span class="n">blurShader</span><span class="p">.</span><span class="n">setInt</span><span class="p">(</span><span class="s">&quot;horizontal&quot;</span><span class="p">,</span><span class="w"> </span><span class="n">horizontal</span><span class="p">);</span>
<a id="__codelineno-86-43" name="__codelineno-86-43" href="#__codelineno-86-43"></a><span class="w">        </span><span class="n">blurShader</span><span class="p">.</span><span class="n">setFloatArray</span><span class="p">(</span><span class="s">&quot;weight&quot;</span><span class="p">,</span><span class="w"> </span><span class="n">weights</span><span class="p">,</span><span class="w"> </span><span class="mi">5</span><span class="p">);</span>
<a id="__codelineno-86-44" name="__codelineno-86-44" href="#__codelineno-86-44"></a><span class="w">        </span><span class="n">BindTexture</span><span class="p">(</span><span class="n">firstIteration</span><span class="w"> </span><span class="o">?</span><span class="w"> </span><span class="n">pingpongColorbuffers</span><span class="p">[</span>
<a id="__codelineno-86-45" name="__codelineno-86-45" href="#__codelineno-86-45"></a>
<a id="__codelineno-86-46" name="__codelineno-86-46" href="#__codelineno-86-46"></a><span class="mi">0</span><span class="p">]</span><span class="w"> </span><span class="o">:</span><span class="w"> </span><span class="n">pingpongColorbuffers</span><span class="p">[</span><span class="o">!</span><span class="n">horizontal</span><span class="p">],</span><span class="w"> </span><span class="s">&quot;image&quot;</span><span class="p">,</span><span class="w"> </span><span class="mi">0</span><span class="p">);</span>
<a id="__codelineno-86-47" name="__codelineno-86-47" href="#__codelineno-86-47"></a><span class="w">        </span><span class="n">RenderQuad</span><span class="p">();</span>
<a id="__codelineno-86-48" name="__codelineno-86-48" href="#__codelineno-86-48"></a><span class="w">        </span><span class="n">horizontal</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="o">!</span><span class="n">horizontal</span><span class="p">;</span>
<a id="__codelineno-86-49" name="__codelineno-86-49" href="#__codelineno-86-49"></a><span class="w">        </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">firstIteration</span><span class="p">)</span><span class="w"> </span><span class="n">firstIteration</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nb">false</span><span class="p">;</span>
<a id="__codelineno-86-50" name="__codelineno-86-50" href="#__codelineno-86-50"></a><span class="w">    </span><span class="p">}</span>
<a id="__codelineno-86-51" name="__codelineno-86-51" href="#__codelineno-86-51"></a>
<a id="__codelineno-86-52" name="__codelineno-86-52" href="#__codelineno-86-52"></a><span class="w">    </span><span class="c1">// Combine blurred texture with the original scene</span>
<a id="__codelineno-86-53" name="__codelineno-86-53" href="#__codelineno-86-53"></a><span class="w">    </span><span class="n">glBindFramebuffer</span><span class="p">(</span><span class="n">GL_FRAMEBUFFER</span><span class="p">,</span><span class="w"> </span><span class="n">outputFBO</span><span class="p">);</span>
<a id="__codelineno-86-54" name="__codelineno-86-54" href="#__codelineno-86-54"></a><span class="w">    </span><span class="n">shader</span><span class="p">.</span><span class="n">use</span><span class="p">();</span>
<a id="__codelineno-86-55" name="__codelineno-86-55" href="#__codelineno-86-55"></a><span class="w">    </span><span class="n">BindTexture</span><span class="p">(</span><span class="n">inputTexture</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;scene&quot;</span><span class="p">,</span><span class="w"> </span><span class="mi">0</span><span class="p">);</span>
<a id="__codelineno-86-56" name="__codelineno-86-56" href="#__codelineno-86-56"></a><span class="w">    </span><span class="n">BindTexture</span><span class="p">(</span><span class="n">pingpongColorbuffers</span><span class="p">[</span><span class="o">!</span><span class="n">horizontal</span><span class="p">],</span><span class="w"> </span><span class="s">&quot;bloomBlur&quot;</span><span class="p">,</span><span class="w"> </span><span class="mi">1</span><span class="p">);</span>
<a id="__codelineno-86-57" name="__codelineno-86-57" href="#__codelineno-86-57"></a><span class="w">    </span><span class="n">RenderQuad</span><span class="p">();</span>
<a id="__codelineno-86-58" name="__codelineno-86-58" href="#__codelineno-86-58"></a><span class="p">}</span>
</code></pre></div>
<h3 id="explanation-of-the-bloom-effect-implementation">Explanation of the Bloom Effect Implementation</h3>
<ol>
<li>
<p><strong>Bloom Effect Initialization</strong>:</p>
<ul>
<li>Load the shaders for the bright pass and Gaussian blur stages.</li>
<li>Initialize the Gaussian weights for the blur.</li>
<li>Generate the framebuffers and textures needed for ping-ponging (intermediate steps of the effect).</li>
</ul>
</li>
<li>
<p><strong>Bright Pass Shader</strong>:</p>
<ul>
<li>Extracts the bright areas of the scene based on a threshold.</li>
<li>Sets any pixel below the threshold to black and others to their original color.</li>
</ul>
</li>
<li>
<p><strong>Blur Shader</strong>:</p>
<ul>
<li>Applies a horizontal and vertical Gaussian blur.</li>
<li>Uses texture offsets and weights to sample surrounding pixels and blur the bright areas.</li>
</ul>
</li>
<li>
<p><strong>Combining the Effects</strong>:</p>
<ul>
<li>After applying the blur, the blurred texture is combined with the original scene texture.</li>
<li>The result is written to the output framebuffer.</li>
</ul>
</li>
</ol>
<p>This implementation is modular, allowing additional effects to be easily integrated into the post-processing pipeline.</p>
<h2 id="graphics-apis">Graphics APIs</h2>
<ul>
<li>OpenGL</li>
<li>DirectX</li>
<li>Vulkan</li>
<li>Metal</li>
</ul>












                
              </article>
            </div>
          
          
  <script>var tabs=__md_get("__tabs");if(Array.isArray(tabs))e:for(var set of document.querySelectorAll(".tabbed-set")){var tab,labels=set.querySelector(".tabbed-labels");for(tab of tabs)for(var label of labels.getElementsByTagName("label"))if(label.innerText.trim()===tab){var input=document.getElementById(label.htmlFor);input.checked=!0;continue e}}</script>

<script>var target=document.getElementById(location.hash.slice(1));target&&target.name&&(target.checked=target.name.startsWith("__tabbed_"))</script>
        </div>
        
          <button type="button" class="md-top md-icon" data-md-component="top" hidden>
  
  <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M13 20h-2V8l-5.5 5.5-1.42-1.42L12 4.16l7.92 7.92-1.42 1.42L13 8v12Z"/></svg>
  Back to top
</button>
        
      </main>
      
        <footer class="md-footer">
  
  <div class="md-footer-meta md-typeset">
    <div class="md-footer-meta__inner md-grid">
      <div class="md-copyright">
  
  
    Made with
    <a href="https://squidfunk.github.io/mkdocs-material/" target="_blank" rel="noopener">
      Material for MkDocs
    </a>
  
</div>
      
    </div>
  </div>
</footer>
      
    </div>
    <div class="md-dialog" data-md-component="dialog">
      <div class="md-dialog__inner md-typeset"></div>
    </div>
    
    
    <script id="__config" type="application/json">{"base": "..", "features": ["navigation.tabs", "navigation.sections", "toc.integrate", "navigation.top", "search.suggest", "search.highlight", "content.tabs.link", "content.code.annotation", "content.code.copy"], "search": "../assets/javascripts/workers/search.b8dbb3d2.min.js", "translations": {"clipboard.copied": "Copied to clipboard", "clipboard.copy": "Copy to clipboard", "search.result.more.one": "1 more on this page", "search.result.more.other": "# more on this page", "search.result.none": "No matching documents", "search.result.one": "1 matching document", "search.result.other": "# matching documents", "search.result.placeholder": "Type to start searching", "search.result.term.missing": "Missing", "select.version": "Select version"}}</script>
    
    
      <script src="../assets/javascripts/bundle.fe8b6f2b.min.js"></script>
      
        <script src="https://polyfill.io/v3/polyfill.min.js?features=es6"></script>
      
        <script src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-mml-chtml.js"></script>
      
    
  </body>
</html>