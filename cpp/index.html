
<!doctype html>
<html lang="en" class="no-js">
  <head>
    
      <meta charset="utf-8">
      <meta name="viewport" content="width=device-width,initial-scale=1">
      
      
      
      
        <link rel="prev" href="..">
      
      
        <link rel="next" href="../dsa/">
      
      
      <link rel="icon" href="../assets/images/favicon.png">
      <meta name="generator" content="mkdocs-1.6.0, mkdocs-material-9.5.28">
    
    
      
        <title>C++ - Game Development</title>
      
    
    
      <link rel="stylesheet" href="../assets/stylesheets/main.6543a935.min.css">
      
        
        <link rel="stylesheet" href="../assets/stylesheets/palette.06af60db.min.css">
      
      


    
    
      
    
    
      
        
        
        <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
        <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Roboto:300,300i,400,400i,700,700i%7CRoboto+Mono:400,400i,700,700i&display=fallback">
        <style>:root{--md-text-font:"Roboto";--md-code-font:"Roboto Mono"}</style>
      
    
    
    <script>__md_scope=new URL("..",location),__md_hash=e=>[...e].reduce((e,_)=>(e<<5)-e+_.charCodeAt(0),0),__md_get=(e,_=localStorage,t=__md_scope)=>JSON.parse(_.getItem(t.pathname+"."+e)),__md_set=(e,_,t=localStorage,a=__md_scope)=>{try{t.setItem(a.pathname+"."+e,JSON.stringify(_))}catch(e){}}</script>
    
      

    
    
    
  </head>
  
  
    
    
      
    
    
    
    
    <body dir="ltr" data-md-color-scheme="default" data-md-color-primary="indigo" data-md-color-accent="indigo">
  
    
    <input class="md-toggle" data-md-toggle="drawer" type="checkbox" id="__drawer" autocomplete="off">
    <input class="md-toggle" data-md-toggle="search" type="checkbox" id="__search" autocomplete="off">
    <label class="md-overlay" for="__drawer"></label>
    <div data-md-component="skip">
      
        
        <a href="#c-for-game-development" class="md-skip">
          Skip to content
        </a>
      
    </div>
    <div data-md-component="announce">
      
    </div>
    
    
      

<header class="md-header" data-md-component="header">
  <nav class="md-header__inner md-grid" aria-label="Header">
    <a href=".." title="Game Development" class="md-header__button md-logo" aria-label="Game Development" data-md-component="logo">
      
  
  <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M12 8a3 3 0 0 0 3-3 3 3 0 0 0-3-3 3 3 0 0 0-3 3 3 3 0 0 0 3 3m0 3.54C9.64 9.35 6.5 8 3 8v11c3.5 0 6.64 1.35 9 3.54 2.36-2.19 5.5-3.54 9-3.54V8c-3.5 0-6.64 1.35-9 3.54Z"/></svg>

    </a>
    <label class="md-header__button md-icon" for="__drawer">
      
      <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M3 6h18v2H3V6m0 5h18v2H3v-2m0 5h18v2H3v-2Z"/></svg>
    </label>
    <div class="md-header__title" data-md-component="header-title">
      <div class="md-header__ellipsis">
        <div class="md-header__topic">
          <span class="md-ellipsis">
            Game Development
          </span>
        </div>
        <div class="md-header__topic" data-md-component="header-topic">
          <span class="md-ellipsis">
            
              C++
            
          </span>
        </div>
      </div>
    </div>
    
      
        <form class="md-header__option" data-md-component="palette">
  
    
    
    
    <input class="md-option" data-md-color-media="" data-md-color-scheme="default" data-md-color-primary="indigo" data-md-color-accent="indigo"  aria-label="Switch to dark mode"  type="radio" name="__palette" id="__palette_0">
    
      <label class="md-header__button md-icon" title="Switch to dark mode" for="__palette_1" hidden>
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M17 6H7c-3.31 0-6 2.69-6 6s2.69 6 6 6h10c3.31 0 6-2.69 6-6s-2.69-6-6-6zm0 10H7c-2.21 0-4-1.79-4-4s1.79-4 4-4h10c2.21 0 4 1.79 4 4s-1.79 4-4 4zM7 9c-1.66 0-3 1.34-3 3s1.34 3 3 3 3-1.34 3-3-1.34-3-3-3z"/></svg>
      </label>
    
  
    
    
    
    <input class="md-option" data-md-color-media="" data-md-color-scheme="slate" data-md-color-primary="indigo" data-md-color-accent="indigo"  aria-label="Switch to light mode"  type="radio" name="__palette" id="__palette_1">
    
      <label class="md-header__button md-icon" title="Switch to light mode" for="__palette_0" hidden>
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M17 7H7a5 5 0 0 0-5 5 5 5 0 0 0 5 5h10a5 5 0 0 0 5-5 5 5 0 0 0-5-5m0 8a3 3 0 0 1-3-3 3 3 0 0 1 3-3 3 3 0 0 1 3 3 3 3 0 0 1-3 3Z"/></svg>
      </label>
    
  
</form>
      
    
    
      <script>var media,input,key,value,palette=__md_get("__palette");if(palette&&palette.color){"(prefers-color-scheme)"===palette.color.media&&(media=matchMedia("(prefers-color-scheme: light)"),input=document.querySelector(media.matches?"[data-md-color-media='(prefers-color-scheme: light)']":"[data-md-color-media='(prefers-color-scheme: dark)']"),palette.color.media=input.getAttribute("data-md-color-media"),palette.color.scheme=input.getAttribute("data-md-color-scheme"),palette.color.primary=input.getAttribute("data-md-color-primary"),palette.color.accent=input.getAttribute("data-md-color-accent"));for([key,value]of Object.entries(palette.color))document.body.setAttribute("data-md-color-"+key,value)}</script>
    
    
    
      <label class="md-header__button md-icon" for="__search">
        
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.516 6.516 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5Z"/></svg>
      </label>
      <div class="md-search" data-md-component="search" role="dialog">
  <label class="md-search__overlay" for="__search"></label>
  <div class="md-search__inner" role="search">
    <form class="md-search__form" name="search">
      <input type="text" class="md-search__input" name="query" aria-label="Search" placeholder="Search" autocapitalize="off" autocorrect="off" autocomplete="off" spellcheck="false" data-md-component="search-query" required>
      <label class="md-search__icon md-icon" for="__search">
        
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.516 6.516 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5Z"/></svg>
        
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11h12Z"/></svg>
      </label>
      <nav class="md-search__options" aria-label="Search">
        
        <button type="reset" class="md-search__icon md-icon" title="Clear" aria-label="Clear" tabindex="-1">
          
          <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M19 6.41 17.59 5 12 10.59 6.41 5 5 6.41 10.59 12 5 17.59 6.41 19 12 13.41 17.59 19 19 17.59 13.41 12 19 6.41Z"/></svg>
        </button>
      </nav>
      
        <div class="md-search__suggest" data-md-component="search-suggest"></div>
      
    </form>
    <div class="md-search__output">
      <div class="md-search__scrollwrap" tabindex="0" data-md-scrollfix>
        <div class="md-search-result" data-md-component="search-result">
          <div class="md-search-result__meta">
            Initializing search
          </div>
          <ol class="md-search-result__list" role="presentation"></ol>
        </div>
      </div>
    </div>
  </div>
</div>
    
    
  </nav>
  
</header>
    
    <div class="md-container" data-md-component="container">
      
      
        
          
            
<nav class="md-tabs" aria-label="Tabs" data-md-component="tabs">
  <div class="md-grid">
    <ul class="md-tabs__list">
      
        
  
  
  
    <li class="md-tabs__item">
      <a href=".." class="md-tabs__link">
        
  
    
  
  Home

      </a>
    </li>
  

      
        
  
  
    
  
  
    <li class="md-tabs__item md-tabs__item--active">
      <a href="./" class="md-tabs__link">
        
  
    
  
  C++

      </a>
    </li>
  

      
        
  
  
  
    
    
      <li class="md-tabs__item">
        <a href="../dsa/" class="md-tabs__link">
          
  
  Core Concepts

        </a>
      </li>
    
  

      
        
  
  
  
    
    
      <li class="md-tabs__item">
        <a href="../graphics/" class="md-tabs__link">
          
  
  Graphics

        </a>
      </li>
    
  

      
        
  
  
  
    <li class="md-tabs__item">
      <a href="../patterns/" class="md-tabs__link">
        
  
    
  
  Programming Patterns

      </a>
    </li>
  

      
        
  
  
  
    
    
      <li class="md-tabs__item">
        <a href="../ai/" class="md-tabs__link">
          
  
  AI

        </a>
      </li>
    
  

      
        
  
  
  
    <li class="md-tabs__item">
      <a href="../engine/" class="md-tabs__link">
        
  
    
  
  Game Engine Architecture

      </a>
    </li>
  

      
        
  
  
  
    <li class="md-tabs__item">
      <a href="../algorithms/" class="md-tabs__link">
        
  
    
  
  Algorithms

      </a>
    </li>
  

      
        
  
  
  
    <li class="md-tabs__item">
      <a href="../intersections/" class="md-tabs__link">
        
  
    
  
  Intersections

      </a>
    </li>
  

      
        
  
  
  
    <li class="md-tabs__item">
      <a href="../graph/" class="md-tabs__link">
        
  
    
  
  Graph

      </a>
    </li>
  

      
        
  
  
  
    <li class="md-tabs__item">
      <a href="../gameplay/" class="md-tabs__link">
        
  
    
  
  Gameplay

      </a>
    </li>
  

      
        
  
  
  
    <li class="md-tabs__item">
      <a href="../maths/" class="md-tabs__link">
        
  
    
  
  Maths

      </a>
    </li>
  

      
    </ul>
  </div>
</nav>
          
        
      
      <main class="md-main" data-md-component="main">
        <div class="md-main__inner md-grid">
          
            
              
              <div class="md-sidebar md-sidebar--primary" data-md-component="sidebar" data-md-type="navigation" >
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    


  


  

<nav class="md-nav md-nav--primary md-nav--lifted md-nav--integrated" aria-label="Navigation" data-md-level="0">
  <label class="md-nav__title" for="__drawer">
    <a href=".." title="Game Development" class="md-nav__button md-logo" aria-label="Game Development" data-md-component="logo">
      
  
  <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M12 8a3 3 0 0 0 3-3 3 3 0 0 0-3-3 3 3 0 0 0-3 3 3 3 0 0 0 3 3m0 3.54C9.64 9.35 6.5 8 3 8v11c3.5 0 6.64 1.35 9 3.54 2.36-2.19 5.5-3.54 9-3.54V8c-3.5 0-6.64 1.35-9 3.54Z"/></svg>

    </a>
    Game Development
  </label>
  
  <ul class="md-nav__list" data-md-scrollfix>
    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href=".." class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Home
  </span>
  

      </a>
    </li>
  

    
      
      
  
  
    
  
  
  
    <li class="md-nav__item md-nav__item--active">
      
      <input class="md-nav__toggle md-toggle" type="checkbox" id="__toc">
      
      
        
      
      
        <label class="md-nav__link md-nav__link--active" for="__toc">
          
  
  <span class="md-ellipsis">
    C++
  </span>
  

          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <a href="./" class="md-nav__link md-nav__link--active">
        
  
  <span class="md-ellipsis">
    C++
  </span>
  

      </a>
      
        

<nav class="md-nav md-nav--secondary" aria-label="Table of contents">
  
  
  
    
  
  
    <label class="md-nav__title" for="__toc">
      <span class="md-nav__icon md-icon"></span>
      Table of contents
    </label>
    <ul class="md-nav__list" data-md-component="toc" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#table-of-contents" class="md-nav__link">
    <span class="md-ellipsis">
      Table of Contents
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#structure-and-layout" class="md-nav__link">
    <span class="md-ellipsis">
      Structure And Layout
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Structure And Layout">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#memory-segments" class="md-nav__link">
    <span class="md-ellipsis">
      Memory Segments
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#memory-layout" class="md-nav__link">
    <span class="md-ellipsis">
      Memory Layout
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#detailed-example" class="md-nav__link">
    <span class="md-ellipsis">
      Detailed Example
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Detailed Example">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#1-simple-object" class="md-nav__link">
    <span class="md-ellipsis">
      1. Simple Object:
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#2-object-with-virtual-and-static-members" class="md-nav__link">
    <span class="md-ellipsis">
      2. Object with virtual and static members:
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#3-object-with-inheritance" class="md-nav__link">
    <span class="md-ellipsis">
      3. Object with inheritance:
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#4-object-with-multiple-inheritances-and-virtual-functions" class="md-nav__link">
    <span class="md-ellipsis">
      4. Object with Multiple inheritances and virtual functions:
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#memory-management" class="md-nav__link">
    <span class="md-ellipsis">
      Memory Management
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#memory-layout-and-alignment" class="md-nav__link">
    <span class="md-ellipsis">
      Memory Layout and Alignment
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Memory Layout and Alignment">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#data-alignment-and-padding" class="md-nav__link">
    <span class="md-ellipsis">
      Data Alignment and Padding
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Data Alignment and Padding">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#example-data-alignment" class="md-nav__link">
    <span class="md-ellipsis">
      Example: Data Alignment
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#example-avoiding-excessive-padding" class="md-nav__link">
    <span class="md-ellipsis">
      Example: Avoiding Excessive Padding
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#definition" class="md-nav__link">
    <span class="md-ellipsis">
      Definition
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#how-to" class="md-nav__link">
    <span class="md-ellipsis">
      How To
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#cache-friendly-data-structures" class="md-nav__link">
    <span class="md-ellipsis">
      Cache-Friendly Data Structures
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Cache-Friendly Data Structures">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#example-cache-friendly-linked-list" class="md-nav__link">
    <span class="md-ellipsis">
      Example: Cache-Friendly Linked List
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#conclusion" class="md-nav__link">
    <span class="md-ellipsis">
      Conclusion
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#compilation-and-execution" class="md-nav__link">
    <span class="md-ellipsis">
      Compilation And execution
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Compilation And execution">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#1-preprocessing" class="md-nav__link">
    <span class="md-ellipsis">
      1. Preprocessing
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#2-compilation" class="md-nav__link">
    <span class="md-ellipsis">
      2. Compilation
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#3-assembly" class="md-nav__link">
    <span class="md-ellipsis">
      3. Assembly
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#4-linking" class="md-nav__link">
    <span class="md-ellipsis">
      4. Linking
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#5-loading" class="md-nav__link">
    <span class="md-ellipsis">
      5. Loading
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#build-model" class="md-nav__link">
    <span class="md-ellipsis">
      Build Model
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#c-build-process" class="md-nav__link">
    <span class="md-ellipsis">
      C++ Build Process
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#detailed-example_1" class="md-nav__link">
    <span class="md-ellipsis">
      Detailed Example
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Detailed Example">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#preprocessing" class="md-nav__link">
    <span class="md-ellipsis">
      Preprocessing
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#compilation" class="md-nav__link">
    <span class="md-ellipsis">
      Compilation
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#assembly" class="md-nav__link">
    <span class="md-ellipsis">
      Assembly
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#linking" class="md-nav__link">
    <span class="md-ellipsis">
      Linking
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#loading" class="md-nav__link">
    <span class="md-ellipsis">
      Loading
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#inline-assembly-in-c" class="md-nav__link">
    <span class="md-ellipsis">
      Inline Assembly in C++
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Inline Assembly in C++">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#basics-of-inline-assembly" class="md-nav__link">
    <span class="md-ellipsis">
      Basics of Inline Assembly
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Basics of Inline Assembly">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#syntax" class="md-nav__link">
    <span class="md-ellipsis">
      Syntax
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#gccclang-inline-assembly" class="md-nav__link">
    <span class="md-ellipsis">
      GCC/Clang Inline Assembly
    </span>
  </a>
  
    <nav class="md-nav" aria-label="GCC/Clang Inline Assembly">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#basic-inline-assembly" class="md-nav__link">
    <span class="md-ellipsis">
      Basic Inline Assembly
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#extended-inline-assembly" class="md-nav__link">
    <span class="md-ellipsis">
      Extended Inline Assembly
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#msvc-inline-assembly" class="md-nav__link">
    <span class="md-ellipsis">
      MSVC Inline Assembly
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#constraints-and-clobbered-registers" class="md-nav__link">
    <span class="md-ellipsis">
      Constraints and Clobbered Registers
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#use-cases" class="md-nav__link">
    <span class="md-ellipsis">
      Use Cases
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#best-practices" class="md-nav__link">
    <span class="md-ellipsis">
      Best Practices
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#conclusion_1" class="md-nav__link">
    <span class="md-ellipsis">
      Conclusion
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#inline-functions-and-link-time-optimization-lto" class="md-nav__link">
    <span class="md-ellipsis">
      Inline Functions and Link-Time Optimization (LTO)
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Inline Functions and Link-Time Optimization (LTO)">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#using-inline-functions-for-performance" class="md-nav__link">
    <span class="md-ellipsis">
      Using Inline Functions for Performance
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#declaring-inline-functions" class="md-nav__link">
    <span class="md-ellipsis">
      Declaring Inline Functions
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#benefits-of-inline-functions" class="md-nav__link">
    <span class="md-ellipsis">
      Benefits of Inline Functions
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Benefits of Inline Functions">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#drawbacks-of-inline-functions" class="md-nav__link">
    <span class="md-ellipsis">
      Drawbacks of Inline Functions
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#example" class="md-nav__link">
    <span class="md-ellipsis">
      Example
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#link-time-optimization-lto" class="md-nav__link">
    <span class="md-ellipsis">
      Link-Time Optimization (LTO)
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Link-Time Optimization (LTO)">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#enabling-lto" class="md-nav__link">
    <span class="md-ellipsis">
      Enabling LTO
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#benefits-of-lto" class="md-nav__link">
    <span class="md-ellipsis">
      Benefits of LTO
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Benefits of LTO">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#example-of-lto-benefits" class="md-nav__link">
    <span class="md-ellipsis">
      Example of LTO Benefits
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#combining-inline-functions-and-lto" class="md-nav__link">
    <span class="md-ellipsis">
      Combining Inline Functions and LTO
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#best-practices_1" class="md-nav__link">
    <span class="md-ellipsis">
      Best Practices
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#conclusion_2" class="md-nav__link">
    <span class="md-ellipsis">
      Conclusion
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#virtual-table-vtable-in-c" class="md-nav__link">
    <span class="md-ellipsis">
      Virtual Table (vtable) in C++
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Virtual Table (vtable) in C++">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#how-vtable-works" class="md-nav__link">
    <span class="md-ellipsis">
      How vtable Works
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#example_1" class="md-nav__link">
    <span class="md-ellipsis">
      Example
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#memory-layout_1" class="md-nav__link">
    <span class="md-ellipsis">
      Memory Layout
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Memory Layout">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#diagram" class="md-nav__link">
    <span class="md-ellipsis">
      Diagram
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#how-the-call-works" class="md-nav__link">
    <span class="md-ellipsis">
      How the Call Works
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#advantages-and-disadvantages" class="md-nav__link">
    <span class="md-ellipsis">
      Advantages and Disadvantages
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Advantages and Disadvantages">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#advantages" class="md-nav__link">
    <span class="md-ellipsis">
      Advantages
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#disadvantages" class="md-nav__link">
    <span class="md-ellipsis">
      Disadvantages
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#conclusion_3" class="md-nav__link">
    <span class="md-ellipsis">
      Conclusion
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#translation-unit" class="md-nav__link">
    <span class="md-ellipsis">
      Translation Unit
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Translation Unit">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#key-components-of-a-translation-unit" class="md-nav__link">
    <span class="md-ellipsis">
      Key Components of a Translation Unit
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#example_2" class="md-nav__link">
    <span class="md-ellipsis">
      Example
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#compilation-process" class="md-nav__link">
    <span class="md-ellipsis">
      Compilation Process
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#translation-unit-boundaries" class="md-nav__link">
    <span class="md-ellipsis">
      Translation Unit Boundaries
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#impact-on-code-design" class="md-nav__link">
    <span class="md-ellipsis">
      Impact on Code Design
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#example-with-multiple-translation-units" class="md-nav__link">
    <span class="md-ellipsis">
      Example with Multiple Translation Units
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#compilation-process-for-multiple-files" class="md-nav__link">
    <span class="md-ellipsis">
      Compilation Process for Multiple Files
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#summary" class="md-nav__link">
    <span class="md-ellipsis">
      Summary
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#deep-copy-vs-shallow-copy" class="md-nav__link">
    <span class="md-ellipsis">
      Deep Copy vs Shallow Copy
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Deep Copy vs Shallow Copy">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#shallow-copy" class="md-nav__link">
    <span class="md-ellipsis">
      Shallow Copy
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Shallow Copy">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#example_3" class="md-nav__link">
    <span class="md-ellipsis">
      Example
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#deep-copy" class="md-nav__link">
    <span class="md-ellipsis">
      Deep Copy
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Deep Copy">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#example_4" class="md-nav__link">
    <span class="md-ellipsis">
      Example
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#key-differences" class="md-nav__link">
    <span class="md-ellipsis">
      Key Differences
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#use-cases_1" class="md-nav__link">
    <span class="md-ellipsis">
      Use Cases
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#object-oriented-programming-complexities" class="md-nav__link">
    <span class="md-ellipsis">
      Object-Oriented Programming Complexities
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Object-Oriented Programming Complexities">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#object-slicing-and-how-to-prevent-it" class="md-nav__link">
    <span class="md-ellipsis">
      Object Slicing and How to Prevent It
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Object Slicing and How to Prevent It">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#explanation" class="md-nav__link">
    <span class="md-ellipsis">
      Explanation
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#the-diamond-problem-in-multiple-inheritance" class="md-nav__link">
    <span class="md-ellipsis">
      The Diamond Problem in Multiple Inheritance
    </span>
  </a>
  
    <nav class="md-nav" aria-label="The Diamond Problem in Multiple Inheritance">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#explanation_1" class="md-nav__link">
    <span class="md-ellipsis">
      Explanation
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#virtual-inheritance" class="md-nav__link">
    <span class="md-ellipsis">
      Virtual Inheritance
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#dynamic-cast-and-type-information" class="md-nav__link">
    <span class="md-ellipsis">
      Dynamic Cast and Type Information
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#resource-management" class="md-nav__link">
    <span class="md-ellipsis">
      Resource Management
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Resource Management">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#raii-resource-acquisition-is-initialization" class="md-nav__link">
    <span class="md-ellipsis">
      RAII (Resource Acquisition Is Initialization)
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#smart-pointers" class="md-nav__link">
    <span class="md-ellipsis">
      Smart Pointers
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Smart Pointers">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#stdunique_ptr" class="md-nav__link">
    <span class="md-ellipsis">
      std::unique_ptr
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#stdshared_ptr" class="md-nav__link">
    <span class="md-ellipsis">
      std::shared_ptr
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#stdweak_ptr" class="md-nav__link">
    <span class="md-ellipsis">
      std::weak_ptr
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#custom-deleters-for-smart-pointers" class="md-nav__link">
    <span class="md-ellipsis">
      Custom Deleters for Smart Pointers
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#scope-guards" class="md-nav__link">
    <span class="md-ellipsis">
      Scope Guards
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#template-advanced-techniques" class="md-nav__link">
    <span class="md-ellipsis">
      Template Advanced Techniques
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Template Advanced Techniques">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#sfinae-substitution-failure-is-not-an-error" class="md-nav__link">
    <span class="md-ellipsis">
      SFINAE (Substitution Failure Is Not An Error)
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#tag-dispatching" class="md-nav__link">
    <span class="md-ellipsis">
      Tag Dispatching
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#expression-templates" class="md-nav__link">
    <span class="md-ellipsis">
      Expression Templates
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#curiously-recurring-template-pattern-crtp" class="md-nav__link">
    <span class="md-ellipsis">
      Curiously Recurring Template Pattern (CRTP)
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#template-specialization-and-partial-specialization" class="md-nav__link">
    <span class="md-ellipsis">
      Template Specialization and Partial Specialization
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#move-semantics-and-perfect-forwarding" class="md-nav__link">
    <span class="md-ellipsis">
      Move Semantics and Perfect Forwarding
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Move Semantics and Perfect Forwarding">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#rvalue-references" class="md-nav__link">
    <span class="md-ellipsis">
      Rvalue References
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#move-constructors-and-assignment-operators" class="md-nav__link">
    <span class="md-ellipsis">
      Move Constructors and Assignment Operators
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#stdmove-and-stdforward" class="md-nav__link">
    <span class="md-ellipsis">
      std::move and std::forward
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#universal-references" class="md-nav__link">
    <span class="md-ellipsis">
      Universal References
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#return-value-optimization-rvo-and-named-return-value-optimization-nrvo" class="md-nav__link">
    <span class="md-ellipsis">
      Return Value Optimization (RVO) and Named Return Value Optimization (NRVO)
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#best-practices_2" class="md-nav__link">
    <span class="md-ellipsis">
      Best Practices
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#concurrency-and-multithreading" class="md-nav__link">
    <span class="md-ellipsis">
      Concurrency and Multithreading
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Concurrency and Multithreading">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#stdthread-and-thread-management" class="md-nav__link">
    <span class="md-ellipsis">
      std::thread and Thread Management
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#mutex-locks-and-atomic-operations" class="md-nav__link">
    <span class="md-ellipsis">
      Mutex, Locks, and Atomic Operations
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#condition-variables" class="md-nav__link">
    <span class="md-ellipsis">
      Condition Variables
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#task-based-parallelism-with-stdasync-and-stdfuture" class="md-nav__link">
    <span class="md-ellipsis">
      Task-based Parallelism with std::async and std::future
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#thread-local-storage" class="md-nav__link">
    <span class="md-ellipsis">
      Thread-local Storage
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#best-practices-for-game-development" class="md-nav__link">
    <span class="md-ellipsis">
      Best Practices for Game Development
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#multithreading" class="md-nav__link">
    <span class="md-ellipsis">
      Multithreading
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Multithreading">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#key-concepts" class="md-nav__link">
    <span class="md-ellipsis">
      Key Concepts
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#1-introduction-to-multithreading" class="md-nav__link">
    <span class="md-ellipsis">
      1. Introduction to Multithreading
    </span>
  </a>
  
    <nav class="md-nav" aria-label="1. Introduction to Multithreading">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#what-is-multithreading" class="md-nav__link">
    <span class="md-ellipsis">
      What is Multithreading?
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#why-use-multithreading" class="md-nav__link">
    <span class="md-ellipsis">
      Why Use Multithreading?
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#2-basic-concepts" class="md-nav__link">
    <span class="md-ellipsis">
      2. Basic Concepts
    </span>
  </a>
  
    <nav class="md-nav" aria-label="2. Basic Concepts">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#threads" class="md-nav__link">
    <span class="md-ellipsis">
      Threads
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#processes-vs-threads" class="md-nav__link">
    <span class="md-ellipsis">
      Processes vs. Threads
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#concurrency-vs-parallelism" class="md-nav__link">
    <span class="md-ellipsis">
      Concurrency vs. Parallelism
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#3-c-standard-library-support" class="md-nav__link">
    <span class="md-ellipsis">
      3. C++ Standard Library Support
    </span>
  </a>
  
    <nav class="md-nav" aria-label="3. C++ Standard Library Support">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#library" class="md-nav__link">
    <span class="md-ellipsis">
      Library
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#creating-threads" class="md-nav__link">
    <span class="md-ellipsis">
      Creating Threads
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#joining-and-detaching-threads" class="md-nav__link">
    <span class="md-ellipsis">
      Joining and Detaching Threads
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#4-synchronization-mechanisms" class="md-nav__link">
    <span class="md-ellipsis">
      4. Synchronization Mechanisms
    </span>
  </a>
  
    <nav class="md-nav" aria-label="4. Synchronization Mechanisms">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#race-conditions" class="md-nav__link">
    <span class="md-ellipsis">
      Race Conditions
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#mutex" class="md-nav__link">
    <span class="md-ellipsis">
      Mutex
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#stdlock_guard-and-stdunique_lock" class="md-nav__link">
    <span class="md-ellipsis">
      std::lock_guard and std::unique_lock
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#condition-variables_1" class="md-nav__link">
    <span class="md-ellipsis">
      Condition Variables
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#5-advanced-topics" class="md-nav__link">
    <span class="md-ellipsis">
      5. Advanced Topics
    </span>
  </a>
  
    <nav class="md-nav" aria-label="5. Advanced Topics">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#atomic-operations" class="md-nav__link">
    <span class="md-ellipsis">
      Atomic Operations
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#thread-pools" class="md-nav__link">
    <span class="md-ellipsis">
      Thread Pools
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#parallel-algorithms" class="md-nav__link">
    <span class="md-ellipsis">
      Parallel Algorithms
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#future-and-promise" class="md-nav__link">
    <span class="md-ellipsis">
      Future and Promise
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#6-best-practices" class="md-nav__link">
    <span class="md-ellipsis">
      6. Best Practices
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#conclusion_4" class="md-nav__link">
    <span class="md-ellipsis">
      Conclusion
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#job-system-design" class="md-nav__link">
    <span class="md-ellipsis">
      Job System Design
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Job System Design">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#jobh" class="md-nav__link">
    <span class="md-ellipsis">
      Job.h
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#jobqueueh" class="md-nav__link">
    <span class="md-ellipsis">
      JobQueue.h
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#workerthreadh" class="md-nav__link">
    <span class="md-ellipsis">
      WorkerThread.h
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#jobsystemh" class="md-nav__link">
    <span class="md-ellipsis">
      JobSystem.h
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#maincpp" class="md-nav__link">
    <span class="md-ellipsis">
      Main.cpp
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#explanation_2" class="md-nav__link">
    <span class="md-ellipsis">
      Explanation
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#improved-jobsystem" class="md-nav__link">
    <span class="md-ellipsis">
      Improved JobSystem
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Improved JobSystem">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#key-features" class="md-nav__link">
    <span class="md-ellipsis">
      Key Features
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#enhanced-design" class="md-nav__link">
    <span class="md-ellipsis">
      Enhanced Design
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#jobh_1" class="md-nav__link">
    <span class="md-ellipsis">
      Job.h
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#jobqueueh_1" class="md-nav__link">
    <span class="md-ellipsis">
      JobQueue.h
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#workerthreadh_1" class="md-nav__link">
    <span class="md-ellipsis">
      WorkerThread.h
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#jobsystemh_1" class="md-nav__link">
    <span class="md-ellipsis">
      JobSystem.h
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#maincpp_1" class="md-nav__link">
    <span class="md-ellipsis">
      Main.cpp
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#explanation_3" class="md-nav__link">
    <span class="md-ellipsis">
      Explanation
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#simd-and-vectorization" class="md-nav__link">
    <span class="md-ellipsis">
      SIMD and Vectorization
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#c-20-features" class="md-nav__link">
    <span class="md-ellipsis">
      C++ 20 Features
    </span>
  </a>
  
    <nav class="md-nav" aria-label="C++ 20 Features">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#concepts-and-constraints" class="md-nav__link">
    <span class="md-ellipsis">
      Concepts and Constraints
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#coroutines" class="md-nav__link">
    <span class="md-ellipsis">
      Coroutines
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#ranges" class="md-nav__link">
    <span class="md-ellipsis">
      Ranges
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#modules" class="md-nav__link">
    <span class="md-ellipsis">
      Modules
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#spaceship-operator" class="md-nav__link">
    <span class="md-ellipsis">
      Spaceship Operator (&lt;=&gt;)
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#best-practices-and-considerations" class="md-nav__link">
    <span class="md-ellipsis">
      Best Practices and Considerations
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#performance-optimization" class="md-nav__link">
    <span class="md-ellipsis">
      Performance Optimization
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Performance Optimization">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#advanced-language-features" class="md-nav__link">
    <span class="md-ellipsis">
      Advanced Language Features
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Advanced Language Features">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#argument-dependent-lookup-adl" class="md-nav__link">
    <span class="md-ellipsis">
      Argument-dependent lookup (ADL)
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#fold-expressions" class="md-nav__link">
    <span class="md-ellipsis">
      Fold expressions
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#variadic-templates" class="md-nav__link">
    <span class="md-ellipsis">
      Variadic templates
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#constexpr-and-compile-time-computation" class="md-nav__link">
    <span class="md-ellipsis">
      Constexpr and compile-time computation
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#custom-literals" class="md-nav__link">
    <span class="md-ellipsis">
      Custom literals
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
    </ul>
  
</nav>
      
    </li>
  

    
      
      
  
  
  
  
    
    
    
      
      
        
      
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_3" >
        
          
          <label class="md-nav__link" for="__nav_3" id="__nav_3_label" tabindex="0">
            
  
  <span class="md-ellipsis">
    Core Concepts
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_3_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_3">
            <span class="md-nav__icon md-icon"></span>
            Core Concepts
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../dsa/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Data Structures and Algorithms
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../memory/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Memory Management
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

    
      
      
  
  
  
  
    
    
    
      
      
        
      
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_4" >
        
          
          <label class="md-nav__link" for="__nav_4" id="__nav_4_label" tabindex="0">
            
  
  <span class="md-ellipsis">
    Graphics
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_4_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_4">
            <span class="md-nav__icon md-icon"></span>
            Graphics
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../graphics/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Graphics Programming
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../rendering/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Rendering Techniques
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="../patterns/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Programming Patterns
  </span>
  

      </a>
    </li>
  

    
      
      
  
  
  
  
    
    
    
      
      
        
      
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_6" >
        
          
          <label class="md-nav__link" for="__nav_6" id="__nav_6_label" tabindex="0">
            
  
  <span class="md-ellipsis">
    AI
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_6_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_6">
            <span class="md-nav__icon md-icon"></span>
            AI
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../ai/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Artificial Intelligence in Games
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="../engine/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Game Engine Architecture
  </span>
  

      </a>
    </li>
  

    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="../algorithms/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Algorithms
  </span>
  

      </a>
    </li>
  

    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="../intersections/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Intersections
  </span>
  

      </a>
    </li>
  

    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="../graph/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Graph
  </span>
  

      </a>
    </li>
  

    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="../gameplay/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Gameplay
  </span>
  

      </a>
    </li>
  

    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="../maths/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Maths
  </span>
  

      </a>
    </li>
  

    
  </ul>
</nav>
                  </div>
                </div>
              </div>
            
            
          
          
            <div class="md-content" data-md-component="content">
              <article class="md-content__inner md-typeset">
                
                  


<h1 id="c-for-game-development">C++ for Game Development</h1>
<p>This guide covers intermediate to advanced C++ topics essential for game development. It assumes you have a basic understanding of C++ fundamentals.</p>
<h2 id="table-of-contents">Table of Contents</h2>
<ol>
<li><a href="#object-oriented-programming-complexities">Object-Oriented Programming Complexities</a></li>
<li><a href="#resource-management">Resource Management</a></li>
<li><a href="#template-advanced-techniques">Template Advanced Techniques</a></li>
<li><a href="#move-semantics-and-perfect-forwarding">Move Semantics and Perfect Forwarding</a></li>
<li><a href="#concurrency-and-multithreading">Concurrency and Multithreading</a></li>
<li><a href="#simd-and-vectorization">SIMD and Vectorization</a></li>
<li><a href="#c-20-features">C++ 20 Features</a></li>
<li><a href="#performance-optimization">Performance Optimization</a></li>
<li><a href="#advanced-language-features">Advanced Language Features</a></li>
</ol>
<h2 id="structure-and-layout">Structure And Layout</h2>
<p>The memory structure and layout of a C++ program are crucial to understanding how a program manages and accesses data during execution. Here is an overview of the different segments of memory in a typical C++ program and their purposes:</p>
<h3 id="memory-segments">Memory Segments</h3>
<p><img alt="Alt text" src="../images/memory-layout.gif" title="Memory Layout" /></p>
<ol>
<li>
<p><strong>Text Segment (Code Segment)</strong></p>
<ul>
<li><strong>Contents</strong>: This segment contains the executable machine code of the compiled program.</li>
<li><strong>Characteristics</strong>: Typically read-only to prevent accidental modification of instructions. It may also be shared among processes to save memory.</li>
</ul>
</li>
<li>
<p><strong>Data Segment</strong></p>
<ul>
<li>
<p><strong>Static Data Segment</strong>: </p>
<ul>
<li><strong>Contents</strong>: Global and static variables that are initialized before the program starts.</li>
<li><strong>Characteristics</strong>: Divided into initialized and uninitialized segments. Initialized data (with non-zero values) is in the <code>.data</code> segment, while uninitialized data (or initialized to zero) is in the <code>.bss</code> segment.</li>
</ul>
</li>
<li>
<p><strong>Example</strong>: 
 <div class="highlight"><pre><span></span><code><a id="__codelineno-0-1" name="__codelineno-0-1" href="#__codelineno-0-1"></a><span class="kt">int</span><span class="w"> </span><span class="n">globalVar</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">10</span><span class="p">;</span><span class="w"> </span><span class="c1">// .data segment</span>
<a id="__codelineno-0-2" name="__codelineno-0-2" href="#__codelineno-0-2"></a><span class="k">static</span><span class="w"> </span><span class="kt">int</span><span class="w"> </span><span class="n">staticVar</span><span class="p">;</span><span class="w"> </span><span class="c1">// .bss segment</span>
</code></pre></div></p>
</li>
</ul>
</li>
<li>
<p><strong>Heap</strong></p>
<ul>
<li><strong>Contents</strong>: Dynamically allocated memory, typically allocated using <code>new</code> and deallocated with <code>delete</code>.</li>
<li><strong>Characteristics</strong>: Managed by the program; grows and shrinks as needed during runtime. Memory on the heap is not automatically reclaimed; proper management is required to avoid leaks.</li>
<li><strong>Example</strong>:
 <div class="highlight"><pre><span></span><code><a id="__codelineno-1-1" name="__codelineno-1-1" href="#__codelineno-1-1"></a><span class="kt">int</span><span class="o">*</span><span class="w"> </span><span class="n">p</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">new</span><span class="w"> </span><span class="kt">int</span><span class="p">[</span><span class="mi">10</span><span class="p">];</span><span class="w"> </span><span class="c1">// memory allocated on the heap</span>
<a id="__codelineno-1-2" name="__codelineno-1-2" href="#__codelineno-1-2"></a><span class="k">delete</span><span class="p">[]</span><span class="w"> </span><span class="n">p</span><span class="p">;</span><span class="w"> </span><span class="c1">// memory deallocated</span>
</code></pre></div></li>
</ul>
</li>
<li>
<p><strong>Stack</strong></p>
<ul>
<li><strong>Contents</strong>: Function call stack, local variables, and function call information (e.g., return addresses, parameters).</li>
<li><strong>Characteristics</strong>: Grows and shrinks automatically with function calls and returns. Managed by the runtime system; typically faster access than heap but with limited size.</li>
<li><strong>Example</strong>:
 <div class="highlight"><pre><span></span><code><a id="__codelineno-2-1" name="__codelineno-2-1" href="#__codelineno-2-1"></a><span class="kt">void</span><span class="w"> </span><span class="nf">foo</span><span class="p">()</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-2-2" name="__codelineno-2-2" href="#__codelineno-2-2"></a><span class="w">    </span><span class="kt">int</span><span class="w"> </span><span class="n">localVar</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">5</span><span class="p">;</span><span class="w"> </span><span class="c1">// local variable on the stack</span>
<a id="__codelineno-2-3" name="__codelineno-2-3" href="#__codelineno-2-3"></a><span class="p">}</span>
</code></pre></div></li>
</ul>
</li>
<li>
<p><strong>Additional Segments</strong></p>
<ul>
<li><strong>Read-only Data Segment</strong>: Constants and literals (e.g., string literals).</li>
<li><strong>TLS (Thread-Local Storage)</strong>: Data that is unique to each thread in a multi-threaded program.</li>
</ul>
</li>
</ol>
<p><img alt="Alt text" src="../images/memo-layout-detailed.png" title="Memory Layout Detailed" /></p>
<h3 id="memory-layout">Memory Layout</h3>
<p>A typical memory layout for a C++ program running on a modern operating system might look like this (from high to low memory addresses):</p>
<ul>
<li>
<p><strong>Command-Line Arguments and Environment Variables</strong></p>
</li>
<li>
<p><strong>Stack</strong></p>
<ul>
<li>High memory address; grows downwards.</li>
<li>Contains local variables, function parameters, return addresses.</li>
</ul>
</li>
<li><strong>Heap</strong><ul>
<li>Adjacent to the stack; grows upwards.</li>
<li>Dynamically allocated memory.</li>
</ul>
</li>
<li><strong>BSS Segment</strong><ul>
<li>Uninitialized global and static variables.</li>
</ul>
</li>
<li><strong>Data Segment</strong><ul>
<li>Initialized global and static variables.</li>
</ul>
</li>
<li><strong>Text Segment</strong><ul>
<li>Executable code.</li>
</ul>
</li>
</ul>
<h3 id="detailed-example">Detailed Example</h3>
<p>Consider the following C++ program:</p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-3-1" name="__codelineno-3-1" href="#__codelineno-3-1"></a><span class="cp">#include</span><span class="w"> </span><span class="cpf">&lt;iostream&gt;</span>
<a id="__codelineno-3-2" name="__codelineno-3-2" href="#__codelineno-3-2"></a>
<a id="__codelineno-3-3" name="__codelineno-3-3" href="#__codelineno-3-3"></a><span class="kt">int</span><span class="w"> </span><span class="n">globalVar</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">10</span><span class="p">;</span><span class="w">      </span><span class="c1">// .data segment</span>
<a id="__codelineno-3-4" name="__codelineno-3-4" href="#__codelineno-3-4"></a><span class="k">static</span><span class="w"> </span><span class="kt">int</span><span class="w"> </span><span class="n">staticVar</span><span class="p">;</span><span class="w">    </span><span class="c1">// .bss segment</span>
<a id="__codelineno-3-5" name="__codelineno-3-5" href="#__codelineno-3-5"></a><span class="k">const</span><span class="w"> </span><span class="kt">char</span><span class="o">*</span><span class="w"> </span><span class="n">msg</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s">&quot;Hello, World!&quot;</span><span class="p">;</span><span class="w"> </span><span class="c1">// read-only data segment</span>
<a id="__codelineno-3-6" name="__codelineno-3-6" href="#__codelineno-3-6"></a>
<a id="__codelineno-3-7" name="__codelineno-3-7" href="#__codelineno-3-7"></a><span class="kt">void</span><span class="w"> </span><span class="nf">foo</span><span class="p">()</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-3-8" name="__codelineno-3-8" href="#__codelineno-3-8"></a><span class="w">    </span><span class="kt">int</span><span class="w"> </span><span class="n">localVar</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">5</span><span class="p">;</span><span class="w">    </span><span class="c1">// stack</span>
<a id="__codelineno-3-9" name="__codelineno-3-9" href="#__codelineno-3-9"></a><span class="w">    </span><span class="n">std</span><span class="o">::</span><span class="n">cout</span><span class="w"> </span><span class="o">&lt;&lt;</span><span class="w"> </span><span class="n">localVar</span><span class="w"> </span><span class="o">&lt;&lt;</span><span class="w"> </span><span class="n">std</span><span class="o">::</span><span class="n">endl</span><span class="p">;</span>
<a id="__codelineno-3-10" name="__codelineno-3-10" href="#__codelineno-3-10"></a><span class="p">}</span>
<a id="__codelineno-3-11" name="__codelineno-3-11" href="#__codelineno-3-11"></a>
<a id="__codelineno-3-12" name="__codelineno-3-12" href="#__codelineno-3-12"></a><span class="kt">int</span><span class="w"> </span><span class="nf">main</span><span class="p">()</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-3-13" name="__codelineno-3-13" href="#__codelineno-3-13"></a><span class="w">    </span><span class="n">foo</span><span class="p">();</span>
<a id="__codelineno-3-14" name="__codelineno-3-14" href="#__codelineno-3-14"></a><span class="w">    </span><span class="kt">int</span><span class="o">*</span><span class="w"> </span><span class="n">p</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">new</span><span class="w"> </span><span class="kt">int</span><span class="p">[</span><span class="mi">10</span><span class="p">];</span><span class="w"> </span><span class="c1">// heap</span>
<a id="__codelineno-3-15" name="__codelineno-3-15" href="#__codelineno-3-15"></a><span class="w">    </span><span class="k">delete</span><span class="p">[]</span><span class="w"> </span><span class="n">p</span><span class="p">;</span>
<a id="__codelineno-3-16" name="__codelineno-3-16" href="#__codelineno-3-16"></a><span class="w">    </span><span class="k">return</span><span class="w"> </span><span class="mi">0</span><span class="p">;</span>
<a id="__codelineno-3-17" name="__codelineno-3-17" href="#__codelineno-3-17"></a><span class="p">}</span>
</code></pre></div>
<ul>
<li><strong>Text Segment</strong>: Contains the compiled code for <code>main()</code>, <code>foo()</code>, and <code>std::cout</code>.</li>
<li><strong>Data Segment</strong>: Contains <code>globalVar</code> and <code>msg</code>.</li>
<li><strong>BSS Segment</strong>: Contains <code>staticVar</code>.</li>
<li><strong>Heap</strong>: Memory allocated for <code>p</code> in <code>main()</code>.</li>
<li><strong>Stack</strong>: Contains <code>localVar</code> in <code>foo()</code>, the return address for <code>foo()</code>, the return address for <code>main()</code>, and local variables in <code>main()</code>.</li>
</ul>
<h4 id="1-simple-object">1. Simple Object:</h4>
<p>The memory layout of a simple object in C++ typically consists of its data members arranged sequentially in memory. For example:</p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-4-1" name="__codelineno-4-1" href="#__codelineno-4-1"></a><span class="k">class</span><span class="w"> </span><span class="nc">SimpleObject</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-4-2" name="__codelineno-4-2" href="#__codelineno-4-2"></a><span class="w">    </span><span class="kt">int</span><span class="w"> </span><span class="n">a</span><span class="p">;</span>
<a id="__codelineno-4-3" name="__codelineno-4-3" href="#__codelineno-4-3"></a><span class="w">    </span><span class="kt">char</span><span class="w"> </span><span class="n">b</span><span class="p">;</span>
<a id="__codelineno-4-4" name="__codelineno-4-4" href="#__codelineno-4-4"></a><span class="w">    </span><span class="kt">double</span><span class="w"> </span><span class="n">c</span><span class="p">;</span>
<a id="__codelineno-4-5" name="__codelineno-4-5" href="#__codelineno-4-5"></a><span class="p">};</span>
</code></pre></div>
<p>Memory layout:
<div class="highlight"><pre><span></span><code><a id="__codelineno-5-1" name="__codelineno-5-1" href="#__codelineno-5-1"></a>| int a (4 bytes) | char b (1 byte) | padding (3 bytes) | double c (8 bytes) |
</code></pre></div></p>
<p>Note that padding may be added between members for alignment purposes.</p>
<h4 id="2-object-with-virtual-and-static-members">2. Object with virtual and static members:</h4>
<p>When an object has virtual functions, a virtual function table (vtable) pointer is added at the beginning of the object. Static members are not part of the object's memory layout.</p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-6-1" name="__codelineno-6-1" href="#__codelineno-6-1"></a><span class="k">class</span><span class="w"> </span><span class="nc">ObjectWithVirtual</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-6-2" name="__codelineno-6-2" href="#__codelineno-6-2"></a><span class="w">    </span><span class="kt">int</span><span class="w"> </span><span class="n">x</span><span class="p">;</span>
<a id="__codelineno-6-3" name="__codelineno-6-3" href="#__codelineno-6-3"></a><span class="w">    </span><span class="k">static</span><span class="w"> </span><span class="kt">int</span><span class="w"> </span><span class="n">s</span><span class="p">;</span>
<a id="__codelineno-6-4" name="__codelineno-6-4" href="#__codelineno-6-4"></a><span class="w">    </span><span class="k">virtual</span><span class="w"> </span><span class="kt">void</span><span class="w"> </span><span class="nf">foo</span><span class="p">();</span>
<a id="__codelineno-6-5" name="__codelineno-6-5" href="#__codelineno-6-5"></a><span class="w">    </span><span class="kt">double</span><span class="w"> </span><span class="n">y</span><span class="p">;</span>
<a id="__codelineno-6-6" name="__codelineno-6-6" href="#__codelineno-6-6"></a><span class="p">};</span>
</code></pre></div>
<p>Memory layout:
<div class="highlight"><pre><span></span><code><a id="__codelineno-7-1" name="__codelineno-7-1" href="#__codelineno-7-1"></a>| vptr (8 bytes) | int x (4 bytes) | padding (4 bytes) | double y (8 bytes) |
</code></pre></div></p>
<p>The static member 's' is stored separately in the data segment of the program.</p>
<h4 id="3-object-with-inheritance">3. Object with inheritance:</h4>
<p>In single inheritance, the memory layout of the derived class includes the base class members followed by its own members.</p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-8-1" name="__codelineno-8-1" href="#__codelineno-8-1"></a><span class="k">class</span><span class="w"> </span><span class="nc">Base</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-8-2" name="__codelineno-8-2" href="#__codelineno-8-2"></a><span class="w">    </span><span class="kt">int</span><span class="w"> </span><span class="n">a</span><span class="p">;</span>
<a id="__codelineno-8-3" name="__codelineno-8-3" href="#__codelineno-8-3"></a><span class="w">    </span><span class="k">virtual</span><span class="w"> </span><span class="kt">void</span><span class="w"> </span><span class="nf">foo</span><span class="p">();</span>
<a id="__codelineno-8-4" name="__codelineno-8-4" href="#__codelineno-8-4"></a><span class="p">};</span>
<a id="__codelineno-8-5" name="__codelineno-8-5" href="#__codelineno-8-5"></a>
<a id="__codelineno-8-6" name="__codelineno-8-6" href="#__codelineno-8-6"></a><span class="k">class</span><span class="w"> </span><span class="nc">Derived</span><span class="w"> </span><span class="o">:</span><span class="w"> </span><span class="k">public</span><span class="w"> </span><span class="n">Base</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-8-7" name="__codelineno-8-7" href="#__codelineno-8-7"></a><span class="w">    </span><span class="kt">double</span><span class="w"> </span><span class="n">b</span><span class="p">;</span>
<a id="__codelineno-8-8" name="__codelineno-8-8" href="#__codelineno-8-8"></a><span class="p">};</span>
</code></pre></div>
<p>Memory layout of Derived:
<div class="highlight"><pre><span></span><code><a id="__codelineno-9-1" name="__codelineno-9-1" href="#__codelineno-9-1"></a>| vptr (8 bytes) | int a (4 bytes) | padding (4 bytes) | double b (8 bytes) |
</code></pre></div></p>
<h4 id="4-object-with-multiple-inheritances-and-virtual-functions">4. Object with Multiple inheritances and virtual functions:</h4>
<p>With multiple inheritance, the memory layout becomes more complex. Each base class contributes its members to the derived class layout.</p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-10-1" name="__codelineno-10-1" href="#__codelineno-10-1"></a><span class="k">class</span><span class="w"> </span><span class="nc">Base1</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-10-2" name="__codelineno-10-2" href="#__codelineno-10-2"></a><span class="w">    </span><span class="kt">int</span><span class="w"> </span><span class="n">a</span><span class="p">;</span>
<a id="__codelineno-10-3" name="__codelineno-10-3" href="#__codelineno-10-3"></a><span class="w">    </span><span class="k">virtual</span><span class="w"> </span><span class="kt">void</span><span class="w"> </span><span class="nf">foo</span><span class="p">();</span>
<a id="__codelineno-10-4" name="__codelineno-10-4" href="#__codelineno-10-4"></a><span class="p">};</span>
<a id="__codelineno-10-5" name="__codelineno-10-5" href="#__codelineno-10-5"></a>
<a id="__codelineno-10-6" name="__codelineno-10-6" href="#__codelineno-10-6"></a><span class="k">class</span><span class="w"> </span><span class="nc">Base2</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-10-7" name="__codelineno-10-7" href="#__codelineno-10-7"></a><span class="w">    </span><span class="kt">double</span><span class="w"> </span><span class="n">b</span><span class="p">;</span>
<a id="__codelineno-10-8" name="__codelineno-10-8" href="#__codelineno-10-8"></a><span class="w">    </span><span class="k">virtual</span><span class="w"> </span><span class="kt">void</span><span class="w"> </span><span class="nf">bar</span><span class="p">();</span>
<a id="__codelineno-10-9" name="__codelineno-10-9" href="#__codelineno-10-9"></a><span class="p">};</span>
<a id="__codelineno-10-10" name="__codelineno-10-10" href="#__codelineno-10-10"></a>
<a id="__codelineno-10-11" name="__codelineno-10-11" href="#__codelineno-10-11"></a><span class="k">class</span><span class="w"> </span><span class="nc">Derived</span><span class="w"> </span><span class="o">:</span><span class="w"> </span><span class="k">public</span><span class="w"> </span><span class="n">Base1</span><span class="p">,</span><span class="w"> </span><span class="k">public</span><span class="w"> </span><span class="n">Base2</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-10-12" name="__codelineno-10-12" href="#__codelineno-10-12"></a><span class="w">    </span><span class="kt">char</span><span class="w"> </span><span class="n">c</span><span class="p">;</span>
<a id="__codelineno-10-13" name="__codelineno-10-13" href="#__codelineno-10-13"></a><span class="w">    </span><span class="k">virtual</span><span class="w"> </span><span class="kt">void</span><span class="w"> </span><span class="nf">baz</span><span class="p">();</span>
<a id="__codelineno-10-14" name="__codelineno-10-14" href="#__codelineno-10-14"></a><span class="p">};</span>
</code></pre></div>
<p>Memory layout of Derived:
<div class="highlight"><pre><span></span><code><a id="__codelineno-11-1" name="__codelineno-11-1" href="#__codelineno-11-1"></a>| vptr1 (8 bytes) | int a (4 bytes) | padding (4 bytes) |
<a id="__codelineno-11-2" name="__codelineno-11-2" href="#__codelineno-11-2"></a>| vptr2 (8 bytes) | double b (8 bytes) |
<a id="__codelineno-11-3" name="__codelineno-11-3" href="#__codelineno-11-3"></a>| char c (1 byte) | padding (7 bytes) |
</code></pre></div></p>
<p>In this case, there are two vptrs, one for each base class. The derived class's own virtual functions are typically added to the first vptr's vtable.</p>
<p>It's important to note that the exact memory layout can vary depending on the compiler, architecture, and optimization settings. The layouts shown here are simplified and may not represent the exact implementation in all cases.</p>
<h3 id="memory-management">Memory Management</h3>
<p>Proper memory management is crucial for the stability and performance of a C++ program. This involves:</p>
<ul>
<li><strong>Allocating and Deallocating Heap Memory</strong>: Use <code>new</code> and <code>delete</code> (or <code>malloc</code> and <code>free</code> in C-style).</li>
<li><strong>Avoiding Memory Leaks</strong>: Ensure that all allocated memory is properly deallocated.</li>
<li><strong>Preventing Stack Overflow</strong>: Avoid excessive recursion or large local arrays that can exceed stack limits.</li>
<li><strong>Using Smart Pointers</strong>: In modern C++, prefer <code>std::unique_ptr</code>, <code>std::shared_ptr</code>, and <code>std::weak_ptr</code> to manage dynamic memory automatically.</li>
</ul>
<p>Understanding the memory structure and layout is essential for writing efficient and error-free C++ programs, especially for performance-critical applications like game development and systems programming.</p>
<h2 id="memory-layout-and-alignment">Memory Layout and Alignment</h2>
<p>Understanding memory layout and alignment is crucial for writing efficient C++ programs, especially in performance-critical applications such as game development, real-time systems, and high-performance computing. Here's an in-depth look at data alignment, padding, and cache-friendly data structures.</p>
<h3 id="data-alignment-and-padding">Data Alignment and Padding</h3>
<p><strong>Data Alignment</strong> refers to arranging data in memory according to certain boundaries to improve access efficiency. Different data types have alignment requirements based on their size. For example, a 4-byte integer typically has an alignment requirement of 4 bytes, meaning it should be stored at an address divisible by 4.</p>
<p><strong>Padding</strong> is extra space added by the compiler to satisfy alignment requirements. It ensures that each member of a structure or class is correctly aligned in memory.</p>
<h4 id="example-data-alignment">Example: Data Alignment</h4>
<p>Consider a structure with various data types:</p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-12-1" name="__codelineno-12-1" href="#__codelineno-12-1"></a><span class="k">struct</span><span class="w"> </span><span class="nc">Example</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-12-2" name="__codelineno-12-2" href="#__codelineno-12-2"></a><span class="w">    </span><span class="kt">char</span><span class="w"> </span><span class="n">a</span><span class="p">;</span><span class="w">   </span><span class="c1">// 1 byte</span>
<a id="__codelineno-12-3" name="__codelineno-12-3" href="#__codelineno-12-3"></a><span class="w">    </span><span class="kt">int</span><span class="w"> </span><span class="n">b</span><span class="p">;</span><span class="w">    </span><span class="c1">// 4 bytes</span>
<a id="__codelineno-12-4" name="__codelineno-12-4" href="#__codelineno-12-4"></a><span class="w">    </span><span class="kt">char</span><span class="w"> </span><span class="n">c</span><span class="p">;</span><span class="w">   </span><span class="c1">// 1 byte</span>
<a id="__codelineno-12-5" name="__codelineno-12-5" href="#__codelineno-12-5"></a><span class="p">};</span>
</code></pre></div>
<p>Without padding, the layout in memory would look like this:</p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-13-1" name="__codelineno-13-1" href="#__codelineno-13-1"></a>| a | b | b | b | b | c |
</code></pre></div>
<p>However, due to alignment requirements, <code>b</code> needs to be aligned to a 4-byte boundary. Therefore, the compiler adds padding:</p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-14-1" name="__codelineno-14-1" href="#__codelineno-14-1"></a>| a | _ | _ | _ | b | b | b | b | c | _ | _ | _ |
</code></pre></div>
<p>The actual memory layout is:</p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-15-1" name="__codelineno-15-1" href="#__codelineno-15-1"></a>| a | pad | pad | pad | b | b | b | b | c | pad | pad | pad |
</code></pre></div>
<p>The size of this structure would be 12 bytes, not 6, due to padding.</p>
<h4 id="example-avoiding-excessive-padding">Example: Avoiding Excessive Padding</h4>
<p>To reduce padding, you can reorder members based on their alignment requirements:</p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-16-1" name="__codelineno-16-1" href="#__codelineno-16-1"></a><span class="k">struct</span><span class="w"> </span><span class="nc">OptimizedExample</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-16-2" name="__codelineno-16-2" href="#__codelineno-16-2"></a><span class="w">    </span><span class="kt">int</span><span class="w"> </span><span class="n">b</span><span class="p">;</span><span class="w">    </span><span class="c1">// 4 bytes</span>
<a id="__codelineno-16-3" name="__codelineno-16-3" href="#__codelineno-16-3"></a><span class="w">    </span><span class="kt">char</span><span class="w"> </span><span class="n">a</span><span class="p">;</span><span class="w">   </span><span class="c1">// 1 byte</span>
<a id="__codelineno-16-4" name="__codelineno-16-4" href="#__codelineno-16-4"></a><span class="w">    </span><span class="kt">char</span><span class="w"> </span><span class="n">c</span><span class="p">;</span><span class="w">   </span><span class="c1">// 1 byte</span>
<a id="__codelineno-16-5" name="__codelineno-16-5" href="#__codelineno-16-5"></a><span class="p">};</span>
</code></pre></div>
<p>The layout would now be:</p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-17-1" name="__codelineno-17-1" href="#__codelineno-17-1"></a>| b | b | b | b | a | c | pad | pad |
</code></pre></div>
<p>The size of this structure is 8 bytes.</p>
<h4 id="definition">Definition</h4>
<p>Memory alignment in C++ is an important concept that affects how data is stored in memory. It's a technique used to arrange data in memory to improve performance and ensure compatibility with hardware requirements. Let's dive into the details with examples.</p>
<p>Memory Alignment Basics:</p>
<ol>
<li>Alignment refers to placing data at memory addresses that are multiples of the data's size or some other fixed value.</li>
<li>Most modern processors are optimized to read data from aligned addresses.</li>
<li>The alignment requirement typically depends on the data type and the hardware architecture.</li>
</ol>
<p>Common Alignment Rules:</p>
<ul>
<li>1-byte data types (like char) can be stored at any address</li>
<li>2-byte data types (like short) are usually aligned on 2-byte boundaries</li>
<li>4-byte data types (like int or float) are usually aligned on 4-byte boundaries</li>
<li>8-byte data types (like double or long long) are usually aligned on 8-byte boundaries</li>
</ul>
<p>Example and Explanation:</p>
<p>Let's consider a simple struct:</p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-18-1" name="__codelineno-18-1" href="#__codelineno-18-1"></a><span class="k">struct</span><span class="w"> </span><span class="nc">Example</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-18-2" name="__codelineno-18-2" href="#__codelineno-18-2"></a><span class="w">    </span><span class="kt">char</span><span class="w"> </span><span class="n">a</span><span class="p">;</span>
<a id="__codelineno-18-3" name="__codelineno-18-3" href="#__codelineno-18-3"></a><span class="w">    </span><span class="kt">int</span><span class="w"> </span><span class="n">b</span><span class="p">;</span>
<a id="__codelineno-18-4" name="__codelineno-18-4" href="#__codelineno-18-4"></a><span class="w">    </span><span class="kt">short</span><span class="w"> </span><span class="n">c</span><span class="p">;</span>
<a id="__codelineno-18-5" name="__codelineno-18-5" href="#__codelineno-18-5"></a><span class="w">    </span><span class="kt">double</span><span class="w"> </span><span class="n">d</span><span class="p">;</span>
<a id="__codelineno-18-6" name="__codelineno-18-6" href="#__codelineno-18-6"></a><span class="p">};</span>
</code></pre></div>
<p>You might expect this struct to occupy 15 bytes (1 + 4 + 2 + 8), but due to alignment, it will typically occupy 24 bytes. Here's why:</p>
<ol>
<li>The char 'a' occupies the first byte.</li>
<li>The int 'b' requires 4-byte alignment, so 3 bytes of padding are added after 'a'.</li>
<li>The short 'c' requires 2-byte alignment, which is already satisfied.</li>
<li>The double 'd' requires 8-byte alignment, so 4 bytes of padding are added after 'c'.</li>
</ol>
<p>The memory layout would look like this:</p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-19-1" name="__codelineno-19-1" href="#__codelineno-19-1"></a>| a (1) | pad (3) | b (4) | c (2) | pad (2) | d (8) |
</code></pre></div>
<p>Total size: 1 + 3 + 4 + 2 + 2 + 8 = 20 bytes</p>
<p>We can verify this using the sizeof operator:</p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-20-1" name="__codelineno-20-1" href="#__codelineno-20-1"></a><span class="cp">#include</span><span class="w"> </span><span class="cpf">&lt;iostream&gt;</span>
<a id="__codelineno-20-2" name="__codelineno-20-2" href="#__codelineno-20-2"></a>
<a id="__codelineno-20-3" name="__codelineno-20-3" href="#__codelineno-20-3"></a><span class="k">struct</span><span class="w"> </span><span class="nc">Example</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-20-4" name="__codelineno-20-4" href="#__codelineno-20-4"></a><span class="w">    </span><span class="kt">char</span><span class="w"> </span><span class="n">a</span><span class="p">;</span>
<a id="__codelineno-20-5" name="__codelineno-20-5" href="#__codelineno-20-5"></a><span class="w">    </span><span class="kt">int</span><span class="w"> </span><span class="n">b</span><span class="p">;</span>
<a id="__codelineno-20-6" name="__codelineno-20-6" href="#__codelineno-20-6"></a><span class="w">    </span><span class="kt">short</span><span class="w"> </span><span class="n">c</span><span class="p">;</span>
<a id="__codelineno-20-7" name="__codelineno-20-7" href="#__codelineno-20-7"></a><span class="w">    </span><span class="kt">double</span><span class="w"> </span><span class="n">d</span><span class="p">;</span>
<a id="__codelineno-20-8" name="__codelineno-20-8" href="#__codelineno-20-8"></a><span class="p">};</span>
<a id="__codelineno-20-9" name="__codelineno-20-9" href="#__codelineno-20-9"></a>
<a id="__codelineno-20-10" name="__codelineno-20-10" href="#__codelineno-20-10"></a><span class="kt">int</span><span class="w"> </span><span class="nf">main</span><span class="p">()</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-20-11" name="__codelineno-20-11" href="#__codelineno-20-11"></a><span class="w">    </span><span class="n">std</span><span class="o">::</span><span class="n">cout</span><span class="w"> </span><span class="o">&lt;&lt;</span><span class="w"> </span><span class="s">&quot;Size of Example: &quot;</span><span class="w"> </span><span class="o">&lt;&lt;</span><span class="w"> </span><span class="k">sizeof</span><span class="p">(</span><span class="n">Example</span><span class="p">)</span><span class="w"> </span><span class="o">&lt;&lt;</span><span class="w"> </span><span class="s">&quot; bytes</span><span class="se">\n</span><span class="s">&quot;</span><span class="p">;</span>
<a id="__codelineno-20-12" name="__codelineno-20-12" href="#__codelineno-20-12"></a><span class="w">    </span><span class="k">return</span><span class="w"> </span><span class="mi">0</span><span class="p">;</span>
<a id="__codelineno-20-13" name="__codelineno-20-13" href="#__codelineno-20-13"></a><span class="p">}</span>
</code></pre></div>
<p>This will typically output: "Size of Example: 24 bytes"</p>
<p>Note: The actual output might be 20 or 24 bytes depending on the compiler and architecture. Some compilers might add extra padding at the end to ensure the struct's size is a multiple of its largest member's alignment requirement.</p>
<p>Implications and Considerations:</p>
<ol>
<li>
<p>Performance: Aligned memory access is generally faster because the processor can fetch data in a single operation.</p>
</li>
<li>
<p>Memory usage: Alignment can lead to increased memory usage due to padding.</p>
</li>
<li>
<p>Data packing: You can use #pragma pack or <strong>attribute</strong>((packed)) to reduce padding, but this can affect performance and portability.</p>
</li>
<li>
<p>Order of members: Reordering struct members can sometimes reduce padding and overall size.</p>
</li>
<li>
<p>Cross-platform issues: Alignment rules can vary across different platforms and compilers, which can lead to portability issues.</p>
</li>
<li>
<p>Arrays: Elements in arrays are always contiguous, so the entire array might be aligned based on the type's requirements.</p>
</li>
</ol>
<p>Understanding memory alignment is crucial for:</p>
<ul>
<li>Optimizing memory usage</li>
<li>Ensuring correct behavior when working with hardware devices</li>
<li>Implementing certain low-level optimizations</li>
<li>Debugging issues related to data corruption or unexpected behavior</li>
</ul>
<h3 id="how-to">How To</h3>
<p>In C++, you have several ways to control memory alignment. Let's go through the main methods:</p>
<ol>
<li>
<p>Using alignas specifier (C++11 and later):</p>
<p>The alignas specifier allows you to specify the alignment requirement for a variable or type.</p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-21-1" name="__codelineno-21-1" href="#__codelineno-21-1"></a><span class="cp">#include</span><span class="w"> </span><span class="cpf">&lt;iostream&gt;</span>
<a id="__codelineno-21-2" name="__codelineno-21-2" href="#__codelineno-21-2"></a>
<a id="__codelineno-21-3" name="__codelineno-21-3" href="#__codelineno-21-3"></a><span class="k">struct</span><span class="w"> </span><span class="nc">alignas</span><span class="p">(</span><span class="mi">16</span><span class="p">)</span><span class="w"> </span><span class="n">AlignedStruct</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-21-4" name="__codelineno-21-4" href="#__codelineno-21-4"></a><span class="w">    </span><span class="kt">int</span><span class="w"> </span><span class="n">a</span><span class="p">;</span>
<a id="__codelineno-21-5" name="__codelineno-21-5" href="#__codelineno-21-5"></a><span class="w">    </span><span class="kt">char</span><span class="w"> </span><span class="n">b</span><span class="p">;</span>
<a id="__codelineno-21-6" name="__codelineno-21-6" href="#__codelineno-21-6"></a><span class="p">};</span>
<a id="__codelineno-21-7" name="__codelineno-21-7" href="#__codelineno-21-7"></a>
<a id="__codelineno-21-8" name="__codelineno-21-8" href="#__codelineno-21-8"></a><span class="kt">int</span><span class="w"> </span><span class="nf">main</span><span class="p">()</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-21-9" name="__codelineno-21-9" href="#__codelineno-21-9"></a><span class="w">    </span><span class="n">std</span><span class="o">::</span><span class="n">cout</span><span class="w"> </span><span class="o">&lt;&lt;</span><span class="w"> </span><span class="s">&quot;Size of AlignedStruct: &quot;</span><span class="w"> </span><span class="o">&lt;&lt;</span><span class="w"> </span><span class="k">sizeof</span><span class="p">(</span><span class="n">AlignedStruct</span><span class="p">)</span><span class="w"> </span><span class="o">&lt;&lt;</span><span class="w"> </span><span class="n">std</span><span class="o">::</span><span class="n">endl</span><span class="p">;</span>
<a id="__codelineno-21-10" name="__codelineno-21-10" href="#__codelineno-21-10"></a><span class="w">    </span><span class="n">std</span><span class="o">::</span><span class="n">cout</span><span class="w"> </span><span class="o">&lt;&lt;</span><span class="w"> </span><span class="s">&quot;Alignment of AlignedStruct: &quot;</span><span class="w"> </span><span class="o">&lt;&lt;</span><span class="w"> </span><span class="k">alignof</span><span class="p">(</span><span class="n">AlignedStruct</span><span class="p">)</span><span class="w"> </span><span class="o">&lt;&lt;</span><span class="w"> </span><span class="n">std</span><span class="o">::</span><span class="n">endl</span><span class="p">;</span>
<a id="__codelineno-21-11" name="__codelineno-21-11" href="#__codelineno-21-11"></a>
<a id="__codelineno-21-12" name="__codelineno-21-12" href="#__codelineno-21-12"></a><span class="w">    </span><span class="k">alignas</span><span class="p">(</span><span class="mi">32</span><span class="p">)</span><span class="w"> </span><span class="kt">int</span><span class="w"> </span><span class="n">aligned_int</span><span class="p">;</span>
<a id="__codelineno-21-13" name="__codelineno-21-13" href="#__codelineno-21-13"></a><span class="w">    </span><span class="n">std</span><span class="o">::</span><span class="n">cout</span><span class="w"> </span><span class="o">&lt;&lt;</span><span class="w"> </span><span class="s">&quot;Alignment of aligned_int: &quot;</span><span class="w"> </span><span class="o">&lt;&lt;</span><span class="w"> </span><span class="k">alignof</span><span class="p">(</span><span class="n">aligned_int</span><span class="p">)</span><span class="w"> </span><span class="o">&lt;&lt;</span><span class="w"> </span><span class="n">std</span><span class="o">::</span><span class="n">endl</span><span class="p">;</span>
<a id="__codelineno-21-14" name="__codelineno-21-14" href="#__codelineno-21-14"></a>
<a id="__codelineno-21-15" name="__codelineno-21-15" href="#__codelineno-21-15"></a><span class="w">    </span><span class="k">return</span><span class="w"> </span><span class="mi">0</span><span class="p">;</span>
<a id="__codelineno-21-16" name="__codelineno-21-16" href="#__codelineno-21-16"></a><span class="p">}</span>
</code></pre></div>
</li>
<li>
<p>Using compiler-specific attributes:</p>
<p>For older compilers or specific needs, you might use compiler-specific attributes:</p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-22-1" name="__codelineno-22-1" href="#__codelineno-22-1"></a><span class="c1">// GCC and Clang</span>
<a id="__codelineno-22-2" name="__codelineno-22-2" href="#__codelineno-22-2"></a><span class="k">struct</span><span class="w"> </span><span class="nc">__attribute__</span><span class="p">((</span><span class="n">aligned</span><span class="p">(</span><span class="mi">16</span><span class="p">)))</span><span class="w"> </span><span class="n">AlignedStruct</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-22-3" name="__codelineno-22-3" href="#__codelineno-22-3"></a><span class="w">    </span><span class="kt">int</span><span class="w"> </span><span class="n">a</span><span class="p">;</span>
<a id="__codelineno-22-4" name="__codelineno-22-4" href="#__codelineno-22-4"></a><span class="w">    </span><span class="kt">char</span><span class="w"> </span><span class="n">b</span><span class="p">;</span>
<a id="__codelineno-22-5" name="__codelineno-22-5" href="#__codelineno-22-5"></a><span class="p">};</span>
<a id="__codelineno-22-6" name="__codelineno-22-6" href="#__codelineno-22-6"></a>
<a id="__codelineno-22-7" name="__codelineno-22-7" href="#__codelineno-22-7"></a><span class="c1">// MSVC</span>
<a id="__codelineno-22-8" name="__codelineno-22-8" href="#__codelineno-22-8"></a><span class="kr">__declspec</span><span class="p">(</span><span class="n">align</span><span class="p">(</span><span class="mi">16</span><span class="p">))</span><span class="w"> </span><span class="k">struct</span><span class="w"> </span><span class="nc">AlignedStruct</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-22-9" name="__codelineno-22-9" href="#__codelineno-22-9"></a><span class="w">    </span><span class="kt">int</span><span class="w"> </span><span class="n">a</span><span class="p">;</span>
<a id="__codelineno-22-10" name="__codelineno-22-10" href="#__codelineno-22-10"></a><span class="w">    </span><span class="kt">char</span><span class="w"> </span><span class="n">b</span><span class="p">;</span>
<a id="__codelineno-22-11" name="__codelineno-22-11" href="#__codelineno-22-11"></a><span class="p">};</span>
</code></pre></div>
</li>
<li>
<p>Using std::aligned_storage (C++11 and later):</p>
<p>This is useful for creating aligned storage for objects:</p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-23-1" name="__codelineno-23-1" href="#__codelineno-23-1"></a><span class="cp">#include</span><span class="w"> </span><span class="cpf">&lt;type_traits&gt;</span>
<a id="__codelineno-23-2" name="__codelineno-23-2" href="#__codelineno-23-2"></a>
<a id="__codelineno-23-3" name="__codelineno-23-3" href="#__codelineno-23-3"></a><span class="n">std</span><span class="o">::</span><span class="n">aligned_storage</span><span class="o">&lt;</span><span class="k">sizeof</span><span class="p">(</span><span class="kt">double</span><span class="p">),</span><span class="w"> </span><span class="k">alignof</span><span class="p">(</span><span class="kt">double</span><span class="p">)</span><span class="o">&gt;::</span><span class="n">type</span><span class="w"> </span><span class="n">aligned_double</span><span class="p">;</span>
</code></pre></div>
</li>
<li>
<p>Using placement new with aligned memory:</p>
<p>You can allocate aligned memory and then construct objects in it:</p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-24-1" name="__codelineno-24-1" href="#__codelineno-24-1"></a><span class="cp">#include</span><span class="w"> </span><span class="cpf">&lt;cstdlib&gt;</span>
<a id="__codelineno-24-2" name="__codelineno-24-2" href="#__codelineno-24-2"></a><span class="cp">#include</span><span class="w"> </span><span class="cpf">&lt;new&gt;</span>
<a id="__codelineno-24-3" name="__codelineno-24-3" href="#__codelineno-24-3"></a>
<a id="__codelineno-24-4" name="__codelineno-24-4" href="#__codelineno-24-4"></a><span class="kt">void</span><span class="o">*</span><span class="w"> </span><span class="nf">aligned_malloc</span><span class="p">(</span><span class="kt">size_t</span><span class="w"> </span><span class="n">size</span><span class="p">,</span><span class="w"> </span><span class="kt">size_t</span><span class="w"> </span><span class="n">alignment</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-24-5" name="__codelineno-24-5" href="#__codelineno-24-5"></a><span class="w">    </span><span class="kt">void</span><span class="o">*</span><span class="w"> </span><span class="n">p</span><span class="p">;</span>
<a id="__codelineno-24-6" name="__codelineno-24-6" href="#__codelineno-24-6"></a><span class="cp">#ifdef _MSC_VER</span>
<a id="__codelineno-24-7" name="__codelineno-24-7" href="#__codelineno-24-7"></a><span class="w">    </span><span class="n">p</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">_aligned_malloc</span><span class="p">(</span><span class="n">size</span><span class="p">,</span><span class="w"> </span><span class="n">alignment</span><span class="p">);</span>
<a id="__codelineno-24-8" name="__codelineno-24-8" href="#__codelineno-24-8"></a><span class="cp">#else</span>
<a id="__codelineno-24-9" name="__codelineno-24-9" href="#__codelineno-24-9"></a><span class="w">    </span><span class="k">if</span><span class="p">(</span><span class="n">posix_memalign</span><span class="p">(</span><span class="o">&amp;</span><span class="n">p</span><span class="p">,</span><span class="w"> </span><span class="n">alignment</span><span class="p">,</span><span class="w"> </span><span class="n">size</span><span class="p">))</span><span class="w"> </span><span class="k">return</span><span class="w"> </span><span class="k">nullptr</span><span class="p">;</span>
<a id="__codelineno-24-10" name="__codelineno-24-10" href="#__codelineno-24-10"></a><span class="cp">#endif</span>
<a id="__codelineno-24-11" name="__codelineno-24-11" href="#__codelineno-24-11"></a><span class="w">    </span><span class="k">return</span><span class="w"> </span><span class="n">p</span><span class="p">;</span>
<a id="__codelineno-24-12" name="__codelineno-24-12" href="#__codelineno-24-12"></a><span class="p">}</span>
<a id="__codelineno-24-13" name="__codelineno-24-13" href="#__codelineno-24-13"></a>
<a id="__codelineno-24-14" name="__codelineno-24-14" href="#__codelineno-24-14"></a><span class="kt">void</span><span class="w"> </span><span class="nf">aligned_free</span><span class="p">(</span><span class="kt">void</span><span class="o">*</span><span class="w"> </span><span class="n">p</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-24-15" name="__codelineno-24-15" href="#__codelineno-24-15"></a><span class="cp">#ifdef _MSC_VER</span>
<a id="__codelineno-24-16" name="__codelineno-24-16" href="#__codelineno-24-16"></a><span class="w">    </span><span class="n">_aligned_free</span><span class="p">(</span><span class="n">p</span><span class="p">);</span>
<a id="__codelineno-24-17" name="__codelineno-24-17" href="#__codelineno-24-17"></a><span class="cp">#else</span>
<a id="__codelineno-24-18" name="__codelineno-24-18" href="#__codelineno-24-18"></a><span class="w">    </span><span class="n">free</span><span class="p">(</span><span class="n">p</span><span class="p">);</span>
<a id="__codelineno-24-19" name="__codelineno-24-19" href="#__codelineno-24-19"></a><span class="cp">#endif</span>
<a id="__codelineno-24-20" name="__codelineno-24-20" href="#__codelineno-24-20"></a><span class="p">}</span>
<a id="__codelineno-24-21" name="__codelineno-24-21" href="#__codelineno-24-21"></a>
<a id="__codelineno-24-22" name="__codelineno-24-22" href="#__codelineno-24-22"></a><span class="kt">int</span><span class="w"> </span><span class="nf">main</span><span class="p">()</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-24-23" name="__codelineno-24-23" href="#__codelineno-24-23"></a><span class="w">    </span><span class="k">constexpr</span><span class="w"> </span><span class="kt">size_t</span><span class="w"> </span><span class="n">alignment</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">32</span><span class="p">;</span>
<a id="__codelineno-24-24" name="__codelineno-24-24" href="#__codelineno-24-24"></a><span class="w">    </span><span class="kt">void</span><span class="o">*</span><span class="w"> </span><span class="n">ptr</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">aligned_malloc</span><span class="p">(</span><span class="k">sizeof</span><span class="p">(</span><span class="kt">int</span><span class="p">),</span><span class="w"> </span><span class="n">alignment</span><span class="p">);</span>
<a id="__codelineno-24-25" name="__codelineno-24-25" href="#__codelineno-24-25"></a><span class="w">    </span><span class="k">if</span><span class="p">(</span><span class="n">ptr</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-24-26" name="__codelineno-24-26" href="#__codelineno-24-26"></a><span class="w">        </span><span class="k">new</span><span class="w"> </span><span class="p">(</span><span class="n">ptr</span><span class="p">)</span><span class="w"> </span><span class="kt">int</span><span class="p">(</span><span class="mi">42</span><span class="p">);</span><span class="w">  </span><span class="c1">// Placement new</span>
<a id="__codelineno-24-27" name="__codelineno-24-27" href="#__codelineno-24-27"></a><span class="w">        </span><span class="c1">// Use the int...</span>
<a id="__codelineno-24-28" name="__codelineno-24-28" href="#__codelineno-24-28"></a><span class="w">        </span><span class="k">reinterpret_cast</span><span class="o">&lt;</span><span class="kt">int</span><span class="o">*&gt;</span><span class="p">(</span><span class="n">ptr</span><span class="p">)</span><span class="o">-&gt;~</span><span class="kt">int</span><span class="p">();</span><span class="w">  </span><span class="c1">// Explicit destructor call</span>
<a id="__codelineno-24-29" name="__codelineno-24-29" href="#__codelineno-24-29"></a><span class="w">        </span><span class="n">aligned_free</span><span class="p">(</span><span class="n">ptr</span><span class="p">);</span>
<a id="__codelineno-24-30" name="__codelineno-24-30" href="#__codelineno-24-30"></a><span class="w">    </span><span class="p">}</span>
<a id="__codelineno-24-31" name="__codelineno-24-31" href="#__codelineno-24-31"></a><span class="w">    </span><span class="k">return</span><span class="w"> </span><span class="mi">0</span><span class="p">;</span>
<a id="__codelineno-24-32" name="__codelineno-24-32" href="#__codelineno-24-32"></a><span class="p">}</span>
</code></pre></div>
</li>
<li>
<p>Using std::align (C++11 and later):</p>
<p>This function can be used to align pointers within a buffer:</p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-25-1" name="__codelineno-25-1" href="#__codelineno-25-1"></a><span class="cp">#include</span><span class="w"> </span><span class="cpf">&lt;memory&gt;</span>
<a id="__codelineno-25-2" name="__codelineno-25-2" href="#__codelineno-25-2"></a><span class="cp">#include</span><span class="w"> </span><span class="cpf">&lt;iostream&gt;</span>
<a id="__codelineno-25-3" name="__codelineno-25-3" href="#__codelineno-25-3"></a>
<a id="__codelineno-25-4" name="__codelineno-25-4" href="#__codelineno-25-4"></a><span class="kt">int</span><span class="w"> </span><span class="nf">main</span><span class="p">()</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-25-5" name="__codelineno-25-5" href="#__codelineno-25-5"></a><span class="w">    </span><span class="k">constexpr</span><span class="w"> </span><span class="kt">size_t</span><span class="w"> </span><span class="n">alignment</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">16</span><span class="p">;</span>
<a id="__codelineno-25-6" name="__codelineno-25-6" href="#__codelineno-25-6"></a><span class="w">    </span><span class="kt">char</span><span class="w"> </span><span class="n">buffer</span><span class="p">[</span><span class="mi">64</span><span class="p">];</span>
<a id="__codelineno-25-7" name="__codelineno-25-7" href="#__codelineno-25-7"></a><span class="w">    </span><span class="kt">void</span><span class="o">*</span><span class="w"> </span><span class="n">ptr</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">buffer</span><span class="p">;</span>
<a id="__codelineno-25-8" name="__codelineno-25-8" href="#__codelineno-25-8"></a><span class="w">    </span><span class="kt">size_t</span><span class="w"> </span><span class="n">space</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">sizeof</span><span class="p">(</span><span class="n">buffer</span><span class="p">);</span>
<a id="__codelineno-25-9" name="__codelineno-25-9" href="#__codelineno-25-9"></a>
<a id="__codelineno-25-10" name="__codelineno-25-10" href="#__codelineno-25-10"></a><span class="w">    </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">std</span><span class="o">::</span><span class="n">align</span><span class="p">(</span><span class="n">alignment</span><span class="p">,</span><span class="w"> </span><span class="k">sizeof</span><span class="p">(</span><span class="kt">int</span><span class="p">),</span><span class="w"> </span><span class="n">ptr</span><span class="p">,</span><span class="w"> </span><span class="n">space</span><span class="p">))</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-25-11" name="__codelineno-25-11" href="#__codelineno-25-11"></a><span class="w">        </span><span class="c1">// ptr is now aligned</span>
<a id="__codelineno-25-12" name="__codelineno-25-12" href="#__codelineno-25-12"></a><span class="w">        </span><span class="k">new</span><span class="w"> </span><span class="p">(</span><span class="n">ptr</span><span class="p">)</span><span class="w"> </span><span class="kt">int</span><span class="p">(</span><span class="mi">42</span><span class="p">);</span>
<a id="__codelineno-25-13" name="__codelineno-25-13" href="#__codelineno-25-13"></a><span class="w">        </span><span class="n">std</span><span class="o">::</span><span class="n">cout</span><span class="w"> </span><span class="o">&lt;&lt;</span><span class="w"> </span><span class="s">&quot;Aligned address: &quot;</span><span class="w"> </span><span class="o">&lt;&lt;</span><span class="w"> </span><span class="n">ptr</span><span class="w"> </span><span class="o">&lt;&lt;</span><span class="w"> </span><span class="n">std</span><span class="o">::</span><span class="n">endl</span><span class="p">;</span>
<a id="__codelineno-25-14" name="__codelineno-25-14" href="#__codelineno-25-14"></a><span class="w">    </span><span class="p">}</span>
<a id="__codelineno-25-15" name="__codelineno-25-15" href="#__codelineno-25-15"></a>
<a id="__codelineno-25-16" name="__codelineno-25-16" href="#__codelineno-25-16"></a><span class="w">    </span><span class="k">return</span><span class="w"> </span><span class="mi">0</span><span class="p">;</span>
<a id="__codelineno-25-17" name="__codelineno-25-17" href="#__codelineno-25-17"></a><span class="p">}</span>
</code></pre></div>
</li>
<li>
<p>Reordering struct members:</p>
<p>While not a direct alignment method, reordering struct members can help reduce padding and improve alignment:</p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-26-1" name="__codelineno-26-1" href="#__codelineno-26-1"></a><span class="c1">// Less efficient alignment</span>
<a id="__codelineno-26-2" name="__codelineno-26-2" href="#__codelineno-26-2"></a><span class="k">struct</span><span class="w"> </span><span class="nc">BadStruct</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-26-3" name="__codelineno-26-3" href="#__codelineno-26-3"></a><span class="w">    </span><span class="kt">char</span><span class="w"> </span><span class="n">a</span><span class="p">;</span>
<a id="__codelineno-26-4" name="__codelineno-26-4" href="#__codelineno-26-4"></a><span class="w">    </span><span class="kt">double</span><span class="w"> </span><span class="n">b</span><span class="p">;</span>
<a id="__codelineno-26-5" name="__codelineno-26-5" href="#__codelineno-26-5"></a><span class="w">    </span><span class="kt">int</span><span class="w"> </span><span class="n">c</span><span class="p">;</span>
<a id="__codelineno-26-6" name="__codelineno-26-6" href="#__codelineno-26-6"></a><span class="p">};</span>
<a id="__codelineno-26-7" name="__codelineno-26-7" href="#__codelineno-26-7"></a>
<a id="__codelineno-26-8" name="__codelineno-26-8" href="#__codelineno-26-8"></a><span class="c1">// More efficient alignment</span>
<a id="__codelineno-26-9" name="__codelineno-26-9" href="#__codelineno-26-9"></a><span class="k">struct</span><span class="w"> </span><span class="nc">GoodStruct</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-26-10" name="__codelineno-26-10" href="#__codelineno-26-10"></a><span class="w">    </span><span class="kt">double</span><span class="w"> </span><span class="n">b</span><span class="p">;</span>
<a id="__codelineno-26-11" name="__codelineno-26-11" href="#__codelineno-26-11"></a><span class="w">    </span><span class="kt">int</span><span class="w"> </span><span class="n">c</span><span class="p">;</span>
<a id="__codelineno-26-12" name="__codelineno-26-12" href="#__codelineno-26-12"></a><span class="w">    </span><span class="kt">char</span><span class="w"> </span><span class="n">a</span><span class="p">;</span>
<a id="__codelineno-26-13" name="__codelineno-26-13" href="#__codelineno-26-13"></a><span class="p">};</span>
</code></pre></div>
</li>
</ol>
<p>Remember that excessive alignment can lead to increased memory usage, so it's important to balance alignment needs with memory efficiency. Also, some alignment techniques may be platform-specific, so consider portability when choosing an approach.</p>
<h3 id="cache-friendly-data-structures">Cache-Friendly Data Structures</h3>
<p>Cache-friendly data structures are designed to optimize the use of the CPU cache, leading to better performance. Modern CPUs have multiple levels of cache (L1, L2, L3), and accessing data from cache is much faster than accessing data from main memory. Here are some strategies to design cache-friendly data structures:</p>
<ol>
<li>
<p><strong>Data Locality</strong>:</p>
<ul>
<li><strong>Spatial Locality</strong>: Ensure that data accessed close in time is also close in memory. This means grouping related data together.</li>
<li><strong>Temporal Locality</strong>: Reuse recently accessed data to maximize the likelihood of it being in the cache.</li>
</ul>
</li>
<li>
<p><strong>Array of Structures (AoS) vs. Structure of Arrays (SoA)</strong>:</p>
<ul>
<li><strong>Array of Structures (AoS)</strong>: Each element is a structure, leading to poor cache utilization if only a subset of fields is accessed frequently.
 <div class="highlight"><pre><span></span><code><a id="__codelineno-27-1" name="__codelineno-27-1" href="#__codelineno-27-1"></a><span class="k">struct</span><span class="w"> </span><span class="nc">Particle</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-27-2" name="__codelineno-27-2" href="#__codelineno-27-2"></a><span class="w">    </span><span class="kt">float</span><span class="w"> </span><span class="n">x</span><span class="p">,</span><span class="w"> </span><span class="n">y</span><span class="p">,</span><span class="w"> </span><span class="n">z</span><span class="p">;</span>
<a id="__codelineno-27-3" name="__codelineno-27-3" href="#__codelineno-27-3"></a><span class="w">    </span><span class="kt">float</span><span class="w"> </span><span class="n">velocity</span><span class="p">;</span>
<a id="__codelineno-27-4" name="__codelineno-27-4" href="#__codelineno-27-4"></a><span class="w">    </span><span class="kt">int</span><span class="w"> </span><span class="n">id</span><span class="p">;</span>
<a id="__codelineno-27-5" name="__codelineno-27-5" href="#__codelineno-27-5"></a><span class="p">};</span>
<a id="__codelineno-27-6" name="__codelineno-27-6" href="#__codelineno-27-6"></a><span class="n">Particle</span><span class="w"> </span><span class="n">particles</span><span class="p">[</span><span class="mi">1000</span><span class="p">];</span>
</code></pre></div></li>
<li><strong>Structure of Arrays (SoA)</strong>: Separate arrays for each field, improving cache performance for accessing specific fields.
 <div class="highlight"><pre><span></span><code><a id="__codelineno-28-1" name="__codelineno-28-1" href="#__codelineno-28-1"></a><span class="k">struct</span><span class="w"> </span><span class="nc">ParticleData</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-28-2" name="__codelineno-28-2" href="#__codelineno-28-2"></a><span class="w">    </span><span class="kt">float</span><span class="w"> </span><span class="n">x</span><span class="p">[</span><span class="mi">1000</span><span class="p">],</span><span class="w"> </span><span class="n">y</span><span class="p">[</span><span class="mi">1000</span><span class="p">],</span><span class="w"> </span><span class="n">z</span><span class="p">[</span><span class="mi">1000</span><span class="p">];</span>
<a id="__codelineno-28-3" name="__codelineno-28-3" href="#__codelineno-28-3"></a><span class="w">    </span><span class="kt">float</span><span class="w"> </span><span class="n">velocity</span><span class="p">[</span><span class="mi">1000</span><span class="p">];</span>
<a id="__codelineno-28-4" name="__codelineno-28-4" href="#__codelineno-28-4"></a><span class="w">    </span><span class="kt">int</span><span class="w"> </span><span class="n">id</span><span class="p">[</span><span class="mi">1000</span><span class="p">];</span>
<a id="__codelineno-28-5" name="__codelineno-28-5" href="#__codelineno-28-5"></a><span class="p">};</span>
<a id="__codelineno-28-6" name="__codelineno-28-6" href="#__codelineno-28-6"></a><span class="n">ParticleData</span><span class="w"> </span><span class="n">particles</span><span class="p">;</span>
</code></pre></div></li>
</ul>
</li>
<li>
<p><strong>Padding and Alignment for Cache Lines</strong>:</p>
<ul>
<li>Ensure that frequently accessed data fits within a single cache line (typically 64 bytes on modern CPUs) to avoid cache line splits.</li>
<li>Align data structures to cache line boundaries using <code>alignas</code> specifier in C++11 and later.
 <div class="highlight"><pre><span></span><code><a id="__codelineno-29-1" name="__codelineno-29-1" href="#__codelineno-29-1"></a><span class="k">struct</span><span class="w"> </span><span class="nc">alignas</span><span class="p">(</span><span class="mi">64</span><span class="p">)</span><span class="w"> </span><span class="n">AlignedStruct</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-29-2" name="__codelineno-29-2" href="#__codelineno-29-2"></a><span class="w">    </span><span class="kt">int</span><span class="w"> </span><span class="n">data</span><span class="p">[</span><span class="mi">16</span><span class="p">];</span>
<a id="__codelineno-29-3" name="__codelineno-29-3" href="#__codelineno-29-3"></a><span class="p">};</span>
</code></pre></div></li>
</ul>
</li>
<li>
<p><strong>Avoid False Sharing</strong>:</p>
<ul>
<li>In multi-threaded programs, false sharing occurs when threads on different cores modify variables that reside on the same cache line. This causes unnecessary cache coherency traffic.</li>
<li>Align shared data structures to cache line boundaries to prevent false sharing.
 <div class="highlight"><pre><span></span><code><a id="__codelineno-30-1" name="__codelineno-30-1" href="#__codelineno-30-1"></a><span class="k">struct</span><span class="w"> </span><span class="nc">alignas</span><span class="p">(</span><span class="mi">64</span><span class="p">)</span><span class="w"> </span><span class="n">SharedData</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-30-2" name="__codelineno-30-2" href="#__codelineno-30-2"></a><span class="w">    </span><span class="kt">int</span><span class="w"> </span><span class="n">counter</span><span class="p">;</span>
<a id="__codelineno-30-3" name="__codelineno-30-3" href="#__codelineno-30-3"></a><span class="p">};</span>
</code></pre></div></li>
</ul>
</li>
</ol>
<h4 id="example-cache-friendly-linked-list">Example: Cache-Friendly Linked List</h4>
<p>A traditional linked list has poor spatial locality because nodes are allocated individually and may be scattered in memory. A more cache-friendly approach is to use a contiguous block of memory:</p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-31-1" name="__codelineno-31-1" href="#__codelineno-31-1"></a><span class="k">template</span><span class="w"> </span><span class="o">&lt;</span><span class="k">typename</span><span class="w"> </span><span class="nc">T</span><span class="o">&gt;</span>
<a id="__codelineno-31-2" name="__codelineno-31-2" href="#__codelineno-31-2"></a><span class="k">class</span><span class="w"> </span><span class="nc">CacheFriendlyList</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-31-3" name="__codelineno-31-3" href="#__codelineno-31-3"></a><span class="k">public</span><span class="o">:</span>
<a id="__codelineno-31-4" name="__codelineno-31-4" href="#__codelineno-31-4"></a><span class="w">    </span><span class="n">CacheFriendlyList</span><span class="p">(</span><span class="kt">size_t</span><span class="w"> </span><span class="n">capacity</span><span class="p">)</span><span class="w"> </span><span class="o">:</span><span class="w"> </span><span class="n">capacity</span><span class="p">(</span><span class="n">capacity</span><span class="p">),</span><span class="w"> </span><span class="n">size</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-31-5" name="__codelineno-31-5" href="#__codelineno-31-5"></a><span class="w">        </span><span class="n">data</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">new</span><span class="w"> </span><span class="n">T</span><span class="p">[</span><span class="n">capacity</span><span class="p">];</span>
<a id="__codelineno-31-6" name="__codelineno-31-6" href="#__codelineno-31-6"></a><span class="w">    </span><span class="p">}</span>
<a id="__codelineno-31-7" name="__codelineno-31-7" href="#__codelineno-31-7"></a>
<a id="__codelineno-31-8" name="__codelineno-31-8" href="#__codelineno-31-8"></a><span class="w">    </span><span class="o">~</span><span class="n">CacheFriendlyList</span><span class="p">()</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-31-9" name="__codelineno-31-9" href="#__codelineno-31-9"></a><span class="w">        </span><span class="k">delete</span><span class="p">[]</span><span class="w"> </span><span class="n">data</span><span class="p">;</span>
<a id="__codelineno-31-10" name="__codelineno-31-10" href="#__codelineno-31-10"></a><span class="w">    </span><span class="p">}</span>
<a id="__codelineno-31-11" name="__codelineno-31-11" href="#__codelineno-31-11"></a>
<a id="__codelineno-31-12" name="__codelineno-31-12" href="#__codelineno-31-12"></a><span class="w">    </span><span class="kt">void</span><span class="w"> </span><span class="n">add</span><span class="p">(</span><span class="k">const</span><span class="w"> </span><span class="n">T</span><span class="o">&amp;</span><span class="w"> </span><span class="n">value</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-31-13" name="__codelineno-31-13" href="#__codelineno-31-13"></a><span class="w">        </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">size</span><span class="w"> </span><span class="o">&lt;</span><span class="w"> </span><span class="n">capacity</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-31-14" name="__codelineno-31-14" href="#__codelineno-31-14"></a><span class="w">            </span><span class="n">data</span><span class="p">[</span><span class="n">size</span><span class="o">++</span><span class="p">]</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">value</span><span class="p">;</span>
<a id="__codelineno-31-15" name="__codelineno-31-15" href="#__codelineno-31-15"></a><span class="w">        </span><span class="p">}</span>
<a id="__codelineno-31-16" name="__codelineno-31-16" href="#__codelineno-31-16"></a><span class="w">    </span><span class="p">}</span>
<a id="__codelineno-31-17" name="__codelineno-31-17" href="#__codelineno-31-17"></a>
<a id="__codelineno-31-18" name="__codelineno-31-18" href="#__codelineno-31-18"></a><span class="w">    </span><span class="n">T</span><span class="o">&amp;</span><span class="w"> </span><span class="k">operator</span><span class="p">[](</span><span class="kt">size_t</span><span class="w"> </span><span class="n">index</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-31-19" name="__codelineno-31-19" href="#__codelineno-31-19"></a><span class="w">        </span><span class="k">return</span><span class="w"> </span><span class="n">data</span><span class="p">[</span><span class="n">index</span><span class="p">];</span>
<a id="__codelineno-31-20" name="__codelineno-31-20" href="#__codelineno-31-20"></a><span class="w">    </span><span class="p">}</span>
<a id="__codelineno-31-21" name="__codelineno-31-21" href="#__codelineno-31-21"></a>
<a id="__codelineno-31-22" name="__codelineno-31-22" href="#__codelineno-31-22"></a><span class="k">private</span><span class="o">:</span>
<a id="__codelineno-31-23" name="__codelineno-31-23" href="#__codelineno-31-23"></a><span class="w">    </span><span class="n">T</span><span class="o">*</span><span class="w"> </span><span class="n">data</span><span class="p">;</span>
<a id="__codelineno-31-24" name="__codelineno-31-24" href="#__codelineno-31-24"></a><span class="w">    </span><span class="kt">size_t</span><span class="w"> </span><span class="n">capacity</span><span class="p">;</span>
<a id="__codelineno-31-25" name="__codelineno-31-25" href="#__codelineno-31-25"></a><span class="w">    </span><span class="kt">size_t</span><span class="w"> </span><span class="n">size</span><span class="p">;</span>
<a id="__codelineno-31-26" name="__codelineno-31-26" href="#__codelineno-31-26"></a><span class="p">};</span>
</code></pre></div>
<p>By storing list elements in a contiguous array, this implementation benefits from spatial locality, leading to better cache performance.</p>
<h4 id="conclusion">Conclusion</h4>
<p>Understanding and leveraging data alignment, padding, and cache-friendly data structures can significantly improve the performance of C++ programs. Properly aligned data ensures efficient access, while cache-friendly structures maximize the use of the CPU cache, reducing memory access latency. These techniques are particularly important in systems programming, game development, and other performance-critical applications.</p>
<h2 id="compilation-and-execution">Compilation And execution</h2>
<p>The compilation flow of a C++ program involves several steps, each crucial for transforming human-readable source code into machine-executable binary. Here is a detailed breakdown of the entire process:</p>
<p><img alt="Alt text" src="../images/cpp-workflow.png" title="workflow" /></p>
<h3 id="1-preprocessing">1. <strong>Preprocessing</strong></h3>
<p>The first step is preprocessing, handled by the preprocessor. During this phase, the preprocessor processes directives (commands) that begin with <code>#</code>. This includes:</p>
<ul>
<li><strong>File Inclusion</strong> (<code>#include</code>): The preprocessor includes the contents of the specified header files into the source file.</li>
<li><strong>Macro Expansion</strong> (<code>#define</code>): Macro definitions are expanded throughout the code.</li>
<li><strong>Conditional Compilation</strong> (<code>#if</code>, <code>#ifdef</code>, <code>#ifndef</code>, <code>#else</code>, <code>#elif</code>, <code>#endif</code>): Code blocks are included or excluded based on specified conditions.</li>
<li><strong>Other Directives</strong>: Such as <code>#pragma</code> and <code>#line</code>.</li>
</ul>
<p>The result of preprocessing is an expanded source file with all macros expanded and file inclusions resolved.</p>
<h3 id="2-compilation">2. <strong>Compilation</strong></h3>
<p>The compilation phase translates the preprocessed source code into an intermediate representation called <strong>assembly code</strong>. This phase can be divided into several sub-steps:</p>
<ul>
<li><strong>Lexical Analysis</strong>: The compiler breaks the source code into tokens, which are the smallest units of meaning (keywords, identifiers, literals, operators, etc.).</li>
<li><strong>Syntax Analysis</strong> (Parsing): The tokens are analyzed according to the grammatical rules of the language to form a syntax tree (parse tree). This tree represents the hierarchical structure of the source code.</li>
<li><strong>Semantic Analysis</strong>: The compiler checks for semantic errors and ensures that the code adheres to the rules of the language. This includes type checking, scope resolution, and other validations.</li>
<li><strong>Intermediate Code Generation</strong>: The compiler generates an intermediate representation of the source code, often in a form that is closer to machine code but still abstract.</li>
<li><strong>Optimization</strong>: Various optimization techniques are applied to the intermediate code to improve performance and reduce resource usage.</li>
</ul>
<p>The output of the compilation phase is assembly code, which is a low-level representation of the program.</p>
<h3 id="3-assembly">3. <strong>Assembly</strong></h3>
<p>The assembly phase converts the assembly code into machine code (binary instructions). This is done by the assembler, which produces an <strong>object file</strong>. The object file contains machine code and metadata, including information about unresolved symbols (e.g., external functions and global variables).</p>
<h3 id="4-linking">4. <strong>Linking</strong></h3>
<p>The linking phase combines one or more object files and libraries into a single executable or library. This phase includes:</p>
<ul>
<li><strong>Symbol Resolution</strong>: The linker resolves references to symbols (variables, functions) across object files.</li>
<li><strong>Address Binding</strong>: The linker assigns final memory addresses to the symbols.</li>
<li><strong>Library Inclusion</strong>: The linker includes necessary code from static libraries.</li>
<li><strong>Relocation</strong>: The linker adjusts addresses within the code and data sections to reflect their final positions in memory.</li>
</ul>
<p>The output of the linking phase is an executable file or a shared library.</p>
<h3 id="5-loading">5. <strong>Loading</strong></h3>
<p>Although not strictly part of the compilation process, loading is the final step that happens when you run the program:</p>
<ul>
<li><strong>Loading into Memory</strong>: The operating system's loader loads the executable into memory, setting up the necessary environment.</li>
<li><strong>Dynamic Linking</strong>: If the executable depends on shared libraries, the dynamic linker/loader resolves these dependencies at runtime.</li>
</ul>
<h3 id="build-model">Build Model</h3>
<p><img alt="Alt text" src="../images/build-model.svg" title="Build Model" /></p>
<h3 id="c-build-process">C++ Build Process</h3>
<p>Building an executable file from a C++ source code file is a multi-step process. For example, if you have a C++ source code file named prog1.cpp and you execute the command</p>
<p>g++ -Wall -Werror -ansi -pedantic -std=c++14 -o prog1 prog1.cpp</p>
<p>the build process looks like this:</p>
<ul>
<li>
<p>The C++ preprocessor copies the contents of the included header files into the source code file, generates macro code, and replaces symbolic constants defined using #define with their values.</p>
</li>
<li>
<p>The expanded source code file produced by the C++ preprocessor is compiled into the assembly language for the platform.</p>
</li>
<li>
<p>The assembler code generated by the compiler is assembled into the object code for the platform.</p>
</li>
<li>
<p>The object code file generated by the assembler combined with functions from the standard library archive files by the linker to produce an executable file. By default, this executable file is named a.out. In this case, we have used the -o option to specify the name of the executable file as prog1.</p>
</li>
</ul>
<p>By using appropriate compiler options, we can stop this process at any stage.</p>
<ul>
<li>
<p>To stop the process after the preprocessor step, you can use the -E option:</p>
<div class="highlight"><pre><span></span><code>g++ -Wall -Werror -ansi -pedantic -std=c++14 -E prog1.cpp
</code></pre></div>
<p>The expanded source code file will be printed on standard output (the screen by default); you can redirect the output to a file if you wish. Note that the expanded source code file is often incredibly large - a 20 line source code file can easily produce an expanded file of 20,000 lines or more, depending on which header files were included.</p>
</li>
<li>
<p>To stop the process after the compile step, you can use the -S option:</p>
<div class="highlight"><pre><span></span><code>g++ -Wall -Werror -ansi -pedantic -std=c++14 -S prog1.cpp
</code></pre></div>
<p>By default, the assembler code for a source file named filename.cpp will be placed in a file named filename.s.</p>
</li>
<li>
<p>To stop the process after the assembly step, you can use the -c option:</p>
<div class="highlight"><pre><span></span><code>g++ -Wall -Werror -ansi -pedantic -std=c++14 -c prog1.cpp
</code></pre></div>
<p>By default, the object code for a source file named filename.cpp will be placed in a file named filename.o.</p>
</li>
</ul>
<p>Projects with Multiple Source Files</p>
<p>For a project with multiple source files, Steps 1 through 3 of the build process are performed independently on each source file to produce an object file. The linker then collects the object files and does the following:</p>
<ul>
<li>Scans the given .o files looking for functions that are referenced but not present.</li>
<li>Scans archive (.a) files from the standard disk directories looking for those "unresolved" functions.</li>
<li>Combines the object files with parts from the archive files into an executable file.</li>
</ul>
<p>The key thing to understand here is that each source file is an independent translation unit. That means any required #include statements, using statements, class definitions, function prototypes, etc. neeed to be present in each source file. A using statement coded in one source file is not automatically available to your other source files.</p>
<p><img alt="Alt text" src="../images/build-process.png" title="Build Process" /></p>
<h3 id="detailed-example_1">Detailed Example</h3>
<p>Consider a simple C++ program:</p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-32-1" name="__codelineno-32-1" href="#__codelineno-32-1"></a><span class="c1">// main.cpp</span>
<a id="__codelineno-32-2" name="__codelineno-32-2" href="#__codelineno-32-2"></a><span class="cp">#include</span><span class="w"> </span><span class="cpf">&lt;iostream&gt;</span>
<a id="__codelineno-32-3" name="__codelineno-32-3" href="#__codelineno-32-3"></a>
<a id="__codelineno-32-4" name="__codelineno-32-4" href="#__codelineno-32-4"></a><span class="kt">int</span><span class="w"> </span><span class="nf">main</span><span class="p">()</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-32-5" name="__codelineno-32-5" href="#__codelineno-32-5"></a><span class="w">    </span><span class="n">std</span><span class="o">::</span><span class="n">cout</span><span class="w"> </span><span class="o">&lt;&lt;</span><span class="w"> </span><span class="s">&quot;Hello, world!&quot;</span><span class="w"> </span><span class="o">&lt;&lt;</span><span class="w"> </span><span class="n">std</span><span class="o">::</span><span class="n">endl</span><span class="p">;</span>
<a id="__codelineno-32-6" name="__codelineno-32-6" href="#__codelineno-32-6"></a><span class="w">    </span><span class="k">return</span><span class="w"> </span><span class="mi">0</span><span class="p">;</span>
<a id="__codelineno-32-7" name="__codelineno-32-7" href="#__codelineno-32-7"></a><span class="p">}</span>
</code></pre></div>
<h4 id="preprocessing">Preprocessing</h4>
<ul>
<li><code>#include &lt;iostream&gt;</code>: The content of <code>iostream</code> is included.</li>
<li>Result: Expanded source file with <code>iostream</code> code included.</li>
</ul>
<h4 id="compilation">Compilation</h4>
<ul>
<li><strong>Lexical Analysis</strong>: Tokens generated for <code>int main() { std::cout &lt;&lt; "Hello, world!" &lt;&lt; std::endl; return 0; }</code>.</li>
<li><strong>Syntax Analysis</strong>: Parse tree created for the main function.</li>
<li><strong>Semantic Analysis</strong>: Type checks and validations performed.</li>
<li><strong>Intermediate Code Generation</strong>: Intermediate representation created.</li>
<li><strong>Optimization</strong>: Code optimized.</li>
<li><strong>Output</strong>: Assembly code.</li>
</ul>
<h4 id="assembly">Assembly</h4>
<ul>
<li>Assembly code translated to machine code.</li>
<li><strong>Output</strong>: Object file (<code>main.o</code> or <code>main.obj</code>).</li>
</ul>
<h4 id="linking">Linking</h4>
<ul>
<li>Object file combined with standard library object files.</li>
<li>Symbol resolution, address binding, and relocation performed.</li>
<li><strong>Output</strong>: Executable file (<code>main.exe</code> or <code>a.out</code>).</li>
</ul>
<h4 id="loading">Loading</h4>
<ul>
<li>OS loader loads executable into memory.</li>
<li>Dynamic linker resolves any shared library dependencies.</li>
<li>Program starts execution.</li>
</ul>
<p>This is a high-level overview of what happens under the hood during the compilation and execution of a C++ program. Each phase involves numerous intricate steps and sophisticated tools to ensure that the final executable runs correctly and efficiently.</p>
<h2 id="inline-assembly-in-c">Inline Assembly in C++</h2>
<p>Inline assembly allows embedding assembly language instructions directly within C++ code. This can be useful for performance-critical sections where precise control over the hardware is necessary, or when certain operations are not efficiently supported by high-level C++ constructs. Here's an in-depth look at how to use inline assembly in C++.</p>
<h3 id="basics-of-inline-assembly">Basics of Inline Assembly</h3>
<h4 id="syntax">Syntax</h4>
<p>In C++, inline assembly can be written using the <code>asm</code> keyword in GCC/Clang, or the <code>_asm</code> keyword in MSVC. The syntax varies slightly between compilers.</p>
<p><strong>GCC/Clang Syntax</strong>:
<div class="highlight"><pre><span></span><code><a id="__codelineno-33-1" name="__codelineno-33-1" href="#__codelineno-33-1"></a><span class="k">asm</span><span class="p">(</span><span class="s">&quot;assembly code&quot;</span><span class="p">);</span>
</code></pre></div></p>
<p><strong>MSVC Syntax</strong>:
<div class="highlight"><pre><span></span><code><a id="__codelineno-34-1" name="__codelineno-34-1" href="#__codelineno-34-1"></a><span class="kr">__asm</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-34-2" name="__codelineno-34-2" href="#__codelineno-34-2"></a><span class="w">    </span><span class="n">assembly</span><span class="w"> </span><span class="n">code</span>
<a id="__codelineno-34-3" name="__codelineno-34-3" href="#__codelineno-34-3"></a><span class="p">}</span>
</code></pre></div></p>
<h3 id="gccclang-inline-assembly">GCC/Clang Inline Assembly</h3>
<p>In GCC and Clang, the <code>asm</code> keyword (or <code>__asm__</code> for portability) is used to embed assembly code. GCC provides two forms of inline assembly: basic and extended.</p>
<h4 id="basic-inline-assembly">Basic Inline Assembly</h4>
<p>This form is simpler but less flexible and less powerful. It's useful for inserting a few assembly instructions directly.</p>
<p><strong>Example</strong>:
<div class="highlight"><pre><span></span><code><a id="__codelineno-35-1" name="__codelineno-35-1" href="#__codelineno-35-1"></a><span class="kt">void</span><span class="w"> </span><span class="nf">basicExample</span><span class="p">()</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-35-2" name="__codelineno-35-2" href="#__codelineno-35-2"></a><span class="w">    </span><span class="k">asm</span><span class="p">(</span><span class="s">&quot;nop&quot;</span><span class="p">);</span><span class="w"> </span><span class="c1">// Insert a no-operation instruction</span>
<a id="__codelineno-35-3" name="__codelineno-35-3" href="#__codelineno-35-3"></a><span class="p">}</span>
</code></pre></div></p>
<h4 id="extended-inline-assembly">Extended Inline Assembly</h4>
<p>Extended inline assembly is more powerful and provides a way to specify input and output operands, clobbered registers, and assembler templates.</p>
<p><strong>Syntax</strong>:
<div class="highlight"><pre><span></span><code><a id="__codelineno-36-1" name="__codelineno-36-1" href="#__codelineno-36-1"></a><span class="k">asm</span><span class="w"> </span><span class="p">(</span><span class="w"> </span><span class="n">assembler</span><span class="w"> </span><span class="k">template</span>
<a id="__codelineno-36-2" name="__codelineno-36-2" href="#__codelineno-36-2"></a><span class="w">    </span><span class="o">:</span><span class="w"> </span><span class="n">output</span><span class="w"> </span><span class="n">operands</span><span class="w">                  </span><span class="cm">/* optional */</span>
<a id="__codelineno-36-3" name="__codelineno-36-3" href="#__codelineno-36-3"></a><span class="w">    </span><span class="o">:</span><span class="w"> </span><span class="n">input</span><span class="w"> </span><span class="n">operands</span><span class="w">                   </span><span class="cm">/* optional */</span>
<a id="__codelineno-36-4" name="__codelineno-36-4" href="#__codelineno-36-4"></a><span class="w">    </span><span class="o">:</span><span class="w"> </span><span class="n">list</span><span class="w"> </span><span class="n">of</span><span class="w"> </span><span class="n">clobbered</span><span class="w"> </span><span class="n">registers</span><span class="w">      </span><span class="cm">/* optional */</span>
<a id="__codelineno-36-5" name="__codelineno-36-5" href="#__codelineno-36-5"></a><span class="p">);</span>
</code></pre></div></p>
<p><strong>Example</strong>:
<div class="highlight"><pre><span></span><code><a id="__codelineno-37-1" name="__codelineno-37-1" href="#__codelineno-37-1"></a><span class="cp">#include</span><span class="w"> </span><span class="cpf">&lt;iostream&gt;</span>
<a id="__codelineno-37-2" name="__codelineno-37-2" href="#__codelineno-37-2"></a>
<a id="__codelineno-37-3" name="__codelineno-37-3" href="#__codelineno-37-3"></a><span class="kt">int</span><span class="w"> </span><span class="nf">add</span><span class="p">(</span><span class="kt">int</span><span class="w"> </span><span class="n">a</span><span class="p">,</span><span class="w"> </span><span class="kt">int</span><span class="w"> </span><span class="n">b</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-37-4" name="__codelineno-37-4" href="#__codelineno-37-4"></a><span class="w">    </span><span class="kt">int</span><span class="w"> </span><span class="n">result</span><span class="p">;</span>
<a id="__codelineno-37-5" name="__codelineno-37-5" href="#__codelineno-37-5"></a><span class="w">    </span><span class="k">asm</span><span class="w"> </span><span class="p">(</span><span class="s">&quot;add %1, %2</span><span class="se">\n\t</span><span class="s">&quot;</span>
<a id="__codelineno-37-6" name="__codelineno-37-6" href="#__codelineno-37-6"></a><span class="w">         </span><span class="s">&quot;mov %0, %1&quot;</span>
<a id="__codelineno-37-7" name="__codelineno-37-7" href="#__codelineno-37-7"></a><span class="w">         </span><span class="o">:</span><span class="w"> </span><span class="s">&quot;=r&quot;</span><span class="w"> </span><span class="p">(</span><span class="n">result</span><span class="p">)</span><span class="w">          </span><span class="c1">// output operand</span>
<a id="__codelineno-37-8" name="__codelineno-37-8" href="#__codelineno-37-8"></a><span class="w">         </span><span class="o">:</span><span class="w"> </span><span class="s">&quot;r&quot;</span><span class="w"> </span><span class="p">(</span><span class="n">a</span><span class="p">),</span><span class="w"> </span><span class="s">&quot;r&quot;</span><span class="w"> </span><span class="p">(</span><span class="n">b</span><span class="p">)</span><span class="w">       </span><span class="c1">// input operands</span>
<a id="__codelineno-37-9" name="__codelineno-37-9" href="#__codelineno-37-9"></a><span class="w">         </span><span class="o">:</span><span class="w"> </span><span class="cm">/* no clobbered registers */</span>
<a id="__codelineno-37-10" name="__codelineno-37-10" href="#__codelineno-37-10"></a><span class="w">    </span><span class="p">);</span>
<a id="__codelineno-37-11" name="__codelineno-37-11" href="#__codelineno-37-11"></a><span class="w">    </span><span class="k">return</span><span class="w"> </span><span class="n">result</span><span class="p">;</span>
<a id="__codelineno-37-12" name="__codelineno-37-12" href="#__codelineno-37-12"></a><span class="p">}</span>
<a id="__codelineno-37-13" name="__codelineno-37-13" href="#__codelineno-37-13"></a>
<a id="__codelineno-37-14" name="__codelineno-37-14" href="#__codelineno-37-14"></a><span class="kt">int</span><span class="w"> </span><span class="nf">main</span><span class="p">()</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-37-15" name="__codelineno-37-15" href="#__codelineno-37-15"></a><span class="w">    </span><span class="kt">int</span><span class="w"> </span><span class="n">x</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">5</span><span class="p">,</span><span class="w"> </span><span class="n">y</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">10</span><span class="p">;</span>
<a id="__codelineno-37-16" name="__codelineno-37-16" href="#__codelineno-37-16"></a><span class="w">    </span><span class="n">std</span><span class="o">::</span><span class="n">cout</span><span class="w"> </span><span class="o">&lt;&lt;</span><span class="w"> </span><span class="s">&quot;Sum: &quot;</span><span class="w"> </span><span class="o">&lt;&lt;</span><span class="w"> </span><span class="n">add</span><span class="p">(</span><span class="n">x</span><span class="p">,</span><span class="w"> </span><span class="n">y</span><span class="p">)</span><span class="w"> </span><span class="o">&lt;&lt;</span><span class="w"> </span><span class="n">std</span><span class="o">::</span><span class="n">endl</span><span class="p">;</span>
<a id="__codelineno-37-17" name="__codelineno-37-17" href="#__codelineno-37-17"></a><span class="w">    </span><span class="k">return</span><span class="w"> </span><span class="mi">0</span><span class="p">;</span>
<a id="__codelineno-37-18" name="__codelineno-37-18" href="#__codelineno-37-18"></a><span class="p">}</span>
</code></pre></div></p>
<p>In this example:</p>
<ul>
<li><code>"add %1, %2\n\tmov %0, %1"</code> is the assembly code.</li>
<li><code>: "=r" (result)</code> specifies that the result will be stored in a register (<code>r</code>), and the result will be assigned to the C++ variable <code>result</code>.</li>
<li><code>: "r" (a), "r" (b)</code> specifies that the input values <code>a</code> and <code>b</code> will be stored in registers.</li>
<li>The clobbered registers section is empty, indicating no registers are clobbered by this assembly code.</li>
</ul>
<h3 id="msvc-inline-assembly">MSVC Inline Assembly</h3>
<p>In MSVC, inline assembly uses the <code>__asm</code> keyword. This is generally simpler but less flexible compared to GCC/Clang's extended assembly.</p>
<p><strong>Example</strong>:
<div class="highlight"><pre><span></span><code><a id="__codelineno-38-1" name="__codelineno-38-1" href="#__codelineno-38-1"></a><span class="cp">#include</span><span class="w"> </span><span class="cpf">&lt;iostream&gt;</span>
<a id="__codelineno-38-2" name="__codelineno-38-2" href="#__codelineno-38-2"></a>
<a id="__codelineno-38-3" name="__codelineno-38-3" href="#__codelineno-38-3"></a><span class="kt">int</span><span class="w"> </span><span class="nf">add</span><span class="p">(</span><span class="kt">int</span><span class="w"> </span><span class="n">a</span><span class="p">,</span><span class="w"> </span><span class="kt">int</span><span class="w"> </span><span class="n">b</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-38-4" name="__codelineno-38-4" href="#__codelineno-38-4"></a><span class="w">    </span><span class="kt">int</span><span class="w"> </span><span class="n">result</span><span class="p">;</span>
<a id="__codelineno-38-5" name="__codelineno-38-5" href="#__codelineno-38-5"></a><span class="w">    </span><span class="kr">__asm</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-38-6" name="__codelineno-38-6" href="#__codelineno-38-6"></a><span class="w">        </span><span class="n">mov</span><span class="w"> </span><span class="n">eax</span><span class="p">,</span><span class="w"> </span><span class="n">a</span>
<a id="__codelineno-38-7" name="__codelineno-38-7" href="#__codelineno-38-7"></a><span class="w">        </span><span class="n">add</span><span class="w"> </span><span class="n">eax</span><span class="p">,</span><span class="w"> </span><span class="n">b</span>
<a id="__codelineno-38-8" name="__codelineno-38-8" href="#__codelineno-38-8"></a><span class="w">        </span><span class="n">mov</span><span class="w"> </span><span class="n">result</span><span class="p">,</span><span class="w"> </span><span class="n">eax</span>
<a id="__codelineno-38-9" name="__codelineno-38-9" href="#__codelineno-38-9"></a><span class="w">    </span><span class="p">}</span>
<a id="__codelineno-38-10" name="__codelineno-38-10" href="#__codelineno-38-10"></a><span class="w">    </span><span class="k">return</span><span class="w"> </span><span class="n">result</span><span class="p">;</span>
<a id="__codelineno-38-11" name="__codelineno-38-11" href="#__codelineno-38-11"></a><span class="p">}</span>
<a id="__codelineno-38-12" name="__codelineno-38-12" href="#__codelineno-38-12"></a>
<a id="__codelineno-38-13" name="__codelineno-38-13" href="#__codelineno-38-13"></a><span class="kt">int</span><span class="w"> </span><span class="nf">main</span><span class="p">()</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-38-14" name="__codelineno-38-14" href="#__codelineno-38-14"></a><span class="w">    </span><span class="kt">int</span><span class="w"> </span><span class="n">x</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">5</span><span class="p">,</span><span class="w"> </span><span class="n">y</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">10</span><span class="p">;</span>
<a id="__codelineno-38-15" name="__codelineno-38-15" href="#__codelineno-38-15"></a><span class="w">    </span><span class="n">std</span><span class="o">::</span><span class="n">cout</span><span class="w"> </span><span class="o">&lt;&lt;</span><span class="w"> </span><span class="s">&quot;Sum: &quot;</span><span class="w"> </span><span class="o">&lt;&lt;</span><span class="w"> </span><span class="n">add</span><span class="p">(</span><span class="n">x</span><span class="p">,</span><span class="w"> </span><span class="n">y</span><span class="p">)</span><span class="w"> </span><span class="o">&lt;&lt;</span><span class="w"> </span><span class="n">std</span><span class="o">::</span><span class="n">endl</span><span class="p">;</span>
<a id="__codelineno-38-16" name="__codelineno-38-16" href="#__codelineno-38-16"></a><span class="w">    </span><span class="k">return</span><span class="w"> </span><span class="mi">0</span><span class="p">;</span>
<a id="__codelineno-38-17" name="__codelineno-38-17" href="#__codelineno-38-17"></a><span class="p">}</span>
</code></pre></div></p>
<p>In this example:
- The <code>__asm</code> block contains assembly instructions.
- <code>mov eax, a</code> moves the value of <code>a</code> into the <code>eax</code> register.
- <code>add eax, b</code> adds the value of <code>b</code> to <code>eax</code>.
- <code>mov result, eax</code> moves the result from <code>eax</code> back to the C++ variable <code>result</code>.</p>
<h3 id="constraints-and-clobbered-registers">Constraints and Clobbered Registers</h3>
<p>In GCC/Clang's extended inline assembly, you can specify constraints and clobbered registers.</p>
<p><strong>Constraints</strong>:</p>
<ul>
<li><code>"=r"</code>: Output in a register.</li>
<li><code>"r"</code>: Input in a register.</li>
<li><code>"m"</code>: Memory operand.</li>
<li><code>"i"</code>: Immediate operand.</li>
</ul>
<p><strong>Clobbered Registers</strong>:</p>
<ul>
<li>Clobbered registers specify which registers are modified by the assembly code and need to be preserved. For example, if your assembly code modifies <code>eax</code>, you should list it as clobbered.</li>
</ul>
<p><strong>Example with Clobbered Registers</strong>:
<div class="highlight"><pre><span></span><code><a id="__codelineno-39-1" name="__codelineno-39-1" href="#__codelineno-39-1"></a><span class="kt">int</span><span class="w"> </span><span class="nf">multiply</span><span class="p">(</span><span class="kt">int</span><span class="w"> </span><span class="n">a</span><span class="p">,</span><span class="w"> </span><span class="kt">int</span><span class="w"> </span><span class="n">b</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-39-2" name="__codelineno-39-2" href="#__codelineno-39-2"></a><span class="w">    </span><span class="kt">int</span><span class="w"> </span><span class="n">result</span><span class="p">;</span>
<a id="__codelineno-39-3" name="__codelineno-39-3" href="#__codelineno-39-3"></a><span class="w">    </span><span class="k">asm</span><span class="w"> </span><span class="p">(</span><span class="s">&quot;imul %1, %2</span><span class="se">\n\t</span><span class="s">&quot;</span>
<a id="__codelineno-39-4" name="__codelineno-39-4" href="#__codelineno-39-4"></a><span class="w">         </span><span class="s">&quot;mov %0, %1&quot;</span>
<a id="__codelineno-39-5" name="__codelineno-39-5" href="#__codelineno-39-5"></a><span class="w">         </span><span class="o">:</span><span class="w"> </span><span class="s">&quot;=r&quot;</span><span class="w"> </span><span class="p">(</span><span class="n">result</span><span class="p">)</span>
<a id="__codelineno-39-6" name="__codelineno-39-6" href="#__codelineno-39-6"></a><span class="w">         </span><span class="o">:</span><span class="w"> </span><span class="s">&quot;r&quot;</span><span class="w"> </span><span class="p">(</span><span class="n">a</span><span class="p">),</span><span class="w"> </span><span class="s">&quot;r&quot;</span><span class="w"> </span><span class="p">(</span><span class="n">b</span><span class="p">)</span>
<a id="__codelineno-39-7" name="__codelineno-39-7" href="#__codelineno-39-7"></a><span class="w">         </span><span class="o">:</span><span class="w"> </span><span class="s">&quot;eax&quot;</span><span class="w">  </span><span class="c1">// clobbered register</span>
<a id="__codelineno-39-8" name="__codelineno-39-8" href="#__codelineno-39-8"></a><span class="w">    </span><span class="p">);</span>
<a id="__codelineno-39-9" name="__codelineno-39-9" href="#__codelineno-39-9"></a><span class="w">    </span><span class="k">return</span><span class="w"> </span><span class="n">result</span><span class="p">;</span>
<a id="__codelineno-39-10" name="__codelineno-39-10" href="#__codelineno-39-10"></a><span class="p">}</span>
</code></pre></div></p>
<h3 id="use-cases">Use Cases</h3>
<ol>
<li>
<p><strong>Performance-Critical Code</strong>:</p>
<ul>
<li>Inline assembly is used in scenarios where the highest performance is required, and the overhead of high-level constructs is unacceptable.</li>
</ul>
</li>
<li>
<p><strong>Accessing Special Hardware Instructions</strong>:</p>
<ul>
<li>When special CPU instructions are required that are not accessible from C++.</li>
</ul>
</li>
<li>
<p><strong>Embedded Systems</strong>:</p>
<ul>
<li>In embedded systems programming, where direct hardware manipulation is often necessary.</li>
</ul>
</li>
<li>
<p><strong>Optimization</strong>:</p>
<ul>
<li>Fine-tuning certain critical sections of code to take full advantage of the hardware capabilities.</li>
</ul>
</li>
</ol>
<h3 id="best-practices">Best Practices</h3>
<ul>
<li>
<p><strong>Readability and Maintenance</strong>:</p>
<ul>
<li>Use inline assembly sparingly, as it can make the code harder to read and maintain.</li>
<li>Comment the assembly code thoroughly to explain its purpose and functionality.</li>
</ul>
</li>
<li>
<p><strong>Portability</strong>:</p>
<ul>
<li>Inline assembly is not portable across different architectures and compilers. Use it only when absolutely necessary, and consider providing fallback code in C++.</li>
</ul>
</li>
<li>
<p><strong>Performance</strong>:</p>
<ul>
<li>Ensure that the use of inline assembly actually provides a performance benefit. Modern compilers are very good at optimizing C++ code, and hand-written assembly may not always be faster.</li>
</ul>
</li>
</ul>
<h3 id="conclusion_1">Conclusion</h3>
<p>Inline assembly in C++ allows embedding low-level instructions directly within high-level code, providing precise control over the hardware for performance-critical sections. While powerful, it should be used judiciously due to its impact on code readability, maintainability, and portability. Proper use of constraints and clobbered registers ensures that inline assembly integrates smoothly with the surrounding C++ code, allowing for efficient and effective optimization.</p>
<h2 id="inline-functions-and-link-time-optimization-lto">Inline Functions and Link-Time Optimization (LTO)</h2>
<h3 id="using-inline-functions-for-performance">Using Inline Functions for Performance</h3>
<p><strong>Inline functions</strong> in C++ are a way to suggest to the compiler that the function's code should be inserted at each point the function is called, rather than using the usual function call mechanism. This can eliminate the overhead associated with function calls, such as saving registers, stack operations, and jumping to the function code.</p>
<h3 id="declaring-inline-functions">Declaring Inline Functions</h3>
<p>You can declare a function as <code>inline</code> using the <code>inline</code> keyword:</p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-40-1" name="__codelineno-40-1" href="#__codelineno-40-1"></a><span class="kr">inline</span><span class="w"> </span><span class="kt">int</span><span class="w"> </span><span class="nf">add</span><span class="p">(</span><span class="kt">int</span><span class="w"> </span><span class="n">a</span><span class="p">,</span><span class="w"> </span><span class="kt">int</span><span class="w"> </span><span class="n">b</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-40-2" name="__codelineno-40-2" href="#__codelineno-40-2"></a><span class="w">    </span><span class="k">return</span><span class="w"> </span><span class="n">a</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="n">b</span><span class="p">;</span>
<a id="__codelineno-40-3" name="__codelineno-40-3" href="#__codelineno-40-3"></a><span class="p">}</span>
</code></pre></div>
<p>When the compiler sees the <code>inline</code> keyword, it attempts to replace the function call with the actual code of the function. </p>
<h3 id="benefits-of-inline-functions">Benefits of Inline Functions</h3>
<ol>
<li>
<p><strong>Reduced Function Call Overhead</strong>:</p>
<ul>
<li>By inlining a function, you eliminate the overhead of a function call, which includes stack operations and jumps.</li>
</ul>
</li>
<li>
<p><strong>Improved Performance for Small Functions</strong>:</p>
<ul>
<li>Inlining is particularly beneficial for small, frequently called functions where the overhead of the function call is significant relative to the execution time of the function itself.</li>
</ul>
</li>
<li>
<p><strong>Potential for Further Optimization</strong>:</p>
<ul>
<li>Once the function is inlined, the compiler may have more opportunities to optimize the code, such as constant folding, loop unrolling, and dead code elimination.</li>
</ul>
</li>
</ol>
<h4 id="drawbacks-of-inline-functions">Drawbacks of Inline Functions</h4>
<ol>
<li>
<p><strong>Code Size Increase</strong>:</p>
<ul>
<li>Excessive inlining can lead to code bloat, where the binary size increases significantly because the function code is duplicated at each call site.</li>
</ul>
</li>
<li>
<p><strong>Cache Efficiency</strong>:</p>
<ul>
<li>Larger binary sizes can negatively impact instruction cache efficiency, potentially offsetting the performance gains from inlining.</li>
</ul>
</li>
<li>
<p><strong>Compiler Discretion</strong>:</p>
<ul>
<li>The <code>inline</code> keyword is merely a suggestion to the compiler, which may choose not to inline the function if it deems it inappropriate (e.g., if the function is too large).</li>
</ul>
</li>
</ol>
<h3 id="example">Example</h3>
<p>Consider a simple example of an inline function to calculate the square of a number:</p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-41-1" name="__codelineno-41-1" href="#__codelineno-41-1"></a><span class="kr">inline</span><span class="w"> </span><span class="kt">int</span><span class="w"> </span><span class="nf">square</span><span class="p">(</span><span class="kt">int</span><span class="w"> </span><span class="n">x</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-41-2" name="__codelineno-41-2" href="#__codelineno-41-2"></a><span class="w">    </span><span class="k">return</span><span class="w"> </span><span class="n">x</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="n">x</span><span class="p">;</span>
<a id="__codelineno-41-3" name="__codelineno-41-3" href="#__codelineno-41-3"></a><span class="p">}</span>
<a id="__codelineno-41-4" name="__codelineno-41-4" href="#__codelineno-41-4"></a>
<a id="__codelineno-41-5" name="__codelineno-41-5" href="#__codelineno-41-5"></a><span class="kt">int</span><span class="w"> </span><span class="nf">main</span><span class="p">()</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-41-6" name="__codelineno-41-6" href="#__codelineno-41-6"></a><span class="w">    </span><span class="kt">int</span><span class="w"> </span><span class="n">result</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">square</span><span class="p">(</span><span class="mi">5</span><span class="p">);</span><span class="w">  </span><span class="c1">// This will be replaced by int result = 5 * 5;</span>
<a id="__codelineno-41-7" name="__codelineno-41-7" href="#__codelineno-41-7"></a><span class="w">    </span><span class="k">return</span><span class="w"> </span><span class="mi">0</span><span class="p">;</span>
<a id="__codelineno-41-8" name="__codelineno-41-8" href="#__codelineno-41-8"></a><span class="p">}</span>
</code></pre></div>
<p>In this case, the call to <code>square(5)</code> is replaced by <code>5 * 5</code>, eliminating the function call overhead.</p>
<h3 id="link-time-optimization-lto">Link-Time Optimization (LTO)</h3>
<p><strong>Link-Time Optimization (LTO)</strong> is a powerful compiler optimization technique that performs optimization across the entire program, including across different translation units (source files). LTO allows the compiler to see the whole program at once, enabling more aggressive and effective optimizations.</p>
<h4 id="enabling-lto">Enabling LTO</h4>
<p>Different compilers have different flags to enable LTO:</p>
<ul>
<li>
<p><strong>GCC/Clang</strong>:</p>
</li>
<li>
<p>Compile with <code>-flto</code> flag.</p>
</li>
<li>Link with <code>-flto</code> flag.</li>
</ul>
<div class="highlight"><pre><span></span><code><a id="__codelineno-42-1" name="__codelineno-42-1" href="#__codelineno-42-1"></a>g++<span class="w"> </span>-flto<span class="w"> </span>-O2<span class="w"> </span>-c<span class="w"> </span>file1.cpp
<a id="__codelineno-42-2" name="__codelineno-42-2" href="#__codelineno-42-2"></a>g++<span class="w"> </span>-flto<span class="w"> </span>-O2<span class="w"> </span>-c<span class="w"> </span>file2.cpp
<a id="__codelineno-42-3" name="__codelineno-42-3" href="#__codelineno-42-3"></a>g++<span class="w"> </span>-flto<span class="w"> </span>-o<span class="w"> </span>myprogram<span class="w"> </span>file1.o<span class="w"> </span>file2.o
</code></pre></div>
<ul>
<li>
<p><strong>MSVC</strong>:</p>
</li>
<li>
<p>Compile with <code>/GL</code> flag.</p>
</li>
<li>Link with <code>/LTCG</code> flag.</li>
</ul>
<div class="highlight"><pre><span></span><code><a id="__codelineno-43-1" name="__codelineno-43-1" href="#__codelineno-43-1"></a>cl<span class="w"> </span>/GL<span class="w"> </span>/O2<span class="w"> </span>/c<span class="w"> </span>file1.cpp
<a id="__codelineno-43-2" name="__codelineno-43-2" href="#__codelineno-43-2"></a>cl<span class="w"> </span>/GL<span class="w"> </span>/O2<span class="w"> </span>/c<span class="w"> </span>file2.cpp
<a id="__codelineno-43-3" name="__codelineno-43-3" href="#__codelineno-43-3"></a>link<span class="w"> </span>/LTCG<span class="w"> </span>/out:myprogram.exe<span class="w"> </span>file1.obj<span class="w"> </span>file2.obj
</code></pre></div>
<h4 id="benefits-of-lto">Benefits of LTO</h4>
<ol>
<li>
<p><strong>Whole-Program Optimization</strong>:</p>
<ul>
<li>LTO allows the compiler to optimize across translation units, performing optimizations that are not possible when each file is compiled separately.</li>
</ul>
</li>
<li>
<p><strong>Inlining Across Translation Units</strong>:</p>
<ul>
<li>Functions defined in one source file can be inlined into functions defined in another source file, improving performance by eliminating function call overhead.</li>
</ul>
</li>
<li>
<p><strong>Dead Code Elimination</strong>:</p>
<ul>
<li>The compiler can eliminate unused code and data, resulting in a smaller and more efficient binary.</li>
</ul>
</li>
<li>
<p><strong>Improved Inter-Procedural Optimizations</strong>:</p>
<ul>
<li>LTO enables more effective inter-procedural optimizations (IPO), such as constant propagation, alias analysis, and cross-module inlining.</li>
</ul>
</li>
</ol>
<h5 id="example-of-lto-benefits">Example of LTO Benefits</h5>
<p>Consider a scenario with two source files:</p>
<p><strong>file1.cpp</strong>:
<div class="highlight"><pre><span></span><code><a id="__codelineno-44-1" name="__codelineno-44-1" href="#__codelineno-44-1"></a><span class="cp">#include</span><span class="w"> </span><span class="cpf">&quot;file2.h&quot;</span>
<a id="__codelineno-44-2" name="__codelineno-44-2" href="#__codelineno-44-2"></a>
<a id="__codelineno-44-3" name="__codelineno-44-3" href="#__codelineno-44-3"></a><span class="kt">int</span><span class="w"> </span><span class="nf">main</span><span class="p">()</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-44-4" name="__codelineno-44-4" href="#__codelineno-44-4"></a><span class="w">    </span><span class="k">return</span><span class="w"> </span><span class="n">add</span><span class="p">(</span><span class="mi">3</span><span class="p">,</span><span class="w"> </span><span class="mi">4</span><span class="p">);</span>
<a id="__codelineno-44-5" name="__codelineno-44-5" href="#__codelineno-44-5"></a><span class="p">}</span>
</code></pre></div></p>
<p><strong>file2.cpp</strong>:
<div class="highlight"><pre><span></span><code><a id="__codelineno-45-1" name="__codelineno-45-1" href="#__codelineno-45-1"></a><span class="kt">int</span><span class="w"> </span><span class="nf">add</span><span class="p">(</span><span class="kt">int</span><span class="w"> </span><span class="n">a</span><span class="p">,</span><span class="w"> </span><span class="kt">int</span><span class="w"> </span><span class="n">b</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-45-2" name="__codelineno-45-2" href="#__codelineno-45-2"></a><span class="w">    </span><span class="k">return</span><span class="w"> </span><span class="n">a</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="n">b</span><span class="p">;</span>
<a id="__codelineno-45-3" name="__codelineno-45-3" href="#__codelineno-45-3"></a><span class="p">}</span>
</code></pre></div></p>
<p>Without LTO, the compiler might not inline the <code>add</code> function because it resides in a different translation unit. With LTO enabled, the compiler can inline <code>add</code>, resulting in optimized code like:</p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-46-1" name="__codelineno-46-1" href="#__codelineno-46-1"></a><span class="kt">int</span><span class="w"> </span><span class="nf">main</span><span class="p">()</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-46-2" name="__codelineno-46-2" href="#__codelineno-46-2"></a><span class="w">    </span><span class="k">return</span><span class="w"> </span><span class="mi">3</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="mi">4</span><span class="p">;</span>
<a id="__codelineno-46-3" name="__codelineno-46-3" href="#__codelineno-46-3"></a><span class="p">}</span>
</code></pre></div>
<h4 id="combining-inline-functions-and-lto">Combining Inline Functions and LTO</h4>
<p>Combining inline functions with LTO can provide significant performance improvements. Inline functions can be effectively inlined across translation units with LTO enabled, resulting in both reduced function call overhead and better global optimizations.</p>
<h3 id="best-practices_1">Best Practices</h3>
<ol>
<li><strong>Use <code>inline</code> for Small, Frequently Called Functions</strong>:</li>
<li>
<p>Apply the <code>inline</code> keyword to small functions that are called frequently to reduce function call overhead.</p>
</li>
<li>
<p><strong>Enable LTO for Release Builds</strong>:</p>
</li>
<li>
<p>Enable LTO for production builds to benefit from whole-program optimization and cross-module inlining.</p>
</li>
<li>
<p><strong>Monitor Code Size</strong>:</p>
</li>
<li>
<p>Be cautious of code bloat due to excessive inlining and monitor the binary size.</p>
</li>
<li>
<p><strong>Profile and Benchmark</strong>:</p>
</li>
<li>Always profile and benchmark the application to ensure that inlining and LTO are providing the expected performance benefits.</li>
</ol>
<h3 id="conclusion_2">Conclusion</h3>
<p>Using inline functions and Link-Time Optimization (LTO) can significantly enhance the performance of C++ programs. Inline functions reduce function call overhead by embedding the function code directly at the call site, while LTO performs whole-program optimization across translation units, enabling more aggressive and effective optimizations. By judiciously applying these techniques and balancing performance gains with potential drawbacks like code bloat, developers can create highly optimized C++ applications.</p>
<h2 id="virtual-table-vtable-in-c">Virtual Table (vtable) in C++</h2>
<p>A <strong>virtual table</strong> (vtable) is a mechanism used by C++ to support dynamic (runtime) polymorphism. When a class has virtual functions, the compiler generates a vtable for that class. The vtable is an array of pointers to virtual functions. Each object of a class with virtual functions contains a pointer to the vtable for its class. This enables the correct function to be called at runtime based on the actual object type, even if accessed through a base class pointer or reference.</p>
<h3 id="how-vtable-works">How vtable Works</h3>
<ol>
<li>
<p><strong>Class with Virtual Functions</strong>:</p>
<ul>
<li>When a class declares a virtual function, the compiler creates a vtable for that class.</li>
<li>The vtable contains pointers to the virtual functions of the class.</li>
</ul>
</li>
<li>
<p><strong>Objects and vtable Pointer</strong>:</p>
<ul>
<li>Each object of the class contains a hidden pointer to the vtable.</li>
<li>This pointer is used at runtime to resolve virtual function calls.</li>
</ul>
</li>
</ol>
<h3 id="example_1">Example</h3>
<p>Consider the following example with a base class and derived classes:</p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-47-1" name="__codelineno-47-1" href="#__codelineno-47-1"></a><span class="cp">#include</span><span class="w"> </span><span class="cpf">&lt;iostream&gt;</span>
<a id="__codelineno-47-2" name="__codelineno-47-2" href="#__codelineno-47-2"></a>
<a id="__codelineno-47-3" name="__codelineno-47-3" href="#__codelineno-47-3"></a><span class="k">class</span><span class="w"> </span><span class="nc">Base</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-47-4" name="__codelineno-47-4" href="#__codelineno-47-4"></a><span class="k">public</span><span class="o">:</span>
<a id="__codelineno-47-5" name="__codelineno-47-5" href="#__codelineno-47-5"></a><span class="w">    </span><span class="k">virtual</span><span class="w"> </span><span class="kt">void</span><span class="w"> </span><span class="n">show</span><span class="p">()</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-47-6" name="__codelineno-47-6" href="#__codelineno-47-6"></a><span class="w">        </span><span class="n">std</span><span class="o">::</span><span class="n">cout</span><span class="w"> </span><span class="o">&lt;&lt;</span><span class="w"> </span><span class="s">&quot;Base show()&quot;</span><span class="w"> </span><span class="o">&lt;&lt;</span><span class="w"> </span><span class="n">std</span><span class="o">::</span><span class="n">endl</span><span class="p">;</span>
<a id="__codelineno-47-7" name="__codelineno-47-7" href="#__codelineno-47-7"></a><span class="w">    </span><span class="p">}</span>
<a id="__codelineno-47-8" name="__codelineno-47-8" href="#__codelineno-47-8"></a><span class="w">    </span><span class="k">virtual</span><span class="w"> </span><span class="o">~</span><span class="n">Base</span><span class="p">()</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">default</span><span class="p">;</span>
<a id="__codelineno-47-9" name="__codelineno-47-9" href="#__codelineno-47-9"></a><span class="p">};</span>
<a id="__codelineno-47-10" name="__codelineno-47-10" href="#__codelineno-47-10"></a>
<a id="__codelineno-47-11" name="__codelineno-47-11" href="#__codelineno-47-11"></a><span class="k">class</span><span class="w"> </span><span class="nc">Derived1</span><span class="w"> </span><span class="o">:</span><span class="w"> </span><span class="k">public</span><span class="w"> </span><span class="n">Base</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-47-12" name="__codelineno-47-12" href="#__codelineno-47-12"></a><span class="k">public</span><span class="o">:</span>
<a id="__codelineno-47-13" name="__codelineno-47-13" href="#__codelineno-47-13"></a><span class="w">    </span><span class="kt">void</span><span class="w"> </span><span class="n">show</span><span class="p">()</span><span class="w"> </span><span class="k">override</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-47-14" name="__codelineno-47-14" href="#__codelineno-47-14"></a><span class="w">        </span><span class="n">std</span><span class="o">::</span><span class="n">cout</span><span class="w"> </span><span class="o">&lt;&lt;</span><span class="w"> </span><span class="s">&quot;Derived1 show()&quot;</span><span class="w"> </span><span class="o">&lt;&lt;</span><span class="w"> </span><span class="n">std</span><span class="o">::</span><span class="n">endl</span><span class="p">;</span>
<a id="__codelineno-47-15" name="__codelineno-47-15" href="#__codelineno-47-15"></a><span class="w">    </span><span class="p">}</span>
<a id="__codelineno-47-16" name="__codelineno-47-16" href="#__codelineno-47-16"></a><span class="p">};</span>
<a id="__codelineno-47-17" name="__codelineno-47-17" href="#__codelineno-47-17"></a>
<a id="__codelineno-47-18" name="__codelineno-47-18" href="#__codelineno-47-18"></a><span class="k">class</span><span class="w"> </span><span class="nc">Derived2</span><span class="w"> </span><span class="o">:</span><span class="w"> </span><span class="k">public</span><span class="w"> </span><span class="n">Base</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-47-19" name="__codelineno-47-19" href="#__codelineno-47-19"></a><span class="k">public</span><span class="o">:</span>
<a id="__codelineno-47-20" name="__codelineno-47-20" href="#__codelineno-47-20"></a><span class="w">    </span><span class="kt">void</span><span class="w"> </span><span class="n">show</span><span class="p">()</span><span class="w"> </span><span class="k">override</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-47-21" name="__codelineno-47-21" href="#__codelineno-47-21"></a><span class="w">        </span><span class="n">std</span><span class="o">::</span><span class="n">cout</span><span class="w"> </span><span class="o">&lt;&lt;</span><span class="w"> </span><span class="s">&quot;Derived2 show()&quot;</span><span class="w"> </span><span class="o">&lt;&lt;</span><span class="w"> </span><span class="n">std</span><span class="o">::</span><span class="n">endl</span><span class="p">;</span>
<a id="__codelineno-47-22" name="__codelineno-47-22" href="#__codelineno-47-22"></a><span class="w">    </span><span class="p">}</span>
<a id="__codelineno-47-23" name="__codelineno-47-23" href="#__codelineno-47-23"></a><span class="p">};</span>
<a id="__codelineno-47-24" name="__codelineno-47-24" href="#__codelineno-47-24"></a>
<a id="__codelineno-47-25" name="__codelineno-47-25" href="#__codelineno-47-25"></a><span class="kt">void</span><span class="w"> </span><span class="nf">display</span><span class="p">(</span><span class="n">Base</span><span class="o">*</span><span class="w"> </span><span class="n">b</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-47-26" name="__codelineno-47-26" href="#__codelineno-47-26"></a><span class="w">    </span><span class="n">b</span><span class="o">-&gt;</span><span class="n">show</span><span class="p">();</span>
<a id="__codelineno-47-27" name="__codelineno-47-27" href="#__codelineno-47-27"></a><span class="p">}</span>
<a id="__codelineno-47-28" name="__codelineno-47-28" href="#__codelineno-47-28"></a>
<a id="__codelineno-47-29" name="__codelineno-47-29" href="#__codelineno-47-29"></a><span class="kt">int</span><span class="w"> </span><span class="nf">main</span><span class="p">()</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-47-30" name="__codelineno-47-30" href="#__codelineno-47-30"></a><span class="w">    </span><span class="n">Base</span><span class="w"> </span><span class="n">base</span><span class="p">;</span>
<a id="__codelineno-47-31" name="__codelineno-47-31" href="#__codelineno-47-31"></a><span class="w">    </span><span class="n">Derived1</span><span class="w"> </span><span class="n">d1</span><span class="p">;</span>
<a id="__codelineno-47-32" name="__codelineno-47-32" href="#__codelineno-47-32"></a><span class="w">    </span><span class="n">Derived2</span><span class="w"> </span><span class="n">d2</span><span class="p">;</span>
<a id="__codelineno-47-33" name="__codelineno-47-33" href="#__codelineno-47-33"></a>
<a id="__codelineno-47-34" name="__codelineno-47-34" href="#__codelineno-47-34"></a><span class="w">    </span><span class="n">display</span><span class="p">(</span><span class="o">&amp;</span><span class="n">base</span><span class="p">);</span><span class="w">    </span><span class="c1">// Outputs: Base show()</span>
<a id="__codelineno-47-35" name="__codelineno-47-35" href="#__codelineno-47-35"></a><span class="w">    </span><span class="n">display</span><span class="p">(</span><span class="o">&amp;</span><span class="n">d1</span><span class="p">);</span><span class="w">      </span><span class="c1">// Outputs: Derived1 show()</span>
<a id="__codelineno-47-36" name="__codelineno-47-36" href="#__codelineno-47-36"></a><span class="w">    </span><span class="n">display</span><span class="p">(</span><span class="o">&amp;</span><span class="n">d2</span><span class="p">);</span><span class="w">      </span><span class="c1">// Outputs: Derived2 show()</span>
<a id="__codelineno-47-37" name="__codelineno-47-37" href="#__codelineno-47-37"></a>
<a id="__codelineno-47-38" name="__codelineno-47-38" href="#__codelineno-47-38"></a><span class="w">    </span><span class="k">return</span><span class="w"> </span><span class="mi">0</span><span class="p">;</span>
<a id="__codelineno-47-39" name="__codelineno-47-39" href="#__codelineno-47-39"></a><span class="p">}</span>
</code></pre></div>
<p>In this example:</p>
<ul>
<li><code>Base</code> has a virtual function <code>show()</code>.</li>
<li><code>Derived1</code> and <code>Derived2</code> override <code>show()</code>.</li>
<li>The function <code>display</code> takes a pointer to <code>Base</code> and calls <code>show()</code>. The correct <code>show</code> function is called based on the actual type of the object passed.</li>
</ul>
<h3 id="memory-layout_1">Memory Layout</h3>
<p>When an object of a class with virtual functions is created, it contains a pointer to the vtable. The vtable itself is a static array of function pointers.</p>
<h4 id="diagram">Diagram</h4>
<div class="highlight"><pre><span></span><code><a id="__codelineno-48-1" name="__codelineno-48-1" href="#__codelineno-48-1"></a>Memory Layout:
<a id="__codelineno-48-2" name="__codelineno-48-2" href="#__codelineno-48-2"></a>+---------------------+
<a id="__codelineno-48-3" name="__codelineno-48-3" href="#__codelineno-48-3"></a>| Pointer to vtable   |
<a id="__codelineno-48-4" name="__codelineno-48-4" href="#__codelineno-48-4"></a>+---------------------+
<a id="__codelineno-48-5" name="__codelineno-48-5" href="#__codelineno-48-5"></a>| Member variables... |
<a id="__codelineno-48-6" name="__codelineno-48-6" href="#__codelineno-48-6"></a>+---------------------+
<a id="__codelineno-48-7" name="__codelineno-48-7" href="#__codelineno-48-7"></a>
<a id="__codelineno-48-8" name="__codelineno-48-8" href="#__codelineno-48-8"></a>Vtable Layout:
<a id="__codelineno-48-9" name="__codelineno-48-9" href="#__codelineno-48-9"></a>+---------------------+
<a id="__codelineno-48-10" name="__codelineno-48-10" href="#__codelineno-48-10"></a>| Pointer to show()   |
<a id="__codelineno-48-11" name="__codelineno-48-11" href="#__codelineno-48-11"></a>+---------------------+
<a id="__codelineno-48-12" name="__codelineno-48-12" href="#__codelineno-48-12"></a>| Pointer to ...      |
<a id="__codelineno-48-13" name="__codelineno-48-13" href="#__codelineno-48-13"></a>+---------------------+
</code></pre></div>
<p>For <code>Base</code>, <code>Derived1</code>, and <code>Derived2</code>, the vtables might look like this:</p>
<ul>
<li><code>Base</code> vtable:</li>
<li>
<p><code>show() -&gt; Base::show</code></p>
</li>
<li>
<p><code>Derived1</code> vtable:</p>
</li>
<li>
<p><code>show() -&gt; Derived1::show</code></p>
</li>
<li>
<p><code>Derived2</code> vtable:</p>
</li>
<li><code>show() -&gt; Derived2::show</code></li>
</ul>
<h4 id="how-the-call-works">How the Call Works</h4>
<ol>
<li>The <code>display</code> function receives a pointer to <code>Base</code>.</li>
<li>The <code>show</code> function is called on this pointer.</li>
<li>The compiler uses the vtable pointer in the object to find the correct function address.</li>
<li>The function pointer in the vtable is dereferenced, and the correct function (<code>Base::show</code>, <code>Derived1::show</code>, or <code>Derived2::show</code>) is called.</li>
</ol>
<h3 id="advantages-and-disadvantages">Advantages and Disadvantages</h3>
<h4 id="advantages">Advantages</h4>
<ol>
<li>
<p><strong>Runtime Polymorphism</strong>:</p>
<ul>
<li>Allows for dynamic binding of function calls, enabling runtime polymorphism.</li>
</ul>
</li>
<li>
<p><strong>Flexibility</strong>:</p>
<ul>
<li>Makes it possible to write more flexible and reusable code by allowing functions to be overridden in derived classes.</li>
</ul>
</li>
</ol>
<h4 id="disadvantages">Disadvantages</h4>
<ol>
<li>
<p><strong>Performance Overhead</strong>:</p>
<ul>
<li>Virtual function calls are slightly slower than non-virtual function calls due to the indirection through the vtable.</li>
</ul>
</li>
<li>
<p><strong>Increased Memory Usage</strong>:</p>
<ul>
<li>Each object of a class with virtual functions has a pointer to the vtable, increasing memory usage.</li>
</ul>
</li>
<li>
<p><strong>Complexity</strong>:</p>
<ul>
<li>Increases the complexity of the class design and introduces a level of indirection.</li>
</ul>
</li>
</ol>
<h3 id="conclusion_3">Conclusion</h3>
<p>The vtable is a crucial part of the C++ language's support for dynamic polymorphism. It allows for the flexible and dynamic resolution of function calls at runtime based on the actual type of the object, enabling powerful object-oriented programming techniques. Understanding how the vtable works and its implications on performance and memory usage is essential for writing efficient and effective C++ code.</p>
<h2 id="translation-unit">Translation Unit</h2>
<p>A <strong>translation unit</strong> is the ultimate input to a C++ compiler from which an object file is generated. It includes the content of a source file after preprocessing, which involves expanding all the <code>#include</code> directives, macro definitions, and other preprocessing directives.</p>
<h3 id="key-components-of-a-translation-unit">Key Components of a Translation Unit</h3>
<ol>
<li>
<p><strong>Source File Content</strong>:</p>
<ul>
<li>The main content of the <code>.cpp</code> file being compiled.</li>
</ul>
</li>
<li>
<p><strong>Included Header Files</strong>:</p>
<ul>
<li>The content of all the header files included via <code>#include</code> directives.</li>
</ul>
</li>
<li>
<p><strong>Expanded Macros</strong>:</p>
<ul>
<li>All macros are expanded according to their definitions.</li>
</ul>
</li>
<li>
<p><strong>Removed Comments</strong>:</p>
<ul>
<li>Comments are stripped out during preprocessing.</li>
</ul>
</li>
</ol>
<h3 id="example_2">Example</h3>
<p>Consider a simple example with two files: <code>main.cpp</code> and <code>utils.h</code>.</p>
<p><strong>main.cpp</strong>:
<div class="highlight"><pre><span></span><code><a id="__codelineno-49-1" name="__codelineno-49-1" href="#__codelineno-49-1"></a><span class="cp">#include</span><span class="w"> </span><span class="cpf">&quot;utils.h&quot;</span>
<a id="__codelineno-49-2" name="__codelineno-49-2" href="#__codelineno-49-2"></a><span class="cp">#include</span><span class="w"> </span><span class="cpf">&lt;iostream&gt;</span>
<a id="__codelineno-49-3" name="__codelineno-49-3" href="#__codelineno-49-3"></a>
<a id="__codelineno-49-4" name="__codelineno-49-4" href="#__codelineno-49-4"></a><span class="kt">int</span><span class="w"> </span><span class="nf">main</span><span class="p">()</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-49-5" name="__codelineno-49-5" href="#__codelineno-49-5"></a><span class="w">    </span><span class="n">std</span><span class="o">::</span><span class="n">cout</span><span class="w"> </span><span class="o">&lt;&lt;</span><span class="w"> </span><span class="s">&quot;Sum: &quot;</span><span class="w"> </span><span class="o">&lt;&lt;</span><span class="w"> </span><span class="n">add</span><span class="p">(</span><span class="mi">3</span><span class="p">,</span><span class="w"> </span><span class="mi">4</span><span class="p">)</span><span class="w"> </span><span class="o">&lt;&lt;</span><span class="w"> </span><span class="n">std</span><span class="o">::</span><span class="n">endl</span><span class="p">;</span>
<a id="__codelineno-49-6" name="__codelineno-49-6" href="#__codelineno-49-6"></a><span class="w">    </span><span class="k">return</span><span class="w"> </span><span class="mi">0</span><span class="p">;</span>
<a id="__codelineno-49-7" name="__codelineno-49-7" href="#__codelineno-49-7"></a><span class="p">}</span>
</code></pre></div></p>
<p><strong>utils.h</strong>:
<div class="highlight"><pre><span></span><code><a id="__codelineno-50-1" name="__codelineno-50-1" href="#__codelineno-50-1"></a><span class="cp">#ifndef UTILS_H</span>
<a id="__codelineno-50-2" name="__codelineno-50-2" href="#__codelineno-50-2"></a><span class="cp">#define UTILS_H</span>
<a id="__codelineno-50-3" name="__codelineno-50-3" href="#__codelineno-50-3"></a>
<a id="__codelineno-50-4" name="__codelineno-50-4" href="#__codelineno-50-4"></a><span class="kr">inline</span><span class="w"> </span><span class="kt">int</span><span class="w"> </span><span class="nf">add</span><span class="p">(</span><span class="kt">int</span><span class="w"> </span><span class="n">a</span><span class="p">,</span><span class="w"> </span><span class="kt">int</span><span class="w"> </span><span class="n">b</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-50-5" name="__codelineno-50-5" href="#__codelineno-50-5"></a><span class="w">    </span><span class="k">return</span><span class="w"> </span><span class="n">a</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="n">b</span><span class="p">;</span>
<a id="__codelineno-50-6" name="__codelineno-50-6" href="#__codelineno-50-6"></a><span class="p">}</span>
<a id="__codelineno-50-7" name="__codelineno-50-7" href="#__codelineno-50-7"></a>
<a id="__codelineno-50-8" name="__codelineno-50-8" href="#__codelineno-50-8"></a><span class="cp">#endif </span><span class="c1">// UTILS_H</span>
</code></pre></div></p>
<p>After preprocessing, <code>main.cpp</code> might look like this:</p>
<p><strong>Preprocessed main.cpp</strong>:
<div class="highlight"><pre><span></span><code><a id="__codelineno-51-1" name="__codelineno-51-1" href="#__codelineno-51-1"></a><span class="kr">inline</span><span class="w"> </span><span class="kt">int</span><span class="w"> </span><span class="nf">add</span><span class="p">(</span><span class="kt">int</span><span class="w"> </span><span class="n">a</span><span class="p">,</span><span class="w"> </span><span class="kt">int</span><span class="w"> </span><span class="n">b</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-51-2" name="__codelineno-51-2" href="#__codelineno-51-2"></a><span class="w">    </span><span class="k">return</span><span class="w"> </span><span class="n">a</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="n">b</span><span class="p">;</span>
<a id="__codelineno-51-3" name="__codelineno-51-3" href="#__codelineno-51-3"></a><span class="p">}</span>
<a id="__codelineno-51-4" name="__codelineno-51-4" href="#__codelineno-51-4"></a>
<a id="__codelineno-51-5" name="__codelineno-51-5" href="#__codelineno-51-5"></a><span class="kt">int</span><span class="w"> </span><span class="nf">main</span><span class="p">()</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-51-6" name="__codelineno-51-6" href="#__codelineno-51-6"></a><span class="w">    </span><span class="n">std</span><span class="o">::</span><span class="n">cout</span><span class="w"> </span><span class="o">&lt;&lt;</span><span class="w"> </span><span class="s">&quot;Sum: &quot;</span><span class="w"> </span><span class="o">&lt;&lt;</span><span class="w"> </span><span class="n">add</span><span class="p">(</span><span class="mi">3</span><span class="p">,</span><span class="w"> </span><span class="mi">4</span><span class="p">)</span><span class="w"> </span><span class="o">&lt;&lt;</span><span class="w"> </span><span class="n">std</span><span class="o">::</span><span class="n">endl</span><span class="p">;</span>
<a id="__codelineno-51-7" name="__codelineno-51-7" href="#__codelineno-51-7"></a><span class="w">    </span><span class="k">return</span><span class="w"> </span><span class="mi">0</span><span class="p">;</span>
<a id="__codelineno-51-8" name="__codelineno-51-8" href="#__codelineno-51-8"></a><span class="p">}</span>
</code></pre></div></p>
<h3 id="compilation-process">Compilation Process</h3>
<p>The process of compiling a C++ program involves several steps:</p>
<ol>
<li>
<p><strong>Preprocessing</strong>:</p>
<ul>
<li>The preprocessor handles all <code>#include</code> directives, macro expansions, and conditional compilations. It generates a single translation unit from the source file and its included headers.</li>
</ul>
</li>
<li>
<p><strong>Compilation</strong>:</p>
<ul>
<li>The compiler takes the preprocessed translation unit and converts it into assembly code for the target architecture.</li>
</ul>
</li>
<li>
<p><strong>Assembly</strong>:</p>
<ul>
<li>The assembler converts the assembly code into machine code, resulting in an object file (<code>.o</code> or <code>.obj</code>).</li>
</ul>
</li>
<li>
<p><strong>Linking</strong>:</p>
<ul>
<li>The linker combines multiple object files into a single executable or library, resolving references between them.</li>
</ul>
</li>
</ol>
<h3 id="translation-unit-boundaries">Translation Unit Boundaries</h3>
<p>Each <code>.cpp</code> file in your project typically results in one translation unit. This has several implications:</p>
<ul>
<li>
<p><strong>Separate Compilation</strong>:</p>
</li>
<li>
<p>Each <code>.cpp</code> file can be compiled independently, which speeds up the build process and allows for incremental builds.</p>
</li>
<li>
<p><strong>Symbol Visibility</strong>:</p>
</li>
<li>
<p>Symbols (e.g., variables, functions) defined in a translation unit are not visible to other translation units unless explicitly declared as <code>extern</code>.</p>
</li>
</ul>
<h3 id="impact-on-code-design">Impact on Code Design</h3>
<p>Understanding translation units is crucial for efficient and organized code design. Here are some important considerations:</p>
<ol>
<li>
<p><strong>Header Guards</strong>:</p>
<ul>
<li>Use include guards (<code>#ifndef</code>, <code>#define</code>, <code>#endif</code>) in header files to prevent multiple inclusions within a single translation unit.</li>
</ul>
</li>
<li>
<p><strong>Inline Functions</strong>:</p>
<ul>
<li>Define inline functions in header files to allow their inclusion in multiple translation units without violating the One Definition Rule (ODR).</li>
</ul>
</li>
<li>
<p><strong>Templates</strong>:</p>
<ul>
<li>Template definitions must be available in every translation unit that uses them. This typically means defining templates in header files.</li>
</ul>
</li>
<li>
<p><strong>Static Variables</strong>:</p>
<ul>
<li>Static variables have internal linkage and are restricted to the translation unit in which they are defined. This prevents naming conflicts across translation units.</li>
</ul>
</li>
</ol>
<h3 id="example-with-multiple-translation-units">Example with Multiple Translation Units</h3>
<p>Consider a more complex example with three files: <code>main.cpp</code>, <code>math.cpp</code>, and <code>math.h</code>.</p>
<p><strong>main.cpp</strong>:
<div class="highlight"><pre><span></span><code><a id="__codelineno-52-1" name="__codelineno-52-1" href="#__codelineno-52-1"></a><span class="cp">#include</span><span class="w"> </span><span class="cpf">&lt;iostream&gt;</span>
<a id="__codelineno-52-2" name="__codelineno-52-2" href="#__codelineno-52-2"></a><span class="cp">#include</span><span class="w"> </span><span class="cpf">&quot;math.h&quot;</span>
<a id="__codelineno-52-3" name="__codelineno-52-3" href="#__codelineno-52-3"></a>
<a id="__codelineno-52-4" name="__codelineno-52-4" href="#__codelineno-52-4"></a><span class="kt">int</span><span class="w"> </span><span class="nf">main</span><span class="p">()</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-52-5" name="__codelineno-52-5" href="#__codelineno-52-5"></a><span class="w">    </span><span class="n">std</span><span class="o">::</span><span class="n">cout</span><span class="w"> </span><span class="o">&lt;&lt;</span><span class="w"> </span><span class="s">&quot;Sum: &quot;</span><span class="w"> </span><span class="o">&lt;&lt;</span><span class="w"> </span><span class="n">add</span><span class="p">(</span><span class="mi">3</span><span class="p">,</span><span class="w"> </span><span class="mi">4</span><span class="p">)</span><span class="w"> </span><span class="o">&lt;&lt;</span><span class="w"> </span><span class="n">std</span><span class="o">::</span><span class="n">endl</span><span class="p">;</span>
<a id="__codelineno-52-6" name="__codelineno-52-6" href="#__codelineno-52-6"></a><span class="w">    </span><span class="n">std</span><span class="o">::</span><span class="n">cout</span><span class="w"> </span><span class="o">&lt;&lt;</span><span class="w"> </span><span class="s">&quot;Product: &quot;</span><span class="w"> </span><span class="o">&lt;&lt;</span><span class="w"> </span><span class="n">multiply</span><span class="p">(</span><span class="mi">3</span><span class="p">,</span><span class="w"> </span><span class="mi">4</span><span class="p">)</span><span class="w"> </span><span class="o">&lt;&lt;</span><span class="w"> </span><span class="n">std</span><span class="o">::</span><span class="n">endl</span><span class="p">;</span>
<a id="__codelineno-52-7" name="__codelineno-52-7" href="#__codelineno-52-7"></a><span class="w">    </span><span class="k">return</span><span class="w"> </span><span class="mi">0</span><span class="p">;</span>
<a id="__codelineno-52-8" name="__codelineno-52-8" href="#__codelineno-52-8"></a><span class="p">}</span>
</code></pre></div></p>
<p><strong>math.h</strong>:
<div class="highlight"><pre><span></span><code><a id="__codelineno-53-1" name="__codelineno-53-1" href="#__codelineno-53-1"></a><span class="cp">#ifndef MATH_H</span>
<a id="__codelineno-53-2" name="__codelineno-53-2" href="#__codelineno-53-2"></a><span class="cp">#define MATH_H</span>
<a id="__codelineno-53-3" name="__codelineno-53-3" href="#__codelineno-53-3"></a>
<a id="__codelineno-53-4" name="__codelineno-53-4" href="#__codelineno-53-4"></a><span class="kt">int</span><span class="w"> </span><span class="nf">add</span><span class="p">(</span><span class="kt">int</span><span class="w"> </span><span class="n">a</span><span class="p">,</span><span class="w"> </span><span class="kt">int</span><span class="w"> </span><span class="n">b</span><span class="p">);</span>
<a id="__codelineno-53-5" name="__codelineno-53-5" href="#__codelineno-53-5"></a><span class="kt">int</span><span class="w"> </span><span class="nf">multiply</span><span class="p">(</span><span class="kt">int</span><span class="w"> </span><span class="n">a</span><span class="p">,</span><span class="w"> </span><span class="kt">int</span><span class="w"> </span><span class="n">b</span><span class="p">);</span>
<a id="__codelineno-53-6" name="__codelineno-53-6" href="#__codelineno-53-6"></a>
<a id="__codelineno-53-7" name="__codelineno-53-7" href="#__codelineno-53-7"></a><span class="cp">#endif </span><span class="c1">// MATH_H</span>
</code></pre></div></p>
<p><strong>math.cpp</strong>:
<div class="highlight"><pre><span></span><code><a id="__codelineno-54-1" name="__codelineno-54-1" href="#__codelineno-54-1"></a><span class="cp">#include</span><span class="w"> </span><span class="cpf">&quot;math.h&quot;</span>
<a id="__codelineno-54-2" name="__codelineno-54-2" href="#__codelineno-54-2"></a>
<a id="__codelineno-54-3" name="__codelineno-54-3" href="#__codelineno-54-3"></a><span class="kt">int</span><span class="w"> </span><span class="nf">add</span><span class="p">(</span><span class="kt">int</span><span class="w"> </span><span class="n">a</span><span class="p">,</span><span class="w"> </span><span class="kt">int</span><span class="w"> </span><span class="n">b</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-54-4" name="__codelineno-54-4" href="#__codelineno-54-4"></a><span class="w">    </span><span class="k">return</span><span class="w"> </span><span class="n">a</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="n">b</span><span class="p">;</span>
<a id="__codelineno-54-5" name="__codelineno-54-5" href="#__codelineno-54-5"></a><span class="p">}</span>
<a id="__codelineno-54-6" name="__codelineno-54-6" href="#__codelineno-54-6"></a>
<a id="__codelineno-54-7" name="__codelineno-54-7" href="#__codelineno-54-7"></a><span class="kt">int</span><span class="w"> </span><span class="nf">multiply</span><span class="p">(</span><span class="kt">int</span><span class="w"> </span><span class="n">a</span><span class="p">,</span><span class="w"> </span><span class="kt">int</span><span class="w"> </span><span class="n">b</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-54-8" name="__codelineno-54-8" href="#__codelineno-54-8"></a><span class="w">    </span><span class="k">return</span><span class="w"> </span><span class="n">a</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="n">b</span><span class="p">;</span>
<a id="__codelineno-54-9" name="__codelineno-54-9" href="#__codelineno-54-9"></a><span class="p">}</span>
</code></pre></div></p>
<h3 id="compilation-process-for-multiple-files">Compilation Process for Multiple Files</h3>
<ol>
<li>
<p><strong>Compile main.cpp</strong>:</p>
<ul>
<li>Preprocessing combines <code>main.cpp</code> and <code>math.h</code>.</li>
<li>Compilation generates <code>main.o</code>.</li>
</ul>
</li>
<li>
<p><strong>Compile math.cpp</strong>:</p>
<ul>
<li>Preprocessing combines <code>math.cpp</code> and <code>math.h</code>.</li>
<li>Compilation generates <code>math.o</code>.</li>
</ul>
</li>
<li>
<p><strong>Linking</strong>:</p>
<ul>
<li>The linker combines <code>main.o</code> and <code>math.o</code> into a single executable.</li>
</ul>
</li>
</ol>
<div class="highlight"><pre><span></span><code><a id="__codelineno-55-1" name="__codelineno-55-1" href="#__codelineno-55-1"></a>g++<span class="w"> </span>-c<span class="w"> </span>main.cpp<span class="w"> </span>-o<span class="w"> </span>main.o
<a id="__codelineno-55-2" name="__codelineno-55-2" href="#__codelineno-55-2"></a>g++<span class="w"> </span>-c<span class="w"> </span>math.cpp<span class="w"> </span>-o<span class="w"> </span>math.o
<a id="__codelineno-55-3" name="__codelineno-55-3" href="#__codelineno-55-3"></a>g++<span class="w"> </span>main.o<span class="w"> </span>math.o<span class="w"> </span>-o<span class="w"> </span>myprogram
</code></pre></div>
<h3 id="summary">Summary</h3>
<ul>
<li>A <strong>translation unit</strong> is the result of the preprocessing step, which includes a single source file and all the headers it includes, minus comments and expanded macros.</li>
<li>Each source file (<code>.cpp</code>) typically results in one translation unit.</li>
<li>Understanding translation units is essential for effective code organization, efficient compilation, and proper symbol visibility management in C++ programs.</li>
</ul>
<h2 id="deep-copy-vs-shallow-copy">Deep Copy vs Shallow Copy</h2>
<p>Deep copy and shallow copy are two different methods of copying objects in programming, particularly in the context of copying the contents of objects that contain references to other objects. Understanding the difference between these two methods is crucial to avoid unintended side effects and ensure the correct behavior of your programs.</p>
<h3 id="shallow-copy">Shallow Copy</h3>
<p>A shallow copy of an object is a new object that is a copy of the original object, but it only copies the references to the original elements rather than the actual elements themselves. This means that if the original object contains references to other objects, the shallow copy will contain references to the same objects.</p>
<h4 id="example_3">Example</h4>
<p>Consider a simple class <code>Person</code> with a nested <code>Address</code> class:</p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-56-1" name="__codelineno-56-1" href="#__codelineno-56-1"></a><span class="cp">#include</span><span class="w"> </span><span class="cpf">&lt;iostream&gt;</span>
<a id="__codelineno-56-2" name="__codelineno-56-2" href="#__codelineno-56-2"></a><span class="cp">#include</span><span class="w"> </span><span class="cpf">&lt;string&gt;</span>
<a id="__codelineno-56-3" name="__codelineno-56-3" href="#__codelineno-56-3"></a><span class="k">using</span><span class="w"> </span><span class="k">namespace</span><span class="w"> </span><span class="nn">std</span><span class="p">;</span>
<a id="__codelineno-56-4" name="__codelineno-56-4" href="#__codelineno-56-4"></a>
<a id="__codelineno-56-5" name="__codelineno-56-5" href="#__codelineno-56-5"></a><span class="k">class</span><span class="w"> </span><span class="nc">Address</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-56-6" name="__codelineno-56-6" href="#__codelineno-56-6"></a><span class="k">public</span><span class="o">:</span>
<a id="__codelineno-56-7" name="__codelineno-56-7" href="#__codelineno-56-7"></a><span class="w">    </span><span class="n">string</span><span class="w"> </span><span class="n">city</span><span class="p">;</span>
<a id="__codelineno-56-8" name="__codelineno-56-8" href="#__codelineno-56-8"></a><span class="w">    </span><span class="n">string</span><span class="w"> </span><span class="n">street</span><span class="p">;</span>
<a id="__codelineno-56-9" name="__codelineno-56-9" href="#__codelineno-56-9"></a><span class="w">    </span><span class="kt">int</span><span class="w"> </span><span class="n">houseNumber</span><span class="p">;</span>
<a id="__codelineno-56-10" name="__codelineno-56-10" href="#__codelineno-56-10"></a>
<a id="__codelineno-56-11" name="__codelineno-56-11" href="#__codelineno-56-11"></a><span class="w">    </span><span class="n">Address</span><span class="p">(</span><span class="n">string</span><span class="w"> </span><span class="n">city</span><span class="p">,</span><span class="w"> </span><span class="n">string</span><span class="w"> </span><span class="n">street</span><span class="p">,</span><span class="w"> </span><span class="kt">int</span><span class="w"> </span><span class="n">houseNumber</span><span class="p">)</span>
<a id="__codelineno-56-12" name="__codelineno-56-12" href="#__codelineno-56-12"></a><span class="w">        </span><span class="o">:</span><span class="w"> </span><span class="n">city</span><span class="p">(</span><span class="n">city</span><span class="p">),</span><span class="w"> </span><span class="n">street</span><span class="p">(</span><span class="n">street</span><span class="p">),</span><span class="w"> </span><span class="n">houseNumber</span><span class="p">(</span><span class="n">houseNumber</span><span class="p">)</span><span class="w"> </span><span class="p">{}</span>
<a id="__codelineno-56-13" name="__codelineno-56-13" href="#__codelineno-56-13"></a><span class="p">};</span>
<a id="__codelineno-56-14" name="__codelineno-56-14" href="#__codelineno-56-14"></a>
<a id="__codelineno-56-15" name="__codelineno-56-15" href="#__codelineno-56-15"></a><span class="k">class</span><span class="w"> </span><span class="nc">Person</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-56-16" name="__codelineno-56-16" href="#__codelineno-56-16"></a><span class="k">public</span><span class="o">:</span>
<a id="__codelineno-56-17" name="__codelineno-56-17" href="#__codelineno-56-17"></a><span class="w">    </span><span class="n">string</span><span class="w"> </span><span class="n">name</span><span class="p">;</span>
<a id="__codelineno-56-18" name="__codelineno-56-18" href="#__codelineno-56-18"></a><span class="w">    </span><span class="kt">int</span><span class="w"> </span><span class="n">age</span><span class="p">;</span>
<a id="__codelineno-56-19" name="__codelineno-56-19" href="#__codelineno-56-19"></a><span class="w">    </span><span class="n">Address</span><span class="o">*</span><span class="w"> </span><span class="n">address</span><span class="p">;</span>
<a id="__codelineno-56-20" name="__codelineno-56-20" href="#__codelineno-56-20"></a>
<a id="__codelineno-56-21" name="__codelineno-56-21" href="#__codelineno-56-21"></a><span class="w">    </span><span class="n">Person</span><span class="p">(</span><span class="n">string</span><span class="w"> </span><span class="n">name</span><span class="p">,</span><span class="w"> </span><span class="kt">int</span><span class="w"> </span><span class="n">age</span><span class="p">,</span><span class="w"> </span><span class="n">Address</span><span class="o">*</span><span class="w"> </span><span class="n">address</span><span class="p">)</span>
<a id="__codelineno-56-22" name="__codelineno-56-22" href="#__codelineno-56-22"></a><span class="w">        </span><span class="o">:</span><span class="w"> </span><span class="n">name</span><span class="p">(</span><span class="n">name</span><span class="p">),</span><span class="w"> </span><span class="n">age</span><span class="p">(</span><span class="n">age</span><span class="p">),</span><span class="w"> </span><span class="n">address</span><span class="p">(</span><span class="n">address</span><span class="p">)</span><span class="w"> </span><span class="p">{}</span>
<a id="__codelineno-56-23" name="__codelineno-56-23" href="#__codelineno-56-23"></a>
<a id="__codelineno-56-24" name="__codelineno-56-24" href="#__codelineno-56-24"></a><span class="w">    </span><span class="c1">// Shallow copy constructor</span>
<a id="__codelineno-56-25" name="__codelineno-56-25" href="#__codelineno-56-25"></a><span class="w">    </span><span class="n">Person</span><span class="p">(</span><span class="k">const</span><span class="w"> </span><span class="n">Person</span><span class="o">&amp;</span><span class="w"> </span><span class="n">other</span><span class="p">)</span>
<a id="__codelineno-56-26" name="__codelineno-56-26" href="#__codelineno-56-26"></a><span class="w">        </span><span class="o">:</span><span class="w"> </span><span class="n">name</span><span class="p">(</span><span class="n">other</span><span class="p">.</span><span class="n">name</span><span class="p">),</span><span class="w"> </span><span class="n">age</span><span class="p">(</span><span class="n">other</span><span class="p">.</span><span class="n">age</span><span class="p">),</span><span class="w"> </span><span class="n">address</span><span class="p">(</span><span class="n">other</span><span class="p">.</span><span class="n">address</span><span class="p">)</span><span class="w"> </span><span class="p">{}</span>
<a id="__codelineno-56-27" name="__codelineno-56-27" href="#__codelineno-56-27"></a>
<a id="__codelineno-56-28" name="__codelineno-56-28" href="#__codelineno-56-28"></a><span class="w">    </span><span class="kt">void</span><span class="w"> </span><span class="n">print</span><span class="p">()</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-56-29" name="__codelineno-56-29" href="#__codelineno-56-29"></a><span class="w">        </span><span class="n">cout</span><span class="w"> </span><span class="o">&lt;&lt;</span><span class="w"> </span><span class="n">name</span><span class="w"> </span><span class="o">&lt;&lt;</span><span class="w"> </span><span class="s">&quot; (&quot;</span><span class="w"> </span><span class="o">&lt;&lt;</span><span class="w"> </span><span class="n">age</span><span class="w"> </span><span class="o">&lt;&lt;</span><span class="w"> </span><span class="s">&quot;) lives at &quot;</span><span class="w"> </span>
<a id="__codelineno-56-30" name="__codelineno-56-30" href="#__codelineno-56-30"></a><span class="w">             </span><span class="o">&lt;&lt;</span><span class="w"> </span><span class="n">address</span><span class="o">-&gt;</span><span class="n">houseNumber</span><span class="w"> </span><span class="o">&lt;&lt;</span><span class="w"> </span><span class="s">&quot; &quot;</span><span class="w"> </span><span class="o">&lt;&lt;</span><span class="w"> </span><span class="n">address</span><span class="o">-&gt;</span><span class="n">street</span><span class="w"> </span>
<a id="__codelineno-56-31" name="__codelineno-56-31" href="#__codelineno-56-31"></a><span class="w">             </span><span class="o">&lt;&lt;</span><span class="w"> </span><span class="s">&quot;, &quot;</span><span class="w"> </span><span class="o">&lt;&lt;</span><span class="w"> </span><span class="n">address</span><span class="o">-&gt;</span><span class="n">city</span><span class="w"> </span><span class="o">&lt;&lt;</span><span class="w"> </span><span class="n">endl</span><span class="p">;</span>
<a id="__codelineno-56-32" name="__codelineno-56-32" href="#__codelineno-56-32"></a><span class="w">    </span><span class="p">}</span>
<a id="__codelineno-56-33" name="__codelineno-56-33" href="#__codelineno-56-33"></a><span class="p">};</span>
<a id="__codelineno-56-34" name="__codelineno-56-34" href="#__codelineno-56-34"></a>
<a id="__codelineno-56-35" name="__codelineno-56-35" href="#__codelineno-56-35"></a><span class="kt">int</span><span class="w"> </span><span class="nf">main</span><span class="p">()</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-56-36" name="__codelineno-56-36" href="#__codelineno-56-36"></a><span class="w">    </span><span class="n">Address</span><span class="o">*</span><span class="w"> </span><span class="n">addr</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">new</span><span class="w"> </span><span class="n">Address</span><span class="p">(</span><span class="s">&quot;New York&quot;</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;5th Avenue&quot;</span><span class="p">,</span><span class="w"> </span><span class="mi">101</span><span class="p">);</span>
<a id="__codelineno-56-37" name="__codelineno-56-37" href="#__codelineno-56-37"></a><span class="w">    </span><span class="n">Person</span><span class="w"> </span><span class="n">person1</span><span class="p">(</span><span class="s">&quot;Alice&quot;</span><span class="p">,</span><span class="w"> </span><span class="mi">30</span><span class="p">,</span><span class="w"> </span><span class="n">addr</span><span class="p">);</span>
<a id="__codelineno-56-38" name="__codelineno-56-38" href="#__codelineno-56-38"></a><span class="w">    </span><span class="n">Person</span><span class="w"> </span><span class="n">person2</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">person1</span><span class="p">;</span><span class="w"> </span><span class="c1">// Shallow copy</span>
<a id="__codelineno-56-39" name="__codelineno-56-39" href="#__codelineno-56-39"></a>
<a id="__codelineno-56-40" name="__codelineno-56-40" href="#__codelineno-56-40"></a><span class="w">    </span><span class="n">person1</span><span class="p">.</span><span class="n">print</span><span class="p">();</span>
<a id="__codelineno-56-41" name="__codelineno-56-41" href="#__codelineno-56-41"></a><span class="w">    </span><span class="n">person2</span><span class="p">.</span><span class="n">print</span><span class="p">();</span>
<a id="__codelineno-56-42" name="__codelineno-56-42" href="#__codelineno-56-42"></a>
<a id="__codelineno-56-43" name="__codelineno-56-43" href="#__codelineno-56-43"></a><span class="w">    </span><span class="c1">// Modify the address of person2</span>
<a id="__codelineno-56-44" name="__codelineno-56-44" href="#__codelineno-56-44"></a><span class="w">    </span><span class="n">person2</span><span class="p">.</span><span class="n">address</span><span class="o">-&gt;</span><span class="n">houseNumber</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">202</span><span class="p">;</span>
<a id="__codelineno-56-45" name="__codelineno-56-45" href="#__codelineno-56-45"></a><span class="w">    </span><span class="n">person1</span><span class="p">.</span><span class="n">print</span><span class="p">();</span><span class="w"> </span><span class="c1">// The address of person1 is also changed</span>
<a id="__codelineno-56-46" name="__codelineno-56-46" href="#__codelineno-56-46"></a><span class="w">    </span><span class="n">person2</span><span class="p">.</span><span class="n">print</span><span class="p">();</span>
<a id="__codelineno-56-47" name="__codelineno-56-47" href="#__codelineno-56-47"></a>
<a id="__codelineno-56-48" name="__codelineno-56-48" href="#__codelineno-56-48"></a><span class="w">    </span><span class="k">return</span><span class="w"> </span><span class="mi">0</span><span class="p">;</span>
<a id="__codelineno-56-49" name="__codelineno-56-49" href="#__codelineno-56-49"></a><span class="p">}</span>
</code></pre></div>
<p>Output:
<div class="highlight"><pre><span></span><code><a id="__codelineno-57-1" name="__codelineno-57-1" href="#__codelineno-57-1"></a>Alice (30) lives at 101 5th Avenue, New York
<a id="__codelineno-57-2" name="__codelineno-57-2" href="#__codelineno-57-2"></a>Alice (30) lives at 101 5th Avenue, New York
<a id="__codelineno-57-3" name="__codelineno-57-3" href="#__codelineno-57-3"></a>Alice (30) lives at 202 5th Avenue, New York
<a id="__codelineno-57-4" name="__codelineno-57-4" href="#__codelineno-57-4"></a>Alice (30) lives at 202 5th Avenue, New York
</code></pre></div></p>
<p>In the example above, modifying the address of <code>person2</code> also affects <code>person1</code> because <code>person1</code> and <code>person2</code> share the same <code>Address</code> object.</p>
<h3 id="deep-copy">Deep Copy</h3>
<p>A deep copy of an object is a new object that is a copy of the original object, but it also creates copies of the objects referenced by the original object. This means that the new object is completely independent of the original object, and changes to the new object do not affect the original object.</p>
<h4 id="example_4">Example</h4>
<p>Using the same <code>Person</code> and <code>Address</code> classes, here is an implementation of a deep copy:</p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-58-1" name="__codelineno-58-1" href="#__codelineno-58-1"></a><span class="cp">#include</span><span class="w"> </span><span class="cpf">&lt;iostream&gt;</span>
<a id="__codelineno-58-2" name="__codelineno-58-2" href="#__codelineno-58-2"></a><span class="cp">#include</span><span class="w"> </span><span class="cpf">&lt;string&gt;</span>
<a id="__codelineno-58-3" name="__codelineno-58-3" href="#__codelineno-58-3"></a><span class="k">using</span><span class="w"> </span><span class="k">namespace</span><span class="w"> </span><span class="nn">std</span><span class="p">;</span>
<a id="__codelineno-58-4" name="__codelineno-58-4" href="#__codelineno-58-4"></a>
<a id="__codelineno-58-5" name="__codelineno-58-5" href="#__codelineno-58-5"></a><span class="k">class</span><span class="w"> </span><span class="nc">Address</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-58-6" name="__codelineno-58-6" href="#__codelineno-58-6"></a><span class="k">public</span><span class="o">:</span>
<a id="__codelineno-58-7" name="__codelineno-58-7" href="#__codelineno-58-7"></a><span class="w">    </span><span class="n">string</span><span class="w"> </span><span class="n">city</span><span class="p">;</span>
<a id="__codelineno-58-8" name="__codelineno-58-8" href="#__codelineno-58-8"></a><span class="w">    </span><span class="n">string</span><span class="w"> </span><span class="n">street</span><span class="p">;</span>
<a id="__codelineno-58-9" name="__codelineno-58-9" href="#__codelineno-58-9"></a><span class="w">    </span><span class="kt">int</span><span class="w"> </span><span class="n">houseNumber</span><span class="p">;</span>
<a id="__codelineno-58-10" name="__codelineno-58-10" href="#__codelineno-58-10"></a>
<a id="__codelineno-58-11" name="__codelineno-58-11" href="#__codelineno-58-11"></a><span class="w">    </span><span class="n">Address</span><span class="p">(</span><span class="n">string</span><span class="w"> </span><span class="n">city</span><span class="p">,</span><span class="w"> </span><span class="n">string</span><span class="w"> </span><span class="n">street</span><span class="p">,</span><span class="w"> </span><span class="kt">int</span><span class="w"> </span><span class="n">houseNumber</span><span class="p">)</span>
<a id="__codelineno-58-12" name="__codelineno-58-12" href="#__codelineno-58-12"></a><span class="w">        </span><span class="o">:</span><span class="w"> </span><span class="n">city</span><span class="p">(</span><span class="n">city</span><span class="p">),</span><span class="w"> </span><span class="n">street</span><span class="p">(</span><span class="n">street</span><span class="p">),</span><span class="w"> </span><span class="n">houseNumber</span><span class="p">(</span><span class="n">houseNumber</span><span class="p">)</span><span class="w"> </span><span class="p">{}</span>
<a id="__codelineno-58-13" name="__codelineno-58-13" href="#__codelineno-58-13"></a>
<a id="__codelineno-58-14" name="__codelineno-58-14" href="#__codelineno-58-14"></a><span class="w">    </span><span class="c1">// Deep copy constructor</span>
<a id="__codelineno-58-15" name="__codelineno-58-15" href="#__codelineno-58-15"></a><span class="w">    </span><span class="n">Address</span><span class="p">(</span><span class="k">const</span><span class="w"> </span><span class="n">Address</span><span class="o">&amp;</span><span class="w"> </span><span class="n">other</span><span class="p">)</span>
<a id="__codelineno-58-16" name="__codelineno-58-16" href="#__codelineno-58-16"></a><span class="w">        </span><span class="o">:</span><span class="w"> </span><span class="n">city</span><span class="p">(</span><span class="n">other</span><span class="p">.</span><span class="n">city</span><span class="p">),</span><span class="w"> </span><span class="n">street</span><span class="p">(</span><span class="n">other</span><span class="p">.</span><span class="n">street</span><span class="p">),</span><span class="w"> </span><span class="n">houseNumber</span><span class="p">(</span><span class="n">other</span><span class="p">.</span><span class="n">houseNumber</span><span class="p">)</span><span class="w"> </span><span class="p">{}</span>
<a id="__codelineno-58-17" name="__codelineno-58-17" href="#__codelineno-58-17"></a><span class="p">};</span>
<a id="__codelineno-58-18" name="__codelineno-58-18" href="#__codelineno-58-18"></a>
<a id="__codelineno-58-19" name="__codelineno-58-19" href="#__codelineno-58-19"></a><span class="k">class</span><span class="w"> </span><span class="nc">Person</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-58-20" name="__codelineno-58-20" href="#__codelineno-58-20"></a><span class="k">public</span><span class="o">:</span>
<a id="__codelineno-58-21" name="__codelineno-58-21" href="#__codelineno-58-21"></a><span class="w">    </span><span class="n">string</span><span class="w"> </span><span class="n">name</span><span class="p">;</span>
<a id="__codelineno-58-22" name="__codelineno-58-22" href="#__codelineno-58-22"></a><span class="w">    </span><span class="kt">int</span><span class="w"> </span><span class="n">age</span><span class="p">;</span>
<a id="__codelineno-58-23" name="__codelineno-58-23" href="#__codelineno-58-23"></a><span class="w">    </span><span class="n">Address</span><span class="o">*</span><span class="w"> </span><span class="n">address</span><span class="p">;</span>
<a id="__codelineno-58-24" name="__codelineno-58-24" href="#__codelineno-58-24"></a>
<a id="__codelineno-58-25" name="__codelineno-58-25" href="#__codelineno-58-25"></a><span class="w">    </span><span class="n">Person</span><span class="p">(</span><span class="n">string</span><span class="w"> </span><span class="n">name</span><span class="p">,</span><span class="w"> </span><span class="kt">int</span><span class="w"> </span><span class="n">age</span><span class="p">,</span><span class="w"> </span><span class="n">Address</span><span class="o">*</span><span class="w"> </span><span class="n">address</span><span class="p">)</span>
<a id="__codelineno-58-26" name="__codelineno-58-26" href="#__codelineno-58-26"></a><span class="w">        </span><span class="o">:</span><span class="w"> </span><span class="n">name</span><span class="p">(</span><span class="n">name</span><span class="p">),</span><span class="w"> </span><span class="n">age</span><span class="p">(</span><span class="n">age</span><span class="p">),</span><span class="w"> </span><span class="n">address</span><span class="p">(</span><span class="k">new</span><span class="w"> </span><span class="n">Address</span><span class="p">(</span><span class="o">*</span><span class="n">address</span><span class="p">))</span><span class="w"> </span><span class="p">{}</span>
<a id="__codelineno-58-27" name="__codelineno-58-27" href="#__codelineno-58-27"></a>
<a id="__codelineno-58-28" name="__codelineno-58-28" href="#__codelineno-58-28"></a><span class="w">    </span><span class="c1">// Deep copy constructor</span>
<a id="__codelineno-58-29" name="__codelineno-58-29" href="#__codelineno-58-29"></a><span class="w">    </span><span class="n">Person</span><span class="p">(</span><span class="k">const</span><span class="w"> </span><span class="n">Person</span><span class="o">&amp;</span><span class="w"> </span><span class="n">other</span><span class="p">)</span>
<a id="__codelineno-58-30" name="__codelineno-58-30" href="#__codelineno-58-30"></a><span class="w">        </span><span class="o">:</span><span class="w"> </span><span class="n">name</span><span class="p">(</span><span class="n">other</span><span class="p">.</span><span class="n">name</span><span class="p">),</span><span class="w"> </span><span class="n">age</span><span class="p">(</span><span class="n">other</span><span class="p">.</span><span class="n">age</span><span class="p">),</span><span class="w"> </span><span class="n">address</span><span class="p">(</span><span class="k">new</span><span class="w"> </span><span class="n">Address</span><span class="p">(</span><span class="o">*</span><span class="n">other</span><span class="p">.</span><span class="n">address</span><span class="p">))</span><span class="w"> </span><span class="p">{}</span>
<a id="__codelineno-58-31" name="__codelineno-58-31" href="#__codelineno-58-31"></a>
<a id="__codelineno-58-32" name="__codelineno-58-32" href="#__codelineno-58-32"></a><span class="w">    </span><span class="o">~</span><span class="n">Person</span><span class="p">()</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-58-33" name="__codelineno-58-33" href="#__codelineno-58-33"></a><span class="w">        </span><span class="k">delete</span><span class="w"> </span><span class="n">address</span><span class="p">;</span>
<a id="__codelineno-58-34" name="__codelineno-58-34" href="#__codelineno-58-34"></a><span class="w">    </span><span class="p">}</span>
<a id="__codelineno-58-35" name="__codelineno-58-35" href="#__codelineno-58-35"></a>
<a id="__codelineno-58-36" name="__codelineno-58-36" href="#__codelineno-58-36"></a><span class="w">    </span><span class="kt">void</span><span class="w"> </span><span class="n">print</span><span class="p">()</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-58-37" name="__codelineno-58-37" href="#__codelineno-58-37"></a><span class="w">        </span><span class="n">cout</span><span class="w"> </span><span class="o">&lt;&lt;</span><span class="w"> </span><span class="n">name</span><span class="w"> </span><span class="o">&lt;&lt;</span><span class="w"> </span><span class="s">&quot; (&quot;</span><span class="w"> </span><span class="o">&lt;&lt;</span><span class="w"> </span><span class="n">age</span><span class="w"> </span><span class="o">&lt;&lt;</span><span class="w"> </span><span class="s">&quot;) lives at &quot;</span><span class="w"> </span>
<a id="__codelineno-58-38" name="__codelineno-58-38" href="#__codelineno-58-38"></a><span class="w">             </span><span class="o">&lt;&lt;</span><span class="w"> </span><span class="n">address</span><span class="o">-&gt;</span><span class="n">houseNumber</span><span class="w"> </span><span class="o">&lt;&lt;</span><span class="w"> </span><span class="s">&quot; &quot;</span><span class="w"> </span><span class="o">&lt;&lt;</span><span class="w"> </span><span class="n">address</span><span class="o">-&gt;</span><span class="n">street</span><span class="w"> </span>
<a id="__codelineno-58-39" name="__codelineno-58-39" href="#__codelineno-58-39"></a><span class="w">             </span><span class="o">&lt;&lt;</span><span class="w"> </span><span class="s">&quot;, &quot;</span><span class="w"> </span><span class="o">&lt;&lt;</span><span class="w"> </span><span class="n">address</span><span class="o">-&gt;</span><span class="n">city</span><span class="w"> </span><span class="o">&lt;&lt;</span><span class="w"> </span><span class="n">endl</span><span class="p">;</span>
<a id="__codelineno-58-40" name="__codelineno-58-40" href="#__codelineno-58-40"></a><span class="w">    </span><span class="p">}</span>
<a id="__codelineno-58-41" name="__codelineno-58-41" href="#__codelineno-58-41"></a><span class="p">};</span>
<a id="__codelineno-58-42" name="__codelineno-58-42" href="#__codelineno-58-42"></a>
<a id="__codelineno-58-43" name="__codelineno-58-43" href="#__codelineno-58-43"></a><span class="kt">int</span><span class="w"> </span><span class="nf">main</span><span class="p">()</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-58-44" name="__codelineno-58-44" href="#__codelineno-58-44"></a><span class="w">    </span><span class="n">Address</span><span class="o">*</span><span class="w"> </span><span class="n">addr</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">new</span><span class="w"> </span><span class="n">Address</span><span class="p">(</span><span class="s">&quot;New York&quot;</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;5th Avenue&quot;</span><span class="p">,</span><span class="w"> </span><span class="mi">101</span><span class="p">);</span>
<a id="__codelineno-58-45" name="__codelineno-58-45" href="#__codelineno-58-45"></a><span class="w">    </span><span class="n">Person</span><span class="w"> </span><span class="n">person1</span><span class="p">(</span><span class="s">&quot;Alice&quot;</span><span class="p">,</span><span class="w"> </span><span class="mi">30</span><span class="p">,</span><span class="w"> </span><span class="n">addr</span><span class="p">);</span>
<a id="__codelineno-58-46" name="__codelineno-58-46" href="#__codelineno-58-46"></a><span class="w">    </span><span class="n">Person</span><span class="w"> </span><span class="n">person2</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">person1</span><span class="p">;</span><span class="w"> </span><span class="c1">// Deep copy</span>
<a id="__codelineno-58-47" name="__codelineno-58-47" href="#__codelineno-58-47"></a>
<a id="__codelineno-58-48" name="__codelineno-58-48" href="#__codelineno-58-48"></a><span class="w">    </span><span class="n">person1</span><span class="p">.</span><span class="n">print</span><span class="p">();</span>
<a id="__codelineno-58-49" name="__codelineno-58-49" href="#__codelineno-58-49"></a><span class="w">    </span><span class="n">person2</span><span class="p">.</span><span class="n">print</span><span class="p">();</span>
<a id="__codelineno-58-50" name="__codelineno-58-50" href="#__codelineno-58-50"></a>
<a id="__codelineno-58-51" name="__codelineno-58-51" href="#__codelineno-58-51"></a><span class="w">    </span><span class="c1">// Modify the address of person2</span>
<a id="__codelineno-58-52" name="__codelineno-58-52" href="#__codelineno-58-52"></a><span class="w">    </span><span class="n">person2</span><span class="p">.</span><span class="n">address</span><span class="o">-&gt;</span><span class="n">houseNumber</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">202</span><span class="p">;</span>
<a id="__codelineno-58-53" name="__codelineno-58-53" href="#__codelineno-58-53"></a><span class="w">    </span><span class="n">person1</span><span class="p">.</span><span class="n">print</span><span class="p">();</span><span class="w"> </span><span class="c1">// The address of person1 remains unchanged</span>
<a id="__codelineno-58-54" name="__codelineno-58-54" href="#__codelineno-58-54"></a><span class="w">    </span><span class="n">person2</span><span class="p">.</span><span class="n">print</span><span class="p">();</span>
<a id="__codelineno-58-55" name="__codelineno-58-55" href="#__codelineno-58-55"></a>
<a id="__codelineno-58-56" name="__codelineno-58-56" href="#__codelineno-58-56"></a><span class="w">    </span><span class="k">delete</span><span class="w"> </span><span class="n">addr</span><span class="p">;</span>
<a id="__codelineno-58-57" name="__codelineno-58-57" href="#__codelineno-58-57"></a>
<a id="__codelineno-58-58" name="__codelineno-58-58" href="#__codelineno-58-58"></a><span class="w">    </span><span class="k">return</span><span class="w"> </span><span class="mi">0</span><span class="p">;</span>
<a id="__codelineno-58-59" name="__codelineno-58-59" href="#__codelineno-58-59"></a><span class="p">}</span>
</code></pre></div>
<p>Output:
<div class="highlight"><pre><span></span><code><a id="__codelineno-59-1" name="__codelineno-59-1" href="#__codelineno-59-1"></a>Alice (30) lives at 101 5th Avenue, New York
<a id="__codelineno-59-2" name="__codelineno-59-2" href="#__codelineno-59-2"></a>Alice (30) lives at 101 5th Avenue, New York
<a id="__codelineno-59-3" name="__codelineno-59-3" href="#__codelineno-59-3"></a>Alice (30) lives at 101 5th Avenue, New York
<a id="__codelineno-59-4" name="__codelineno-59-4" href="#__codelineno-59-4"></a>Alice (30) lives at 202 5th Avenue, New York
</code></pre></div></p>
<p>In this example, modifying the address of <code>person2</code> does not affect <code>person1</code> because <code>person1</code> and <code>person2</code> have their own independent copies of the <code>Address</code> object.</p>
<h3 id="key-differences">Key Differences</h3>
<ul>
<li>
<p><strong>Shallow Copy</strong>:</p>
<ul>
<li>Copies the references to the objects.</li>
<li>Changes to the copied object will reflect in the original object if they share references.</li>
<li>Faster and less memory-intensive than a deep copy.</li>
<li>Suitable when you do not need independent copies of the referenced objects.</li>
</ul>
</li>
<li>
<p><strong>Deep Copy</strong>:</p>
<ul>
<li>Creates copies of the objects referenced.</li>
<li>Changes to the copied object do not affect the original object.</li>
<li>More memory-intensive and slower than a shallow copy.</li>
<li>Necessary when you need completely independent copies of the objects.</li>
</ul>
</li>
</ul>
<h3 id="use-cases_1">Use Cases</h3>
<ul>
<li>
<p><strong>Shallow Copy</strong>: Useful when working with objects where shared state is acceptable or beneficial. For instance, when dealing with large data structures where duplication of data would be inefficient.</p>
</li>
<li>
<p><strong>Deep Copy</strong>: Necessary when objects need to be completely independent, such as when passing objects to functions that modify their state and ensuring that the original data remains unchanged.</p>
</li>
</ul>
<p>Understanding when to use shallow copy and when to use deep copy is crucial for writing efficient and bug-free code, especially in complex systems with multiple interdependent objects.</p>
<h2 id="object-oriented-programming-complexities">Object-Oriented Programming Complexities</h2>
<h3 id="object-slicing-and-how-to-prevent-it">Object Slicing and How to Prevent It</h3>
<p>Object slicing occurs when a derived class object is assigned to a base class object, causing the derived part to be "sliced off".</p>
<p>Example of object slicing:</p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-60-1" name="__codelineno-60-1" href="#__codelineno-60-1"></a><span class="k">class</span><span class="w"> </span><span class="nc">Base</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-60-2" name="__codelineno-60-2" href="#__codelineno-60-2"></a><span class="k">public</span><span class="o">:</span>
<a id="__codelineno-60-3" name="__codelineno-60-3" href="#__codelineno-60-3"></a><span class="w">    </span><span class="kt">int</span><span class="w"> </span><span class="n">baseData</span><span class="p">;</span>
<a id="__codelineno-60-4" name="__codelineno-60-4" href="#__codelineno-60-4"></a><span class="w">    </span><span class="k">virtual</span><span class="w"> </span><span class="kt">void</span><span class="w"> </span><span class="nf">print</span><span class="p">()</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="n">std</span><span class="o">::</span><span class="n">cout</span><span class="w"> </span><span class="o">&lt;&lt;</span><span class="w"> </span><span class="s">&quot;Base: &quot;</span><span class="w"> </span><span class="o">&lt;&lt;</span><span class="w"> </span><span class="n">baseData</span><span class="w"> </span><span class="o">&lt;&lt;</span><span class="w"> </span><span class="n">std</span><span class="o">::</span><span class="n">endl</span><span class="p">;</span><span class="w"> </span><span class="p">}</span>
<a id="__codelineno-60-5" name="__codelineno-60-5" href="#__codelineno-60-5"></a><span class="p">};</span>
<a id="__codelineno-60-6" name="__codelineno-60-6" href="#__codelineno-60-6"></a>
<a id="__codelineno-60-7" name="__codelineno-60-7" href="#__codelineno-60-7"></a><span class="k">class</span><span class="w"> </span><span class="nc">Derived</span><span class="w"> </span><span class="o">:</span><span class="w"> </span><span class="k">public</span><span class="w"> </span><span class="n">Base</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-60-8" name="__codelineno-60-8" href="#__codelineno-60-8"></a><span class="k">public</span><span class="o">:</span>
<a id="__codelineno-60-9" name="__codelineno-60-9" href="#__codelineno-60-9"></a><span class="w">    </span><span class="kt">int</span><span class="w"> </span><span class="n">derivedData</span><span class="p">;</span>
<a id="__codelineno-60-10" name="__codelineno-60-10" href="#__codelineno-60-10"></a><span class="w">    </span><span class="kt">void</span><span class="w"> </span><span class="nf">print</span><span class="p">()</span><span class="w"> </span><span class="k">override</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="n">std</span><span class="o">::</span><span class="n">cout</span><span class="w"> </span><span class="o">&lt;&lt;</span><span class="w"> </span><span class="s">&quot;Derived: &quot;</span><span class="w"> </span><span class="o">&lt;&lt;</span><span class="w"> </span><span class="n">baseData</span><span class="w"> </span><span class="o">&lt;&lt;</span><span class="w"> </span><span class="s">&quot;, &quot;</span><span class="w"> </span><span class="o">&lt;&lt;</span><span class="w"> </span><span class="n">derivedData</span><span class="w"> </span><span class="o">&lt;&lt;</span><span class="w"> </span><span class="n">std</span><span class="o">::</span><span class="n">endl</span><span class="p">;</span><span class="w"> </span><span class="p">}</span>
<a id="__codelineno-60-11" name="__codelineno-60-11" href="#__codelineno-60-11"></a><span class="p">};</span>
<a id="__codelineno-60-12" name="__codelineno-60-12" href="#__codelineno-60-12"></a>
<a id="__codelineno-60-13" name="__codelineno-60-13" href="#__codelineno-60-13"></a><span class="n">Base</span><span class="w"> </span><span class="n">b</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">Derived</span><span class="p">();</span><span class="w"> </span><span class="c1">// Object slicing occurs here</span>
</code></pre></div>
<p>To prevent object slicing:</p>
<ol>
<li>Use pointers or references to base class</li>
<li>Make the base class abstract</li>
<li>Delete the copy constructor and assignment operator in the base class</li>
</ol>
<p>Example of preventing slicing:</p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-61-1" name="__codelineno-61-1" href="#__codelineno-61-1"></a><span class="k">class</span><span class="w"> </span><span class="nc">Base</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-61-2" name="__codelineno-61-2" href="#__codelineno-61-2"></a><span class="k">public</span><span class="o">:</span>
<a id="__codelineno-61-3" name="__codelineno-61-3" href="#__codelineno-61-3"></a><span class="w">    </span><span class="k">virtual</span><span class="w"> </span><span class="kt">void</span><span class="w"> </span><span class="n">print</span><span class="p">()</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">0</span><span class="p">;</span><span class="w"> </span><span class="c1">// Pure virtual function</span>
<a id="__codelineno-61-4" name="__codelineno-61-4" href="#__codelineno-61-4"></a><span class="w">    </span><span class="n">Base</span><span class="p">(</span><span class="k">const</span><span class="w"> </span><span class="n">Base</span><span class="o">&amp;</span><span class="p">)</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">delete</span><span class="p">;</span><span class="w"> </span><span class="c1">// Deleted copy constructor</span>
<a id="__codelineno-61-5" name="__codelineno-61-5" href="#__codelineno-61-5"></a><span class="w">    </span><span class="n">Base</span><span class="o">&amp;</span><span class="w"> </span><span class="k">operator</span><span class="o">=</span><span class="p">(</span><span class="k">const</span><span class="w"> </span><span class="n">Base</span><span class="o">&amp;</span><span class="p">)</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">delete</span><span class="p">;</span><span class="w"> </span><span class="c1">// Deleted assignment operator</span>
<a id="__codelineno-61-6" name="__codelineno-61-6" href="#__codelineno-61-6"></a><span class="k">protected</span><span class="o">:</span>
<a id="__codelineno-61-7" name="__codelineno-61-7" href="#__codelineno-61-7"></a><span class="w">    </span><span class="n">Base</span><span class="p">()</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">default</span><span class="p">;</span><span class="w"> </span><span class="c1">// Protected constructor</span>
<a id="__codelineno-61-8" name="__codelineno-61-8" href="#__codelineno-61-8"></a><span class="p">};</span>
</code></pre></div>
<h4 id="explanation">Explanation</h4>
<p>Object slicing is a term used in C++ to describe a situation where an object of a derived class is assigned to an object of a base class, and the derived class's additional data members are "sliced off" or lost. This can lead to unexpected behavior or bugs in the program.</p>
<p>Object slicing occurs when an object of a derived class is assigned to an object of a base class using a copy constructor or assignment operator that is not virtual. When this happens, the copy constructor or assignment operator of the base class is called, which only copies the data members of the base class. Any additional data members of the derived class are not copied, and their values are lost.</p>
<p>Here's an example to illustrate object slicing:</p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-62-1" name="__codelineno-62-1" href="#__codelineno-62-1"></a><span class="cp">#include</span><span class="w"> </span><span class="cpf">&lt;iostream&gt;</span>
<a id="__codelineno-62-2" name="__codelineno-62-2" href="#__codelineno-62-2"></a>
<a id="__codelineno-62-3" name="__codelineno-62-3" href="#__codelineno-62-3"></a><span class="k">class</span><span class="w"> </span><span class="nc">Base</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-62-4" name="__codelineno-62-4" href="#__codelineno-62-4"></a><span class="k">public</span><span class="o">:</span>
<a id="__codelineno-62-5" name="__codelineno-62-5" href="#__codelineno-62-5"></a><span class="w">    </span><span class="n">Base</span><span class="p">(</span><span class="kt">int</span><span class="w"> </span><span class="n">x</span><span class="p">)</span><span class="w"> </span><span class="o">:</span><span class="w"> </span><span class="n">x_</span><span class="p">(</span><span class="n">x</span><span class="p">)</span><span class="w"> </span><span class="p">{}</span>
<a id="__codelineno-62-6" name="__codelineno-62-6" href="#__codelineno-62-6"></a><span class="w">    </span><span class="k">virtual</span><span class="w"> </span><span class="kt">void</span><span class="w"> </span><span class="n">print</span><span class="p">()</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-62-7" name="__codelineno-62-7" href="#__codelineno-62-7"></a><span class="w">        </span><span class="n">std</span><span class="o">::</span><span class="n">cout</span><span class="w"> </span><span class="o">&lt;&lt;</span><span class="w"> </span><span class="s">&quot;Base: &quot;</span><span class="w"> </span><span class="o">&lt;&lt;</span><span class="w"> </span><span class="n">x_</span><span class="w"> </span><span class="o">&lt;&lt;</span><span class="w"> </span><span class="n">std</span><span class="o">::</span><span class="n">endl</span><span class="p">;</span>
<a id="__codelineno-62-8" name="__codelineno-62-8" href="#__codelineno-62-8"></a><span class="w">    </span><span class="p">}</span>
<a id="__codelineno-62-9" name="__codelineno-62-9" href="#__codelineno-62-9"></a><span class="k">private</span><span class="o">:</span>
<a id="__codelineno-62-10" name="__codelineno-62-10" href="#__codelineno-62-10"></a><span class="w">    </span><span class="kt">int</span><span class="w"> </span><span class="n">x_</span><span class="p">;</span>
<a id="__codelineno-62-11" name="__codelineno-62-11" href="#__codelineno-62-11"></a><span class="p">};</span>
<a id="__codelineno-62-12" name="__codelineno-62-12" href="#__codelineno-62-12"></a>
<a id="__codelineno-62-13" name="__codelineno-62-13" href="#__codelineno-62-13"></a><span class="k">class</span><span class="w"> </span><span class="nc">Derived</span><span class="w"> </span><span class="o">:</span><span class="w"> </span><span class="k">public</span><span class="w"> </span><span class="n">Base</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-62-14" name="__codelineno-62-14" href="#__codelineno-62-14"></a><span class="k">public</span><span class="o">:</span>
<a id="__codelineno-62-15" name="__codelineno-62-15" href="#__codelineno-62-15"></a><span class="w">    </span><span class="n">Derived</span><span class="p">(</span><span class="kt">int</span><span class="w"> </span><span class="n">x</span><span class="p">,</span><span class="w"> </span><span class="kt">int</span><span class="w"> </span><span class="n">y</span><span class="p">)</span><span class="w"> </span><span class="o">:</span><span class="w"> </span><span class="n">Base</span><span class="p">(</span><span class="n">x</span><span class="p">),</span><span class="w"> </span><span class="n">y_</span><span class="p">(</span><span class="n">y</span><span class="p">)</span><span class="w"> </span><span class="p">{}</span>
<a id="__codelineno-62-16" name="__codelineno-62-16" href="#__codelineno-62-16"></a><span class="w">    </span><span class="kt">void</span><span class="w"> </span><span class="n">print</span><span class="p">()</span><span class="w"> </span><span class="k">override</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-62-17" name="__codelineno-62-17" href="#__codelineno-62-17"></a><span class="w">        </span><span class="n">std</span><span class="o">::</span><span class="n">cout</span><span class="w"> </span><span class="o">&lt;&lt;</span><span class="w"> </span><span class="s">&quot;Derived: &quot;</span><span class="w"> </span><span class="o">&lt;&lt;</span><span class="w"> </span><span class="n">x_</span><span class="w"> </span><span class="o">&lt;&lt;</span><span class="w"> </span><span class="s">&quot;, &quot;</span><span class="w"> </span><span class="o">&lt;&lt;</span><span class="w"> </span><span class="n">y_</span><span class="w"> </span><span class="o">&lt;&lt;</span><span class="w"> </span><span class="n">std</span><span class="o">::</span><span class="n">endl</span><span class="p">;</span>
<a id="__codelineno-62-18" name="__codelineno-62-18" href="#__codelineno-62-18"></a><span class="w">    </span><span class="p">}</span>
<a id="__codelineno-62-19" name="__codelineno-62-19" href="#__codelineno-62-19"></a><span class="k">private</span><span class="o">:</span>
<a id="__codelineno-62-20" name="__codelineno-62-20" href="#__codelineno-62-20"></a><span class="w">    </span><span class="kt">int</span><span class="w"> </span><span class="n">y_</span><span class="p">;</span>
<a id="__codelineno-62-21" name="__codelineno-62-21" href="#__codelineno-62-21"></a><span class="p">};</span>
<a id="__codelineno-62-22" name="__codelineno-62-22" href="#__codelineno-62-22"></a>
<a id="__codelineno-62-23" name="__codelineno-62-23" href="#__codelineno-62-23"></a><span class="kt">int</span><span class="w"> </span><span class="nf">main</span><span class="p">()</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-62-24" name="__codelineno-62-24" href="#__codelineno-62-24"></a><span class="w">    </span><span class="n">Derived</span><span class="w"> </span><span class="n">d</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span><span class="w"> </span><span class="mi">2</span><span class="p">);</span>
<a id="__codelineno-62-25" name="__codelineno-62-25" href="#__codelineno-62-25"></a><span class="w">    </span><span class="n">Base</span><span class="w"> </span><span class="n">b</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">d</span><span class="p">;</span><span class="w"> </span><span class="c1">// object slicing occurs here</span>
<a id="__codelineno-62-26" name="__codelineno-62-26" href="#__codelineno-62-26"></a><span class="w">    </span><span class="n">b</span><span class="p">.</span><span class="n">print</span><span class="p">();</span><span class="w"> </span><span class="c1">// prints &quot;Base: 1&quot;</span>
<a id="__codelineno-62-27" name="__codelineno-62-27" href="#__codelineno-62-27"></a><span class="w">    </span><span class="k">return</span><span class="w"> </span><span class="mi">0</span><span class="p">;</span>
<a id="__codelineno-62-28" name="__codelineno-62-28" href="#__codelineno-62-28"></a><span class="p">}</span>
</code></pre></div>
<p>In this example, we have a base class <code>Base</code> and a derived class <code>Derived</code>. The <code>Derived</code> class has an additional data member <code>y_</code> that is not present in the <code>Base</code> class. When we create an object of the <code>Derived</code> class <code>d</code> and assign it to an object of the <code>Base</code> class <code>b</code>, object slicing occurs. The copy constructor of the <code>Base</code> class is called, which only copies the data member <code>x_</code> of the <code>Base</code> class. The data member <code>y_</code> of the <code>Derived</code> class is not copied, and its value is lost. When we call the <code>print</code> function on the <code>Base</code> object <code>b</code>, it prints the value of <code>x_</code>, but not the value of <code>y_</code>.</p>
<p>Object slicing can be a source of bugs in C++ programs, especially when working with polymorphic classes. To avoid object slicing, it's important to use pointers or references to base classes when working with derived classes, and to ensure that the copy constructor and assignment operator of the base class are virtual. This allows the correct copy constructor or assignment operator of the derived class to be called, which will copy all of the data members of the derived class.</p>
<p>Here's an example that avoids object slicing:</p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-63-1" name="__codelineno-63-1" href="#__codelineno-63-1"></a><span class="cp">#include</span><span class="w"> </span><span class="cpf">&lt;iostream&gt;</span>
<a id="__codelineno-63-2" name="__codelineno-63-2" href="#__codelineno-63-2"></a><span class="cp">#include</span><span class="w"> </span><span class="cpf">&lt;memory&gt;</span>
<a id="__codelineno-63-3" name="__codelineno-63-3" href="#__codelineno-63-3"></a>
<a id="__codelineno-63-4" name="__codelineno-63-4" href="#__codelineno-63-4"></a><span class="k">class</span><span class="w"> </span><span class="nc">Base</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-63-5" name="__codelineno-63-5" href="#__codelineno-63-5"></a><span class="k">public</span><span class="o">:</span>
<a id="__codelineno-63-6" name="__codelineno-63-6" href="#__codelineno-63-6"></a><span class="w">    </span><span class="n">Base</span><span class="p">(</span><span class="kt">int</span><span class="w"> </span><span class="n">x</span><span class="p">)</span><span class="w"> </span><span class="o">:</span><span class="w"> </span><span class="n">x_</span><span class="p">(</span><span class="n">x</span><span class="p">)</span><span class="w"> </span><span class="p">{}</span>
<a id="__codelineno-63-7" name="__codelineno-63-7" href="#__codelineno-63-7"></a><span class="w">    </span><span class="k">virtual</span><span class="w"> </span><span class="o">~</span><span class="n">Base</span><span class="p">()</span><span class="w"> </span><span class="p">{}</span>
<a id="__codelineno-63-8" name="__codelineno-63-8" href="#__codelineno-63-8"></a><span class="w">    </span><span class="k">virtual</span><span class="w"> </span><span class="kt">void</span><span class="w"> </span><span class="n">print</span><span class="p">()</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-63-9" name="__codelineno-63-9" href="#__codelineno-63-9"></a><span class="w">        </span><span class="n">std</span><span class="o">::</span><span class="n">cout</span><span class="w"> </span><span class="o">&lt;&lt;</span><span class="w"> </span><span class="s">&quot;Base: &quot;</span><span class="w"> </span><span class="o">&lt;&lt;</span><span class="w"> </span><span class="n">x_</span><span class="w"> </span><span class="o">&lt;&lt;</span><span class="w"> </span><span class="n">std</span><span class="o">::</span><span class="n">endl</span><span class="p">;</span>
<a id="__codelineno-63-10" name="__codelineno-63-10" href="#__codelineno-63-10"></a><span class="w">    </span><span class="p">}</span>
<a id="__codelineno-63-11" name="__codelineno-63-11" href="#__codelineno-63-11"></a><span class="w">    </span><span class="k">virtual</span><span class="w"> </span><span class="n">Base</span><span class="o">*</span><span class="w"> </span><span class="n">clone</span><span class="p">()</span><span class="w"> </span><span class="k">const</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-63-12" name="__codelineno-63-12" href="#__codelineno-63-12"></a><span class="w">        </span><span class="k">return</span><span class="w"> </span><span class="k">new</span><span class="w"> </span><span class="n">Base</span><span class="p">(</span><span class="o">*</span><span class="k">this</span><span class="p">);</span>
<a id="__codelineno-63-13" name="__codelineno-63-13" href="#__codelineno-63-13"></a><span class="w">    </span><span class="p">}</span>
<a id="__codelineno-63-14" name="__codelineno-63-14" href="#__codelineno-63-14"></a><span class="k">private</span><span class="o">:</span>
<a id="__codelineno-63-15" name="__codelineno-63-15" href="#__codelineno-63-15"></a><span class="w">    </span><span class="kt">int</span><span class="w"> </span><span class="n">x_</span><span class="p">;</span>
<a id="__codelineno-63-16" name="__codelineno-63-16" href="#__codelineno-63-16"></a><span class="p">};</span>
<a id="__codelineno-63-17" name="__codelineno-63-17" href="#__codelineno-63-17"></a>
<a id="__codelineno-63-18" name="__codelineno-63-18" href="#__codelineno-63-18"></a><span class="k">class</span><span class="w"> </span><span class="nc">Derived</span><span class="w"> </span><span class="o">:</span><span class="w"> </span><span class="k">public</span><span class="w"> </span><span class="n">Base</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-63-19" name="__codelineno-63-19" href="#__codelineno-63-19"></a><span class="k">public</span><span class="o">:</span>
<a id="__codelineno-63-20" name="__codelineno-63-20" href="#__codelineno-63-20"></a><span class="w">    </span><span class="n">Derived</span><span class="p">(</span><span class="kt">int</span><span class="w"> </span><span class="n">x</span><span class="p">,</span><span class="w"> </span><span class="kt">int</span><span class="w"> </span><span class="n">y</span><span class="p">)</span><span class="w"> </span><span class="o">:</span><span class="w"> </span><span class="n">Base</span><span class="p">(</span><span class="n">x</span><span class="p">),</span><span class="w"> </span><span class="n">y_</span><span class="p">(</span><span class="n">y</span><span class="p">)</span><span class="w"> </span><span class="p">{}</span>
<a id="__codelineno-63-21" name="__codelineno-63-21" href="#__codelineno-63-21"></a><span class="w">    </span><span class="kt">void</span><span class="w"> </span><span class="n">print</span><span class="p">()</span><span class="w"> </span><span class="k">override</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-63-22" name="__codelineno-63-22" href="#__codelineno-63-22"></a><span class="w">        </span><span class="n">std</span><span class="o">::</span><span class="n">cout</span><span class="w"> </span><span class="o">&lt;&lt;</span><span class="w"> </span><span class="s">&quot;Derived: &quot;</span><span class="w"> </span><span class="o">&lt;&lt;</span><span class="w"> </span><span class="n">x_</span><span class="w"> </span><span class="o">&lt;&lt;</span><span class="w"> </span><span class="s">&quot;, &quot;</span><span class="w"> </span><span class="o">&lt;&lt;</span><span class="w"> </span><span class="n">y_</span><span class="w"> </span><span class="o">&lt;&lt;</span><span class="w"> </span><span class="n">std</span><span class="o">::</span><span class="n">endl</span><span class="p">;</span>
<a id="__codelineno-63-23" name="__codelineno-63-23" href="#__codelineno-63-23"></a><span class="w">    </span><span class="p">}</span>
<a id="__codelineno-63-24" name="__codelineno-63-24" href="#__codelineno-63-24"></a><span class="w">    </span><span class="n">Derived</span><span class="o">*</span><span class="w"> </span><span class="n">clone</span><span class="p">()</span><span class="w"> </span><span class="k">const</span><span class="w"> </span><span class="k">override</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-63-25" name="__codelineno-63-25" href="#__codelineno-63-25"></a><span class="w">        </span><span class="k">return</span><span class="w"> </span><span class="k">new</span><span class="w"> </span><span class="n">Derived</span><span class="p">(</span><span class="o">*</span><span class="k">this</span><span class="p">);</span>
<a id="__codelineno-63-26" name="__codelineno-63-26" href="#__codelineno-63-26"></a><span class="w">    </span><span class="p">}</span>
<a id="__codelineno-63-27" name="__codelineno-63-27" href="#__codelineno-63-27"></a><span class="k">private</span><span class="o">:</span>
<a id="__codelineno-63-28" name="__codelineno-63-28" href="#__codelineno-63-28"></a><span class="w">    </span><span class="kt">int</span><span class="w"> </span><span class="n">y_</span><span class="p">;</span>
<a id="__codelineno-63-29" name="__codelineno-63-29" href="#__codelineno-63-29"></a><span class="p">};</span>
<a id="__codelineno-63-30" name="__codelineno-63-30" href="#__codelineno-63-30"></a>
<a id="__codelineno-63-31" name="__codelineno-63-31" href="#__codelineno-63-31"></a><span class="kt">int</span><span class="w"> </span><span class="nf">main</span><span class="p">()</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-63-32" name="__codelineno-63-32" href="#__codelineno-63-32"></a><span class="w">    </span><span class="n">std</span><span class="o">::</span><span class="n">unique_ptr</span><span class="o">&lt;</span><span class="n">Base</span><span class="o">&gt;</span><span class="w"> </span><span class="n">d</span><span class="p">(</span><span class="k">new</span><span class="w"> </span><span class="n">Derived</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span><span class="w"> </span><span class="mi">2</span><span class="p">));</span>
<a id="__codelineno-63-33" name="__codelineno-63-33" href="#__codelineno-63-33"></a><span class="w">    </span><span class="n">std</span><span class="o">::</span><span class="n">unique_ptr</span><span class="o">&lt;</span><span class="n">Base</span><span class="o">&gt;</span><span class="w"> </span><span class="n">b</span><span class="p">(</span><span class="n">d</span><span class="o">-&gt;</span><span class="n">clone</span><span class="p">());</span>
<a id="__codelineno-63-34" name="__codelineno-63-34" href="#__codelineno-63-34"></a><span class="w">    </span><span class="n">b</span><span class="o">-&gt;</span><span class="n">print</span><span class="p">();</span><span class="w"> </span><span class="c1">// prints &quot;Derived: 1, 2&quot;</span>
<a id="__codelineno-63-35" name="__codelineno-63-35" href="#__codelineno-63-35"></a><span class="w">    </span><span class="k">return</span><span class="w"> </span><span class="mi">0</span><span class="p">;</span>
<a id="__codelineno-63-36" name="__codelineno-63-36" href="#__codelineno-63-36"></a><span class="p">}</span>
</code></pre></div>
<p>In this example, we use a virtual copy constructor (the <code>clone</code> function) to avoid object slicing. The <code>clone</code> function returns a pointer to a new object of the same type as the object it is called on. When we create an object of the <code>Derived</code> class <code>d</code> and assign it to an object of the <code>Base</code> class <code>b</code> using the <code>clone</code> function, the correct copy constructor of the <code>Derived</code> class is called, which copies all of the data members of the <code>Derived</code> class. When we call the <code>print</code> function on the <code>Base</code> object <code>b</code>, it prints the values of both <code>x_</code> and <code>y_</code>.</p>
<h3 id="the-diamond-problem-in-multiple-inheritance">The Diamond Problem in Multiple Inheritance</h3>
<p>The diamond problem occurs when a class inherits from two classes that have a common base class.</p>
<p>Example of the diamond problem:</p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-64-1" name="__codelineno-64-1" href="#__codelineno-64-1"></a><span class="k">class</span><span class="w"> </span><span class="nc">A</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-64-2" name="__codelineno-64-2" href="#__codelineno-64-2"></a><span class="k">public</span><span class="o">:</span>
<a id="__codelineno-64-3" name="__codelineno-64-3" href="#__codelineno-64-3"></a><span class="w">    </span><span class="kt">int</span><span class="w"> </span><span class="n">data</span><span class="p">;</span>
<a id="__codelineno-64-4" name="__codelineno-64-4" href="#__codelineno-64-4"></a><span class="p">};</span>
<a id="__codelineno-64-5" name="__codelineno-64-5" href="#__codelineno-64-5"></a>
<a id="__codelineno-64-6" name="__codelineno-64-6" href="#__codelineno-64-6"></a><span class="k">class</span><span class="w"> </span><span class="nc">B</span><span class="w"> </span><span class="o">:</span><span class="w"> </span><span class="k">public</span><span class="w"> </span><span class="n">A</span><span class="w"> </span><span class="p">{};</span>
<a id="__codelineno-64-7" name="__codelineno-64-7" href="#__codelineno-64-7"></a><span class="k">class</span><span class="w"> </span><span class="nc">C</span><span class="w"> </span><span class="o">:</span><span class="w"> </span><span class="k">public</span><span class="w"> </span><span class="n">A</span><span class="w"> </span><span class="p">{};</span>
<a id="__codelineno-64-8" name="__codelineno-64-8" href="#__codelineno-64-8"></a>
<a id="__codelineno-64-9" name="__codelineno-64-9" href="#__codelineno-64-9"></a><span class="k">class</span><span class="w"> </span><span class="nc">D</span><span class="w"> </span><span class="o">:</span><span class="w"> </span><span class="k">public</span><span class="w"> </span><span class="n">B</span><span class="p">,</span><span class="w"> </span><span class="k">public</span><span class="w"> </span><span class="n">C</span><span class="w"> </span><span class="p">{};</span><span class="w"> </span><span class="c1">// Diamond problem: two copies of A&#39;s data</span>
</code></pre></div>
<h4 id="explanation_1">Explanation</h4>
<p>The diamond problem is a term used in C++ to describe a situation where a class inherits from two classes that have a common base class, and the common base class contains a member that is ambiguous in the derived class. This can lead to ambiguity and compilation errors in the program.</p>
<p>Here's an example to illustrate the diamond problem:</p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-65-1" name="__codelineno-65-1" href="#__codelineno-65-1"></a><span class="cp">#include</span><span class="w"> </span><span class="cpf">&lt;iostream&gt;</span>
<a id="__codelineno-65-2" name="__codelineno-65-2" href="#__codelineno-65-2"></a>
<a id="__codelineno-65-3" name="__codelineno-65-3" href="#__codelineno-65-3"></a><span class="k">class</span><span class="w"> </span><span class="nc">Base</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-65-4" name="__codelineno-65-4" href="#__codelineno-65-4"></a><span class="k">public</span><span class="o">:</span>
<a id="__codelineno-65-5" name="__codelineno-65-5" href="#__codelineno-65-5"></a><span class="w">    </span><span class="kt">void</span><span class="w"> </span><span class="n">print</span><span class="p">()</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-65-6" name="__codelineno-65-6" href="#__codelineno-65-6"></a><span class="w">        </span><span class="n">std</span><span class="o">::</span><span class="n">cout</span><span class="w"> </span><span class="o">&lt;&lt;</span><span class="w"> </span><span class="s">&quot;Base&quot;</span><span class="w"> </span><span class="o">&lt;&lt;</span><span class="w"> </span><span class="n">std</span><span class="o">::</span><span class="n">endl</span><span class="p">;</span>
<a id="__codelineno-65-7" name="__codelineno-65-7" href="#__codelineno-65-7"></a><span class="w">    </span><span class="p">}</span>
<a id="__codelineno-65-8" name="__codelineno-65-8" href="#__codelineno-65-8"></a><span class="p">};</span>
<a id="__codelineno-65-9" name="__codelineno-65-9" href="#__codelineno-65-9"></a>
<a id="__codelineno-65-10" name="__codelineno-65-10" href="#__codelineno-65-10"></a><span class="k">class</span><span class="w"> </span><span class="nc">Derived1</span><span class="w"> </span><span class="o">:</span><span class="w"> </span><span class="k">public</span><span class="w"> </span><span class="n">Base</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-65-11" name="__codelineno-65-11" href="#__codelineno-65-11"></a><span class="p">};</span>
<a id="__codelineno-65-12" name="__codelineno-65-12" href="#__codelineno-65-12"></a>
<a id="__codelineno-65-13" name="__codelineno-65-13" href="#__codelineno-65-13"></a><span class="k">class</span><span class="w"> </span><span class="nc">Derived2</span><span class="w"> </span><span class="o">:</span><span class="w"> </span><span class="k">public</span><span class="w"> </span><span class="n">Base</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-65-14" name="__codelineno-65-14" href="#__codelineno-65-14"></a><span class="p">};</span>
<a id="__codelineno-65-15" name="__codelineno-65-15" href="#__codelineno-65-15"></a>
<a id="__codelineno-65-16" name="__codelineno-65-16" href="#__codelineno-65-16"></a><span class="k">class</span><span class="w"> </span><span class="nc">Derived3</span><span class="w"> </span><span class="o">:</span><span class="w"> </span><span class="k">public</span><span class="w"> </span><span class="n">Derived1</span><span class="p">,</span><span class="w"> </span><span class="k">public</span><span class="w"> </span><span class="n">Derived2</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-65-17" name="__codelineno-65-17" href="#__codelineno-65-17"></a><span class="p">};</span>
<a id="__codelineno-65-18" name="__codelineno-65-18" href="#__codelineno-65-18"></a>
<a id="__codelineno-65-19" name="__codelineno-65-19" href="#__codelineno-65-19"></a><span class="kt">int</span><span class="w"> </span><span class="nf">main</span><span class="p">()</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-65-20" name="__codelineno-65-20" href="#__codelineno-65-20"></a><span class="w">    </span><span class="n">Derived3</span><span class="w"> </span><span class="n">d</span><span class="p">;</span>
<a id="__codelineno-65-21" name="__codelineno-65-21" href="#__codelineno-65-21"></a><span class="w">    </span><span class="n">d</span><span class="p">.</span><span class="n">print</span><span class="p">();</span><span class="w"> </span><span class="c1">// error: ambiguous call to &#39;print&#39;</span>
<a id="__codelineno-65-22" name="__codelineno-65-22" href="#__codelineno-65-22"></a><span class="w">    </span><span class="k">return</span><span class="w"> </span><span class="mi">0</span><span class="p">;</span>
<a id="__codelineno-65-23" name="__codelineno-65-23" href="#__codelineno-65-23"></a><span class="p">}</span>
</code></pre></div>
<p>In this example, we have a base class <code>Base</code> and two derived classes <code>Derived1</code> and <code>Derived2</code> that inherit from <code>Base</code>. We then have a third derived class <code>Derived3</code> that inherits from both <code>Derived1</code> and <code>Derived2</code>. The problem is that <code>Derived3</code> inherits two copies of the <code>print</code> function from <code>Derived1</code> and <code>Derived2</code>, which both inherit from <code>Base</code>. When we try to call <code>print</code> on an object of type <code>Derived3</code>, the compiler doesn't know which version of <code>print</code> to call, and it generates an ambiguity error.</p>
<p>The diamond problem can be solved using virtual inheritance. Virtual inheritance allows a class to inherit from multiple base classes, but only creates a single instance of the base class in the derived class. This resolves the ambiguity and allows the derived class to access the member of the base class unambiguously.</p>
<p>Here's an example that uses virtual inheritance to solve the diamond problem:</p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-66-1" name="__codelineno-66-1" href="#__codelineno-66-1"></a><span class="cp">#include</span><span class="w"> </span><span class="cpf">&lt;iostream&gt;</span>
<a id="__codelineno-66-2" name="__codelineno-66-2" href="#__codelineno-66-2"></a>
<a id="__codelineno-66-3" name="__codelineno-66-3" href="#__codelineno-66-3"></a><span class="k">class</span><span class="w"> </span><span class="nc">Base</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-66-4" name="__codelineno-66-4" href="#__codelineno-66-4"></a><span class="k">public</span><span class="o">:</span>
<a id="__codelineno-66-5" name="__codelineno-66-5" href="#__codelineno-66-5"></a><span class="w">    </span><span class="k">virtual</span><span class="w"> </span><span class="kt">void</span><span class="w"> </span><span class="n">print</span><span class="p">()</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-66-6" name="__codelineno-66-6" href="#__codelineno-66-6"></a><span class="w">        </span><span class="n">std</span><span class="o">::</span><span class="n">cout</span><span class="w"> </span><span class="o">&lt;&lt;</span><span class="w"> </span><span class="s">&quot;Base&quot;</span><span class="w"> </span><span class="o">&lt;&lt;</span><span class="w"> </span><span class="n">std</span><span class="o">::</span><span class="n">endl</span><span class="p">;</span>
<a id="__codelineno-66-7" name="__codelineno-66-7" href="#__codelineno-66-7"></a><span class="w">    </span><span class="p">}</span>
<a id="__codelineno-66-8" name="__codelineno-66-8" href="#__codelineno-66-8"></a><span class="p">};</span>
<a id="__codelineno-66-9" name="__codelineno-66-9" href="#__codelineno-66-9"></a>
<a id="__codelineno-66-10" name="__codelineno-66-10" href="#__codelineno-66-10"></a><span class="k">class</span><span class="w"> </span><span class="nc">Derived1</span><span class="w"> </span><span class="o">:</span><span class="w"> </span><span class="k">virtual</span><span class="w"> </span><span class="k">public</span><span class="w"> </span><span class="n">Base</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-66-11" name="__codelineno-66-11" href="#__codelineno-66-11"></a><span class="p">};</span>
<a id="__codelineno-66-12" name="__codelineno-66-12" href="#__codelineno-66-12"></a>
<a id="__codelineno-66-13" name="__codelineno-66-13" href="#__codelineno-66-13"></a><span class="k">class</span><span class="w"> </span><span class="nc">Derived2</span><span class="w"> </span><span class="o">:</span><span class="w"> </span><span class="k">virtual</span><span class="w"> </span><span class="k">public</span><span class="w"> </span><span class="n">Base</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-66-14" name="__codelineno-66-14" href="#__codelineno-66-14"></a><span class="p">};</span>
<a id="__codelineno-66-15" name="__codelineno-66-15" href="#__codelineno-66-15"></a>
<a id="__codelineno-66-16" name="__codelineno-66-16" href="#__codelineno-66-16"></a><span class="k">class</span><span class="w"> </span><span class="nc">Derived3</span><span class="w"> </span><span class="o">:</span><span class="w"> </span><span class="k">public</span><span class="w"> </span><span class="n">Derived1</span><span class="p">,</span><span class="w"> </span><span class="k">public</span><span class="w"> </span><span class="n">Derived2</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-66-17" name="__codelineno-66-17" href="#__codelineno-66-17"></a><span class="p">};</span>
<a id="__codelineno-66-18" name="__codelineno-66-18" href="#__codelineno-66-18"></a>
<a id="__codelineno-66-19" name="__codelineno-66-19" href="#__codelineno-66-19"></a><span class="kt">int</span><span class="w"> </span><span class="nf">main</span><span class="p">()</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-66-20" name="__codelineno-66-20" href="#__codelineno-66-20"></a><span class="w">    </span><span class="n">Derived3</span><span class="w"> </span><span class="n">d</span><span class="p">;</span>
<a id="__codelineno-66-21" name="__codelineno-66-21" href="#__codelineno-66-21"></a><span class="w">    </span><span class="n">d</span><span class="p">.</span><span class="n">print</span><span class="p">();</span><span class="w"> </span><span class="c1">// prints &quot;Base&quot;</span>
<a id="__codelineno-66-22" name="__codelineno-66-22" href="#__codelineno-66-22"></a><span class="w">    </span><span class="k">return</span><span class="w"> </span><span class="mi">0</span><span class="p">;</span>
<a id="__codelineno-66-23" name="__codelineno-66-23" href="#__codelineno-66-23"></a><span class="p">}</span>
</code></pre></div>
<p>In this example, we use the <code>virtual</code> keyword to indicate that <code>Derived1</code> and <code>Derived2</code> should use virtual inheritance when inheriting from <code>Base</code>. This means that <code>Derived3</code> will only inherit a single instance of <code>Base</code> from <code>Derived1</code> and <code>Derived2</code>, and the <code>print</code> function will be unambiguous. When we call <code>print</code> on an object of type <code>Derived3</code>, it prints the expected output.</p>
<p>Virtual inheritance can be a useful technique for resolving the diamond problem, but it can also introduce additional complexity and overhead. It's important to use virtual inheritance judiciously, and to understand the trade-offs involved.</p>
<h3 id="virtual-inheritance">Virtual Inheritance</h3>
<p>Virtual inheritance is used to solve the diamond problem by ensuring only one instance of the base class is inherited.</p>
<p>Example of virtual inheritance:</p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-67-1" name="__codelineno-67-1" href="#__codelineno-67-1"></a><span class="k">class</span><span class="w"> </span><span class="nc">A</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-67-2" name="__codelineno-67-2" href="#__codelineno-67-2"></a><span class="k">public</span><span class="o">:</span>
<a id="__codelineno-67-3" name="__codelineno-67-3" href="#__codelineno-67-3"></a><span class="w">    </span><span class="kt">int</span><span class="w"> </span><span class="n">data</span><span class="p">;</span>
<a id="__codelineno-67-4" name="__codelineno-67-4" href="#__codelineno-67-4"></a><span class="p">};</span>
<a id="__codelineno-67-5" name="__codelineno-67-5" href="#__codelineno-67-5"></a>
<a id="__codelineno-67-6" name="__codelineno-67-6" href="#__codelineno-67-6"></a><span class="k">class</span><span class="w"> </span><span class="nc">B</span><span class="w"> </span><span class="o">:</span><span class="w"> </span><span class="k">virtual</span><span class="w"> </span><span class="k">public</span><span class="w"> </span><span class="n">A</span><span class="w"> </span><span class="p">{};</span>
<a id="__codelineno-67-7" name="__codelineno-67-7" href="#__codelineno-67-7"></a><span class="k">class</span><span class="w"> </span><span class="nc">C</span><span class="w"> </span><span class="o">:</span><span class="w"> </span><span class="k">virtual</span><span class="w"> </span><span class="k">public</span><span class="w"> </span><span class="n">A</span><span class="w"> </span><span class="p">{};</span>
<a id="__codelineno-67-8" name="__codelineno-67-8" href="#__codelineno-67-8"></a>
<a id="__codelineno-67-9" name="__codelineno-67-9" href="#__codelineno-67-9"></a><span class="k">class</span><span class="w"> </span><span class="nc">D</span><span class="w"> </span><span class="o">:</span><span class="w"> </span><span class="k">public</span><span class="w"> </span><span class="n">B</span><span class="p">,</span><span class="w"> </span><span class="k">public</span><span class="w"> </span><span class="n">C</span><span class="w"> </span><span class="p">{};</span><span class="w"> </span><span class="c1">// Only one instance of A&#39;s data</span>
</code></pre></div>
<h3 id="dynamic-cast-and-type-information">Dynamic Cast and Type Information</h3>
<p>Dynamic cast is used for safe downcasting in inheritance hierarchies. It requires Run-Time Type Information (RTTI) to be enabled.</p>
<p>Example of dynamic cast:</p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-68-1" name="__codelineno-68-1" href="#__codelineno-68-1"></a><span class="k">class</span><span class="w"> </span><span class="nc">Base</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-68-2" name="__codelineno-68-2" href="#__codelineno-68-2"></a><span class="k">public</span><span class="o">:</span>
<a id="__codelineno-68-3" name="__codelineno-68-3" href="#__codelineno-68-3"></a><span class="w">    </span><span class="k">virtual</span><span class="w"> </span><span class="o">~</span><span class="n">Base</span><span class="p">()</span><span class="w"> </span><span class="p">{}</span><span class="w"> </span><span class="c1">// Virtual destructor for polymorphic behavior</span>
<a id="__codelineno-68-4" name="__codelineno-68-4" href="#__codelineno-68-4"></a><span class="p">};</span>
<a id="__codelineno-68-5" name="__codelineno-68-5" href="#__codelineno-68-5"></a>
<a id="__codelineno-68-6" name="__codelineno-68-6" href="#__codelineno-68-6"></a><span class="k">class</span><span class="w"> </span><span class="nc">Derived</span><span class="w"> </span><span class="o">:</span><span class="w"> </span><span class="k">public</span><span class="w"> </span><span class="n">Base</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-68-7" name="__codelineno-68-7" href="#__codelineno-68-7"></a><span class="k">public</span><span class="o">:</span>
<a id="__codelineno-68-8" name="__codelineno-68-8" href="#__codelineno-68-8"></a><span class="w">    </span><span class="kt">void</span><span class="w"> </span><span class="n">derivedFunction</span><span class="p">()</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="n">std</span><span class="o">::</span><span class="n">cout</span><span class="w"> </span><span class="o">&lt;&lt;</span><span class="w"> </span><span class="s">&quot;Derived function&quot;</span><span class="w"> </span><span class="o">&lt;&lt;</span><span class="w"> </span><span class="n">std</span><span class="o">::</span><span class="n">endl</span><span class="p">;</span><span class="w"> </span><span class="p">}</span>
<a id="__codelineno-68-9" name="__codelineno-68-9" href="#__codelineno-68-9"></a><span class="p">};</span>
<a id="__codelineno-68-10" name="__codelineno-68-10" href="#__codelineno-68-10"></a>
<a id="__codelineno-68-11" name="__codelineno-68-11" href="#__codelineno-68-11"></a><span class="kt">void</span><span class="w"> </span><span class="nf">processObject</span><span class="p">(</span><span class="n">Base</span><span class="o">*</span><span class="w"> </span><span class="n">obj</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-68-12" name="__codelineno-68-12" href="#__codelineno-68-12"></a><span class="w">    </span><span class="n">Derived</span><span class="o">*</span><span class="w"> </span><span class="n">derivedPtr</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">dynamic_cast</span><span class="o">&lt;</span><span class="n">Derived</span><span class="o">*&gt;</span><span class="p">(</span><span class="n">obj</span><span class="p">);</span>
<a id="__codelineno-68-13" name="__codelineno-68-13" href="#__codelineno-68-13"></a><span class="w">    </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">derivedPtr</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-68-14" name="__codelineno-68-14" href="#__codelineno-68-14"></a><span class="w">        </span><span class="n">derivedPtr</span><span class="o">-&gt;</span><span class="n">derivedFunction</span><span class="p">();</span>
<a id="__codelineno-68-15" name="__codelineno-68-15" href="#__codelineno-68-15"></a><span class="w">    </span><span class="p">}</span><span class="w"> </span><span class="k">else</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-68-16" name="__codelineno-68-16" href="#__codelineno-68-16"></a><span class="w">        </span><span class="n">std</span><span class="o">::</span><span class="n">cout</span><span class="w"> </span><span class="o">&lt;&lt;</span><span class="w"> </span><span class="s">&quot;Not a Derived object&quot;</span><span class="w"> </span><span class="o">&lt;&lt;</span><span class="w"> </span><span class="n">std</span><span class="o">::</span><span class="n">endl</span><span class="p">;</span>
<a id="__codelineno-68-17" name="__codelineno-68-17" href="#__codelineno-68-17"></a><span class="w">    </span><span class="p">}</span>
<a id="__codelineno-68-18" name="__codelineno-68-18" href="#__codelineno-68-18"></a><span class="p">}</span>
<a id="__codelineno-68-19" name="__codelineno-68-19" href="#__codelineno-68-19"></a>
<a id="__codelineno-68-20" name="__codelineno-68-20" href="#__codelineno-68-20"></a><span class="kt">int</span><span class="w"> </span><span class="nf">main</span><span class="p">()</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-68-21" name="__codelineno-68-21" href="#__codelineno-68-21"></a><span class="w">    </span><span class="n">Base</span><span class="o">*</span><span class="w"> </span><span class="n">b</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">new</span><span class="w"> </span><span class="n">Base</span><span class="p">();</span>
<a id="__codelineno-68-22" name="__codelineno-68-22" href="#__codelineno-68-22"></a><span class="w">    </span><span class="n">Base</span><span class="o">*</span><span class="w"> </span><span class="n">d</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">new</span><span class="w"> </span><span class="n">Derived</span><span class="p">();</span>
<a id="__codelineno-68-23" name="__codelineno-68-23" href="#__codelineno-68-23"></a>
<a id="__codelineno-68-24" name="__codelineno-68-24" href="#__codelineno-68-24"></a><span class="w">    </span><span class="n">processObject</span><span class="p">(</span><span class="n">b</span><span class="p">);</span><span class="w"> </span><span class="c1">// Outputs: Not a Derived object</span>
<a id="__codelineno-68-25" name="__codelineno-68-25" href="#__codelineno-68-25"></a><span class="w">    </span><span class="n">processObject</span><span class="p">(</span><span class="n">d</span><span class="p">);</span><span class="w"> </span><span class="c1">// Outputs: Derived function</span>
<a id="__codelineno-68-26" name="__codelineno-68-26" href="#__codelineno-68-26"></a>
<a id="__codelineno-68-27" name="__codelineno-68-27" href="#__codelineno-68-27"></a><span class="w">    </span><span class="k">delete</span><span class="w"> </span><span class="n">b</span><span class="p">;</span>
<a id="__codelineno-68-28" name="__codelineno-68-28" href="#__codelineno-68-28"></a><span class="w">    </span><span class="k">delete</span><span class="w"> </span><span class="n">d</span><span class="p">;</span>
<a id="__codelineno-68-29" name="__codelineno-68-29" href="#__codelineno-68-29"></a><span class="p">}</span>
</code></pre></div>
<p>Type information can also be accessed using the <code>typeid</code> operator:</p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-69-1" name="__codelineno-69-1" href="#__codelineno-69-1"></a><span class="cp">#include</span><span class="w"> </span><span class="cpf">&lt;typeinfo&gt;</span>
<a id="__codelineno-69-2" name="__codelineno-69-2" href="#__codelineno-69-2"></a>
<a id="__codelineno-69-3" name="__codelineno-69-3" href="#__codelineno-69-3"></a><span class="c1">// ...</span>
<a id="__codelineno-69-4" name="__codelineno-69-4" href="#__codelineno-69-4"></a>
<a id="__codelineno-69-5" name="__codelineno-69-5" href="#__codelineno-69-5"></a><span class="n">std</span><span class="o">::</span><span class="n">cout</span><span class="w"> </span><span class="o">&lt;&lt;</span><span class="w"> </span><span class="k">typeid</span><span class="p">(</span><span class="o">*</span><span class="n">obj</span><span class="p">).</span><span class="n">name</span><span class="p">()</span><span class="w"> </span><span class="o">&lt;&lt;</span><span class="w"> </span><span class="n">std</span><span class="o">::</span><span class="n">endl</span><span class="p">;</span><span class="w"> </span><span class="c1">// Prints the type name</span>
</code></pre></div>
<h3 id="resource-management">Resource Management</h3>
<p>Effective resource management is crucial in game development to ensure optimal performance and stability. Below are some key concepts and techniques used in resource management:</p>
<h4 id="raii-resource-acquisition-is-initialization">RAII (Resource Acquisition Is Initialization)</h4>
<p>RAII (Resource Acquisition Is Initialization) is a programming technique used in C++ to manage resources, such as memory, file handles, and network connections, in a safe and efficient way. The idea behind RAII is to associate the lifetime of a resource with the lifetime of an object, and to ensure that the resource is properly acquired and released when the object is created and destroyed, respectively.</p>
<p>Here's an example to illustrate RAII:</p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-70-1" name="__codelineno-70-1" href="#__codelineno-70-1"></a><span class="cp">#include</span><span class="w"> </span><span class="cpf">&lt;iostream&gt;</span>
<a id="__codelineno-70-2" name="__codelineno-70-2" href="#__codelineno-70-2"></a><span class="cp">#include</span><span class="w"> </span><span class="cpf">&lt;memory&gt;</span>
<a id="__codelineno-70-3" name="__codelineno-70-3" href="#__codelineno-70-3"></a>
<a id="__codelineno-70-4" name="__codelineno-70-4" href="#__codelineno-70-4"></a><span class="k">class</span><span class="w"> </span><span class="nc">File</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-70-5" name="__codelineno-70-5" href="#__codelineno-70-5"></a><span class="k">public</span><span class="o">:</span>
<a id="__codelineno-70-6" name="__codelineno-70-6" href="#__codelineno-70-6"></a><span class="w">    </span><span class="n">File</span><span class="p">(</span><span class="k">const</span><span class="w"> </span><span class="n">std</span><span class="o">::</span><span class="n">string</span><span class="o">&amp;</span><span class="w"> </span><span class="n">filename</span><span class="p">)</span><span class="w"> </span><span class="o">:</span><span class="w"> </span><span class="n">file_</span><span class="p">(</span><span class="n">fopen</span><span class="p">(</span><span class="n">filename</span><span class="p">.</span><span class="n">c_str</span><span class="p">(),</span><span class="w"> </span><span class="s">&quot;r&quot;</span><span class="p">))</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-70-7" name="__codelineno-70-7" href="#__codelineno-70-7"></a><span class="w">        </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="o">!</span><span class="n">file_</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-70-8" name="__codelineno-70-8" href="#__codelineno-70-8"></a><span class="w">            </span><span class="k">throw</span><span class="w"> </span><span class="n">std</span><span class="o">::</span><span class="n">runtime_error</span><span class="p">(</span><span class="s">&quot;Failed to open file&quot;</span><span class="p">);</span>
<a id="__codelineno-70-9" name="__codelineno-70-9" href="#__codelineno-70-9"></a><span class="w">        </span><span class="p">}</span>
<a id="__codelineno-70-10" name="__codelineno-70-10" href="#__codelineno-70-10"></a><span class="w">    </span><span class="p">}</span>
<a id="__codelineno-70-11" name="__codelineno-70-11" href="#__codelineno-70-11"></a><span class="w">    </span><span class="o">~</span><span class="n">File</span><span class="p">()</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-70-12" name="__codelineno-70-12" href="#__codelineno-70-12"></a><span class="w">        </span><span class="n">fclose</span><span class="p">(</span><span class="n">file_</span><span class="p">);</span>
<a id="__codelineno-70-13" name="__codelineno-70-13" href="#__codelineno-70-13"></a><span class="w">    </span><span class="p">}</span>
<a id="__codelineno-70-14" name="__codelineno-70-14" href="#__codelineno-70-14"></a><span class="w">    </span><span class="c1">// other methods for reading from the file...</span>
<a id="__codelineno-70-15" name="__codelineno-70-15" href="#__codelineno-70-15"></a><span class="k">private</span><span class="o">:</span>
<a id="__codelineno-70-16" name="__codelineno-70-16" href="#__codelineno-70-16"></a><span class="w">    </span><span class="kt">FILE</span><span class="o">*</span><span class="w"> </span><span class="n">file_</span><span class="p">;</span>
<a id="__codelineno-70-17" name="__codelineno-70-17" href="#__codelineno-70-17"></a><span class="p">};</span>
<a id="__codelineno-70-18" name="__codelineno-70-18" href="#__codelineno-70-18"></a>
<a id="__codelineno-70-19" name="__codelineno-70-19" href="#__codelineno-70-19"></a><span class="kt">int</span><span class="w"> </span><span class="nf">main</span><span class="p">()</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-70-20" name="__codelineno-70-20" href="#__codelineno-70-20"></a><span class="w">    </span><span class="k">try</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-70-21" name="__codelineno-70-21" href="#__codelineno-70-21"></a><span class="w">        </span><span class="n">File</span><span class="w"> </span><span class="n">file</span><span class="p">(</span><span class="s">&quot;example.txt&quot;</span><span class="p">);</span>
<a id="__codelineno-70-22" name="__codelineno-70-22" href="#__codelineno-70-22"></a><span class="w">        </span><span class="c1">// use the file...</span>
<a id="__codelineno-70-23" name="__codelineno-70-23" href="#__codelineno-70-23"></a><span class="w">    </span><span class="p">}</span><span class="w"> </span><span class="k">catch</span><span class="w"> </span><span class="p">(</span><span class="k">const</span><span class="w"> </span><span class="n">std</span><span class="o">::</span><span class="n">exception</span><span class="o">&amp;</span><span class="w"> </span><span class="n">e</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-70-24" name="__codelineno-70-24" href="#__codelineno-70-24"></a><span class="w">        </span><span class="n">std</span><span class="o">::</span><span class="n">cerr</span><span class="w"> </span><span class="o">&lt;&lt;</span><span class="w"> </span><span class="s">&quot;Caught exception: &quot;</span><span class="w"> </span><span class="o">&lt;&lt;</span><span class="w"> </span><span class="n">e</span><span class="p">.</span><span class="n">what</span><span class="p">()</span><span class="w"> </span><span class="o">&lt;&lt;</span><span class="w"> </span><span class="n">std</span><span class="o">::</span><span class="n">endl</span><span class="p">;</span>
<a id="__codelineno-70-25" name="__codelineno-70-25" href="#__codelineno-70-25"></a><span class="w">    </span><span class="p">}</span>
<a id="__codelineno-70-26" name="__codelineno-70-26" href="#__codelineno-70-26"></a><span class="w">    </span><span class="k">return</span><span class="w"> </span><span class="mi">0</span><span class="p">;</span>
<a id="__codelineno-70-27" name="__codelineno-70-27" href="#__codelineno-70-27"></a><span class="p">}</span>
</code></pre></div>
<p>In this example, we have a <code>File</code> class that represents a file handle. The <code>File</code> constructor opens the file and stores the file handle in a member variable. The <code>File</code> destructor closes the file handle. By using RAII, we ensure that the file handle is properly closed when the <code>File</code> object goes out of scope, even if an exception is thrown.</p>
<p>RAII can be a very powerful technique for managing resources in C++. By associating the lifetime of a resource with the lifetime of an object, we can ensure that the resource is properly acquired and released, even in the presence of exceptions or errors. This can lead to safer and more reliable code.</p>
<p>In addition to using RAII for managing resources explicitly, C++ also provides several standard library classes that use RAII to manage resources automatically. For example, the <code>std::unique_ptr</code> and <code>std::shared_ptr</code> classes can be used to manage dynamically allocated memory, and the <code>std::lock_guard</code> and <code>std::unique_lock</code> classes can be used to manage mutexes.</p>
<p>Here's an example that uses <code>std::unique_ptr</code> to manage dynamically allocated memory:</p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-71-1" name="__codelineno-71-1" href="#__codelineno-71-1"></a><span class="cp">#include</span><span class="w"> </span><span class="cpf">&lt;iostream&gt;</span>
<a id="__codelineno-71-2" name="__codelineno-71-2" href="#__codelineno-71-2"></a><span class="cp">#include</span><span class="w"> </span><span class="cpf">&lt;memory&gt;</span>
<a id="__codelineno-71-3" name="__codelineno-71-3" href="#__codelineno-71-3"></a>
<a id="__codelineno-71-4" name="__codelineno-71-4" href="#__codelineno-71-4"></a><span class="kt">int</span><span class="w"> </span><span class="nf">main</span><span class="p">()</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-71-5" name="__codelineno-71-5" href="#__codelineno-71-5"></a><span class="w">    </span><span class="n">std</span><span class="o">::</span><span class="n">unique_ptr</span><span class="o">&lt;</span><span class="kt">int</span><span class="o">&gt;</span><span class="w"> </span><span class="n">p</span><span class="p">(</span><span class="k">new</span><span class="w"> </span><span class="kt">int</span><span class="p">(</span><span class="mi">42</span><span class="p">));</span>
<a id="__codelineno-71-6" name="__codelineno-71-6" href="#__codelineno-71-6"></a><span class="w">    </span><span class="c1">// use the dynamically allocated memory...</span>
<a id="__codelineno-71-7" name="__codelineno-71-7" href="#__codelineno-71-7"></a><span class="w">    </span><span class="k">return</span><span class="w"> </span><span class="mi">0</span><span class="p">;</span>
<a id="__codelineno-71-8" name="__codelineno-71-8" href="#__codelineno-71-8"></a><span class="p">}</span>
</code></pre></div>
<p>In this example, we use <code>std::unique_ptr</code> to manage dynamically allocated memory. The <code>std::unique_ptr</code> constructor takes a pointer to the dynamically allocated memory, and the <code>std::unique_ptr</code> destructor automatically deletes the memory when the <code>std::unique_ptr</code> object goes out of scope. By using <code>std::unique_ptr</code>, we ensure that the memory is properly released, even in the presence of exceptions or errors.</p>
<p>RAII is a powerful and important technique for managing resources in C++. By using RAII, we can ensure that resources are properly acquired and released, even in the presence of exceptions or errors, and we can write safer and more reliable code.</p>
<h4 id="smart-pointers">Smart Pointers</h4>
<p>Smart pointers are a set of C++ classes that provide automatic memory management for dynamically allocated objects. Smart pointers are used to manage resources that are allocated dynamically, such as memory, file handles, and network connections, and to ensure that the resources are properly released when they are no longer needed.</p>
<p>C++ provides three types of smart pointers: <code>std::unique_ptr</code>, <code>std::shared_ptr</code>, and <code>std::weak_ptr</code>.</p>
<h5 id="stdunique_ptr"><code>std::unique_ptr</code></h5>
<p><code>std::unique_ptr</code> is a smart pointer that owns the object it points to. When the <code>std::unique_ptr</code> object goes out of scope, the object it points to is automatically deleted. <code>std::unique_ptr</code> is used to manage resources that should have a single owner.</p>
<p>Here's an example that uses <code>std::unique_ptr</code> to manage dynamically allocated memory:</p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-72-1" name="__codelineno-72-1" href="#__codelineno-72-1"></a><span class="cp">#include</span><span class="w"> </span><span class="cpf">&lt;iostream&gt;</span>
<a id="__codelineno-72-2" name="__codelineno-72-2" href="#__codelineno-72-2"></a><span class="cp">#include</span><span class="w"> </span><span class="cpf">&lt;memory&gt;</span>
<a id="__codelineno-72-3" name="__codelineno-72-3" href="#__codelineno-72-3"></a>
<a id="__codelineno-72-4" name="__codelineno-72-4" href="#__codelineno-72-4"></a><span class="kt">int</span><span class="w"> </span><span class="nf">main</span><span class="p">()</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-72-5" name="__codelineno-72-5" href="#__codelineno-72-5"></a><span class="w">    </span><span class="n">std</span><span class="o">::</span><span class="n">unique_ptr</span><span class="o">&lt;</span><span class="kt">int</span><span class="o">&gt;</span><span class="w"> </span><span class="n">p</span><span class="p">(</span><span class="k">new</span><span class="w"> </span><span class="kt">int</span><span class="p">(</span><span class="mi">42</span><span class="p">));</span>
<a id="__codelineno-72-6" name="__codelineno-72-6" href="#__codelineno-72-6"></a><span class="w">    </span><span class="c1">// use the dynamically allocated memory...</span>
<a id="__codelineno-72-7" name="__codelineno-72-7" href="#__codelineno-72-7"></a><span class="w">    </span><span class="k">return</span><span class="w"> </span><span class="mi">0</span><span class="p">;</span>
<a id="__codelineno-72-8" name="__codelineno-72-8" href="#__codelineno-72-8"></a><span class="p">}</span>
</code></pre></div>
<p>In this example, we use <code>std::unique_ptr</code> to manage dynamically allocated memory. The <code>std::unique_ptr</code> constructor takes a pointer to the dynamically allocated memory, and the <code>std::unique_ptr</code> destructor automatically deletes the memory when the <code>std::unique_ptr</code> object goes out of scope. By using <code>std::unique_ptr</code>, we ensure that the memory is properly released, even in the presence of exceptions or errors.</p>
<h5 id="stdshared_ptr"><code>std::shared_ptr</code></h5>
<p><code>std::shared_ptr</code> is a smart pointer that shares ownership of the object it points to. When a <code>std::shared_ptr</code> object is copied, the reference count of the object it points to is incremented. When the reference count of the object reaches zero, the object is automatically deleted. <code>std::shared_ptr</code> is used to manage resources that can have multiple owners.</p>
<p>Here's an example that uses <code>std::shared_ptr</code> to manage dynamically allocated memory:</p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-73-1" name="__codelineno-73-1" href="#__codelineno-73-1"></a><span class="cp">#include</span><span class="w"> </span><span class="cpf">&lt;iostream&gt;</span>
<a id="__codelineno-73-2" name="__codelineno-73-2" href="#__codelineno-73-2"></a><span class="cp">#include</span><span class="w"> </span><span class="cpf">&lt;memory&gt;</span>
<a id="__codelineno-73-3" name="__codelineno-73-3" href="#__codelineno-73-3"></a>
<a id="__codelineno-73-4" name="__codelineno-73-4" href="#__codelineno-73-4"></a><span class="kt">int</span><span class="w"> </span><span class="nf">main</span><span class="p">()</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-73-5" name="__codelineno-73-5" href="#__codelineno-73-5"></a><span class="w">    </span><span class="n">std</span><span class="o">::</span><span class="n">shared_ptr</span><span class="o">&lt;</span><span class="kt">int</span><span class="o">&gt;</span><span class="w"> </span><span class="n">p1</span><span class="p">(</span><span class="k">new</span><span class="w"> </span><span class="kt">int</span><span class="p">(</span><span class="mi">42</span><span class="p">));</span>
<a id="__codelineno-73-6" name="__codelineno-73-6" href="#__codelineno-73-6"></a><span class="w">    </span><span class="n">std</span><span class="o">::</span><span class="n">shared_ptr</span><span class="o">&lt;</span><span class="kt">int</span><span class="o">&gt;</span><span class="w"> </span><span class="n">p2</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">p1</span><span class="p">;</span><span class="w"> </span><span class="c1">// reference count is incremented</span>
<a id="__codelineno-73-7" name="__codelineno-73-7" href="#__codelineno-73-7"></a><span class="w">    </span><span class="c1">// use the dynamically allocated memory...</span>
<a id="__codelineno-73-8" name="__codelineno-73-8" href="#__codelineno-73-8"></a><span class="w">    </span><span class="k">return</span><span class="w"> </span><span class="mi">0</span><span class="p">;</span>
<a id="__codelineno-73-9" name="__codelineno-73-9" href="#__codelineno-73-9"></a><span class="p">}</span>
</code></pre></div>
<p>In this example, we use <code>std::shared_ptr</code> to manage dynamically allocated memory. The <code>std::shared_ptr</code> constructor takes a pointer to the dynamically allocated memory, and the reference count of the object is incremented when the <code>std::shared_ptr</code> object is copied. When both <code>std::shared_ptr</code> objects go out of scope, the reference count of the object reaches zero, and the object is automatically deleted. By using <code>std::shared_ptr</code>, we ensure that the memory is properly released, even in the presence of multiple owners.</p>
<h5 id="stdweak_ptr"><code>std::weak_ptr</code></h5>
<p><code>std::weak_ptr</code> is a smart pointer that does not share ownership of the object it points to. <code>std::weak_ptr</code> is used to break circular references between <code>std::shared_ptr</code> objects. When a <code>std::weak_ptr</code> object is created, it does not increment the reference count of the object it points to. When the reference count of the object reaches zero, the object is automatically deleted, even if there are <code>std::weak_ptr</code> objects that point to it.</p>
<p>Here's an example that uses <code>std::weak_ptr</code> to break a circular reference between <code>std::shared_ptr</code> objects:</p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-74-1" name="__codelineno-74-1" href="#__codelineno-74-1"></a><span class="cp">#include</span><span class="w"> </span><span class="cpf">&lt;iostream&gt;</span>
<a id="__codelineno-74-2" name="__codelineno-74-2" href="#__codelineno-74-2"></a><span class="cp">#include</span><span class="w"> </span><span class="cpf">&lt;memory&gt;</span>
<a id="__codelineno-74-3" name="__codelineno-74-3" href="#__codelineno-74-3"></a>
<a id="__codelineno-74-4" name="__codelineno-74-4" href="#__codelineno-74-4"></a><span class="k">class</span><span class="w"> </span><span class="nc">B</span><span class="p">;</span>
<a id="__codelineno-74-5" name="__codelineno-74-5" href="#__codelineno-74-5"></a>
<a id="__codelineno-74-6" name="__codelineno-74-6" href="#__codelineno-74-6"></a><span class="k">class</span><span class="w"> </span><span class="nc">A</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-74-7" name="__codelineno-74-7" href="#__codelineno-74-7"></a><span class="k">public</span><span class="o">:</span>
<a id="__codelineno-74-8" name="__codelineno-74-8" href="#__codelineno-74-8"></a><span class="w">    </span><span class="kt">void</span><span class="w"> </span><span class="n">set_b</span><span class="p">(</span><span class="n">std</span><span class="o">::</span><span class="n">shared_ptr</span><span class="o">&lt;</span><span class="n">B</span><span class="o">&gt;</span><span class="w"> </span><span class="n">b</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-74-9" name="__codelineno-74-9" href="#__codelineno-74-9"></a><span class="w">        </span><span class="n">b_</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">b</span><span class="p">;</span>
<a id="__codelineno-74-10" name="__codelineno-74-10" href="#__codelineno-74-10"></a><span class="w">    </span><span class="p">}</span>
<a id="__codelineno-74-11" name="__codelineno-74-11" href="#__codelineno-74-11"></a><span class="k">private</span><span class="o">:</span>
<a id="__codelineno-74-12" name="__codelineno-74-12" href="#__codelineno-74-12"></a><span class="w">    </span><span class="n">std</span><span class="o">::</span><span class="n">shared_ptr</span><span class="o">&lt;</span><span class="n">B</span><span class="o">&gt;</span><span class="w"> </span><span class="n">b_</span><span class="p">;</span>
<a id="__codelineno-74-13" name="__codelineno-74-13" href="#__codelineno-74-13"></a><span class="p">};</span>
<a id="__codelineno-74-14" name="__codelineno-74-14" href="#__codelineno-74-14"></a>
<a id="__codelineno-74-15" name="__codelineno-74-15" href="#__codelineno-74-15"></a><span class="k">class</span><span class="w"> </span><span class="nc">B</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-74-16" name="__codelineno-74-16" href="#__codelineno-74-16"></a><span class="k">public</span><span class="o">:</span>
<a id="__codelineno-74-17" name="__codelineno-74-17" href="#__codelineno-74-17"></a><span class="w">    </span><span class="kt">void</span><span class="w"> </span><span class="n">set_a</span><span class="p">(</span><span class="n">std</span><span class="o">::</span><span class="n">shared_ptr</span><span class="o">&lt;</span><span class="n">A</span><span class="o">&gt;</span><span class="w"> </span><span class="n">a</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-74-18" name="__codelineno-74-18" href="#__codelineno-74-18"></a><span class="w">        </span><span class="n">a_</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">a</span><span class="p">;</span>
<a id="__codelineno-74-19" name="__codelineno-74-19" href="#__codelineno-74-19"></a><span class="w">    </span><span class="p">}</span>
<a id="__codelineno-74-20" name="__codelineno-74-20" href="#__codelineno-74-20"></a><span class="k">private</span><span class="o">:</span>
<a id="__codelineno-74-21" name="__codelineno-74-21" href="#__codelineno-74-21"></a><span class="w">    </span><span class="n">std</span><span class="o">::</span><span class="n">weak_ptr</span><span class="o">&lt;</span><span class="n">A</span><span class="o">&gt;</span><span class="w"> </span><span class="n">a_</span><span class="p">;</span>
<a id="__codelineno-74-22" name="__codelineno-74-22" href="#__codelineno-74-22"></a><span class="p">};</span>
<a id="__codelineno-74-23" name="__codelineno-74-23" href="#__codelineno-74-23"></a>
<a id="__codelineno-74-24" name="__codelineno-74-24" href="#__codelineno-74-24"></a><span class="kt">int</span><span class="w"> </span><span class="nf">main</span><span class="p">()</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-74-25" name="__codelineno-74-25" href="#__codelineno-74-25"></a><span class="w">    </span><span class="n">std</span><span class="o">::</span><span class="n">shared_ptr</span><span class="o">&lt;</span><span class="n">A</span><span class="o">&gt;</span><span class="w"> </span><span class="n">a</span><span class="p">(</span><span class="k">new</span><span class="w"> </span><span class="n">A</span><span class="p">);</span>
<a id="__codelineno-74-26" name="__codelineno-74-26" href="#__codelineno-74-26"></a><span class="w">    </span><span class="n">std</span><span class="o">::</span><span class="n">shared_ptr</span><span class="o">&lt;</span><span class="n">B</span><span class="o">&gt;</span><span class="w"> </span><span class="n">b</span><span class="p">(</span><span class="k">new</span><span class="w"> </span><span class="n">B</span><span class="p">);</span>
<a id="__codelineno-74-27" name="__codelineno-74-27" href="#__codelineno-74-27"></a><span class="w">    </span><span class="n">a</span><span class="o">-&gt;</span><span class="n">set_b</span><span class="p">(</span><span class="n">b</span><span class="p">);</span>
<a id="__codelineno-74-28" name="__codelineno-74-28" href="#__codelineno-74-28"></a><span class="w">    </span><span class="n">b</span><span class="o">-&gt;</span><span class="n">set_a</span><span class="p">(</span><span class="n">a</span><span class="p">);</span>
<a id="__codelineno-74-29" name="__codelineno-74-29" href="#__codelineno-74-29"></a><span class="w">    </span><span class="c1">// a and b are no longer needed</span>
<a id="__codelineno-74-30" name="__codelineno-74-30" href="#__codelineno-74-30"></a><span class="w">    </span><span class="k">return</span><span class="w"> </span><span class="mi">0</span><span class="p">;</span>
<a id="__codelineno-74-31" name="__codelineno-74-31" href="#__codelineno-74-31"></a><span class="p">}</span>
</code></pre></div>
<p>In this example, we have two classes <code>A</code> and <code>B</code> that have a circular reference between them. To break the circular reference, we use <code>std::weak_ptr</code> to store the pointer to <code>A</code> in <code>B</code>. When both <code>std::shared_ptr</code> objects <code>a</code> and <code>b</code> go out of scope, the reference count of the objects reaches zero, and the objects are automatically deleted. By using <code>std::weak_ptr</code>, we ensure that the circular reference is broken, and that the objects are properly released.</p>
<p>Smart pointers are a powerful and important feature of C++ that can help to manage resources safely and efficiently. By using smart pointers, we can ensure that resources are properly acquired and released, even in the presence of exceptions or errors, and we can write safer and more reliable code.``</p>
<h4 id="custom-deleters-for-smart-pointers">Custom Deleters for Smart Pointers</h4>
<p>Custom deleters are functions or function objects that are used to release the resources managed by smart pointers. Smart pointers in C++, such as <code>std::unique_ptr</code> and <code>std::shared_ptr</code>, use a deleter to release the resources they manage. By default, smart pointers use the <code>delete</code> operator to release dynamically allocated memory, but custom deleters can be used to release other types of resources, such as file handles or network connections.</p>
<p>Custom deleters can be useful in a variety of situations. For example, if a resource is allocated using a function other than <code>new</code>, such as <code>fopen</code>, then a custom deleter can be used to release the resource using the appropriate function, such as <code>fclose</code>. Custom deleters can also be used to release resources that are not owned by the smart pointer, such as resources that are allocated by a third-party library.</p>
<p>Here's an example that uses a custom deleter to release a file handle:</p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-75-1" name="__codelineno-75-1" href="#__codelineno-75-1"></a><span class="cp">#include</span><span class="w"> </span><span class="cpf">&lt;iostream&gt;</span>
<a id="__codelineno-75-2" name="__codelineno-75-2" href="#__codelineno-75-2"></a><span class="cp">#include</span><span class="w"> </span><span class="cpf">&lt;memory&gt;</span>
<a id="__codelineno-75-3" name="__codelineno-75-3" href="#__codelineno-75-3"></a><span class="cp">#include</span><span class="w"> </span><span class="cpf">&lt;cstdio&gt;</span>
<a id="__codelineno-75-4" name="__codelineno-75-4" href="#__codelineno-75-4"></a>
<a id="__codelineno-75-5" name="__codelineno-75-5" href="#__codelineno-75-5"></a><span class="kt">void</span><span class="w"> </span><span class="nf">close_file</span><span class="p">(</span><span class="kt">FILE</span><span class="o">*</span><span class="w"> </span><span class="n">file</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-75-6" name="__codelineno-75-6" href="#__codelineno-75-6"></a><span class="w">    </span><span class="n">fclose</span><span class="p">(</span><span class="n">file</span><span class="p">);</span>
<a id="__codelineno-75-7" name="__codelineno-75-7" href="#__codelineno-75-7"></a><span class="p">}</span>
<a id="__codelineno-75-8" name="__codelineno-75-8" href="#__codelineno-75-8"></a>
<a id="__codelineno-75-9" name="__codelineno-75-9" href="#__codelineno-75-9"></a><span class="kt">int</span><span class="w"> </span><span class="nf">main</span><span class="p">()</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-75-10" name="__codelineno-75-10" href="#__codelineno-75-10"></a><span class="w">    </span><span class="n">std</span><span class="o">::</span><span class="n">shared_ptr</span><span class="o">&lt;</span><span class="kt">FILE</span><span class="o">&gt;</span><span class="w"> </span><span class="n">file</span><span class="p">(</span><span class="n">fopen</span><span class="p">(</span><span class="s">&quot;example.txt&quot;</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;r&quot;</span><span class="p">),</span><span class="w"> </span><span class="n">close_file</span><span class="p">);</span>
<a id="__codelineno-75-11" name="__codelineno-75-11" href="#__codelineno-75-11"></a><span class="w">    </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="o">!</span><span class="n">file</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-75-12" name="__codelineno-75-12" href="#__codelineno-75-12"></a><span class="w">        </span><span class="n">std</span><span class="o">::</span><span class="n">cerr</span><span class="w"> </span><span class="o">&lt;&lt;</span><span class="w"> </span><span class="s">&quot;Failed to open file&quot;</span><span class="w"> </span><span class="o">&lt;&lt;</span><span class="w"> </span><span class="n">std</span><span class="o">::</span><span class="n">endl</span><span class="p">;</span>
<a id="__codelineno-75-13" name="__codelineno-75-13" href="#__codelineno-75-13"></a><span class="w">        </span><span class="k">return</span><span class="w"> </span><span class="mi">1</span><span class="p">;</span>
<a id="__codelineno-75-14" name="__codelineno-75-14" href="#__codelineno-75-14"></a><span class="w">    </span><span class="p">}</span>
<a id="__codelineno-75-15" name="__codelineno-75-15" href="#__codelineno-75-15"></a><span class="w">    </span><span class="c1">// use the file...</span>
<a id="__codelineno-75-16" name="__codelineno-75-16" href="#__codelineno-75-16"></a><span class="w">    </span><span class="k">return</span><span class="w"> </span><span class="mi">0</span><span class="p">;</span>
<a id="__codelineno-75-17" name="__codelineno-75-17" href="#__codelineno-75-17"></a><span class="p">}</span>
</code></pre></div>
<p>In this example, we define a custom deleter function <code>close_file</code> that takes a <code>FILE*</code> pointer and closes the file using <code>fclose</code>. We then use the <code>std::shared_ptr</code> constructor to open the file using <code>fopen</code> and pass the custom deleter function to the constructor. When the <code>std::shared_ptr</code> object goes out of scope, the custom deleter function is called to close the file.</p>
<p>Custom deleters can be passed to smart pointers in several ways. The most common way is to pass the deleter function or function object as the second argument to the smart pointer constructor. For example:</p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-76-1" name="__codelineno-76-1" href="#__codelineno-76-1"></a><span class="n">std</span><span class="o">::</span><span class="n">shared_ptr</span><span class="o">&lt;</span><span class="kt">FILE</span><span class="o">&gt;</span><span class="w"> </span><span class="n">file</span><span class="p">(</span><span class="n">fopen</span><span class="p">(</span><span class="s">&quot;example.txt&quot;</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;r&quot;</span><span class="p">),</span><span class="w"> </span><span class="n">close_file</span><span class="p">);</span>
</code></pre></div>
<p>Another way to pass a custom deleter to a smart pointer is to use the <code>std::shared_ptr::reset</code> function. For example:</p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-77-1" name="__codelineno-77-1" href="#__codelineno-77-1"></a><span class="n">std</span><span class="o">::</span><span class="n">shared_ptr</span><span class="o">&lt;</span><span class="kt">FILE</span><span class="o">&gt;</span><span class="w"> </span><span class="n">file</span><span class="p">;</span>
<a id="__codelineno-77-2" name="__codelineno-77-2" href="#__codelineno-77-2"></a><span class="n">file</span><span class="p">.</span><span class="n">reset</span><span class="p">(</span><span class="n">fopen</span><span class="p">(</span><span class="s">&quot;example.txt&quot;</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;r&quot;</span><span class="p">),</span><span class="w"> </span><span class="n">close_file</span><span class="p">);</span>
</code></pre></div>
<p>Custom deleters can also be used with <code>std::unique_ptr</code>. However, since <code>std::unique_ptr</code> only supports custom deleters through its constructor, it's not possible to change the deleter of an existing <code>std::unique_ptr</code> object.</p>
<p>Custom deleters can be a very powerful feature of C++ that can help to manage resources safely and efficiently. By using custom deleters, we can ensure that resources are properly released, even in the presence of exceptions or errors, and we can write safer and more reliable code.</p>
<h4 id="scope-guards">Scope Guards</h4>
<p>Scope guards are a technique used in C++ to ensure that resources are properly released when they are no longer needed. Scope guards are used to automatically execute a piece of code when a scope is exited, regardless of how the scope is exited. This can be useful for releasing resources that are acquired within a scope, such as dynamically allocated memory or file handles.</p>
<p>Scope guards are implemented using a technique called RAII (Resource Acquisition Is Initialization). RAII is a programming technique that associates the lifetime of a resource with the lifetime of an object. When the object is created, the resource is acquired, and when the object is destroyed, the resource is released. Scope guards are implemented using a special type of object that is created at the beginning of a scope and destroyed at the end of the scope.</p>
<p>Here's an example that uses a scope guard to release dynamically allocated memory:</p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-78-1" name="__codelineno-78-1" href="#__codelineno-78-1"></a><span class="cp">#include</span><span class="w"> </span><span class="cpf">&lt;iostream&gt;</span>
<a id="__codelineno-78-2" name="__codelineno-78-2" href="#__codelineno-78-2"></a><span class="cp">#include</span><span class="w"> </span><span class="cpf">&lt;memory&gt;</span>
<a id="__codelineno-78-3" name="__codelineno-78-3" href="#__codelineno-78-3"></a>
<a id="__codelineno-78-4" name="__codelineno-78-4" href="#__codelineno-78-4"></a><span class="k">class</span><span class="w"> </span><span class="nc">ScopeGuard</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-78-5" name="__codelineno-78-5" href="#__codelineno-78-5"></a><span class="k">public</span><span class="o">:</span>
<a id="__codelineno-78-6" name="__codelineno-78-6" href="#__codelineno-78-6"></a><span class="w">    </span><span class="n">ScopeGuard</span><span class="p">(</span><span class="n">std</span><span class="o">::</span><span class="n">function</span><span class="o">&lt;</span><span class="kt">void</span><span class="p">()</span><span class="o">&gt;</span><span class="w"> </span><span class="n">f</span><span class="p">)</span><span class="w"> </span><span class="o">:</span><span class="w"> </span><span class="n">f_</span><span class="p">(</span><span class="n">f</span><span class="p">)</span><span class="w"> </span><span class="p">{}</span>
<a id="__codelineno-78-7" name="__codelineno-78-7" href="#__codelineno-78-7"></a><span class="w">    </span><span class="o">~</span><span class="n">ScopeGuard</span><span class="p">()</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-78-8" name="__codelineno-78-8" href="#__codelineno-78-8"></a><span class="w">        </span><span class="n">f_</span><span class="p">();</span>
<a id="__codelineno-78-9" name="__codelineno-78-9" href="#__codelineno-78-9"></a><span class="w">    </span><span class="p">}</span>
<a id="__codelineno-78-10" name="__codelineno-78-10" href="#__codelineno-78-10"></a><span class="w">    </span><span class="n">ScopeGuard</span><span class="p">(</span><span class="k">const</span><span class="w"> </span><span class="n">ScopeGuard</span><span class="o">&amp;</span><span class="p">)</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">delete</span><span class="p">;</span>
<a id="__codelineno-78-11" name="__codelineno-78-11" href="#__codelineno-78-11"></a><span class="w">    </span><span class="n">ScopeGuard</span><span class="o">&amp;</span><span class="w"> </span><span class="k">operator</span><span class="o">=</span><span class="p">(</span><span class="k">const</span><span class="w"> </span><span class="n">ScopeGuard</span><span class="o">&amp;</span><span class="p">)</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">delete</span><span class="p">;</span>
<a id="__codelineno-78-12" name="__codelineno-78-12" href="#__codelineno-78-12"></a><span class="k">private</span><span class="o">:</span>
<a id="__codelineno-78-13" name="__codelineno-78-13" href="#__codelineno-78-13"></a><span class="w">    </span><span class="n">std</span><span class="o">::</span><span class="n">function</span><span class="o">&lt;</span><span class="kt">void</span><span class="p">()</span><span class="o">&gt;</span><span class="w"> </span><span class="n">f_</span><span class="p">;</span>
<a id="__codelineno-78-14" name="__codelineno-78-14" href="#__codelineno-78-14"></a><span class="p">};</span>
<a id="__codelineno-78-15" name="__codelineno-78-15" href="#__codelineno-78-15"></a>
<a id="__codelineno-78-16" name="__codelineno-78-16" href="#__codelineno-78-16"></a><span class="kt">int</span><span class="w"> </span><span class="nf">main</span><span class="p">()</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-78-17" name="__codelineno-78-17" href="#__codelineno-78-17"></a><span class="w">    </span><span class="kt">int</span><span class="o">*</span><span class="w"> </span><span class="n">p</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">new</span><span class="w"> </span><span class="kt">int</span><span class="p">(</span><span class="mi">42</span><span class="p">);</span>
<a id="__codelineno-78-18" name="__codelineno-78-18" href="#__codelineno-78-18"></a><span class="w">    </span><span class="n">ScopeGuard</span><span class="w"> </span><span class="n">guard</span><span class="p">([</span><span class="n">p</span><span class="p">]()</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="k">delete</span><span class="w"> </span><span class="n">p</span><span class="p">;</span><span class="w"> </span><span class="p">});</span>
<a id="__codelineno-78-19" name="__codelineno-78-19" href="#__codelineno-78-19"></a><span class="w">    </span><span class="c1">// use the dynamically allocated memory...</span>
<a id="__codelineno-78-20" name="__codelineno-78-20" href="#__codelineno-78-20"></a><span class="w">    </span><span class="k">return</span><span class="w"> </span><span class="mi">0</span><span class="p">;</span>
<a id="__codelineno-78-21" name="__codelineno-78-21" href="#__codelineno-78-21"></a><span class="p">}</span>
</code></pre></div>
<p>In this example, we define a <code>ScopeGuard</code> class that takes a function object as a constructor argument. The function object is executed when the <code>ScopeGuard</code> object is destroyed. We then use the <code>ScopeGuard</code> class to create a scope guard that releases the dynamically allocated memory when the scope is exited.</p>
<p>Scope guards can be a very powerful technique for managing resources in C++. By using scope guards, we can ensure that resources are properly released, even in the presence of exceptions or errors, and we can write safer and more reliable code.</p>
<p>C++11 introduced a feature called "lambda expressions" that can be used to create scope guards in a more concise way. Here's an example that uses a lambda expression to create a scope guard:</p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-79-1" name="__codelineno-79-1" href="#__codelineno-79-1"></a><span class="cp">#include</span><span class="w"> </span><span class="cpf">&lt;iostream&gt;</span>
<a id="__codelineno-79-2" name="__codelineno-79-2" href="#__codelineno-79-2"></a><span class="cp">#include</span><span class="w"> </span><span class="cpf">&lt;memory&gt;</span>
<a id="__codelineno-79-3" name="__codelineno-79-3" href="#__codelineno-79-3"></a>
<a id="__codelineno-79-4" name="__codelineno-79-4" href="#__codelineno-79-4"></a><span class="kt">int</span><span class="w"> </span><span class="nf">main</span><span class="p">()</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-79-5" name="__codelineno-79-5" href="#__codelineno-79-5"></a><span class="w">    </span><span class="kt">int</span><span class="o">*</span><span class="w"> </span><span class="n">p</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">new</span><span class="w"> </span><span class="kt">int</span><span class="p">(</span><span class="mi">42</span><span class="p">);</span>
<a id="__codelineno-79-6" name="__codelineno-79-6" href="#__codelineno-79-6"></a><span class="w">    </span><span class="k">auto</span><span class="w"> </span><span class="n">guard</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">[</span><span class="n">p</span><span class="p">]()</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="k">delete</span><span class="w"> </span><span class="n">p</span><span class="p">;</span><span class="w"> </span><span class="p">};</span>
<a id="__codelineno-79-7" name="__codelineno-79-7" href="#__codelineno-79-7"></a><span class="w">    </span><span class="c1">// use the dynamically allocated memory...</span>
<a id="__codelineno-79-8" name="__codelineno-79-8" href="#__codelineno-79-8"></a><span class="w">    </span><span class="k">return</span><span class="w"> </span><span class="mi">0</span><span class="p">;</span>
<a id="__codelineno-79-9" name="__codelineno-79-9" href="#__codelineno-79-9"></a><span class="p">}</span>
</code></pre></div>
<p>In this example, we use a lambda expression to create a scope guard that releases the dynamically allocated memory when the scope is exited. The lambda expression is assigned to a variable <code>guard</code>, and the scope guard is automatically executed when the variable goes out of scope.</p>
<p>Scope guards can be a very powerful feature of C++ that can help to manage resources safely and efficiently. By using scope guards, we can ensure that resources are properly acquired and released, even in the presence of exceptions or errors, and we can write safer and more reliable code.</p>
<p>By utilizing these resource management techniques, game developers can ensure efficient and reliable handling of resources, leading to better performance and stability in their games.</p>
<h3 id="template-advanced-techniques">Template Advanced Techniques</h3>
<p>Templates in C++ are a powerful feature that allows for generic programming and code reuse. Advanced template techniques can provide even more flexibility and functionality. Here are some key advanced techniques:</p>
<h4 id="sfinae-substitution-failure-is-not-an-error">SFINAE (Substitution Failure Is Not An Error)</h4>
<p>SFINAE (Substitution Failure Is Not An Error) is a technique used in C++ template metaprogramming to enable or disable the instantiation of a template based on the presence or absence of certain types or functions. SFINAE is used to implement compile-time type checking and to enable or disable the instantiation of a template based on the properties of its template arguments.</p>
<p>SFINAE works by causing a substitution failure during the template instantiation process. A substitution failure occurs when the compiler encounters a construct that cannot be replaced with a valid type or value. Instead of generating a compilation error, the compiler discards the failed instantiation and continues with the next one.</p>
<p>Here's an example that uses SFINAE to enable or disable the instantiation of a template based on the presence or absence of a member function:</p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-80-1" name="__codelineno-80-1" href="#__codelineno-80-1"></a><span class="cp">#include</span><span class="w"> </span><span class="cpf">&lt;iostream&gt;</span>
<a id="__codelineno-80-2" name="__codelineno-80-2" href="#__codelineno-80-2"></a><span class="cp">#include</span><span class="w"> </span><span class="cpf">&lt;type_traits&gt;</span>
<a id="__codelineno-80-3" name="__codelineno-80-3" href="#__codelineno-80-3"></a>
<a id="__codelineno-80-4" name="__codelineno-80-4" href="#__codelineno-80-4"></a><span class="k">template</span><span class="w"> </span><span class="o">&lt;</span><span class="k">typename</span><span class="w"> </span><span class="nc">T</span><span class="p">,</span><span class="w"> </span><span class="k">typename</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="kt">void</span><span class="o">&gt;</span>
<a id="__codelineno-80-5" name="__codelineno-80-5" href="#__codelineno-80-5"></a><span class="k">struct</span><span class="w"> </span><span class="nc">HasPrintMember</span><span class="w"> </span><span class="o">:</span><span class="w"> </span><span class="n">std</span><span class="o">::</span><span class="n">false_type</span><span class="w"> </span><span class="p">{};</span>
<a id="__codelineno-80-6" name="__codelineno-80-6" href="#__codelineno-80-6"></a>
<a id="__codelineno-80-7" name="__codelineno-80-7" href="#__codelineno-80-7"></a><span class="k">template</span><span class="w"> </span><span class="o">&lt;</span><span class="k">typename</span><span class="w"> </span><span class="nc">T</span><span class="o">&gt;</span>
<a id="__codelineno-80-8" name="__codelineno-80-8" href="#__codelineno-80-8"></a><span class="k">struct</span><span class="w"> </span><span class="nc">HasPrintMember</span><span class="o">&lt;</span><span class="n">T</span><span class="p">,</span><span class="w"> </span><span class="n">std</span><span class="o">::</span><span class="n">void_t</span><span class="o">&lt;</span><span class="k">decltype</span><span class="p">(</span><span class="n">std</span><span class="o">::</span><span class="n">declval</span><span class="o">&lt;</span><span class="n">T</span><span class="o">&gt;</span><span class="p">().</span><span class="n">print</span><span class="p">())</span><span class="o">&gt;&gt;</span><span class="w"> </span><span class="o">:</span><span class="w"> </span><span class="n">std</span><span class="o">::</span><span class="n">true_type</span><span class="w"> </span><span class="p">{};</span>
<a id="__codelineno-80-9" name="__codelineno-80-9" href="#__codelineno-80-9"></a>
<a id="__codelineno-80-10" name="__codelineno-80-10" href="#__codelineno-80-10"></a><span class="k">template</span><span class="w"> </span><span class="o">&lt;</span><span class="k">typename</span><span class="w"> </span><span class="nc">T</span><span class="o">&gt;</span>
<a id="__codelineno-80-11" name="__codelineno-80-11" href="#__codelineno-80-11"></a><span class="n">std</span><span class="o">::</span><span class="n">enable_if_t</span><span class="o">&lt;</span><span class="n">HasPrintMember</span><span class="o">&lt;</span><span class="n">T</span><span class="o">&gt;::</span><span class="n">value</span><span class="p">,</span><span class="w"> </span><span class="kt">void</span><span class="o">&gt;</span><span class="w"> </span><span class="n">print</span><span class="p">(</span><span class="k">const</span><span class="w"> </span><span class="n">T</span><span class="o">&amp;</span><span class="w"> </span><span class="n">t</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-80-12" name="__codelineno-80-12" href="#__codelineno-80-12"></a><span class="w">    </span><span class="n">t</span><span class="p">.</span><span class="n">print</span><span class="p">();</span>
<a id="__codelineno-80-13" name="__codelineno-80-13" href="#__codelineno-80-13"></a><span class="p">}</span>
<a id="__codelineno-80-14" name="__codelineno-80-14" href="#__codelineno-80-14"></a>
<a id="__codelineno-80-15" name="__codelineno-80-15" href="#__codelineno-80-15"></a><span class="k">template</span><span class="w"> </span><span class="o">&lt;</span><span class="k">typename</span><span class="w"> </span><span class="nc">T</span><span class="o">&gt;</span>
<a id="__codelineno-80-16" name="__codelineno-80-16" href="#__codelineno-80-16"></a><span class="n">std</span><span class="o">::</span><span class="n">enable_if_t</span><span class="o">&lt;!</span><span class="n">HasPrintMember</span><span class="o">&lt;</span><span class="n">T</span><span class="o">&gt;::</span><span class="n">value</span><span class="p">,</span><span class="w"> </span><span class="kt">void</span><span class="o">&gt;</span><span class="w"> </span><span class="n">print</span><span class="p">(</span><span class="k">const</span><span class="w"> </span><span class="n">T</span><span class="o">&amp;</span><span class="w"> </span><span class="n">t</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-80-17" name="__codelineno-80-17" href="#__codelineno-80-17"></a><span class="w">    </span><span class="n">std</span><span class="o">::</span><span class="n">cout</span><span class="w"> </span><span class="o">&lt;&lt;</span><span class="w"> </span><span class="s">&quot;No print member function&quot;</span><span class="w"> </span><span class="o">&lt;&lt;</span><span class="w"> </span><span class="n">std</span><span class="o">::</span><span class="n">endl</span><span class="p">;</span>
<a id="__codelineno-80-18" name="__codelineno-80-18" href="#__codelineno-80-18"></a><span class="p">}</span>
<a id="__codelineno-80-19" name="__codelineno-80-19" href="#__codelineno-80-19"></a>
<a id="__codelineno-80-20" name="__codelineno-80-20" href="#__codelineno-80-20"></a><span class="k">struct</span><span class="w"> </span><span class="nc">Foo</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-80-21" name="__codelineno-80-21" href="#__codelineno-80-21"></a><span class="w">    </span><span class="kt">void</span><span class="w"> </span><span class="nf">print</span><span class="p">()</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-80-22" name="__codelineno-80-22" href="#__codelineno-80-22"></a><span class="w">        </span><span class="n">std</span><span class="o">::</span><span class="n">cout</span><span class="w"> </span><span class="o">&lt;&lt;</span><span class="w"> </span><span class="s">&quot;Foo&quot;</span><span class="w"> </span><span class="o">&lt;&lt;</span><span class="w"> </span><span class="n">std</span><span class="o">::</span><span class="n">endl</span><span class="p">;</span>
<a id="__codelineno-80-23" name="__codelineno-80-23" href="#__codelineno-80-23"></a><span class="w">    </span><span class="p">}</span>
<a id="__codelineno-80-24" name="__codelineno-80-24" href="#__codelineno-80-24"></a><span class="p">};</span>
<a id="__codelineno-80-25" name="__codelineno-80-25" href="#__codelineno-80-25"></a>
<a id="__codelineno-80-26" name="__codelineno-80-26" href="#__codelineno-80-26"></a><span class="k">struct</span><span class="w"> </span><span class="nc">Bar</span><span class="w"> </span><span class="p">{};</span>
<a id="__codelineno-80-27" name="__codelineno-80-27" href="#__codelineno-80-27"></a>
<a id="__codelineno-80-28" name="__codelineno-80-28" href="#__codelineno-80-28"></a><span class="kt">int</span><span class="w"> </span><span class="nf">main</span><span class="p">()</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-80-29" name="__codelineno-80-29" href="#__codelineno-80-29"></a><span class="w">    </span><span class="n">Foo</span><span class="w"> </span><span class="n">foo</span><span class="p">;</span>
<a id="__codelineno-80-30" name="__codelineno-80-30" href="#__codelineno-80-30"></a><span class="w">    </span><span class="n">Bar</span><span class="w"> </span><span class="n">bar</span><span class="p">;</span>
<a id="__codelineno-80-31" name="__codelineno-80-31" href="#__codelineno-80-31"></a><span class="w">    </span><span class="n">print</span><span class="p">(</span><span class="n">foo</span><span class="p">);</span><span class="w"> </span><span class="c1">// prints &quot;Foo&quot;</span>
<a id="__codelineno-80-32" name="__codelineno-80-32" href="#__codelineno-80-32"></a><span class="w">    </span><span class="n">print</span><span class="p">(</span><span class="n">bar</span><span class="p">);</span><span class="w"> </span><span class="c1">// prints &quot;No print member function&quot;</span>
<a id="__codelineno-80-33" name="__codelineno-80-33" href="#__codelineno-80-33"></a><span class="w">    </span><span class="k">return</span><span class="w"> </span><span class="mi">0</span><span class="p">;</span>
<a id="__codelineno-80-34" name="__codelineno-80-34" href="#__codelineno-80-34"></a><span class="p">}</span>
</code></pre></div>
<p>In this example, we define a template struct <code>HasPrintMember</code> that uses SFINAE to determine whether a type <code>T</code> has a member function <code>print</code>. The <code>HasPrintMember</code> struct has two template arguments: the type <code>T</code> and a default template argument <code>void</code>. The default template argument is used to enable or disable the instantiation of the struct based on the presence or absence of the <code>print</code> member function.</p>
<p>The <code>HasPrintMember</code> struct has two specializations. The first specialization is a primary template that inherits from <code>std::false_type</code>. The second specialization is a partial specialization that inherits from <code>std::true_type</code> if the expression <code>decltype(std::declval&lt;T&gt;().print())</code> is well-formed. The <code>std::declval</code> function is used to create a value of type <code>T</code> that can be used to test the presence of the <code>print</code> member function.</p>
<p>We then define two overloads of the <code>print</code> function. The first overload is enabled if the <code>HasPrintMember&lt;T&gt;::value</code> is <code>true</code>, and it calls the <code>print</code> member function of the object <code>t</code>. The second overload is enabled if the <code>HasPrintMember&lt;T&gt;::value</code> is <code>false</code>, and it prints a message indicating that the object <code>t</code> does not have a <code>print</code> member function.</p>
<p>Finally, we define two types <code>Foo</code> and <code>Bar</code>. The <code>Foo</code> type has a <code>print</code> member function, and the <code>Bar</code> type does not. We then create objects of type <code>Foo</code> and <code>Bar</code> and call the <code>print</code> function with these objects. The <code>print</code> function correctly determines whether the objects have a <code>print</code> member function and prints the appropriate message.</p>
<p>SFINAE is a powerful technique that can be used to implement compile-time type checking and to enable or disable the instantiation of a template based on the properties of its template arguments. By using SFINAE, we can write more generic and flexible code that can be adapted to a wide range of types and situations.</p>
<h4 id="tag-dispatching">Tag Dispatching</h4>
<p>Tag dispatching is a technique used in C++ template metaprogramming to select the appropriate function or template specialization based on the type of a function argument. Tag dispatching is used to implement compile-time type checking and to enable or disable the instantiation of a template based on the properties of its template arguments.</p>
<p>Tag dispatching works by defining a set of "tag" types that are used to identify the properties of a function argument. The tag types are used to select the appropriate function or template specialization based on the type of the tag.</p>
<p>Here's an example that uses tag dispatching to select the appropriate function based on the type of a function argument:</p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-81-1" name="__codelineno-81-1" href="#__codelineno-81-1"></a><span class="cp">#include</span><span class="w"> </span><span class="cpf">&lt;iostream&gt;</span>
<a id="__codelineno-81-2" name="__codelineno-81-2" href="#__codelineno-81-2"></a><span class="cp">#include</span><span class="w"> </span><span class="cpf">&lt;type_traits&gt;</span>
<a id="__codelineno-81-3" name="__codelineno-81-3" href="#__codelineno-81-3"></a>
<a id="__codelineno-81-4" name="__codelineno-81-4" href="#__codelineno-81-4"></a><span class="k">struct</span><span class="w"> </span><span class="nc">IntTag</span><span class="w"> </span><span class="p">{};</span>
<a id="__codelineno-81-5" name="__codelineno-81-5" href="#__codelineno-81-5"></a><span class="k">struct</span><span class="w"> </span><span class="nc">DoubleTag</span><span class="w"> </span><span class="p">{};</span>
<a id="__codelineno-81-6" name="__codelineno-81-6" href="#__codelineno-81-6"></a>
<a id="__codelineno-81-7" name="__codelineno-81-7" href="#__codelineno-81-7"></a><span class="k">template</span><span class="w"> </span><span class="o">&lt;</span><span class="k">typename</span><span class="w"> </span><span class="nc">T</span><span class="o">&gt;</span>
<a id="__codelineno-81-8" name="__codelineno-81-8" href="#__codelineno-81-8"></a><span class="k">struct</span><span class="w"> </span><span class="nc">TagType</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-81-9" name="__codelineno-81-9" href="#__codelineno-81-9"></a><span class="w">    </span><span class="k">using</span><span class="w"> </span><span class="n">type</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">IntTag</span><span class="p">;</span>
<a id="__codelineno-81-10" name="__codelineno-81-10" href="#__codelineno-81-10"></a><span class="p">};</span>
<a id="__codelineno-81-11" name="__codelineno-81-11" href="#__codelineno-81-11"></a>
<a id="__codelineno-81-12" name="__codelineno-81-12" href="#__codelineno-81-12"></a><span class="k">template</span><span class="w"> </span><span class="o">&lt;&gt;</span>
<a id="__codelineno-81-13" name="__codelineno-81-13" href="#__codelineno-81-13"></a><span class="k">struct</span><span class="w"> </span><span class="nc">TagType</span><span class="o">&lt;</span><span class="kt">double</span><span class="o">&gt;</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-81-14" name="__codelineno-81-14" href="#__codelineno-81-14"></a><span class="w">    </span><span class="k">using</span><span class="w"> </span><span class="n">type</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">DoubleTag</span><span class="p">;</span>
<a id="__codelineno-81-15" name="__codelineno-81-15" href="#__codelineno-81-15"></a><span class="p">};</span>
<a id="__codelineno-81-16" name="__codelineno-81-16" href="#__codelineno-81-16"></a>
<a id="__codelineno-81-17" name="__codelineno-81-17" href="#__codelineno-81-17"></a><span class="k">template</span><span class="w"> </span><span class="o">&lt;</span><span class="k">typename</span><span class="w"> </span><span class="nc">T</span><span class="o">&gt;</span>
<a id="__codelineno-81-18" name="__codelineno-81-18" href="#__codelineno-81-18"></a><span class="kt">void</span><span class="w"> </span><span class="n">print</span><span class="p">(</span><span class="k">const</span><span class="w"> </span><span class="n">T</span><span class="o">&amp;</span><span class="w"> </span><span class="n">t</span><span class="p">,</span><span class="w"> </span><span class="n">IntTag</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-81-19" name="__codelineno-81-19" href="#__codelineno-81-19"></a><span class="w">    </span><span class="n">std</span><span class="o">::</span><span class="n">cout</span><span class="w"> </span><span class="o">&lt;&lt;</span><span class="w"> </span><span class="s">&quot;Int: &quot;</span><span class="w"> </span><span class="o">&lt;&lt;</span><span class="w"> </span><span class="n">t</span><span class="w"> </span><span class="o">&lt;&lt;</span><span class="w"> </span><span class="n">std</span><span class="o">::</span><span class="n">endl</span><span class="p">;</span>
<a id="__codelineno-81-20" name="__codelineno-81-20" href="#__codelineno-81-20"></a><span class="p">}</span>
<a id="__codelineno-81-21" name="__codelineno-81-21" href="#__codelineno-81-21"></a>
<a id="__codelineno-81-22" name="__codelineno-81-22" href="#__codelineno-81-22"></a><span class="k">template</span><span class="w"> </span><span class="o">&lt;</span><span class="k">typename</span><span class="w"> </span><span class="nc">T</span><span class="o">&gt;</span>
<a id="__codelineno-81-23" name="__codelineno-81-23" href="#__codelineno-81-23"></a><span class="kt">void</span><span class="w"> </span><span class="n">print</span><span class="p">(</span><span class="k">const</span><span class="w"> </span><span class="n">T</span><span class="o">&amp;</span><span class="w"> </span><span class="n">t</span><span class="p">,</span><span class="w"> </span><span class="n">DoubleTag</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-81-24" name="__codelineno-81-24" href="#__codelineno-81-24"></a><span class="w">    </span><span class="n">std</span><span class="o">::</span><span class="n">cout</span><span class="w"> </span><span class="o">&lt;&lt;</span><span class="w"> </span><span class="s">&quot;Double: &quot;</span><span class="w"> </span><span class="o">&lt;&lt;</span><span class="w"> </span><span class="n">t</span><span class="w"> </span><span class="o">&lt;&lt;</span><span class="w"> </span><span class="n">std</span><span class="o">::</span><span class="n">endl</span><span class="p">;</span>
<a id="__codelineno-81-25" name="__codelineno-81-25" href="#__codelineno-81-25"></a><span class="p">}</span>
<a id="__codelineno-81-26" name="__codelineno-81-26" href="#__codelineno-81-26"></a>
<a id="__codelineno-81-27" name="__codelineno-81-27" href="#__codelineno-81-27"></a><span class="k">template</span><span class="w"> </span><span class="o">&lt;</span><span class="k">typename</span><span class="w"> </span><span class="nc">T</span><span class="o">&gt;</span>
<a id="__codelineno-81-28" name="__codelineno-81-28" href="#__codelineno-81-28"></a><span class="kt">void</span><span class="w"> </span><span class="n">print</span><span class="p">(</span><span class="k">const</span><span class="w"> </span><span class="n">T</span><span class="o">&amp;</span><span class="w"> </span><span class="n">t</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-81-29" name="__codelineno-81-29" href="#__codelineno-81-29"></a><span class="w">    </span><span class="n">print</span><span class="p">(</span><span class="n">t</span><span class="p">,</span><span class="w"> </span><span class="k">typename</span><span class="w"> </span><span class="nc">TagType</span><span class="o">&lt;</span><span class="n">T</span><span class="o">&gt;::</span><span class="n">type</span><span class="p">());</span>
<a id="__codelineno-81-30" name="__codelineno-81-30" href="#__codelineno-81-30"></a><span class="p">}</span>
<a id="__codelineno-81-31" name="__codelineno-81-31" href="#__codelineno-81-31"></a>
<a id="__codelineno-81-32" name="__codelineno-81-32" href="#__codelineno-81-32"></a><span class="kt">int</span><span class="w"> </span><span class="n">main</span><span class="p">()</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-81-33" name="__codelineno-81-33" href="#__codelineno-81-33"></a><span class="w">    </span><span class="kt">int</span><span class="w"> </span><span class="n">i</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">42</span><span class="p">;</span>
<a id="__codelineno-81-34" name="__codelineno-81-34" href="#__codelineno-81-34"></a><span class="w">    </span><span class="kt">double</span><span class="w"> </span><span class="n">d</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mf">3.14</span><span class="p">;</span>
<a id="__codelineno-81-35" name="__codelineno-81-35" href="#__codelineno-81-35"></a><span class="w">    </span><span class="n">print</span><span class="p">(</span><span class="n">i</span><span class="p">);</span><span class="w"> </span><span class="c1">// prints &quot;Int: 42&quot;</span>
<a id="__codelineno-81-36" name="__codelineno-81-36" href="#__codelineno-81-36"></a><span class="w">    </span><span class="n">print</span><span class="p">(</span><span class="n">d</span><span class="p">);</span><span class="w"> </span><span class="c1">// prints &quot;Double: 3.14&quot;</span>
<a id="__codelineno-81-37" name="__codelineno-81-37" href="#__codelineno-81-37"></a><span class="w">    </span><span class="k">return</span><span class="w"> </span><span class="mi">0</span><span class="p">;</span>
<a id="__codelineno-81-38" name="__codelineno-81-38" href="#__codelineno-81-38"></a><span class="p">}</span>
</code></pre></div>
<p>In this example, we define two tag types <code>IntTag</code> and <code>DoubleTag</code>. We then define a template struct <code>TagType</code> that maps each type to its corresponding tag type. The <code>TagType</code> struct has a primary template that maps all types to <code>IntTag</code>, and a specialization for <code>double</code> that maps to <code>DoubleTag</code>.</p>
<p>We then define two overloads of the <code>print</code> function. The first overload takes an argument of type <code>T</code> and a tag of type <code>IntTag</code>, and it prints the argument as an integer. The second overload takes an argument of type <code>T</code> and a tag of type <code>DoubleTag</code>, and it prints the argument as a double.</p>
<p>Finally, we define a third overload of the <code>print</code> function that takes an argument of type <code>T</code> and no tag. This overload uses the <code>TagType</code> struct to map the type <code>T</code> to its corresponding tag type, and it calls the appropriate overload of the <code>print</code> function based on the tag type.</p>
<p>Tag dispatching is a powerful technique that can be used to implement compile-time type checking and to enable or disable the instantiation of a template based on the properties of its template arguments. By using tag dispatching, we can write more generic and flexible code that can be adapted to a wide range of types and situations.</p>
<h4 id="expression-templates">Expression Templates</h4>
<p>Expression templates are a technique used to optimize the performance of complex mathematical expressions in template libraries by eliminating intermediate temporaries. This technique is widely used in libraries for numerical computations, such as Eigen and Blitz++.</p>
<ul>
<li><strong>Example:</strong> Implementing a simple expression template for vector addition.</li>
</ul>
<div class="highlight"><pre><span></span><code><a id="__codelineno-82-1" name="__codelineno-82-1" href="#__codelineno-82-1"></a><span class="k">template</span><span class="w"> </span><span class="o">&lt;</span><span class="k">typename</span><span class="w"> </span><span class="nc">T</span><span class="o">&gt;</span>
<a id="__codelineno-82-2" name="__codelineno-82-2" href="#__codelineno-82-2"></a><span class="k">class</span><span class="w"> </span><span class="nc">Vector</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-82-3" name="__codelineno-82-3" href="#__codelineno-82-3"></a><span class="k">public</span><span class="o">:</span>
<a id="__codelineno-82-4" name="__codelineno-82-4" href="#__codelineno-82-4"></a><span class="w">    </span><span class="n">Vector</span><span class="p">(</span><span class="kt">size_t</span><span class="w"> </span><span class="n">size</span><span class="p">)</span><span class="w"> </span><span class="o">:</span><span class="w"> </span><span class="n">size</span><span class="p">(</span><span class="n">size</span><span class="p">),</span><span class="w"> </span><span class="n">data</span><span class="p">(</span><span class="k">new</span><span class="w"> </span><span class="n">T</span><span class="p">[</span><span class="n">size</span><span class="p">])</span><span class="w"> </span><span class="p">{}</span>
<a id="__codelineno-82-5" name="__codelineno-82-5" href="#__codelineno-82-5"></a><span class="w">    </span><span class="o">~</span><span class="n">Vector</span><span class="p">()</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="k">delete</span><span class="p">[]</span><span class="w"> </span><span class="n">data</span><span class="p">;</span><span class="w"> </span><span class="p">}</span>
<a id="__codelineno-82-6" name="__codelineno-82-6" href="#__codelineno-82-6"></a>
<a id="__codelineno-82-7" name="__codelineno-82-7" href="#__codelineno-82-7"></a><span class="w">    </span><span class="n">T</span><span class="o">&amp;</span><span class="w"> </span><span class="k">operator</span><span class="p">[](</span><span class="kt">size_t</span><span class="w"> </span><span class="n">index</span><span class="p">)</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="k">return</span><span class="w"> </span><span class="n">data</span><span class="p">[</span><span class="n">index</span><span class="p">];</span><span class="w"> </span><span class="p">}</span>
<a id="__codelineno-82-8" name="__codelineno-82-8" href="#__codelineno-82-8"></a><span class="w">    </span><span class="k">const</span><span class="w"> </span><span class="n">T</span><span class="o">&amp;</span><span class="w"> </span><span class="k">operator</span><span class="p">[](</span><span class="kt">size_t</span><span class="w"> </span><span class="n">index</span><span class="p">)</span><span class="w"> </span><span class="k">const</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="k">return</span><span class="w"> </span><span class="n">data</span><span class="p">[</span><span class="n">index</span><span class="p">];</span><span class="w"> </span><span class="p">}</span>
<a id="__codelineno-82-9" name="__codelineno-82-9" href="#__codelineno-82-9"></a>
<a id="__codelineno-82-10" name="__codelineno-82-10" href="#__codelineno-82-10"></a><span class="w">    </span><span class="k">template</span><span class="w"> </span><span class="o">&lt;</span><span class="k">typename</span><span class="w"> </span><span class="nc">E</span><span class="o">&gt;</span>
<a id="__codelineno-82-11" name="__codelineno-82-11" href="#__codelineno-82-11"></a><span class="w">    </span><span class="n">Vector</span><span class="o">&amp;</span><span class="w"> </span><span class="k">operator</span><span class="o">=</span><span class="p">(</span><span class="k">const</span><span class="w"> </span><span class="n">E</span><span class="o">&amp;</span><span class="w"> </span><span class="n">expr</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-82-12" name="__codelineno-82-12" href="#__codelineno-82-12"></a><span class="w">        </span><span class="k">for</span><span class="w"> </span><span class="p">(</span><span class="kt">size_t</span><span class="w"> </span><span class="n">i</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">0</span><span class="p">;</span><span class="w"> </span><span class="n">i</span><span class="w"> </span><span class="o">&lt;</span><span class="w"> </span><span class="n">size</span><span class="p">;</span><span class="w"> </span><span class="o">++</span><span class="n">i</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-82-13" name="__codelineno-82-13" href="#__codelineno-82-13"></a><span class="w">            </span><span class="n">data</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">expr</span><span class="p">[</span><span class="n">i</span><span class="p">];</span>
<a id="__codelineno-82-14" name="__codelineno-82-14" href="#__codelineno-82-14"></a><span class="w">        </span><span class="p">}</span>
<a id="__codelineno-82-15" name="__codelineno-82-15" href="#__codelineno-82-15"></a><span class="w">        </span><span class="k">return</span><span class="w"> </span><span class="o">*</span><span class="k">this</span><span class="p">;</span>
<a id="__codelineno-82-16" name="__codelineno-82-16" href="#__codelineno-82-16"></a><span class="w">    </span><span class="p">}</span>
<a id="__codelineno-82-17" name="__codelineno-82-17" href="#__codelineno-82-17"></a>
<a id="__codelineno-82-18" name="__codelineno-82-18" href="#__codelineno-82-18"></a><span class="k">private</span><span class="o">:</span>
<a id="__codelineno-82-19" name="__codelineno-82-19" href="#__codelineno-82-19"></a><span class="w">    </span><span class="kt">size_t</span><span class="w"> </span><span class="n">size</span><span class="p">;</span>
<a id="__codelineno-82-20" name="__codelineno-82-20" href="#__codelineno-82-20"></a><span class="w">    </span><span class="n">T</span><span class="o">*</span><span class="w"> </span><span class="n">data</span><span class="p">;</span>
<a id="__codelineno-82-21" name="__codelineno-82-21" href="#__codelineno-82-21"></a><span class="p">};</span>
<a id="__codelineno-82-22" name="__codelineno-82-22" href="#__codelineno-82-22"></a>
<a id="__codelineno-82-23" name="__codelineno-82-23" href="#__codelineno-82-23"></a><span class="k">template</span><span class="w"> </span><span class="o">&lt;</span><span class="k">typename</span><span class="w"> </span><span class="nc">L</span><span class="p">,</span><span class="w"> </span><span class="k">typename</span><span class="w"> </span><span class="nc">R</span><span class="o">&gt;</span>
<a id="__codelineno-82-24" name="__codelineno-82-24" href="#__codelineno-82-24"></a><span class="k">class</span><span class="w"> </span><span class="nc">VectorAdd</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-82-25" name="__codelineno-82-25" href="#__codelineno-82-25"></a><span class="k">public</span><span class="o">:</span>
<a id="__codelineno-82-26" name="__codelineno-82-26" href="#__codelineno-82-26"></a><span class="w">    </span><span class="n">VectorAdd</span><span class="p">(</span><span class="k">const</span><span class="w"> </span><span class="n">L</span><span class="o">&amp;</span><span class="w"> </span><span class="n">lhs</span><span class="p">,</span><span class="w"> </span><span class="k">const</span><span class="w"> </span><span class="n">R</span><span class="o">&amp;</span><span class="w"> </span><span class="n">rhs</span><span class="p">)</span><span class="w"> </span><span class="o">:</span><span class="w"> </span><span class="n">lhs</span><span class="p">(</span><span class="n">lhs</span><span class="p">),</span><span class="w"> </span><span class="n">rhs</span><span class="p">(</span><span class="n">rhs</span><span class="p">)</span><span class="w"> </span><span class="p">{}</span>
<a id="__codelineno-82-27" name="__codelineno-82-27" href="#__codelineno-82-27"></a>
<a id="__codelineno-82-28" name="__codelineno-82-28" href="#__codelineno-82-28"></a><span class="w">    </span><span class="k">auto</span><span class="w"> </span><span class="k">operator</span><span class="p">[](</span><span class="kt">size_t</span><span class="w"> </span><span class="n">index</span><span class="p">)</span><span class="w"> </span><span class="k">const</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="k">return</span><span class="w"> </span><span class="n">lhs</span><span class="p">[</span><span class="n">index</span><span class="p">]</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="n">rhs</span><span class="p">[</span><span class="n">index</span><span class="p">];</span><span class="w"> </span><span class="p">}</span>
<a id="__codelineno-82-29" name="__codelineno-82-29" href="#__codelineno-82-29"></a>
<a id="__codelineno-82-30" name="__codelineno-82-30" href="#__codelineno-82-30"></a><span class="k">private</span><span class="o">:</span>
<a id="__codelineno-82-31" name="__codelineno-82-31" href="#__codelineno-82-31"></a><span class="w">    </span><span class="k">const</span><span class="w"> </span><span class="n">L</span><span class="o">&amp;</span><span class="w"> </span><span class="n">lhs</span><span class="p">;</span>
<a id="__codelineno-82-32" name="__codelineno-82-32" href="#__codelineno-82-32"></a><span class="w">    </span><span class="k">const</span><span class="w"> </span><span class="n">R</span><span class="o">&amp;</span><span class="w"> </span><span class="n">rhs</span><span class="p">;</span>
<a id="__codelineno-82-33" name="__codelineno-82-33" href="#__codelineno-82-33"></a><span class="p">};</span>
<a id="__codelineno-82-34" name="__codelineno-82-34" href="#__codelineno-82-34"></a>
<a id="__codelineno-82-35" name="__codelineno-82-35" href="#__codelineno-82-35"></a><span class="k">template</span><span class="w"> </span><span class="o">&lt;</span><span class="k">typename</span><span class="w"> </span><span class="nc">L</span><span class="p">,</span><span class="w"> </span><span class="k">typename</span><span class="w"> </span><span class="nc">R</span><span class="o">&gt;</span>
<a id="__codelineno-82-36" name="__codelineno-82-36" href="#__codelineno-82-36"></a><span class="n">VectorAdd</span><span class="o">&lt;</span><span class="n">L</span><span class="p">,</span><span class="w"> </span><span class="n">R</span><span class="o">&gt;</span><span class="w"> </span><span class="k">operator</span><span class="o">+</span><span class="p">(</span><span class="k">const</span><span class="w"> </span><span class="n">L</span><span class="o">&amp;</span><span class="w"> </span><span class="n">lhs</span><span class="p">,</span><span class="w"> </span><span class="k">const</span><span class="w"> </span><span class="n">R</span><span class="o">&amp;</span><span class="w"> </span><span class="n">rhs</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-82-37" name="__codelineno-82-37" href="#__codelineno-82-37"></a><span class="w">    </span><span class="k">return</span><span class="w"> </span><span class="n">VectorAdd</span><span class="o">&lt;</span><span class="n">L</span><span class="p">,</span><span class="w"> </span><span class="n">R</span><span class="o">&gt;</span><span class="p">(</span><span class="n">lhs</span><span class="p">,</span><span class="w"> </span><span class="n">rhs</span><span class="p">);</span>
<a id="__codelineno-82-38" name="__codelineno-82-38" href="#__codelineno-82-38"></a><span class="p">}</span>
<a id="__codelineno-82-39" name="__codelineno-82-39" href="#__codelineno-82-39"></a>
<a id="__codelineno-82-40" name="__codelineno-82-40" href="#__codelineno-82-40"></a><span class="kt">int</span><span class="w"> </span><span class="n">main</span><span class="p">()</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-82-41" name="__codelineno-82-41" href="#__codelineno-82-41"></a><span class="w">    </span><span class="n">Vector</span><span class="o">&lt;</span><span class="kt">int</span><span class="o">&gt;</span><span class="w"> </span><span class="n">a</span><span class="p">(</span><span class="mi">10</span><span class="p">),</span><span class="w"> </span><span class="n">b</span><span class="p">(</span><span class="mi">10</span><span class="p">),</span><span class="w"> </span><span class="n">c</span><span class="p">(</span><span class="mi">10</span><span class="p">);</span>
<a id="__codelineno-82-42" name="__codelineno-82-42" href="#__codelineno-82-42"></a><span class="w">    </span><span class="c1">// Initialize vectors a and b</span>
<a id="__codelineno-82-43" name="__codelineno-82-43" href="#__codelineno-82-43"></a><span class="w">    </span><span class="n">c</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">a</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="n">b</span><span class="p">;</span><span class="w"> </span><span class="c1">// Expression template optimizes this addition</span>
<a id="__codelineno-82-44" name="__codelineno-82-44" href="#__codelineno-82-44"></a><span class="p">}</span>
</code></pre></div>
<p>In this example, the expression <code>a + b</code> is represented by a <code>VectorAdd</code> object, avoiding intermediate temporaries.</p>
<h4 id="curiously-recurring-template-pattern-crtp">Curiously Recurring Template Pattern (CRTP)</h4>
<p>The Curiously Recurring Template Pattern (CRTP) is a technique used in C++ template metaprogramming to enable static polymorphism. CRTP is used to implement compile-time type checking and to enable or disable the instantiation of a template based on the properties of its template arguments.</p>
<p>The CRTP works by defining a base class template that takes a derived class type as a template argument. The derived class then inherits from the base class template, passing itself as the template argument. This creates a recursive relationship between the base class and the derived class, which is why the pattern is called the "Curiously Recurring Template Pattern".</p>
<p>Here's an example that uses the CRTP to implement static polymorphism:</p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-83-1" name="__codelineno-83-1" href="#__codelineno-83-1"></a><span class="cp">#include</span><span class="w"> </span><span class="cpf">&lt;iostream&gt;</span>
<a id="__codelineno-83-2" name="__codelineno-83-2" href="#__codelineno-83-2"></a>
<a id="__codelineno-83-3" name="__codelineno-83-3" href="#__codelineno-83-3"></a><span class="k">template</span><span class="w"> </span><span class="o">&lt;</span><span class="k">typename</span><span class="w"> </span><span class="nc">Derived</span><span class="o">&gt;</span>
<a id="__codelineno-83-4" name="__codelineno-83-4" href="#__codelineno-83-4"></a><span class="k">class</span><span class="w"> </span><span class="nc">Base</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-83-5" name="__codelineno-83-5" href="#__codelineno-83-5"></a><span class="k">public</span><span class="o">:</span>
<a id="__codelineno-83-6" name="__codelineno-83-6" href="#__codelineno-83-6"></a><span class="w">    </span><span class="kt">void</span><span class="w"> </span><span class="n">interface</span><span class="p">()</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-83-7" name="__codelineno-83-7" href="#__codelineno-83-7"></a><span class="w">        </span><span class="k">static_cast</span><span class="o">&lt;</span><span class="n">Derived</span><span class="o">*&gt;</span><span class="p">(</span><span class="k">this</span><span class="p">)</span><span class="o">-&gt;</span><span class="n">implementation</span><span class="p">();</span>
<a id="__codelineno-83-8" name="__codelineno-83-8" href="#__codelineno-83-8"></a><span class="w">    </span><span class="p">}</span>
<a id="__codelineno-83-9" name="__codelineno-83-9" href="#__codelineno-83-9"></a><span class="p">};</span>
<a id="__codelineno-83-10" name="__codelineno-83-10" href="#__codelineno-83-10"></a>
<a id="__codelineno-83-11" name="__codelineno-83-11" href="#__codelineno-83-11"></a><span class="k">class</span><span class="w"> </span><span class="nc">Derived1</span><span class="w"> </span><span class="o">:</span><span class="w"> </span><span class="k">public</span><span class="w"> </span><span class="n">Base</span><span class="o">&lt;</span><span class="n">Derived1</span><span class="o">&gt;</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-83-12" name="__codelineno-83-12" href="#__codelineno-83-12"></a><span class="k">public</span><span class="o">:</span>
<a id="__codelineno-83-13" name="__codelineno-83-13" href="#__codelineno-83-13"></a><span class="w">    </span><span class="kt">void</span><span class="w"> </span><span class="n">implementation</span><span class="p">()</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-83-14" name="__codelineno-83-14" href="#__codelineno-83-14"></a><span class="w">        </span><span class="n">std</span><span class="o">::</span><span class="n">cout</span><span class="w"> </span><span class="o">&lt;&lt;</span><span class="w"> </span><span class="s">&quot;Derived1 implementation&quot;</span><span class="w"> </span><span class="o">&lt;&lt;</span><span class="w"> </span><span class="n">std</span><span class="o">::</span><span class="n">endl</span><span class="p">;</span>
<a id="__codelineno-83-15" name="__codelineno-83-15" href="#__codelineno-83-15"></a><span class="w">    </span><span class="p">}</span>
<a id="__codelineno-83-16" name="__codelineno-83-16" href="#__codelineno-83-16"></a><span class="p">};</span>
<a id="__codelineno-83-17" name="__codelineno-83-17" href="#__codelineno-83-17"></a>
<a id="__codelineno-83-18" name="__codelineno-83-18" href="#__codelineno-83-18"></a><span class="k">class</span><span class="w"> </span><span class="nc">Derived2</span><span class="w"> </span><span class="o">:</span><span class="w"> </span><span class="k">public</span><span class="w"> </span><span class="n">Base</span><span class="o">&lt;</span><span class="n">Derived2</span><span class="o">&gt;</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-83-19" name="__codelineno-83-19" href="#__codelineno-83-19"></a><span class="k">public</span><span class="o">:</span>
<a id="__codelineno-83-20" name="__codelineno-83-20" href="#__codelineno-83-20"></a><span class="w">    </span><span class="kt">void</span><span class="w"> </span><span class="n">implementation</span><span class="p">()</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-83-21" name="__codelineno-83-21" href="#__codelineno-83-21"></a><span class="w">        </span><span class="n">std</span><span class="o">::</span><span class="n">cout</span><span class="w"> </span><span class="o">&lt;&lt;</span><span class="w"> </span><span class="s">&quot;Derived2 implementation&quot;</span><span class="w"> </span><span class="o">&lt;&lt;</span><span class="w"> </span><span class="n">std</span><span class="o">::</span><span class="n">endl</span><span class="p">;</span>
<a id="__codelineno-83-22" name="__codelineno-83-22" href="#__codelineno-83-22"></a><span class="w">    </span><span class="p">}</span>
<a id="__codelineno-83-23" name="__codelineno-83-23" href="#__codelineno-83-23"></a><span class="p">};</span>
<a id="__codelineno-83-24" name="__codelineno-83-24" href="#__codelineno-83-24"></a>
<a id="__codelineno-83-25" name="__codelineno-83-25" href="#__codelineno-83-25"></a><span class="kt">int</span><span class="w"> </span><span class="nf">main</span><span class="p">()</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-83-26" name="__codelineno-83-26" href="#__codelineno-83-26"></a><span class="w">    </span><span class="n">Derived1</span><span class="w"> </span><span class="n">d1</span><span class="p">;</span>
<a id="__codelineno-83-27" name="__codelineno-83-27" href="#__codelineno-83-27"></a><span class="w">    </span><span class="n">Derived2</span><span class="w"> </span><span class="n">d2</span><span class="p">;</span>
<a id="__codelineno-83-28" name="__codelineno-83-28" href="#__codelineno-83-28"></a><span class="w">    </span><span class="n">d1</span><span class="p">.</span><span class="n">interface</span><span class="p">();</span><span class="w"> </span><span class="c1">// prints &quot;Derived1 implementation&quot;</span>
<a id="__codelineno-83-29" name="__codelineno-83-29" href="#__codelineno-83-29"></a><span class="w">    </span><span class="n">d2</span><span class="p">.</span><span class="n">interface</span><span class="p">();</span><span class="w"> </span><span class="c1">// prints &quot;Derived2 implementation&quot;</span>
<a id="__codelineno-83-30" name="__codelineno-83-30" href="#__codelineno-83-30"></a><span class="w">    </span><span class="k">return</span><span class="w"> </span><span class="mi">0</span><span class="p">;</span>
<a id="__codelineno-83-31" name="__codelineno-83-31" href="#__codelineno-83-31"></a><span class="p">}</span>
</code></pre></div>
<p>In this example, we define a base class template <code>Base</code> that takes a derived class type <code>Derived</code> as a template argument. The <code>Base</code> class defines a public interface function <code>interface</code> that calls a private implementation function <code>implementation</code> on the derived class.</p>
<p>We then define two derived classes <code>Derived1</code> and <code>Derived2</code> that inherit from the <code>Base</code> class template, passing themselves as the template argument. Each derived class implements the <code>implementation</code> function to provide its own implementation of the interface.</p>
<p>Finally, we create objects of type <code>Derived1</code> and <code>Derived2</code> and call the <code>interface</code> function on these objects. The <code>interface</code> function correctly calls the appropriate implementation function based on the type of the object.</p>
<p>The CRTP is a powerful technique that can be used to implement static polymorphism and to enable or disable the instantiation of a template based on the properties of its template arguments. By using the CRTP, we can write more generic and flexible code that can be adapted to a wide range of types and situations.</p>
<h4 id="template-specialization-and-partial-specialization">Template Specialization and Partial Specialization</h4>
<p>Template specialization allows for defining different implementations of a template for specific types or conditions. Full specialization defines an implementation for a specific type, while partial specialization defines an implementation for a subset of template parameters.</p>
<ul>
<li><strong>Example:</strong> Full and partial specialization of a template class.</li>
</ul>
<div class="highlight"><pre><span></span><code><a id="__codelineno-84-1" name="__codelineno-84-1" href="#__codelineno-84-1"></a><span class="k">template</span><span class="w"> </span><span class="o">&lt;</span><span class="k">typename</span><span class="w"> </span><span class="nc">T</span><span class="o">&gt;</span>
<a id="__codelineno-84-2" name="__codelineno-84-2" href="#__codelineno-84-2"></a><span class="k">class</span><span class="w"> </span><span class="nc">Traits</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-84-3" name="__codelineno-84-3" href="#__codelineno-84-3"></a><span class="k">public</span><span class="o">:</span>
<a id="__codelineno-84-4" name="__codelineno-84-4" href="#__codelineno-84-4"></a><span class="w">    </span><span class="k">static</span><span class="w"> </span><span class="kt">void</span><span class="w"> </span><span class="n">print</span><span class="p">()</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-84-5" name="__codelineno-84-5" href="#__codelineno-84-5"></a><span class="w">        </span><span class="n">std</span><span class="o">::</span><span class="n">cout</span><span class="w"> </span><span class="o">&lt;&lt;</span><span class="w"> </span><span class="s">&quot;Generic type&quot;</span><span class="w"> </span><span class="o">&lt;&lt;</span><span class="w"> </span><span class="n">std</span><span class="o">::</span><span class="n">endl</span><span class="p">;</span>
<a id="__codelineno-84-6" name="__codelineno-84-6" href="#__codelineno-84-6"></a><span class="w">    </span><span class="p">}</span>
<a id="__codelineno-84-7" name="__codelineno-84-7" href="#__codelineno-84-7"></a><span class="p">};</span>
<a id="__codelineno-84-8" name="__codelineno-84-8" href="#__codelineno-84-8"></a>
<a id="__codelineno-84-9" name="__codelineno-84-9" href="#__codelineno-84-9"></a><span class="k">template</span><span class="w"> </span><span class="o">&lt;&gt;</span>
<a id="__codelineno-84-10" name="__codelineno-84-10" href="#__codelineno-84-10"></a><span class="k">class</span><span class="w"> </span><span class="nc">Traits</span><span class="o">&lt;</span><span class="kt">int</span><span class="o">&gt;</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-84-11" name="__codelineno-84-11" href="#__codelineno-84-11"></a><span class="k">public</span><span class="o">:</span>
<a id="__codelineno-84-12" name="__codelineno-84-12" href="#__codelineno-84-12"></a><span class="w">    </span><span class="k">static</span><span class="w"> </span><span class="kt">void</span><span class="w"> </span><span class="n">print</span><span class="p">()</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-84-13" name="__codelineno-84-13" href="#__codelineno-84-13"></a><span class="w">        </span><span class="n">std</span><span class="o">::</span><span class="n">cout</span><span class="w"> </span><span class="o">&lt;&lt;</span><span class="w"> </span><span class="s">&quot;int type&quot;</span><span class="w"> </span><span class="o">&lt;&lt;</span><span class="w"> </span><span class="n">std</span><span class="o">::</span><span class="n">endl</span><span class="p">;</span>
<a id="__codelineno-84-14" name="__codelineno-84-14" href="#__codelineno-84-14"></a><span class="w">    </span><span class="p">}</span>
<a id="__codelineno-84-15" name="__codelineno-84-15" href="#__codelineno-84-15"></a><span class="p">};</span>
<a id="__codelineno-84-16" name="__codelineno-84-16" href="#__codelineno-84-16"></a>
<a id="__codelineno-84-17" name="__codelineno-84-17" href="#__codelineno-84-17"></a><span class="k">template</span><span class="w"> </span><span class="o">&lt;</span><span class="k">typename</span><span class="w"> </span><span class="nc">T</span><span class="o">&gt;</span>
<a id="__codelineno-84-18" name="__codelineno-84-18" href="#__codelineno-84-18"></a><span class="k">class</span><span class="w"> </span><span class="nc">Traits</span><span class="o">&lt;</span><span class="n">T</span><span class="o">*&gt;</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-84-19" name="__codelineno-84-19" href="#__codelineno-84-19"></a><span class="k">public</span><span class="o">:</span>
<a id="__codelineno-84-20" name="__codelineno-84-20" href="#__codelineno-84-20"></a><span class="w">    </span><span class="k">static</span><span class="w"> </span><span class="kt">void</span><span class="w"> </span><span class="n">print</span><span class="p">()</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-84-21" name="__codelineno-84-21" href="#__codelineno-84-21"></a><span class="w">        </span><span class="n">std</span><span class="o">::</span><span class="n">cout</span><span class="w"> </span><span class="o">&lt;&lt;</span><span class="w"> </span><span class="s">&quot;Pointer type&quot;</span><span class="w"> </span><span class="o">&lt;&lt;</span><span class="w"> </span><span class="n">std</span><span class="o">::</span><span class="n">endl</span><span class="p">;</span>
<a id="__codelineno-84-22" name="__codelineno-84-22" href="#__codelineno-84-22"></a><span class="w">    </span><span class="p">}</span>
<a id="__codelineno-84-23" name="__codelineno-84-23" href="#__codelineno-84-23"></a><span class="p">};</span>
<a id="__codelineno-84-24" name="__codelineno-84-24" href="#__codelineno-84-24"></a>
<a id="__codelineno-84-25" name="__codelineno-84-25" href="#__codelineno-84-25"></a><span class="kt">int</span><span class="w"> </span><span class="nf">main</span><span class="p">()</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-84-26" name="__codelineno-84-26" href="#__codelineno-84-26"></a><span class="w">    </span><span class="n">Traits</span><span class="o">&lt;</span><span class="kt">double</span><span class="o">&gt;::</span><span class="n">print</span><span class="p">();</span><span class="w"> </span><span class="c1">// Generic type</span>
<a id="__codelineno-84-27" name="__codelineno-84-27" href="#__codelineno-84-27"></a><span class="w">    </span><span class="n">Traits</span><span class="o">&lt;</span><span class="kt">int</span><span class="o">&gt;::</span><span class="n">print</span><span class="p">();</span><span class="w"> </span><span class="c1">// int type</span>
<a id="__codelineno-84-28" name="__codelineno-84-28" href="#__codelineno-84-28"></a><span class="w">    </span><span class="n">Traits</span><span class="o">&lt;</span><span class="kt">int</span><span class="o">*&gt;::</span><span class="n">print</span><span class="p">();</span><span class="w"> </span><span class="c1">// Pointer type</span>
<a id="__codelineno-84-29" name="__codelineno-84-29" href="#__codelineno-84-29"></a><span class="p">}</span>
</code></pre></div>
<p>In this example, <code>Traits</code> has a general implementation, a full specialization for <code>int</code>, and a partial specialization for pointers.</p>
<p>By mastering these advanced template techniques, developers can write more efficient, flexible, and maintainable C++ code, leveraging the full power of C++ templates.</p>
<h2 id="move-semantics-and-perfect-forwarding">Move Semantics and Perfect Forwarding</h2>
<h3 id="rvalue-references">Rvalue References</h3>
<p>Rvalue references allow you to bind to temporary objects. They are declared using double ampersands (&amp;&amp;).</p>
<p>Example:
<div class="highlight"><pre><span></span><code><a id="__codelineno-85-1" name="__codelineno-85-1" href="#__codelineno-85-1"></a><span class="kt">int</span><span class="o">&amp;&amp;</span><span class="w"> </span><span class="n">rref</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">10</span><span class="p">;</span><span class="w"> </span><span class="c1">// rvalue reference</span>
<a id="__codelineno-85-2" name="__codelineno-85-2" href="#__codelineno-85-2"></a><span class="kt">int</span><span class="w"> </span><span class="n">x</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">5</span><span class="p">;</span>
<a id="__codelineno-85-3" name="__codelineno-85-3" href="#__codelineno-85-3"></a><span class="kt">int</span><span class="o">&amp;&amp;</span><span class="w"> </span><span class="n">rref2</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">x</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="mi">5</span><span class="p">;</span><span class="w"> </span><span class="c1">// binds to the temporary result of x + 5</span>
</code></pre></div></p>
<p>Rvalue References, introduced in C++11, are a feature that allows you to distinguish between lvalue references and rvalue references. They are particularly useful for implementing move semantics and perfect forwarding, which can significantly improve performance in certain scenarios.</p>
<p>Here's an implementation showcasing various aspects of Rvalue References:</p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-86-1" name="__codelineno-86-1" href="#__codelineno-86-1"></a><span class="cp">#include</span><span class="w"> </span><span class="cpf">&lt;iostream&gt;</span>
<a id="__codelineno-86-2" name="__codelineno-86-2" href="#__codelineno-86-2"></a><span class="cp">#include</span><span class="w"> </span><span class="cpf">&lt;vector&gt;</span>
<a id="__codelineno-86-3" name="__codelineno-86-3" href="#__codelineno-86-3"></a><span class="cp">#include</span><span class="w"> </span><span class="cpf">&lt;utility&gt;</span>
<a id="__codelineno-86-4" name="__codelineno-86-4" href="#__codelineno-86-4"></a><span class="cp">#include</span><span class="w"> </span><span class="cpf">&lt;string&gt;</span>
<a id="__codelineno-86-5" name="__codelineno-86-5" href="#__codelineno-86-5"></a><span class="cp">#include</span><span class="w"> </span><span class="cpf">&lt;chrono&gt;</span>
<a id="__codelineno-86-6" name="__codelineno-86-6" href="#__codelineno-86-6"></a>
<a id="__codelineno-86-7" name="__codelineno-86-7" href="#__codelineno-86-7"></a><span class="k">namespace</span><span class="w"> </span><span class="nn">example</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-86-8" name="__codelineno-86-8" href="#__codelineno-86-8"></a><span class="k">namespace</span><span class="w"> </span><span class="nn">rvalue_references</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-86-9" name="__codelineno-86-9" href="#__codelineno-86-9"></a>
<a id="__codelineno-86-10" name="__codelineno-86-10" href="#__codelineno-86-10"></a><span class="c1">// A simple class to demonstrate move semantics</span>
<a id="__codelineno-86-11" name="__codelineno-86-11" href="#__codelineno-86-11"></a><span class="k">class</span><span class="w"> </span><span class="nc">BigObject</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-86-12" name="__codelineno-86-12" href="#__codelineno-86-12"></a><span class="w"> </span><span class="k">public</span><span class="o">:</span>
<a id="__codelineno-86-13" name="__codelineno-86-13" href="#__codelineno-86-13"></a><span class="w">  </span><span class="k">explicit</span><span class="w"> </span><span class="n">BigObject</span><span class="p">(</span><span class="kt">size_t</span><span class="w"> </span><span class="n">size</span><span class="p">)</span><span class="w"> </span><span class="o">:</span><span class="w"> </span><span class="n">data_</span><span class="p">(</span><span class="k">new</span><span class="w"> </span><span class="kt">int</span><span class="p">[</span><span class="n">size</span><span class="p">]),</span><span class="w"> </span><span class="n">size_</span><span class="p">(</span><span class="n">size</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-86-14" name="__codelineno-86-14" href="#__codelineno-86-14"></a><span class="w">    </span><span class="n">std</span><span class="o">::</span><span class="n">cout</span><span class="w"> </span><span class="o">&lt;&lt;</span><span class="w"> </span><span class="s">&quot;BigObject: Allocating &quot;</span><span class="w"> </span><span class="o">&lt;&lt;</span><span class="w"> </span><span class="n">size_</span><span class="w"> </span><span class="o">&lt;&lt;</span><span class="w"> </span><span class="s">&quot; integers</span><span class="se">\n</span><span class="s">&quot;</span><span class="p">;</span>
<a id="__codelineno-86-15" name="__codelineno-86-15" href="#__codelineno-86-15"></a><span class="w">  </span><span class="p">}</span>
<a id="__codelineno-86-16" name="__codelineno-86-16" href="#__codelineno-86-16"></a>
<a id="__codelineno-86-17" name="__codelineno-86-17" href="#__codelineno-86-17"></a><span class="w">  </span><span class="c1">// Copy constructor</span>
<a id="__codelineno-86-18" name="__codelineno-86-18" href="#__codelineno-86-18"></a><span class="w">  </span><span class="n">BigObject</span><span class="p">(</span><span class="k">const</span><span class="w"> </span><span class="n">BigObject</span><span class="o">&amp;</span><span class="w"> </span><span class="n">other</span><span class="p">)</span><span class="w"> </span><span class="o">:</span><span class="w"> </span><span class="n">data_</span><span class="p">(</span><span class="k">new</span><span class="w"> </span><span class="kt">int</span><span class="p">[</span><span class="n">other</span><span class="p">.</span><span class="n">size_</span><span class="p">]),</span><span class="w"> </span><span class="n">size_</span><span class="p">(</span><span class="n">other</span><span class="p">.</span><span class="n">size_</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-86-19" name="__codelineno-86-19" href="#__codelineno-86-19"></a><span class="w">    </span><span class="n">std</span><span class="o">::</span><span class="n">cout</span><span class="w"> </span><span class="o">&lt;&lt;</span><span class="w"> </span><span class="s">&quot;BigObject: Copy constructor</span><span class="se">\n</span><span class="s">&quot;</span><span class="p">;</span>
<a id="__codelineno-86-20" name="__codelineno-86-20" href="#__codelineno-86-20"></a><span class="w">    </span><span class="n">std</span><span class="o">::</span><span class="n">copy</span><span class="p">(</span><span class="n">other</span><span class="p">.</span><span class="n">data_</span><span class="p">,</span><span class="w"> </span><span class="n">other</span><span class="p">.</span><span class="n">data_</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="n">size_</span><span class="p">,</span><span class="w"> </span><span class="n">data_</span><span class="p">);</span>
<a id="__codelineno-86-21" name="__codelineno-86-21" href="#__codelineno-86-21"></a><span class="w">  </span><span class="p">}</span>
<a id="__codelineno-86-22" name="__codelineno-86-22" href="#__codelineno-86-22"></a>
<a id="__codelineno-86-23" name="__codelineno-86-23" href="#__codelineno-86-23"></a><span class="w">  </span><span class="c1">// Move constructor</span>
<a id="__codelineno-86-24" name="__codelineno-86-24" href="#__codelineno-86-24"></a><span class="w">  </span><span class="n">BigObject</span><span class="p">(</span><span class="n">BigObject</span><span class="o">&amp;&amp;</span><span class="w"> </span><span class="n">other</span><span class="p">)</span><span class="w"> </span><span class="k">noexcept</span>
<a id="__codelineno-86-25" name="__codelineno-86-25" href="#__codelineno-86-25"></a><span class="w">      </span><span class="o">:</span><span class="w"> </span><span class="n">data_</span><span class="p">(</span><span class="n">other</span><span class="p">.</span><span class="n">data_</span><span class="p">),</span><span class="w"> </span><span class="n">size_</span><span class="p">(</span><span class="n">other</span><span class="p">.</span><span class="n">size_</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-86-26" name="__codelineno-86-26" href="#__codelineno-86-26"></a><span class="w">    </span><span class="n">std</span><span class="o">::</span><span class="n">cout</span><span class="w"> </span><span class="o">&lt;&lt;</span><span class="w"> </span><span class="s">&quot;BigObject: Move constructor</span><span class="se">\n</span><span class="s">&quot;</span><span class="p">;</span>
<a id="__codelineno-86-27" name="__codelineno-86-27" href="#__codelineno-86-27"></a><span class="w">    </span><span class="n">other</span><span class="p">.</span><span class="n">data_</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">nullptr</span><span class="p">;</span>
<a id="__codelineno-86-28" name="__codelineno-86-28" href="#__codelineno-86-28"></a><span class="w">    </span><span class="n">other</span><span class="p">.</span><span class="n">size_</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">0</span><span class="p">;</span>
<a id="__codelineno-86-29" name="__codelineno-86-29" href="#__codelineno-86-29"></a><span class="w">  </span><span class="p">}</span>
<a id="__codelineno-86-30" name="__codelineno-86-30" href="#__codelineno-86-30"></a>
<a id="__codelineno-86-31" name="__codelineno-86-31" href="#__codelineno-86-31"></a><span class="w">  </span><span class="c1">// Copy assignment operator</span>
<a id="__codelineno-86-32" name="__codelineno-86-32" href="#__codelineno-86-32"></a><span class="w">  </span><span class="n">BigObject</span><span class="o">&amp;</span><span class="w"> </span><span class="k">operator</span><span class="o">=</span><span class="p">(</span><span class="k">const</span><span class="w"> </span><span class="n">BigObject</span><span class="o">&amp;</span><span class="w"> </span><span class="n">other</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-86-33" name="__codelineno-86-33" href="#__codelineno-86-33"></a><span class="w">    </span><span class="n">std</span><span class="o">::</span><span class="n">cout</span><span class="w"> </span><span class="o">&lt;&lt;</span><span class="w"> </span><span class="s">&quot;BigObject: Copy assignment</span><span class="se">\n</span><span class="s">&quot;</span><span class="p">;</span>
<a id="__codelineno-86-34" name="__codelineno-86-34" href="#__codelineno-86-34"></a><span class="w">    </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="k">this</span><span class="w"> </span><span class="o">!=</span><span class="w"> </span><span class="o">&amp;</span><span class="n">other</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-86-35" name="__codelineno-86-35" href="#__codelineno-86-35"></a><span class="w">      </span><span class="k">delete</span><span class="p">[]</span><span class="w"> </span><span class="n">data_</span><span class="p">;</span>
<a id="__codelineno-86-36" name="__codelineno-86-36" href="#__codelineno-86-36"></a><span class="w">      </span><span class="n">size_</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">other</span><span class="p">.</span><span class="n">size_</span><span class="p">;</span>
<a id="__codelineno-86-37" name="__codelineno-86-37" href="#__codelineno-86-37"></a><span class="w">      </span><span class="n">data_</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">new</span><span class="w"> </span><span class="kt">int</span><span class="p">[</span><span class="n">size_</span><span class="p">];</span>
<a id="__codelineno-86-38" name="__codelineno-86-38" href="#__codelineno-86-38"></a><span class="w">      </span><span class="n">std</span><span class="o">::</span><span class="n">copy</span><span class="p">(</span><span class="n">other</span><span class="p">.</span><span class="n">data_</span><span class="p">,</span><span class="w"> </span><span class="n">other</span><span class="p">.</span><span class="n">data_</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="n">size_</span><span class="p">,</span><span class="w"> </span><span class="n">data_</span><span class="p">);</span>
<a id="__codelineno-86-39" name="__codelineno-86-39" href="#__codelineno-86-39"></a><span class="w">    </span><span class="p">}</span>
<a id="__codelineno-86-40" name="__codelineno-86-40" href="#__codelineno-86-40"></a><span class="w">    </span><span class="k">return</span><span class="w"> </span><span class="o">*</span><span class="k">this</span><span class="p">;</span>
<a id="__codelineno-86-41" name="__codelineno-86-41" href="#__codelineno-86-41"></a><span class="w">  </span><span class="p">}</span>
<a id="__codelineno-86-42" name="__codelineno-86-42" href="#__codelineno-86-42"></a>
<a id="__codelineno-86-43" name="__codelineno-86-43" href="#__codelineno-86-43"></a><span class="w">  </span><span class="c1">// Move assignment operator</span>
<a id="__codelineno-86-44" name="__codelineno-86-44" href="#__codelineno-86-44"></a><span class="w">  </span><span class="n">BigObject</span><span class="o">&amp;</span><span class="w"> </span><span class="k">operator</span><span class="o">=</span><span class="p">(</span><span class="n">BigObject</span><span class="o">&amp;&amp;</span><span class="w"> </span><span class="n">other</span><span class="p">)</span><span class="w"> </span><span class="k">noexcept</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-86-45" name="__codelineno-86-45" href="#__codelineno-86-45"></a><span class="w">    </span><span class="n">std</span><span class="o">::</span><span class="n">cout</span><span class="w"> </span><span class="o">&lt;&lt;</span><span class="w"> </span><span class="s">&quot;BigObject: Move assignment</span><span class="se">\n</span><span class="s">&quot;</span><span class="p">;</span>
<a id="__codelineno-86-46" name="__codelineno-86-46" href="#__codelineno-86-46"></a><span class="w">    </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="k">this</span><span class="w"> </span><span class="o">!=</span><span class="w"> </span><span class="o">&amp;</span><span class="n">other</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-86-47" name="__codelineno-86-47" href="#__codelineno-86-47"></a><span class="w">      </span><span class="k">delete</span><span class="p">[]</span><span class="w"> </span><span class="n">data_</span><span class="p">;</span>
<a id="__codelineno-86-48" name="__codelineno-86-48" href="#__codelineno-86-48"></a><span class="w">      </span><span class="n">data_</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">other</span><span class="p">.</span><span class="n">data_</span><span class="p">;</span>
<a id="__codelineno-86-49" name="__codelineno-86-49" href="#__codelineno-86-49"></a><span class="w">      </span><span class="n">size_</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">other</span><span class="p">.</span><span class="n">size_</span><span class="p">;</span>
<a id="__codelineno-86-50" name="__codelineno-86-50" href="#__codelineno-86-50"></a><span class="w">      </span><span class="n">other</span><span class="p">.</span><span class="n">data_</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">nullptr</span><span class="p">;</span>
<a id="__codelineno-86-51" name="__codelineno-86-51" href="#__codelineno-86-51"></a><span class="w">      </span><span class="n">other</span><span class="p">.</span><span class="n">size_</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">0</span><span class="p">;</span>
<a id="__codelineno-86-52" name="__codelineno-86-52" href="#__codelineno-86-52"></a><span class="w">    </span><span class="p">}</span>
<a id="__codelineno-86-53" name="__codelineno-86-53" href="#__codelineno-86-53"></a><span class="w">    </span><span class="k">return</span><span class="w"> </span><span class="o">*</span><span class="k">this</span><span class="p">;</span>
<a id="__codelineno-86-54" name="__codelineno-86-54" href="#__codelineno-86-54"></a><span class="w">  </span><span class="p">}</span>
<a id="__codelineno-86-55" name="__codelineno-86-55" href="#__codelineno-86-55"></a>
<a id="__codelineno-86-56" name="__codelineno-86-56" href="#__codelineno-86-56"></a><span class="w">  </span><span class="o">~</span><span class="n">BigObject</span><span class="p">()</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-86-57" name="__codelineno-86-57" href="#__codelineno-86-57"></a><span class="w">    </span><span class="k">delete</span><span class="p">[]</span><span class="w"> </span><span class="n">data_</span><span class="p">;</span>
<a id="__codelineno-86-58" name="__codelineno-86-58" href="#__codelineno-86-58"></a><span class="w">  </span><span class="p">}</span>
<a id="__codelineno-86-59" name="__codelineno-86-59" href="#__codelineno-86-59"></a>
<a id="__codelineno-86-60" name="__codelineno-86-60" href="#__codelineno-86-60"></a><span class="w">  </span><span class="kt">size_t</span><span class="w"> </span><span class="n">Size</span><span class="p">()</span><span class="w"> </span><span class="k">const</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="k">return</span><span class="w"> </span><span class="n">size_</span><span class="p">;</span><span class="w"> </span><span class="p">}</span>
<a id="__codelineno-86-61" name="__codelineno-86-61" href="#__codelineno-86-61"></a>
<a id="__codelineno-86-62" name="__codelineno-86-62" href="#__codelineno-86-62"></a><span class="w"> </span><span class="k">private</span><span class="o">:</span>
<a id="__codelineno-86-63" name="__codelineno-86-63" href="#__codelineno-86-63"></a><span class="w">  </span><span class="kt">int</span><span class="o">*</span><span class="w"> </span><span class="n">data_</span><span class="p">;</span>
<a id="__codelineno-86-64" name="__codelineno-86-64" href="#__codelineno-86-64"></a><span class="w">  </span><span class="kt">size_t</span><span class="w"> </span><span class="n">size_</span><span class="p">;</span>
<a id="__codelineno-86-65" name="__codelineno-86-65" href="#__codelineno-86-65"></a><span class="p">};</span>
<a id="__codelineno-86-66" name="__codelineno-86-66" href="#__codelineno-86-66"></a>
<a id="__codelineno-86-67" name="__codelineno-86-67" href="#__codelineno-86-67"></a><span class="c1">// Function to demonstrate perfect forwarding</span>
<a id="__codelineno-86-68" name="__codelineno-86-68" href="#__codelineno-86-68"></a><span class="k">template</span><span class="w"> </span><span class="o">&lt;</span><span class="k">typename</span><span class="w"> </span><span class="nc">T</span><span class="o">&gt;</span>
<a id="__codelineno-86-69" name="__codelineno-86-69" href="#__codelineno-86-69"></a><span class="kt">void</span><span class="w"> </span><span class="n">ForwardingFunction</span><span class="p">(</span><span class="n">T</span><span class="o">&amp;&amp;</span><span class="w"> </span><span class="n">arg</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-86-70" name="__codelineno-86-70" href="#__codelineno-86-70"></a><span class="w">  </span><span class="n">std</span><span class="o">::</span><span class="n">cout</span><span class="w"> </span><span class="o">&lt;&lt;</span><span class="w"> </span><span class="s">&quot;Forwarding argument to ProcessValue</span><span class="se">\n</span><span class="s">&quot;</span><span class="p">;</span>
<a id="__codelineno-86-71" name="__codelineno-86-71" href="#__codelineno-86-71"></a><span class="w">  </span><span class="n">ProcessValue</span><span class="p">(</span><span class="n">std</span><span class="o">::</span><span class="n">forward</span><span class="o">&lt;</span><span class="n">T</span><span class="o">&gt;</span><span class="p">(</span><span class="n">arg</span><span class="p">));</span>
<a id="__codelineno-86-72" name="__codelineno-86-72" href="#__codelineno-86-72"></a><span class="p">}</span>
<a id="__codelineno-86-73" name="__codelineno-86-73" href="#__codelineno-86-73"></a>
<a id="__codelineno-86-74" name="__codelineno-86-74" href="#__codelineno-86-74"></a><span class="c1">// Overloads to demonstrate how perfect forwarding preserves value category</span>
<a id="__codelineno-86-75" name="__codelineno-86-75" href="#__codelineno-86-75"></a><span class="kt">void</span><span class="w"> </span><span class="n">ProcessValue</span><span class="p">(</span><span class="k">const</span><span class="w"> </span><span class="n">BigObject</span><span class="o">&amp;</span><span class="w"> </span><span class="n">obj</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-86-76" name="__codelineno-86-76" href="#__codelineno-86-76"></a><span class="w">  </span><span class="n">std</span><span class="o">::</span><span class="n">cout</span><span class="w"> </span><span class="o">&lt;&lt;</span><span class="w"> </span><span class="s">&quot;ProcessValue: lvalue with size &quot;</span><span class="w"> </span><span class="o">&lt;&lt;</span><span class="w"> </span><span class="n">obj</span><span class="p">.</span><span class="n">Size</span><span class="p">()</span><span class="w"> </span><span class="o">&lt;&lt;</span><span class="w"> </span><span class="s">&quot;</span><span class="se">\n</span><span class="s">&quot;</span><span class="p">;</span>
<a id="__codelineno-86-77" name="__codelineno-86-77" href="#__codelineno-86-77"></a><span class="p">}</span>
<a id="__codelineno-86-78" name="__codelineno-86-78" href="#__codelineno-86-78"></a>
<a id="__codelineno-86-79" name="__codelineno-86-79" href="#__codelineno-86-79"></a><span class="kt">void</span><span class="w"> </span><span class="n">ProcessValue</span><span class="p">(</span><span class="n">BigObject</span><span class="o">&amp;&amp;</span><span class="w"> </span><span class="n">obj</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-86-80" name="__codelineno-86-80" href="#__codelineno-86-80"></a><span class="w">  </span><span class="n">std</span><span class="o">::</span><span class="n">cout</span><span class="w"> </span><span class="o">&lt;&lt;</span><span class="w"> </span><span class="s">&quot;ProcessValue: rvalue with size &quot;</span><span class="w"> </span><span class="o">&lt;&lt;</span><span class="w"> </span><span class="n">obj</span><span class="p">.</span><span class="n">Size</span><span class="p">()</span><span class="w"> </span><span class="o">&lt;&lt;</span><span class="w"> </span><span class="s">&quot;</span><span class="se">\n</span><span class="s">&quot;</span><span class="p">;</span>
<a id="__codelineno-86-81" name="__codelineno-86-81" href="#__codelineno-86-81"></a><span class="p">}</span>
<a id="__codelineno-86-82" name="__codelineno-86-82" href="#__codelineno-86-82"></a>
<a id="__codelineno-86-83" name="__codelineno-86-83" href="#__codelineno-86-83"></a><span class="c1">// Function to measure execution time</span>
<a id="__codelineno-86-84" name="__codelineno-86-84" href="#__codelineno-86-84"></a><span class="k">template</span><span class="w"> </span><span class="o">&lt;</span><span class="k">typename</span><span class="w"> </span><span class="nc">Func</span><span class="o">&gt;</span>
<a id="__codelineno-86-85" name="__codelineno-86-85" href="#__codelineno-86-85"></a><span class="kt">double</span><span class="w"> </span><span class="n">MeasureExecutionTime</span><span class="p">(</span><span class="n">Func</span><span class="w"> </span><span class="n">func</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-86-86" name="__codelineno-86-86" href="#__codelineno-86-86"></a><span class="w">  </span><span class="k">auto</span><span class="w"> </span><span class="n">start</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">std</span><span class="o">::</span><span class="n">chrono</span><span class="o">::</span><span class="n">high_resolution_clock</span><span class="o">::</span><span class="n">now</span><span class="p">();</span>
<a id="__codelineno-86-87" name="__codelineno-86-87" href="#__codelineno-86-87"></a><span class="w">  </span><span class="n">func</span><span class="p">();</span>
<a id="__codelineno-86-88" name="__codelineno-86-88" href="#__codelineno-86-88"></a><span class="w">  </span><span class="k">auto</span><span class="w"> </span><span class="n">end</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">std</span><span class="o">::</span><span class="n">chrono</span><span class="o">::</span><span class="n">high_resolution_clock</span><span class="o">::</span><span class="n">now</span><span class="p">();</span>
<a id="__codelineno-86-89" name="__codelineno-86-89" href="#__codelineno-86-89"></a><span class="w">  </span><span class="n">std</span><span class="o">::</span><span class="n">chrono</span><span class="o">::</span><span class="n">duration</span><span class="o">&lt;</span><span class="kt">double</span><span class="p">,</span><span class="w"> </span><span class="n">std</span><span class="o">::</span><span class="n">milli</span><span class="o">&gt;</span><span class="w"> </span><span class="n">duration</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">end</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="n">start</span><span class="p">;</span>
<a id="__codelineno-86-90" name="__codelineno-86-90" href="#__codelineno-86-90"></a><span class="w">  </span><span class="k">return</span><span class="w"> </span><span class="n">duration</span><span class="p">.</span><span class="n">count</span><span class="p">();</span>
<a id="__codelineno-86-91" name="__codelineno-86-91" href="#__codelineno-86-91"></a><span class="p">}</span>
<a id="__codelineno-86-92" name="__codelineno-86-92" href="#__codelineno-86-92"></a>
<a id="__codelineno-86-93" name="__codelineno-86-93" href="#__codelineno-86-93"></a><span class="c1">// Function to demonstrate the performance benefits of move semantics</span>
<a id="__codelineno-86-94" name="__codelineno-86-94" href="#__codelineno-86-94"></a><span class="kt">void</span><span class="w"> </span><span class="n">DemonstratePerformanceBenefits</span><span class="p">()</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-86-95" name="__codelineno-86-95" href="#__codelineno-86-95"></a><span class="w">  </span><span class="k">const</span><span class="w"> </span><span class="kt">int</span><span class="w"> </span><span class="n">num_iterations</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">100000</span><span class="p">;</span>
<a id="__codelineno-86-96" name="__codelineno-86-96" href="#__codelineno-86-96"></a><span class="w">  </span><span class="n">std</span><span class="o">::</span><span class="n">vector</span><span class="o">&lt;</span><span class="n">BigObject</span><span class="o">&gt;</span><span class="w"> </span><span class="n">vec</span><span class="p">;</span>
<a id="__codelineno-86-97" name="__codelineno-86-97" href="#__codelineno-86-97"></a><span class="w">  </span><span class="n">vec</span><span class="p">.</span><span class="n">reserve</span><span class="p">(</span><span class="n">num_iterations</span><span class="p">);</span>
<a id="__codelineno-86-98" name="__codelineno-86-98" href="#__codelineno-86-98"></a>
<a id="__codelineno-86-99" name="__codelineno-86-99" href="#__codelineno-86-99"></a><span class="w">  </span><span class="kt">double</span><span class="w"> </span><span class="n">copy_time</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">MeasureExecutionTime</span><span class="p">([</span><span class="o">&amp;</span><span class="p">]()</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-86-100" name="__codelineno-86-100" href="#__codelineno-86-100"></a><span class="w">    </span><span class="k">for</span><span class="w"> </span><span class="p">(</span><span class="kt">int</span><span class="w"> </span><span class="n">i</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">0</span><span class="p">;</span><span class="w"> </span><span class="n">i</span><span class="w"> </span><span class="o">&lt;</span><span class="w"> </span><span class="n">num_iterations</span><span class="p">;</span><span class="w"> </span><span class="o">++</span><span class="n">i</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-86-101" name="__codelineno-86-101" href="#__codelineno-86-101"></a><span class="w">      </span><span class="n">BigObject</span><span class="w"> </span><span class="nf">obj</span><span class="p">(</span><span class="mi">1000</span><span class="p">);</span>
<a id="__codelineno-86-102" name="__codelineno-86-102" href="#__codelineno-86-102"></a><span class="w">      </span><span class="n">vec</span><span class="p">.</span><span class="n">push_back</span><span class="p">(</span><span class="n">obj</span><span class="p">);</span>
<a id="__codelineno-86-103" name="__codelineno-86-103" href="#__codelineno-86-103"></a><span class="w">    </span><span class="p">}</span>
<a id="__codelineno-86-104" name="__codelineno-86-104" href="#__codelineno-86-104"></a><span class="w">  </span><span class="p">});</span>
<a id="__codelineno-86-105" name="__codelineno-86-105" href="#__codelineno-86-105"></a>
<a id="__codelineno-86-106" name="__codelineno-86-106" href="#__codelineno-86-106"></a><span class="w">  </span><span class="n">vec</span><span class="p">.</span><span class="n">clear</span><span class="p">();</span>
<a id="__codelineno-86-107" name="__codelineno-86-107" href="#__codelineno-86-107"></a>
<a id="__codelineno-86-108" name="__codelineno-86-108" href="#__codelineno-86-108"></a><span class="w">  </span><span class="kt">double</span><span class="w"> </span><span class="n">move_time</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">MeasureExecutionTime</span><span class="p">([</span><span class="o">&amp;</span><span class="p">]()</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-86-109" name="__codelineno-86-109" href="#__codelineno-86-109"></a><span class="w">    </span><span class="k">for</span><span class="w"> </span><span class="p">(</span><span class="kt">int</span><span class="w"> </span><span class="n">i</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">0</span><span class="p">;</span><span class="w"> </span><span class="n">i</span><span class="w"> </span><span class="o">&lt;</span><span class="w"> </span><span class="n">num_iterations</span><span class="p">;</span><span class="w"> </span><span class="o">++</span><span class="n">i</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-86-110" name="__codelineno-86-110" href="#__codelineno-86-110"></a><span class="w">      </span><span class="n">BigObject</span><span class="w"> </span><span class="nf">obj</span><span class="p">(</span><span class="mi">1000</span><span class="p">);</span>
<a id="__codelineno-86-111" name="__codelineno-86-111" href="#__codelineno-86-111"></a><span class="w">      </span><span class="n">vec</span><span class="p">.</span><span class="n">push_back</span><span class="p">(</span><span class="n">std</span><span class="o">::</span><span class="n">move</span><span class="p">(</span><span class="n">obj</span><span class="p">));</span>
<a id="__codelineno-86-112" name="__codelineno-86-112" href="#__codelineno-86-112"></a><span class="w">    </span><span class="p">}</span>
<a id="__codelineno-86-113" name="__codelineno-86-113" href="#__codelineno-86-113"></a><span class="w">  </span><span class="p">});</span>
<a id="__codelineno-86-114" name="__codelineno-86-114" href="#__codelineno-86-114"></a>
<a id="__codelineno-86-115" name="__codelineno-86-115" href="#__codelineno-86-115"></a><span class="w">  </span><span class="n">std</span><span class="o">::</span><span class="n">cout</span><span class="w"> </span><span class="o">&lt;&lt;</span><span class="w"> </span><span class="s">&quot;Copy time: &quot;</span><span class="w"> </span><span class="o">&lt;&lt;</span><span class="w"> </span><span class="n">copy_time</span><span class="w"> </span><span class="o">&lt;&lt;</span><span class="w"> </span><span class="s">&quot; ms</span><span class="se">\n</span><span class="s">&quot;</span><span class="p">;</span>
<a id="__codelineno-86-116" name="__codelineno-86-116" href="#__codelineno-86-116"></a><span class="w">  </span><span class="n">std</span><span class="o">::</span><span class="n">cout</span><span class="w"> </span><span class="o">&lt;&lt;</span><span class="w"> </span><span class="s">&quot;Move time: &quot;</span><span class="w"> </span><span class="o">&lt;&lt;</span><span class="w"> </span><span class="n">move_time</span><span class="w"> </span><span class="o">&lt;&lt;</span><span class="w"> </span><span class="s">&quot; ms</span><span class="se">\n</span><span class="s">&quot;</span><span class="p">;</span>
<a id="__codelineno-86-117" name="__codelineno-86-117" href="#__codelineno-86-117"></a><span class="w">  </span><span class="n">std</span><span class="o">::</span><span class="n">cout</span><span class="w"> </span><span class="o">&lt;&lt;</span><span class="w"> </span><span class="s">&quot;Performance improvement: &quot;</span><span class="w"> </span><span class="o">&lt;&lt;</span><span class="w"> </span><span class="p">(</span><span class="n">copy_time</span><span class="w"> </span><span class="o">/</span><span class="w"> </span><span class="n">move_time</span><span class="p">)</span><span class="w"> </span><span class="o">&lt;&lt;</span><span class="w"> </span><span class="s">&quot;x</span><span class="se">\n</span><span class="s">&quot;</span><span class="p">;</span>
<a id="__codelineno-86-118" name="__codelineno-86-118" href="#__codelineno-86-118"></a><span class="p">}</span>
<a id="__codelineno-86-119" name="__codelineno-86-119" href="#__codelineno-86-119"></a>
<a id="__codelineno-86-120" name="__codelineno-86-120" href="#__codelineno-86-120"></a><span class="p">}</span><span class="w">  </span><span class="c1">// namespace rvalue_references</span>
<a id="__codelineno-86-121" name="__codelineno-86-121" href="#__codelineno-86-121"></a><span class="p">}</span><span class="w">  </span><span class="c1">// namespace example</span>
<a id="__codelineno-86-122" name="__codelineno-86-122" href="#__codelineno-86-122"></a>
<a id="__codelineno-86-123" name="__codelineno-86-123" href="#__codelineno-86-123"></a><span class="kt">int</span><span class="w"> </span><span class="n">main</span><span class="p">()</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-86-124" name="__codelineno-86-124" href="#__codelineno-86-124"></a><span class="w">  </span><span class="k">using</span><span class="w"> </span><span class="k">namespace</span><span class="w"> </span><span class="nn">example</span><span class="o">::</span><span class="nn">rvalue_references</span><span class="p">;</span>
<a id="__codelineno-86-125" name="__codelineno-86-125" href="#__codelineno-86-125"></a>
<a id="__codelineno-86-126" name="__codelineno-86-126" href="#__codelineno-86-126"></a><span class="w">  </span><span class="n">std</span><span class="o">::</span><span class="n">cout</span><span class="w"> </span><span class="o">&lt;&lt;</span><span class="w"> </span><span class="s">&quot;Demonstrating move semantics:</span><span class="se">\n</span><span class="s">&quot;</span><span class="p">;</span>
<a id="__codelineno-86-127" name="__codelineno-86-127" href="#__codelineno-86-127"></a><span class="w">  </span><span class="n">BigObject</span><span class="w"> </span><span class="nf">obj1</span><span class="p">(</span><span class="mi">1000</span><span class="p">);</span>
<a id="__codelineno-86-128" name="__codelineno-86-128" href="#__codelineno-86-128"></a><span class="w">  </span><span class="n">BigObject</span><span class="w"> </span><span class="n">obj2</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">std</span><span class="o">::</span><span class="n">move</span><span class="p">(</span><span class="n">obj1</span><span class="p">);</span>
<a id="__codelineno-86-129" name="__codelineno-86-129" href="#__codelineno-86-129"></a>
<a id="__codelineno-86-130" name="__codelineno-86-130" href="#__codelineno-86-130"></a><span class="w">  </span><span class="n">std</span><span class="o">::</span><span class="n">cout</span><span class="w"> </span><span class="o">&lt;&lt;</span><span class="w"> </span><span class="s">&quot;</span><span class="se">\n</span><span class="s">Demonstrating perfect forwarding:</span><span class="se">\n</span><span class="s">&quot;</span><span class="p">;</span>
<a id="__codelineno-86-131" name="__codelineno-86-131" href="#__codelineno-86-131"></a><span class="w">  </span><span class="n">BigObject</span><span class="w"> </span><span class="nf">lvalue_obj</span><span class="p">(</span><span class="mi">500</span><span class="p">);</span>
<a id="__codelineno-86-132" name="__codelineno-86-132" href="#__codelineno-86-132"></a><span class="w">  </span><span class="n">ForwardingFunction</span><span class="p">(</span><span class="n">lvalue_obj</span><span class="p">);</span><span class="w">  </span><span class="c1">// Forwards as lvalue</span>
<a id="__codelineno-86-133" name="__codelineno-86-133" href="#__codelineno-86-133"></a><span class="w">  </span><span class="n">ForwardingFunction</span><span class="p">(</span><span class="n">BigObject</span><span class="p">(</span><span class="mi">500</span><span class="p">));</span><span class="w">  </span><span class="c1">// Forwards as rvalue</span>
<a id="__codelineno-86-134" name="__codelineno-86-134" href="#__codelineno-86-134"></a>
<a id="__codelineno-86-135" name="__codelineno-86-135" href="#__codelineno-86-135"></a><span class="w">  </span><span class="n">std</span><span class="o">::</span><span class="n">cout</span><span class="w"> </span><span class="o">&lt;&lt;</span><span class="w"> </span><span class="s">&quot;</span><span class="se">\n</span><span class="s">Demonstrating performance benefits:</span><span class="se">\n</span><span class="s">&quot;</span><span class="p">;</span>
<a id="__codelineno-86-136" name="__codelineno-86-136" href="#__codelineno-86-136"></a><span class="w">  </span><span class="n">DemonstratePerformanceBenefits</span><span class="p">();</span>
<a id="__codelineno-86-137" name="__codelineno-86-137" href="#__codelineno-86-137"></a>
<a id="__codelineno-86-138" name="__codelineno-86-138" href="#__codelineno-86-138"></a><span class="w">  </span><span class="k">return</span><span class="w"> </span><span class="mi">0</span><span class="p">;</span>
<a id="__codelineno-86-139" name="__codelineno-86-139" href="#__codelineno-86-139"></a><span class="p">}</span>
</code></pre></div>
<p>This implementation demonstrates several key concepts related to Rvalue References:</p>
<ol>
<li>
<p>Move Constructor and Move Assignment Operator:
   The <code>BigObject</code> class implements both move constructor and move assignment operator, which efficiently transfer ownership of resources instead of copying them.</p>
</li>
<li>
<p>Perfect Forwarding:
   The <code>ForwardingFunction</code> template function uses <code>std::forward</code> to preserve the value category of its argument when calling <code>ProcessValue</code>.</p>
</li>
<li>
<p>Performance Benefits:
   The <code>DemonstratePerformanceBenefits</code> function shows the performance improvement gained by using move semantics when inserting objects into a vector.</p>
</li>
</ol>
<p>Key points and best practices demonstrated:</p>
<ul>
<li>Use of <code>noexcept</code> for move operations to enable optimizations.</li>
<li>Proper implementation of the Rule of Five (destructor, copy constructor, copy assignment, move constructor, move assignment).</li>
<li>Use of <code>std::move</code> to explicitly cast to an rvalue reference.</li>
<li>Use of <code>std::forward</code> in template functions for perfect forwarding.</li>
<li>Clear separation of concerns with namespaces and well-structured functions.</li>
<li>Use of modern C++ features like <code>auto</code>, range-based for loops, and lambda functions.</li>
</ul>
<p>This code provides a comprehensive example of how Rvalue References can be used to implement move semantics and perfect forwarding, leading to more efficient code. In real-world scenarios, these techniques are particularly useful when dealing with large objects or complex data structures where copying can be expensive.</p>
<h3 id="move-constructors-and-assignment-operators">Move Constructors and Assignment Operators</h3>
<p>Move constructors and move assignment operators allow efficient transfer of resources from one object to another.</p>
<p>Example:
<div class="highlight"><pre><span></span><code><a id="__codelineno-87-1" name="__codelineno-87-1" href="#__codelineno-87-1"></a><span class="k">class</span><span class="w"> </span><span class="nc">Buffer</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-87-2" name="__codelineno-87-2" href="#__codelineno-87-2"></a><span class="w">    </span><span class="n">std</span><span class="o">::</span><span class="n">unique_ptr</span><span class="o">&lt;</span><span class="kt">char</span><span class="p">[]</span><span class="o">&gt;</span><span class="w"> </span><span class="n">data</span><span class="p">;</span>
<a id="__codelineno-87-3" name="__codelineno-87-3" href="#__codelineno-87-3"></a><span class="w">    </span><span class="kt">size_t</span><span class="w"> </span><span class="n">size</span><span class="p">;</span>
<a id="__codelineno-87-4" name="__codelineno-87-4" href="#__codelineno-87-4"></a>
<a id="__codelineno-87-5" name="__codelineno-87-5" href="#__codelineno-87-5"></a><span class="k">public</span><span class="o">:</span>
<a id="__codelineno-87-6" name="__codelineno-87-6" href="#__codelineno-87-6"></a><span class="w">    </span><span class="c1">// Move constructor</span>
<a id="__codelineno-87-7" name="__codelineno-87-7" href="#__codelineno-87-7"></a><span class="w">    </span><span class="n">Buffer</span><span class="p">(</span><span class="n">Buffer</span><span class="o">&amp;&amp;</span><span class="w"> </span><span class="n">other</span><span class="p">)</span><span class="w"> </span><span class="k">noexcept</span>
<a id="__codelineno-87-8" name="__codelineno-87-8" href="#__codelineno-87-8"></a><span class="w">        </span><span class="o">:</span><span class="w"> </span><span class="n">data</span><span class="p">(</span><span class="n">std</span><span class="o">::</span><span class="n">move</span><span class="p">(</span><span class="n">other</span><span class="p">.</span><span class="n">data</span><span class="p">)),</span><span class="w"> </span><span class="n">size</span><span class="p">(</span><span class="n">other</span><span class="p">.</span><span class="n">size</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-87-9" name="__codelineno-87-9" href="#__codelineno-87-9"></a><span class="w">        </span><span class="n">other</span><span class="p">.</span><span class="n">size</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">0</span><span class="p">;</span>
<a id="__codelineno-87-10" name="__codelineno-87-10" href="#__codelineno-87-10"></a><span class="w">    </span><span class="p">}</span>
<a id="__codelineno-87-11" name="__codelineno-87-11" href="#__codelineno-87-11"></a>
<a id="__codelineno-87-12" name="__codelineno-87-12" href="#__codelineno-87-12"></a><span class="w">    </span><span class="c1">// Move assignment operator</span>
<a id="__codelineno-87-13" name="__codelineno-87-13" href="#__codelineno-87-13"></a><span class="w">    </span><span class="n">Buffer</span><span class="o">&amp;</span><span class="w"> </span><span class="k">operator</span><span class="o">=</span><span class="p">(</span><span class="n">Buffer</span><span class="o">&amp;&amp;</span><span class="w"> </span><span class="n">other</span><span class="p">)</span><span class="w"> </span><span class="k">noexcept</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-87-14" name="__codelineno-87-14" href="#__codelineno-87-14"></a><span class="w">        </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="k">this</span><span class="w"> </span><span class="o">!=</span><span class="w"> </span><span class="o">&amp;</span><span class="n">other</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-87-15" name="__codelineno-87-15" href="#__codelineno-87-15"></a><span class="w">            </span><span class="n">data</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">std</span><span class="o">::</span><span class="n">move</span><span class="p">(</span><span class="n">other</span><span class="p">.</span><span class="n">data</span><span class="p">);</span>
<a id="__codelineno-87-16" name="__codelineno-87-16" href="#__codelineno-87-16"></a><span class="w">            </span><span class="n">size</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">other</span><span class="p">.</span><span class="n">size</span><span class="p">;</span>
<a id="__codelineno-87-17" name="__codelineno-87-17" href="#__codelineno-87-17"></a><span class="w">            </span><span class="n">other</span><span class="p">.</span><span class="n">size</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">0</span><span class="p">;</span>
<a id="__codelineno-87-18" name="__codelineno-87-18" href="#__codelineno-87-18"></a><span class="w">        </span><span class="p">}</span>
<a id="__codelineno-87-19" name="__codelineno-87-19" href="#__codelineno-87-19"></a><span class="w">        </span><span class="k">return</span><span class="w"> </span><span class="o">*</span><span class="k">this</span><span class="p">;</span>
<a id="__codelineno-87-20" name="__codelineno-87-20" href="#__codelineno-87-20"></a><span class="w">    </span><span class="p">}</span>
<a id="__codelineno-87-21" name="__codelineno-87-21" href="#__codelineno-87-21"></a><span class="p">};</span>
</code></pre></div></p>
<h3 id="stdmove-and-stdforward">std::move and std::forward</h3>
<p><code>std::move</code> is used to convert an object to an rvalue, enabling move semantics.
<code>std::forward</code> is used for perfect forwarding in template functions.</p>
<p>Example:
<div class="highlight"><pre><span></span><code><a id="__codelineno-88-1" name="__codelineno-88-1" href="#__codelineno-88-1"></a><span class="k">template</span><span class="o">&lt;</span><span class="k">typename</span><span class="w"> </span><span class="nc">T</span><span class="o">&gt;</span>
<a id="__codelineno-88-2" name="__codelineno-88-2" href="#__codelineno-88-2"></a><span class="kt">void</span><span class="w"> </span><span class="n">wrapper</span><span class="p">(</span><span class="n">T</span><span class="o">&amp;&amp;</span><span class="w"> </span><span class="n">arg</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-88-3" name="__codelineno-88-3" href="#__codelineno-88-3"></a><span class="w">    </span><span class="n">foo</span><span class="p">(</span><span class="n">std</span><span class="o">::</span><span class="n">forward</span><span class="o">&lt;</span><span class="n">T</span><span class="o">&gt;</span><span class="p">(</span><span class="n">arg</span><span class="p">));</span><span class="w"> </span><span class="c1">// Perfect forwarding</span>
<a id="__codelineno-88-4" name="__codelineno-88-4" href="#__codelineno-88-4"></a><span class="p">}</span>
<a id="__codelineno-88-5" name="__codelineno-88-5" href="#__codelineno-88-5"></a>
<a id="__codelineno-88-6" name="__codelineno-88-6" href="#__codelineno-88-6"></a><span class="n">std</span><span class="o">::</span><span class="n">vector</span><span class="o">&lt;</span><span class="kt">int</span><span class="o">&gt;</span><span class="w"> </span><span class="n">createVector</span><span class="p">()</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-88-7" name="__codelineno-88-7" href="#__codelineno-88-7"></a><span class="w">    </span><span class="n">std</span><span class="o">::</span><span class="n">vector</span><span class="o">&lt;</span><span class="kt">int</span><span class="o">&gt;</span><span class="w"> </span><span class="n">vec</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">{</span><span class="mi">1</span><span class="p">,</span><span class="w"> </span><span class="mi">2</span><span class="p">,</span><span class="w"> </span><span class="mi">3</span><span class="p">,</span><span class="w"> </span><span class="mi">4</span><span class="p">,</span><span class="w"> </span><span class="mi">5</span><span class="p">};</span>
<a id="__codelineno-88-8" name="__codelineno-88-8" href="#__codelineno-88-8"></a><span class="w">    </span><span class="k">return</span><span class="w"> </span><span class="n">std</span><span class="o">::</span><span class="n">move</span><span class="p">(</span><span class="n">vec</span><span class="p">);</span><span class="w"> </span><span class="c1">// Unnecessary in this case due to RVO</span>
<a id="__codelineno-88-9" name="__codelineno-88-9" href="#__codelineno-88-9"></a><span class="p">}</span>
</code></pre></div></p>
<h3 id="universal-references">Universal References</h3>
<p>Universal references (also known as forwarding references) can bind to both lvalues and rvalues. They are declared as <code>T&amp;&amp;</code> where T is a template parameter.</p>
<p>Example:
<div class="highlight"><pre><span></span><code><a id="__codelineno-89-1" name="__codelineno-89-1" href="#__codelineno-89-1"></a><span class="k">template</span><span class="o">&lt;</span><span class="k">typename</span><span class="w"> </span><span class="nc">T</span><span class="o">&gt;</span>
<a id="__codelineno-89-2" name="__codelineno-89-2" href="#__codelineno-89-2"></a><span class="kt">void</span><span class="w"> </span><span class="n">printType</span><span class="p">(</span><span class="n">T</span><span class="o">&amp;&amp;</span><span class="w"> </span><span class="n">t</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-89-3" name="__codelineno-89-3" href="#__codelineno-89-3"></a><span class="w">    </span><span class="n">std</span><span class="o">::</span><span class="n">cout</span><span class="w"> </span><span class="o">&lt;&lt;</span><span class="w"> </span><span class="s">&quot;T is &quot;</span><span class="w"> </span><span class="o">&lt;&lt;</span><span class="w"> </span><span class="k">typeid</span><span class="p">(</span><span class="n">t</span><span class="p">).</span><span class="n">name</span><span class="p">()</span><span class="w"> </span><span class="o">&lt;&lt;</span><span class="w"> </span><span class="n">std</span><span class="o">::</span><span class="n">endl</span><span class="p">;</span>
<a id="__codelineno-89-4" name="__codelineno-89-4" href="#__codelineno-89-4"></a><span class="p">}</span>
<a id="__codelineno-89-5" name="__codelineno-89-5" href="#__codelineno-89-5"></a>
<a id="__codelineno-89-6" name="__codelineno-89-6" href="#__codelineno-89-6"></a><span class="kt">int</span><span class="w"> </span><span class="n">main</span><span class="p">()</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-89-7" name="__codelineno-89-7" href="#__codelineno-89-7"></a><span class="w">    </span><span class="kt">int</span><span class="w"> </span><span class="n">x</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">10</span><span class="p">;</span>
<a id="__codelineno-89-8" name="__codelineno-89-8" href="#__codelineno-89-8"></a><span class="w">    </span><span class="n">printType</span><span class="p">(</span><span class="n">x</span><span class="p">);</span><span class="w">    </span><span class="c1">// T is int&amp;</span>
<a id="__codelineno-89-9" name="__codelineno-89-9" href="#__codelineno-89-9"></a><span class="w">    </span><span class="n">printType</span><span class="p">(</span><span class="mi">10</span><span class="p">);</span><span class="w">   </span><span class="c1">// T is int</span>
<a id="__codelineno-89-10" name="__codelineno-89-10" href="#__codelineno-89-10"></a><span class="p">}</span>
</code></pre></div></p>
<h3 id="return-value-optimization-rvo-and-named-return-value-optimization-nrvo">Return Value Optimization (RVO) and Named Return Value Optimization (NRVO)</h3>
<p>RVO and NRVO are compiler optimizations that eliminate unnecessary copying when returning objects from functions.</p>
<p>Example of RVO:
<div class="highlight"><pre><span></span><code><a id="__codelineno-90-1" name="__codelineno-90-1" href="#__codelineno-90-1"></a><span class="n">std</span><span class="o">::</span><span class="n">vector</span><span class="o">&lt;</span><span class="kt">int</span><span class="o">&gt;</span><span class="w"> </span><span class="n">createVector</span><span class="p">()</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-90-2" name="__codelineno-90-2" href="#__codelineno-90-2"></a><span class="w">    </span><span class="k">return</span><span class="w"> </span><span class="n">std</span><span class="o">::</span><span class="n">vector</span><span class="o">&lt;</span><span class="kt">int</span><span class="o">&gt;</span><span class="p">{</span><span class="mi">1</span><span class="p">,</span><span class="w"> </span><span class="mi">2</span><span class="p">,</span><span class="w"> </span><span class="mi">3</span><span class="p">,</span><span class="w"> </span><span class="mi">4</span><span class="p">,</span><span class="w"> </span><span class="mi">5</span><span class="p">};</span><span class="w"> </span><span class="c1">// RVO applies here</span>
<a id="__codelineno-90-3" name="__codelineno-90-3" href="#__codelineno-90-3"></a><span class="p">}</span>
</code></pre></div></p>
<p>Example of NRVO:
<div class="highlight"><pre><span></span><code><a id="__codelineno-91-1" name="__codelineno-91-1" href="#__codelineno-91-1"></a><span class="n">std</span><span class="o">::</span><span class="n">vector</span><span class="o">&lt;</span><span class="kt">int</span><span class="o">&gt;</span><span class="w"> </span><span class="n">createVector</span><span class="p">()</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-91-2" name="__codelineno-91-2" href="#__codelineno-91-2"></a><span class="w">    </span><span class="n">std</span><span class="o">::</span><span class="n">vector</span><span class="o">&lt;</span><span class="kt">int</span><span class="o">&gt;</span><span class="w"> </span><span class="n">result</span><span class="p">{</span><span class="mi">1</span><span class="p">,</span><span class="w"> </span><span class="mi">2</span><span class="p">,</span><span class="w"> </span><span class="mi">3</span><span class="p">,</span><span class="w"> </span><span class="mi">4</span><span class="p">,</span><span class="w"> </span><span class="mi">5</span><span class="p">};</span>
<a id="__codelineno-91-3" name="__codelineno-91-3" href="#__codelineno-91-3"></a><span class="w">    </span><span class="c1">// ... do some work with result</span>
<a id="__codelineno-91-4" name="__codelineno-91-4" href="#__codelineno-91-4"></a><span class="w">    </span><span class="k">return</span><span class="w"> </span><span class="n">result</span><span class="p">;</span><span class="w"> </span><span class="c1">// NRVO applies here</span>
<a id="__codelineno-91-5" name="__codelineno-91-5" href="#__codelineno-91-5"></a><span class="p">}</span>
</code></pre></div></p>
<p>In both cases, most modern compilers will optimize away the copy or move operations, constructing the vector directly in the caller's stack frame.</p>
<h3 id="best-practices_2">Best Practices</h3>
<ol>
<li>Use <code>std::move</code> when you want to indicate that an object can be "moved from".</li>
<li>Implement move constructors and move assignment operators for classes that manage resources.</li>
<li>Use universal references and <code>std::forward</code> in template functions to preserve value category.</li>
<li>Avoid unnecessary <code>std::move</code> when returning local objects, as this can prevent RVO.</li>
<li>Mark move operations as <code>noexcept</code> when possible to enable optimizations in standard containers.</li>
</ol>
<p>Understanding these concepts is crucial for writing efficient C++ code, especially in performance-critical areas of game development where unnecessary copying can impact frame rates.</p>
<h2 id="concurrency-and-multithreading">Concurrency and Multithreading</h2>
<p>Effective use of concurrency and multithreading is crucial in modern game development for maximizing performance on multi-core processors.</p>
<h3 id="stdthread-and-thread-management">std::thread and Thread Management</h3>
<p><code>std::thread</code> provides a standard way to create and manage threads.</p>
<p>Example:
<div class="highlight"><pre><span></span><code><a id="__codelineno-92-1" name="__codelineno-92-1" href="#__codelineno-92-1"></a><span class="cp">#include</span><span class="w"> </span><span class="cpf">&lt;thread&gt;</span>
<a id="__codelineno-92-2" name="__codelineno-92-2" href="#__codelineno-92-2"></a><span class="cp">#include</span><span class="w"> </span><span class="cpf">&lt;vector&gt;</span>
<a id="__codelineno-92-3" name="__codelineno-92-3" href="#__codelineno-92-3"></a>
<a id="__codelineno-92-4" name="__codelineno-92-4" href="#__codelineno-92-4"></a><span class="kt">void</span><span class="w"> </span><span class="nf">updateAI</span><span class="p">(</span><span class="kt">int</span><span class="w"> </span><span class="n">entityId</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-92-5" name="__codelineno-92-5" href="#__codelineno-92-5"></a><span class="w">    </span><span class="c1">// AI update logic</span>
<a id="__codelineno-92-6" name="__codelineno-92-6" href="#__codelineno-92-6"></a><span class="p">}</span>
<a id="__codelineno-92-7" name="__codelineno-92-7" href="#__codelineno-92-7"></a>
<a id="__codelineno-92-8" name="__codelineno-92-8" href="#__codelineno-92-8"></a><span class="kt">void</span><span class="w"> </span><span class="nf">gameLoop</span><span class="p">()</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-92-9" name="__codelineno-92-9" href="#__codelineno-92-9"></a><span class="w">    </span><span class="n">std</span><span class="o">::</span><span class="n">vector</span><span class="o">&lt;</span><span class="n">std</span><span class="o">::</span><span class="kr">thread</span><span class="o">&gt;</span><span class="w"> </span><span class="n">aiThreads</span><span class="p">;</span>
<a id="__codelineno-92-10" name="__codelineno-92-10" href="#__codelineno-92-10"></a><span class="w">    </span><span class="k">for</span><span class="w"> </span><span class="p">(</span><span class="kt">int</span><span class="w"> </span><span class="n">i</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">0</span><span class="p">;</span><span class="w"> </span><span class="n">i</span><span class="w"> </span><span class="o">&lt;</span><span class="w"> </span><span class="mi">100</span><span class="p">;</span><span class="w"> </span><span class="o">++</span><span class="n">i</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-92-11" name="__codelineno-92-11" href="#__codelineno-92-11"></a><span class="w">        </span><span class="n">aiThreads</span><span class="p">.</span><span class="n">emplace_back</span><span class="p">(</span><span class="n">updateAI</span><span class="p">,</span><span class="w"> </span><span class="n">i</span><span class="p">);</span>
<a id="__codelineno-92-12" name="__codelineno-92-12" href="#__codelineno-92-12"></a><span class="w">    </span><span class="p">}</span>
<a id="__codelineno-92-13" name="__codelineno-92-13" href="#__codelineno-92-13"></a>
<a id="__codelineno-92-14" name="__codelineno-92-14" href="#__codelineno-92-14"></a><span class="w">    </span><span class="k">for</span><span class="w"> </span><span class="p">(</span><span class="k">auto</span><span class="o">&amp;</span><span class="w"> </span><span class="kr">thread</span><span class="w"> </span><span class="o">:</span><span class="w"> </span><span class="n">aiThreads</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-92-15" name="__codelineno-92-15" href="#__codelineno-92-15"></a><span class="w">        </span><span class="kr">thread</span><span class="p">.</span><span class="n">join</span><span class="p">();</span>
<a id="__codelineno-92-16" name="__codelineno-92-16" href="#__codelineno-92-16"></a><span class="w">    </span><span class="p">}</span>
<a id="__codelineno-92-17" name="__codelineno-92-17" href="#__codelineno-92-17"></a><span class="p">}</span>
</code></pre></div></p>
<p>Best practices:
- Use a thread pool to manage thread creation and destruction efficiently.
- Be mindful of the number of threads created; too many can lead to overhead.</p>
<h3 id="mutex-locks-and-atomic-operations">Mutex, Locks, and Atomic Operations</h3>
<p>Mutexes and locks are used to protect shared resources from concurrent access.</p>
<p>Example:
<div class="highlight"><pre><span></span><code><a id="__codelineno-93-1" name="__codelineno-93-1" href="#__codelineno-93-1"></a><span class="cp">#include</span><span class="w"> </span><span class="cpf">&lt;mutex&gt;</span>
<a id="__codelineno-93-2" name="__codelineno-93-2" href="#__codelineno-93-2"></a>
<a id="__codelineno-93-3" name="__codelineno-93-3" href="#__codelineno-93-3"></a><span class="k">class</span><span class="w"> </span><span class="nc">GameWorld</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-93-4" name="__codelineno-93-4" href="#__codelineno-93-4"></a><span class="w">    </span><span class="n">std</span><span class="o">::</span><span class="n">mutex</span><span class="w"> </span><span class="n">worldMutex</span><span class="p">;</span>
<a id="__codelineno-93-5" name="__codelineno-93-5" href="#__codelineno-93-5"></a><span class="w">    </span><span class="c1">// game world data</span>
<a id="__codelineno-93-6" name="__codelineno-93-6" href="#__codelineno-93-6"></a>
<a id="__codelineno-93-7" name="__codelineno-93-7" href="#__codelineno-93-7"></a><span class="k">public</span><span class="o">:</span>
<a id="__codelineno-93-8" name="__codelineno-93-8" href="#__codelineno-93-8"></a><span class="w">    </span><span class="kt">void</span><span class="w"> </span><span class="n">updateEntity</span><span class="p">(</span><span class="kt">int</span><span class="w"> </span><span class="n">entityId</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-93-9" name="__codelineno-93-9" href="#__codelineno-93-9"></a><span class="w">        </span><span class="n">std</span><span class="o">::</span><span class="n">lock_guard</span><span class="o">&lt;</span><span class="n">std</span><span class="o">::</span><span class="n">mutex</span><span class="o">&gt;</span><span class="w"> </span><span class="n">lock</span><span class="p">(</span><span class="n">worldMutex</span><span class="p">);</span>
<a id="__codelineno-93-10" name="__codelineno-93-10" href="#__codelineno-93-10"></a><span class="w">        </span><span class="c1">// Update entity in the game world</span>
<a id="__codelineno-93-11" name="__codelineno-93-11" href="#__codelineno-93-11"></a><span class="w">    </span><span class="p">}</span>
<a id="__codelineno-93-12" name="__codelineno-93-12" href="#__codelineno-93-12"></a><span class="p">};</span>
</code></pre></div></p>
<p>Atomic operations provide lock-free synchronization for simple data types.</p>
<p>Example:
<div class="highlight"><pre><span></span><code><a id="__codelineno-94-1" name="__codelineno-94-1" href="#__codelineno-94-1"></a><span class="cp">#include</span><span class="w"> </span><span class="cpf">&lt;atomic&gt;</span>
<a id="__codelineno-94-2" name="__codelineno-94-2" href="#__codelineno-94-2"></a>
<a id="__codelineno-94-3" name="__codelineno-94-3" href="#__codelineno-94-3"></a><span class="n">std</span><span class="o">::</span><span class="n">atomic</span><span class="o">&lt;</span><span class="kt">int</span><span class="o">&gt;</span><span class="w"> </span><span class="n">playerCount</span><span class="p">(</span><span class="mi">0</span><span class="p">);</span>
<a id="__codelineno-94-4" name="__codelineno-94-4" href="#__codelineno-94-4"></a>
<a id="__codelineno-94-5" name="__codelineno-94-5" href="#__codelineno-94-5"></a><span class="kt">void</span><span class="w"> </span><span class="nf">playerJoined</span><span class="p">()</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-94-6" name="__codelineno-94-6" href="#__codelineno-94-6"></a><span class="w">    </span><span class="n">playerCount</span><span class="o">++</span><span class="p">;</span>
<a id="__codelineno-94-7" name="__codelineno-94-7" href="#__codelineno-94-7"></a><span class="p">}</span>
<a id="__codelineno-94-8" name="__codelineno-94-8" href="#__codelineno-94-8"></a>
<a id="__codelineno-94-9" name="__codelineno-94-9" href="#__codelineno-94-9"></a><span class="kt">void</span><span class="w"> </span><span class="nf">playerLeft</span><span class="p">()</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-94-10" name="__codelineno-94-10" href="#__codelineno-94-10"></a><span class="w">    </span><span class="n">playerCount</span><span class="o">--</span><span class="p">;</span>
<a id="__codelineno-94-11" name="__codelineno-94-11" href="#__codelineno-94-11"></a><span class="p">}</span>
</code></pre></div></p>
<h3 id="condition-variables">Condition Variables</h3>
<p>Condition variables allow threads to wait for specific conditions to be met.</p>
<p>Example:
<div class="highlight"><pre><span></span><code><a id="__codelineno-95-1" name="__codelineno-95-1" href="#__codelineno-95-1"></a><span class="cp">#include</span><span class="w"> </span><span class="cpf">&lt;condition_variable&gt;</span>
<a id="__codelineno-95-2" name="__codelineno-95-2" href="#__codelineno-95-2"></a><span class="cp">#include</span><span class="w"> </span><span class="cpf">&lt;queue&gt;</span>
<a id="__codelineno-95-3" name="__codelineno-95-3" href="#__codelineno-95-3"></a>
<a id="__codelineno-95-4" name="__codelineno-95-4" href="#__codelineno-95-4"></a><span class="k">class</span><span class="w"> </span><span class="nc">TaskQueue</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-95-5" name="__codelineno-95-5" href="#__codelineno-95-5"></a><span class="w">    </span><span class="n">std</span><span class="o">::</span><span class="n">queue</span><span class="o">&lt;</span><span class="n">Task</span><span class="o">&gt;</span><span class="w"> </span><span class="n">tasks</span><span class="p">;</span>
<a id="__codelineno-95-6" name="__codelineno-95-6" href="#__codelineno-95-6"></a><span class="w">    </span><span class="n">std</span><span class="o">::</span><span class="n">mutex</span><span class="w"> </span><span class="n">queueMutex</span><span class="p">;</span>
<a id="__codelineno-95-7" name="__codelineno-95-7" href="#__codelineno-95-7"></a><span class="w">    </span><span class="n">std</span><span class="o">::</span><span class="n">condition_variable</span><span class="w"> </span><span class="n">cv</span><span class="p">;</span>
<a id="__codelineno-95-8" name="__codelineno-95-8" href="#__codelineno-95-8"></a>
<a id="__codelineno-95-9" name="__codelineno-95-9" href="#__codelineno-95-9"></a><span class="k">public</span><span class="o">:</span>
<a id="__codelineno-95-10" name="__codelineno-95-10" href="#__codelineno-95-10"></a><span class="w">    </span><span class="kt">void</span><span class="w"> </span><span class="n">addTask</span><span class="p">(</span><span class="n">Task</span><span class="w"> </span><span class="n">task</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-95-11" name="__codelineno-95-11" href="#__codelineno-95-11"></a><span class="w">        </span><span class="p">{</span>
<a id="__codelineno-95-12" name="__codelineno-95-12" href="#__codelineno-95-12"></a><span class="w">            </span><span class="n">std</span><span class="o">::</span><span class="n">lock_guard</span><span class="o">&lt;</span><span class="n">std</span><span class="o">::</span><span class="n">mutex</span><span class="o">&gt;</span><span class="w"> </span><span class="n">lock</span><span class="p">(</span><span class="n">queueMutex</span><span class="p">);</span>
<a id="__codelineno-95-13" name="__codelineno-95-13" href="#__codelineno-95-13"></a><span class="w">            </span><span class="n">tasks</span><span class="p">.</span><span class="n">push</span><span class="p">(</span><span class="n">task</span><span class="p">);</span>
<a id="__codelineno-95-14" name="__codelineno-95-14" href="#__codelineno-95-14"></a><span class="w">        </span><span class="p">}</span>
<a id="__codelineno-95-15" name="__codelineno-95-15" href="#__codelineno-95-15"></a><span class="w">        </span><span class="n">cv</span><span class="p">.</span><span class="n">notify_one</span><span class="p">();</span>
<a id="__codelineno-95-16" name="__codelineno-95-16" href="#__codelineno-95-16"></a><span class="w">    </span><span class="p">}</span>
<a id="__codelineno-95-17" name="__codelineno-95-17" href="#__codelineno-95-17"></a>
<a id="__codelineno-95-18" name="__codelineno-95-18" href="#__codelineno-95-18"></a><span class="w">    </span><span class="n">Task</span><span class="w"> </span><span class="n">getTask</span><span class="p">()</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-95-19" name="__codelineno-95-19" href="#__codelineno-95-19"></a><span class="w">        </span><span class="n">std</span><span class="o">::</span><span class="n">unique_lock</span><span class="o">&lt;</span><span class="n">std</span><span class="o">::</span><span class="n">mutex</span><span class="o">&gt;</span><span class="w"> </span><span class="n">lock</span><span class="p">(</span><span class="n">queueMutex</span><span class="p">);</span>
<a id="__codelineno-95-20" name="__codelineno-95-20" href="#__codelineno-95-20"></a><span class="w">        </span><span class="n">cv</span><span class="p">.</span><span class="n">wait</span><span class="p">(</span><span class="n">lock</span><span class="p">,</span><span class="w"> </span><span class="p">[</span><span class="k">this</span><span class="p">]</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="k">return</span><span class="w"> </span><span class="o">!</span><span class="n">tasks</span><span class="p">.</span><span class="n">empty</span><span class="p">();</span><span class="w"> </span><span class="p">});</span>
<a id="__codelineno-95-21" name="__codelineno-95-21" href="#__codelineno-95-21"></a><span class="w">        </span><span class="n">Task</span><span class="w"> </span><span class="n">task</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">tasks</span><span class="p">.</span><span class="n">front</span><span class="p">();</span>
<a id="__codelineno-95-22" name="__codelineno-95-22" href="#__codelineno-95-22"></a><span class="w">        </span><span class="n">tasks</span><span class="p">.</span><span class="n">pop</span><span class="p">();</span>
<a id="__codelineno-95-23" name="__codelineno-95-23" href="#__codelineno-95-23"></a><span class="w">        </span><span class="k">return</span><span class="w"> </span><span class="n">task</span><span class="p">;</span>
<a id="__codelineno-95-24" name="__codelineno-95-24" href="#__codelineno-95-24"></a><span class="w">    </span><span class="p">}</span>
<a id="__codelineno-95-25" name="__codelineno-95-25" href="#__codelineno-95-25"></a><span class="p">};</span>
</code></pre></div></p>
<h3 id="task-based-parallelism-with-stdasync-and-stdfuture">Task-based Parallelism with std::async and std::future</h3>
<p><code>std::async</code> and <code>std::future</code> provide a high-level way to run tasks asynchronously and retrieve their results.</p>
<p>Example:
<div class="highlight"><pre><span></span><code><a id="__codelineno-96-1" name="__codelineno-96-1" href="#__codelineno-96-1"></a><span class="cp">#include</span><span class="w"> </span><span class="cpf">&lt;future&gt;</span>
<a id="__codelineno-96-2" name="__codelineno-96-2" href="#__codelineno-96-2"></a>
<a id="__codelineno-96-3" name="__codelineno-96-3" href="#__codelineno-96-3"></a><span class="n">std</span><span class="o">::</span><span class="n">vector</span><span class="o">&lt;</span><span class="n">GameObject</span><span class="o">&gt;</span><span class="w"> </span><span class="n">loadGameObjects</span><span class="p">()</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-96-4" name="__codelineno-96-4" href="#__codelineno-96-4"></a><span class="w">    </span><span class="c1">// Expensive loading operation</span>
<a id="__codelineno-96-5" name="__codelineno-96-5" href="#__codelineno-96-5"></a><span class="p">}</span>
<a id="__codelineno-96-6" name="__codelineno-96-6" href="#__codelineno-96-6"></a>
<a id="__codelineno-96-7" name="__codelineno-96-7" href="#__codelineno-96-7"></a><span class="kt">void</span><span class="w"> </span><span class="n">initializeGame</span><span class="p">()</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-96-8" name="__codelineno-96-8" href="#__codelineno-96-8"></a><span class="w">    </span><span class="k">auto</span><span class="w"> </span><span class="n">futureObjects</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">std</span><span class="o">::</span><span class="n">async</span><span class="p">(</span><span class="n">std</span><span class="o">::</span><span class="n">launch</span><span class="o">::</span><span class="n">async</span><span class="p">,</span><span class="w"> </span><span class="n">loadGameObjects</span><span class="p">);</span>
<a id="__codelineno-96-9" name="__codelineno-96-9" href="#__codelineno-96-9"></a>
<a id="__codelineno-96-10" name="__codelineno-96-10" href="#__codelineno-96-10"></a><span class="w">    </span><span class="c1">// Do other initialization work</span>
<a id="__codelineno-96-11" name="__codelineno-96-11" href="#__codelineno-96-11"></a>
<a id="__codelineno-96-12" name="__codelineno-96-12" href="#__codelineno-96-12"></a><span class="w">    </span><span class="k">auto</span><span class="w"> </span><span class="n">gameObjects</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">futureObjects</span><span class="p">.</span><span class="n">get</span><span class="p">();</span><span class="w"> </span><span class="c1">// Wait for and retrieve the result</span>
<a id="__codelineno-96-13" name="__codelineno-96-13" href="#__codelineno-96-13"></a><span class="p">}</span>
</code></pre></div></p>
<h3 id="thread-local-storage">Thread-local Storage</h3>
<p>Thread-local storage allows each thread to have its own instance of a variable.</p>
<p>Example:
<div class="highlight"><pre><span></span><code><a id="__codelineno-97-1" name="__codelineno-97-1" href="#__codelineno-97-1"></a><span class="cp">#include</span><span class="w"> </span><span class="cpf">&lt;thread&gt;</span>
<a id="__codelineno-97-2" name="__codelineno-97-2" href="#__codelineno-97-2"></a>
<a id="__codelineno-97-3" name="__codelineno-97-3" href="#__codelineno-97-3"></a><span class="k">thread_local</span><span class="w"> </span><span class="kt">int</span><span class="w"> </span><span class="n">currentEntityId</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">-1</span><span class="p">;</span>
<a id="__codelineno-97-4" name="__codelineno-97-4" href="#__codelineno-97-4"></a>
<a id="__codelineno-97-5" name="__codelineno-97-5" href="#__codelineno-97-5"></a><span class="kt">void</span><span class="w"> </span><span class="nf">processEntity</span><span class="p">(</span><span class="kt">int</span><span class="w"> </span><span class="n">id</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-97-6" name="__codelineno-97-6" href="#__codelineno-97-6"></a><span class="w">    </span><span class="n">currentEntityId</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">id</span><span class="p">;</span>
<a id="__codelineno-97-7" name="__codelineno-97-7" href="#__codelineno-97-7"></a><span class="w">    </span><span class="c1">// Process entity</span>
<a id="__codelineno-97-8" name="__codelineno-97-8" href="#__codelineno-97-8"></a><span class="p">}</span>
<a id="__codelineno-97-9" name="__codelineno-97-9" href="#__codelineno-97-9"></a>
<a id="__codelineno-97-10" name="__codelineno-97-10" href="#__codelineno-97-10"></a><span class="kt">void</span><span class="w"> </span><span class="nf">workerThread</span><span class="p">(</span><span class="n">std</span><span class="o">::</span><span class="n">vector</span><span class="o">&lt;</span><span class="kt">int</span><span class="o">&gt;</span><span class="w"> </span><span class="n">entityIds</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-97-11" name="__codelineno-97-11" href="#__codelineno-97-11"></a><span class="w">    </span><span class="k">for</span><span class="w"> </span><span class="p">(</span><span class="kt">int</span><span class="w"> </span><span class="n">id</span><span class="w"> </span><span class="o">:</span><span class="w"> </span><span class="n">entityIds</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-97-12" name="__codelineno-97-12" href="#__codelineno-97-12"></a><span class="w">        </span><span class="n">processEntity</span><span class="p">(</span><span class="n">id</span><span class="p">);</span>
<a id="__codelineno-97-13" name="__codelineno-97-13" href="#__codelineno-97-13"></a><span class="w">        </span><span class="c1">// currentEntityId is unique for each thread</span>
<a id="__codelineno-97-14" name="__codelineno-97-14" href="#__codelineno-97-14"></a><span class="w">    </span><span class="p">}</span>
<a id="__codelineno-97-15" name="__codelineno-97-15" href="#__codelineno-97-15"></a><span class="p">}</span>
</code></pre></div></p>
<h3 id="best-practices-for-game-development">Best Practices for Game Development</h3>
<ol>
<li>
<p><strong>Job System</strong>: Implement a job system for fine-grained parallelism of game tasks.</p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-98-1" name="__codelineno-98-1" href="#__codelineno-98-1"></a><span class="k">class</span><span class="w"> </span><span class="nc">JobSystem</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-98-2" name="__codelineno-98-2" href="#__codelineno-98-2"></a><span class="k">public</span><span class="o">:</span>
<a id="__codelineno-98-3" name="__codelineno-98-3" href="#__codelineno-98-3"></a><span class="w">    </span><span class="k">template</span><span class="o">&lt;</span><span class="k">typename</span><span class="w"> </span><span class="nc">Func</span><span class="o">&gt;</span>
<a id="__codelineno-98-4" name="__codelineno-98-4" href="#__codelineno-98-4"></a><span class="w">    </span><span class="kt">void</span><span class="w"> </span><span class="n">addJob</span><span class="p">(</span><span class="n">Func</span><span class="o">&amp;&amp;</span><span class="w"> </span><span class="n">func</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-98-5" name="__codelineno-98-5" href="#__codelineno-98-5"></a><span class="w">        </span><span class="c1">// Add job to queue</span>
<a id="__codelineno-98-6" name="__codelineno-98-6" href="#__codelineno-98-6"></a><span class="w">    </span><span class="p">}</span>
<a id="__codelineno-98-7" name="__codelineno-98-7" href="#__codelineno-98-7"></a>
<a id="__codelineno-98-8" name="__codelineno-98-8" href="#__codelineno-98-8"></a><span class="w">    </span><span class="kt">void</span><span class="w"> </span><span class="n">executeJobs</span><span class="p">()</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-98-9" name="__codelineno-98-9" href="#__codelineno-98-9"></a><span class="w">        </span><span class="c1">// Execute jobs in parallel</span>
<a id="__codelineno-98-10" name="__codelineno-98-10" href="#__codelineno-98-10"></a><span class="w">    </span><span class="p">}</span>
<a id="__codelineno-98-11" name="__codelineno-98-11" href="#__codelineno-98-11"></a><span class="p">};</span>
<a id="__codelineno-98-12" name="__codelineno-98-12" href="#__codelineno-98-12"></a>
<a id="__codelineno-98-13" name="__codelineno-98-13" href="#__codelineno-98-13"></a><span class="n">JobSystem</span><span class="w"> </span><span class="n">jobSystem</span><span class="p">;</span>
<a id="__codelineno-98-14" name="__codelineno-98-14" href="#__codelineno-98-14"></a>
<a id="__codelineno-98-15" name="__codelineno-98-15" href="#__codelineno-98-15"></a><span class="n">jobSystem</span><span class="p">.</span><span class="n">addJob</span><span class="p">([]()</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="n">updatePhysics</span><span class="p">();</span><span class="w"> </span><span class="p">});</span>
<a id="__codelineno-98-16" name="__codelineno-98-16" href="#__codelineno-98-16"></a><span class="n">jobSystem</span><span class="p">.</span><span class="n">addJob</span><span class="p">([]()</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="n">updateAI</span><span class="p">();</span><span class="w"> </span><span class="p">});</span>
<a id="__codelineno-98-17" name="__codelineno-98-17" href="#__codelineno-98-17"></a><span class="n">jobSystem</span><span class="p">.</span><span class="n">addJob</span><span class="p">([]()</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="n">updateRendering</span><span class="p">();</span><span class="w"> </span><span class="p">});</span>
<a id="__codelineno-98-18" name="__codelineno-98-18" href="#__codelineno-98-18"></a>
<a id="__codelineno-98-19" name="__codelineno-98-19" href="#__codelineno-98-19"></a><span class="n">jobSystem</span><span class="p">.</span><span class="n">executeJobs</span><span class="p">();</span>
</code></pre></div>
</li>
<li>
<p><strong>Data-Oriented Design</strong>: Structure your data for efficient parallel processing.</p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-99-1" name="__codelineno-99-1" href="#__codelineno-99-1"></a><span class="k">struct</span><span class="w"> </span><span class="nc">GameObject</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-99-2" name="__codelineno-99-2" href="#__codelineno-99-2"></a><span class="w">    </span><span class="n">std</span><span class="o">::</span><span class="n">vector</span><span class="o">&lt;</span><span class="kt">float</span><span class="o">&gt;</span><span class="w"> </span><span class="n">positions</span><span class="p">;</span>
<a id="__codelineno-99-3" name="__codelineno-99-3" href="#__codelineno-99-3"></a><span class="w">    </span><span class="n">std</span><span class="o">::</span><span class="n">vector</span><span class="o">&lt;</span><span class="kt">float</span><span class="o">&gt;</span><span class="w"> </span><span class="n">velocities</span><span class="p">;</span>
<a id="__codelineno-99-4" name="__codelineno-99-4" href="#__codelineno-99-4"></a><span class="w">    </span><span class="c1">// Other components</span>
<a id="__codelineno-99-5" name="__codelineno-99-5" href="#__codelineno-99-5"></a><span class="p">};</span>
<a id="__codelineno-99-6" name="__codelineno-99-6" href="#__codelineno-99-6"></a>
<a id="__codelineno-99-7" name="__codelineno-99-7" href="#__codelineno-99-7"></a><span class="kt">void</span><span class="w"> </span><span class="nf">updatePositions</span><span class="p">(</span><span class="n">GameObject</span><span class="o">&amp;</span><span class="w"> </span><span class="n">objects</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-99-8" name="__codelineno-99-8" href="#__codelineno-99-8"></a><span class="w">    </span><span class="n">std</span><span class="o">::</span><span class="n">for_each</span><span class="p">(</span><span class="n">std</span><span class="o">::</span><span class="n">execution</span><span class="o">::</span><span class="n">par_unseq</span><span class="p">,</span><span class="w"> </span>
<a id="__codelineno-99-9" name="__codelineno-99-9" href="#__codelineno-99-9"></a><span class="w">                  </span><span class="n">objects</span><span class="p">.</span><span class="n">positions</span><span class="p">.</span><span class="n">begin</span><span class="p">(),</span><span class="w"> </span><span class="n">objects</span><span class="p">.</span><span class="n">positions</span><span class="p">.</span><span class="n">end</span><span class="p">(),</span>
<a id="__codelineno-99-10" name="__codelineno-99-10" href="#__codelineno-99-10"></a><span class="w">                  </span><span class="n">objects</span><span class="p">.</span><span class="n">velocities</span><span class="p">.</span><span class="n">begin</span><span class="p">(),</span>
<a id="__codelineno-99-11" name="__codelineno-99-11" href="#__codelineno-99-11"></a><span class="w">                  </span><span class="p">[](</span><span class="kt">float</span><span class="o">&amp;</span><span class="w"> </span><span class="n">pos</span><span class="p">,</span><span class="w"> </span><span class="kt">float</span><span class="w"> </span><span class="n">vel</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-99-12" name="__codelineno-99-12" href="#__codelineno-99-12"></a><span class="w">                      </span><span class="n">pos</span><span class="w"> </span><span class="o">+=</span><span class="w"> </span><span class="n">vel</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="n">deltaTime</span><span class="p">;</span>
<a id="__codelineno-99-13" name="__codelineno-99-13" href="#__codelineno-99-13"></a><span class="w">                  </span><span class="p">});</span>
<a id="__codelineno-99-14" name="__codelineno-99-14" href="#__codelineno-99-14"></a><span class="p">}</span>
</code></pre></div>
</li>
<li>
<p><strong>Lock-Free Algorithms</strong>: Use lock-free data structures for high-contention scenarios.</p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-100-1" name="__codelineno-100-1" href="#__codelineno-100-1"></a><span class="cp">#include</span><span class="w"> </span><span class="cpf">&lt;atomic&gt;</span>
<a id="__codelineno-100-2" name="__codelineno-100-2" href="#__codelineno-100-2"></a>
<a id="__codelineno-100-3" name="__codelineno-100-3" href="#__codelineno-100-3"></a><span class="k">template</span><span class="o">&lt;</span><span class="k">typename</span><span class="w"> </span><span class="nc">T</span><span class="p">,</span><span class="w"> </span><span class="kt">size_t</span><span class="w"> </span><span class="n">Size</span><span class="o">&gt;</span>
<a id="__codelineno-100-4" name="__codelineno-100-4" href="#__codelineno-100-4"></a><span class="k">class</span><span class="w"> </span><span class="nc">LockFreeQueue</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-100-5" name="__codelineno-100-5" href="#__codelineno-100-5"></a><span class="w">    </span><span class="n">std</span><span class="o">::</span><span class="n">array</span><span class="o">&lt;</span><span class="n">T</span><span class="p">,</span><span class="w"> </span><span class="n">Size</span><span class="o">&gt;</span><span class="w"> </span><span class="n">buffer</span><span class="p">;</span>
<a id="__codelineno-100-6" name="__codelineno-100-6" href="#__codelineno-100-6"></a><span class="w">    </span><span class="n">std</span><span class="o">::</span><span class="n">atomic</span><span class="o">&lt;</span><span class="kt">size_t</span><span class="o">&gt;</span><span class="w"> </span><span class="n">head</span><span class="p">{</span><span class="mi">0</span><span class="p">};</span>
<a id="__codelineno-100-7" name="__codelineno-100-7" href="#__codelineno-100-7"></a><span class="w">    </span><span class="n">std</span><span class="o">::</span><span class="n">atomic</span><span class="o">&lt;</span><span class="kt">size_t</span><span class="o">&gt;</span><span class="w"> </span><span class="n">tail</span><span class="p">{</span><span class="mi">0</span><span class="p">};</span>
<a id="__codelineno-100-8" name="__codelineno-100-8" href="#__codelineno-100-8"></a>
<a id="__codelineno-100-9" name="__codelineno-100-9" href="#__codelineno-100-9"></a><span class="k">public</span><span class="o">:</span>
<a id="__codelineno-100-10" name="__codelineno-100-10" href="#__codelineno-100-10"></a><span class="w">    </span><span class="kt">bool</span><span class="w"> </span><span class="n">push</span><span class="p">(</span><span class="k">const</span><span class="w"> </span><span class="n">T</span><span class="o">&amp;</span><span class="w"> </span><span class="n">value</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-100-11" name="__codelineno-100-11" href="#__codelineno-100-11"></a><span class="w">        </span><span class="kt">size_t</span><span class="w"> </span><span class="n">current_tail</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">tail</span><span class="p">.</span><span class="n">load</span><span class="p">(</span><span class="n">std</span><span class="o">::</span><span class="n">memory_order_relaxed</span><span class="p">);</span>
<a id="__codelineno-100-12" name="__codelineno-100-12" href="#__codelineno-100-12"></a><span class="w">        </span><span class="kt">size_t</span><span class="w"> </span><span class="n">next_tail</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">(</span><span class="n">current_tail</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="mi">1</span><span class="p">)</span><span class="w"> </span><span class="o">%</span><span class="w"> </span><span class="n">Size</span><span class="p">;</span>
<a id="__codelineno-100-13" name="__codelineno-100-13" href="#__codelineno-100-13"></a><span class="w">        </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">next_tail</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="n">head</span><span class="p">.</span><span class="n">load</span><span class="p">(</span><span class="n">std</span><span class="o">::</span><span class="n">memory_order_acquire</span><span class="p">))</span>
<a id="__codelineno-100-14" name="__codelineno-100-14" href="#__codelineno-100-14"></a><span class="w">            </span><span class="k">return</span><span class="w"> </span><span class="nb">false</span><span class="p">;</span><span class="w">  </span><span class="c1">// Queue is full</span>
<a id="__codelineno-100-15" name="__codelineno-100-15" href="#__codelineno-100-15"></a><span class="w">        </span><span class="n">buffer</span><span class="p">[</span><span class="n">current_tail</span><span class="p">]</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">value</span><span class="p">;</span>
<a id="__codelineno-100-16" name="__codelineno-100-16" href="#__codelineno-100-16"></a><span class="w">        </span><span class="n">tail</span><span class="p">.</span><span class="n">store</span><span class="p">(</span><span class="n">next_tail</span><span class="p">,</span><span class="w"> </span><span class="n">std</span><span class="o">::</span><span class="n">memory_order_release</span><span class="p">);</span>
<a id="__codelineno-100-17" name="__codelineno-100-17" href="#__codelineno-100-17"></a><span class="w">        </span><span class="k">return</span><span class="w"> </span><span class="nb">true</span><span class="p">;</span>
<a id="__codelineno-100-18" name="__codelineno-100-18" href="#__codelineno-100-18"></a><span class="w">    </span><span class="p">}</span>
<a id="__codelineno-100-19" name="__codelineno-100-19" href="#__codelineno-100-19"></a>
<a id="__codelineno-100-20" name="__codelineno-100-20" href="#__codelineno-100-20"></a><span class="w">    </span><span class="kt">bool</span><span class="w"> </span><span class="n">pop</span><span class="p">(</span><span class="n">T</span><span class="o">&amp;</span><span class="w"> </span><span class="n">result</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-100-21" name="__codelineno-100-21" href="#__codelineno-100-21"></a><span class="w">        </span><span class="kt">size_t</span><span class="w"> </span><span class="n">current_head</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">head</span><span class="p">.</span><span class="n">load</span><span class="p">(</span><span class="n">std</span><span class="o">::</span><span class="n">memory_order_relaxed</span><span class="p">);</span>
<a id="__codelineno-100-22" name="__codelineno-100-22" href="#__codelineno-100-22"></a><span class="w">        </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">current_head</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="n">tail</span><span class="p">.</span><span class="n">load</span><span class="p">(</span><span class="n">std</span><span class="o">::</span><span class="n">memory_order_acquire</span><span class="p">))</span>
<a id="__codelineno-100-23" name="__codelineno-100-23" href="#__codelineno-100-23"></a><span class="w">            </span><span class="k">return</span><span class="w"> </span><span class="nb">false</span><span class="p">;</span><span class="w">  </span><span class="c1">// Queue is empty</span>
<a id="__codelineno-100-24" name="__codelineno-100-24" href="#__codelineno-100-24"></a><span class="w">        </span><span class="n">result</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">buffer</span><span class="p">[</span><span class="n">current_head</span><span class="p">];</span>
<a id="__codelineno-100-25" name="__codelineno-100-25" href="#__codelineno-100-25"></a><span class="w">        </span><span class="n">head</span><span class="p">.</span><span class="n">store</span><span class="p">((</span><span class="n">current_head</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="mi">1</span><span class="p">)</span><span class="w"> </span><span class="o">%</span><span class="w"> </span><span class="n">Size</span><span class="p">,</span><span class="w"> </span><span class="n">std</span><span class="o">::</span><span class="n">memory_order_release</span><span class="p">);</span>
<a id="__codelineno-100-26" name="__codelineno-100-26" href="#__codelineno-100-26"></a><span class="w">        </span><span class="k">return</span><span class="w"> </span><span class="nb">true</span><span class="p">;</span>
<a id="__codelineno-100-27" name="__codelineno-100-27" href="#__codelineno-100-27"></a><span class="w">    </span><span class="p">}</span>
<a id="__codelineno-100-28" name="__codelineno-100-28" href="#__codelineno-100-28"></a><span class="p">};</span>
</code></pre></div>
</li>
<li>
<p><strong>Profiling and Optimization</strong>: Regularly profile your multithreaded code to identify bottlenecks and optimize accordingly.</p>
</li>
</ol>
<p>Remember, while concurrency can significantly improve performance, it also introduces complexity. Always consider the trade-offs between performance gains and code maintainability when implementing multithreaded solutions in your game engine.</p>
<h3 id="multithreading">Multithreading</h3>
<div class="highlight"><pre><span></span><code><a id="__codelineno-101-1" name="__codelineno-101-1" href="#__codelineno-101-1"></a><span class="cp">#include</span><span class="w"> </span><span class="cpf">&lt;iostream&gt;</span>
<a id="__codelineno-101-2" name="__codelineno-101-2" href="#__codelineno-101-2"></a><span class="cp">#include</span><span class="w"> </span><span class="cpf">&lt;thread&gt;</span>
<a id="__codelineno-101-3" name="__codelineno-101-3" href="#__codelineno-101-3"></a><span class="cp">#include</span><span class="w"> </span><span class="cpf">&lt;mutex&gt;</span>
<a id="__codelineno-101-4" name="__codelineno-101-4" href="#__codelineno-101-4"></a><span class="cp">#include</span><span class="w"> </span><span class="cpf">&lt;shared_mutex&gt;</span>
<a id="__codelineno-101-5" name="__codelineno-101-5" href="#__codelineno-101-5"></a><span class="cp">#include</span><span class="w"> </span><span class="cpf">&lt;condition_variable&gt;</span>
<a id="__codelineno-101-6" name="__codelineno-101-6" href="#__codelineno-101-6"></a><span class="cp">#include</span><span class="w"> </span><span class="cpf">&lt;future&gt;</span>
<a id="__codelineno-101-7" name="__codelineno-101-7" href="#__codelineno-101-7"></a><span class="cp">#include</span><span class="w"> </span><span class="cpf">&lt;atomic&gt;</span>
<a id="__codelineno-101-8" name="__codelineno-101-8" href="#__codelineno-101-8"></a><span class="cp">#include</span><span class="w"> </span><span class="cpf">&lt;vector&gt;</span>
<a id="__codelineno-101-9" name="__codelineno-101-9" href="#__codelineno-101-9"></a><span class="cp">#include</span><span class="w"> </span><span class="cpf">&lt;queue&gt;</span>
<a id="__codelineno-101-10" name="__codelineno-101-10" href="#__codelineno-101-10"></a><span class="cp">#include</span><span class="w"> </span><span class="cpf">&lt;chrono&gt;</span>
<a id="__codelineno-101-11" name="__codelineno-101-11" href="#__codelineno-101-11"></a><span class="cp">#include</span><span class="w"> </span><span class="cpf">&lt;random&gt;</span>
<a id="__codelineno-101-12" name="__codelineno-101-12" href="#__codelineno-101-12"></a><span class="cp">#include</span><span class="w"> </span><span class="cpf">&lt;functional&gt;</span>
<a id="__codelineno-101-13" name="__codelineno-101-13" href="#__codelineno-101-13"></a>
<a id="__codelineno-101-14" name="__codelineno-101-14" href="#__codelineno-101-14"></a><span class="k">namespace</span><span class="w"> </span><span class="nn">example</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-101-15" name="__codelineno-101-15" href="#__codelineno-101-15"></a><span class="k">namespace</span><span class="w"> </span><span class="nn">multithreading</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-101-16" name="__codelineno-101-16" href="#__codelineno-101-16"></a>
<a id="__codelineno-101-17" name="__codelineno-101-17" href="#__codelineno-101-17"></a><span class="c1">// Thread-safe queue implementation</span>
<a id="__codelineno-101-18" name="__codelineno-101-18" href="#__codelineno-101-18"></a><span class="k">template</span><span class="w"> </span><span class="o">&lt;</span><span class="k">typename</span><span class="w"> </span><span class="nc">T</span><span class="o">&gt;</span>
<a id="__codelineno-101-19" name="__codelineno-101-19" href="#__codelineno-101-19"></a><span class="k">class</span><span class="w"> </span><span class="nc">ThreadSafeQueue</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-101-20" name="__codelineno-101-20" href="#__codelineno-101-20"></a><span class="w"> </span><span class="k">public</span><span class="o">:</span>
<a id="__codelineno-101-21" name="__codelineno-101-21" href="#__codelineno-101-21"></a><span class="w">  </span><span class="kt">void</span><span class="w"> </span><span class="n">Push</span><span class="p">(</span><span class="n">T</span><span class="w"> </span><span class="n">value</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-101-22" name="__codelineno-101-22" href="#__codelineno-101-22"></a><span class="w">    </span><span class="n">std</span><span class="o">::</span><span class="n">lock_guard</span><span class="o">&lt;</span><span class="n">std</span><span class="o">::</span><span class="n">mutex</span><span class="o">&gt;</span><span class="w"> </span><span class="n">lock</span><span class="p">(</span><span class="n">mutex_</span><span class="p">);</span>
<a id="__codelineno-101-23" name="__codelineno-101-23" href="#__codelineno-101-23"></a><span class="w">    </span><span class="n">queue_</span><span class="p">.</span><span class="n">push</span><span class="p">(</span><span class="n">std</span><span class="o">::</span><span class="n">move</span><span class="p">(</span><span class="n">value</span><span class="p">));</span>
<a id="__codelineno-101-24" name="__codelineno-101-24" href="#__codelineno-101-24"></a><span class="w">    </span><span class="n">cv_</span><span class="p">.</span><span class="n">notify_one</span><span class="p">();</span>
<a id="__codelineno-101-25" name="__codelineno-101-25" href="#__codelineno-101-25"></a><span class="w">  </span><span class="p">}</span>
<a id="__codelineno-101-26" name="__codelineno-101-26" href="#__codelineno-101-26"></a>
<a id="__codelineno-101-27" name="__codelineno-101-27" href="#__codelineno-101-27"></a><span class="w">  </span><span class="kt">bool</span><span class="w"> </span><span class="n">TryPop</span><span class="p">(</span><span class="n">T</span><span class="o">&amp;</span><span class="w"> </span><span class="n">value</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-101-28" name="__codelineno-101-28" href="#__codelineno-101-28"></a><span class="w">    </span><span class="n">std</span><span class="o">::</span><span class="n">lock_guard</span><span class="o">&lt;</span><span class="n">std</span><span class="o">::</span><span class="n">mutex</span><span class="o">&gt;</span><span class="w"> </span><span class="n">lock</span><span class="p">(</span><span class="n">mutex_</span><span class="p">);</span>
<a id="__codelineno-101-29" name="__codelineno-101-29" href="#__codelineno-101-29"></a><span class="w">    </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">queue_</span><span class="p">.</span><span class="n">empty</span><span class="p">())</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-101-30" name="__codelineno-101-30" href="#__codelineno-101-30"></a><span class="w">      </span><span class="k">return</span><span class="w"> </span><span class="nb">false</span><span class="p">;</span>
<a id="__codelineno-101-31" name="__codelineno-101-31" href="#__codelineno-101-31"></a><span class="w">    </span><span class="p">}</span>
<a id="__codelineno-101-32" name="__codelineno-101-32" href="#__codelineno-101-32"></a><span class="w">    </span><span class="n">value</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">std</span><span class="o">::</span><span class="n">move</span><span class="p">(</span><span class="n">queue_</span><span class="p">.</span><span class="n">front</span><span class="p">());</span>
<a id="__codelineno-101-33" name="__codelineno-101-33" href="#__codelineno-101-33"></a><span class="w">    </span><span class="n">queue_</span><span class="p">.</span><span class="n">pop</span><span class="p">();</span>
<a id="__codelineno-101-34" name="__codelineno-101-34" href="#__codelineno-101-34"></a><span class="w">    </span><span class="k">return</span><span class="w"> </span><span class="nb">true</span><span class="p">;</span>
<a id="__codelineno-101-35" name="__codelineno-101-35" href="#__codelineno-101-35"></a><span class="w">  </span><span class="p">}</span>
<a id="__codelineno-101-36" name="__codelineno-101-36" href="#__codelineno-101-36"></a>
<a id="__codelineno-101-37" name="__codelineno-101-37" href="#__codelineno-101-37"></a><span class="w">  </span><span class="kt">void</span><span class="w"> </span><span class="n">WaitAndPop</span><span class="p">(</span><span class="n">T</span><span class="o">&amp;</span><span class="w"> </span><span class="n">value</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-101-38" name="__codelineno-101-38" href="#__codelineno-101-38"></a><span class="w">    </span><span class="n">std</span><span class="o">::</span><span class="n">unique_lock</span><span class="o">&lt;</span><span class="n">std</span><span class="o">::</span><span class="n">mutex</span><span class="o">&gt;</span><span class="w"> </span><span class="n">lock</span><span class="p">(</span><span class="n">mutex_</span><span class="p">);</span>
<a id="__codelineno-101-39" name="__codelineno-101-39" href="#__codelineno-101-39"></a><span class="w">    </span><span class="n">cv_</span><span class="p">.</span><span class="n">wait</span><span class="p">(</span><span class="n">lock</span><span class="p">,</span><span class="w"> </span><span class="p">[</span><span class="k">this</span><span class="p">]</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="k">return</span><span class="w"> </span><span class="o">!</span><span class="n">queue_</span><span class="p">.</span><span class="n">empty</span><span class="p">();</span><span class="w"> </span><span class="p">});</span>
<a id="__codelineno-101-40" name="__codelineno-101-40" href="#__codelineno-101-40"></a><span class="w">    </span><span class="n">value</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">std</span><span class="o">::</span><span class="n">move</span><span class="p">(</span><span class="n">queue_</span><span class="p">.</span><span class="n">front</span><span class="p">());</span>
<a id="__codelineno-101-41" name="__codelineno-101-41" href="#__codelineno-101-41"></a><span class="w">    </span><span class="n">queue_</span><span class="p">.</span><span class="n">pop</span><span class="p">();</span>
<a id="__codelineno-101-42" name="__codelineno-101-42" href="#__codelineno-101-42"></a><span class="w">  </span><span class="p">}</span>
<a id="__codelineno-101-43" name="__codelineno-101-43" href="#__codelineno-101-43"></a>
<a id="__codelineno-101-44" name="__codelineno-101-44" href="#__codelineno-101-44"></a><span class="w"> </span><span class="k">private</span><span class="o">:</span>
<a id="__codelineno-101-45" name="__codelineno-101-45" href="#__codelineno-101-45"></a><span class="w">  </span><span class="n">std</span><span class="o">::</span><span class="n">queue</span><span class="o">&lt;</span><span class="n">T</span><span class="o">&gt;</span><span class="w"> </span><span class="n">queue_</span><span class="p">;</span>
<a id="__codelineno-101-46" name="__codelineno-101-46" href="#__codelineno-101-46"></a><span class="w">  </span><span class="k">mutable</span><span class="w"> </span><span class="n">std</span><span class="o">::</span><span class="n">mutex</span><span class="w"> </span><span class="n">mutex_</span><span class="p">;</span>
<a id="__codelineno-101-47" name="__codelineno-101-47" href="#__codelineno-101-47"></a><span class="w">  </span><span class="n">std</span><span class="o">::</span><span class="n">condition_variable</span><span class="w"> </span><span class="n">cv_</span><span class="p">;</span>
<a id="__codelineno-101-48" name="__codelineno-101-48" href="#__codelineno-101-48"></a><span class="p">};</span>
<a id="__codelineno-101-49" name="__codelineno-101-49" href="#__codelineno-101-49"></a>
<a id="__codelineno-101-50" name="__codelineno-101-50" href="#__codelineno-101-50"></a><span class="c1">// Example of using std::atomic for lock-free operations</span>
<a id="__codelineno-101-51" name="__codelineno-101-51" href="#__codelineno-101-51"></a><span class="k">class</span><span class="w"> </span><span class="nc">AtomicCounter</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-101-52" name="__codelineno-101-52" href="#__codelineno-101-52"></a><span class="w"> </span><span class="k">public</span><span class="o">:</span>
<a id="__codelineno-101-53" name="__codelineno-101-53" href="#__codelineno-101-53"></a><span class="w">  </span><span class="kt">void</span><span class="w"> </span><span class="n">Increment</span><span class="p">()</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-101-54" name="__codelineno-101-54" href="#__codelineno-101-54"></a><span class="w">    </span><span class="n">count_</span><span class="p">.</span><span class="n">fetch_add</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span><span class="w"> </span><span class="n">std</span><span class="o">::</span><span class="n">memory_order_relaxed</span><span class="p">);</span>
<a id="__codelineno-101-55" name="__codelineno-101-55" href="#__codelineno-101-55"></a><span class="w">  </span><span class="p">}</span>
<a id="__codelineno-101-56" name="__codelineno-101-56" href="#__codelineno-101-56"></a>
<a id="__codelineno-101-57" name="__codelineno-101-57" href="#__codelineno-101-57"></a><span class="w">  </span><span class="kt">int</span><span class="w"> </span><span class="n">GetCount</span><span class="p">()</span><span class="w"> </span><span class="k">const</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-101-58" name="__codelineno-101-58" href="#__codelineno-101-58"></a><span class="w">    </span><span class="k">return</span><span class="w"> </span><span class="n">count_</span><span class="p">.</span><span class="n">load</span><span class="p">(</span><span class="n">std</span><span class="o">::</span><span class="n">memory_order_relaxed</span><span class="p">);</span>
<a id="__codelineno-101-59" name="__codelineno-101-59" href="#__codelineno-101-59"></a><span class="w">  </span><span class="p">}</span>
<a id="__codelineno-101-60" name="__codelineno-101-60" href="#__codelineno-101-60"></a>
<a id="__codelineno-101-61" name="__codelineno-101-61" href="#__codelineno-101-61"></a><span class="w"> </span><span class="k">private</span><span class="o">:</span>
<a id="__codelineno-101-62" name="__codelineno-101-62" href="#__codelineno-101-62"></a><span class="w">  </span><span class="n">std</span><span class="o">::</span><span class="n">atomic</span><span class="o">&lt;</span><span class="kt">int</span><span class="o">&gt;</span><span class="w"> </span><span class="n">count_</span><span class="p">{</span><span class="mi">0</span><span class="p">};</span>
<a id="__codelineno-101-63" name="__codelineno-101-63" href="#__codelineno-101-63"></a><span class="p">};</span>
<a id="__codelineno-101-64" name="__codelineno-101-64" href="#__codelineno-101-64"></a>
<a id="__codelineno-101-65" name="__codelineno-101-65" href="#__codelineno-101-65"></a><span class="c1">// Example of using std::shared_mutex for reader-writer lock</span>
<a id="__codelineno-101-66" name="__codelineno-101-66" href="#__codelineno-101-66"></a><span class="k">class</span><span class="w"> </span><span class="nc">ThreadSafeMap</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-101-67" name="__codelineno-101-67" href="#__codelineno-101-67"></a><span class="w"> </span><span class="k">public</span><span class="o">:</span>
<a id="__codelineno-101-68" name="__codelineno-101-68" href="#__codelineno-101-68"></a><span class="w">  </span><span class="kt">void</span><span class="w"> </span><span class="n">Insert</span><span class="p">(</span><span class="kt">int</span><span class="w"> </span><span class="n">key</span><span class="p">,</span><span class="w"> </span><span class="kt">int</span><span class="w"> </span><span class="n">value</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-101-69" name="__codelineno-101-69" href="#__codelineno-101-69"></a><span class="w">    </span><span class="n">std</span><span class="o">::</span><span class="n">unique_lock</span><span class="o">&lt;</span><span class="n">std</span><span class="o">::</span><span class="n">shared_mutex</span><span class="o">&gt;</span><span class="w"> </span><span class="n">lock</span><span class="p">(</span><span class="n">mutex_</span><span class="p">);</span>
<a id="__codelineno-101-70" name="__codelineno-101-70" href="#__codelineno-101-70"></a><span class="w">    </span><span class="n">map_</span><span class="p">[</span><span class="n">key</span><span class="p">]</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">value</span><span class="p">;</span>
<a id="__codelineno-101-71" name="__codelineno-101-71" href="#__codelineno-101-71"></a><span class="w">  </span><span class="p">}</span>
<a id="__codelineno-101-72" name="__codelineno-101-72" href="#__codelineno-101-72"></a>
<a id="__codelineno-101-73" name="__codelineno-101-73" href="#__codelineno-101-73"></a><span class="w">  </span><span class="kt">bool</span><span class="w"> </span><span class="n">Find</span><span class="p">(</span><span class="kt">int</span><span class="w"> </span><span class="n">key</span><span class="p">,</span><span class="w"> </span><span class="kt">int</span><span class="o">&amp;</span><span class="w"> </span><span class="n">value</span><span class="p">)</span><span class="w"> </span><span class="k">const</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-101-74" name="__codelineno-101-74" href="#__codelineno-101-74"></a><span class="w">    </span><span class="n">std</span><span class="o">::</span><span class="n">shared_lock</span><span class="o">&lt;</span><span class="n">std</span><span class="o">::</span><span class="n">shared_mutex</span><span class="o">&gt;</span><span class="w"> </span><span class="n">lock</span><span class="p">(</span><span class="n">mutex_</span><span class="p">);</span>
<a id="__codelineno-101-75" name="__codelineno-101-75" href="#__codelineno-101-75"></a><span class="w">    </span><span class="k">auto</span><span class="w"> </span><span class="n">it</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">map_</span><span class="p">.</span><span class="n">find</span><span class="p">(</span><span class="n">key</span><span class="p">);</span>
<a id="__codelineno-101-76" name="__codelineno-101-76" href="#__codelineno-101-76"></a><span class="w">    </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">it</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="n">map_</span><span class="p">.</span><span class="n">end</span><span class="p">())</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-101-77" name="__codelineno-101-77" href="#__codelineno-101-77"></a><span class="w">      </span><span class="k">return</span><span class="w"> </span><span class="nb">false</span><span class="p">;</span>
<a id="__codelineno-101-78" name="__codelineno-101-78" href="#__codelineno-101-78"></a><span class="w">    </span><span class="p">}</span>
<a id="__codelineno-101-79" name="__codelineno-101-79" href="#__codelineno-101-79"></a><span class="w">    </span><span class="n">value</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">it</span><span class="o">-&gt;</span><span class="n">second</span><span class="p">;</span>
<a id="__codelineno-101-80" name="__codelineno-101-80" href="#__codelineno-101-80"></a><span class="w">    </span><span class="k">return</span><span class="w"> </span><span class="nb">true</span><span class="p">;</span>
<a id="__codelineno-101-81" name="__codelineno-101-81" href="#__codelineno-101-81"></a><span class="w">  </span><span class="p">}</span>
<a id="__codelineno-101-82" name="__codelineno-101-82" href="#__codelineno-101-82"></a>
<a id="__codelineno-101-83" name="__codelineno-101-83" href="#__codelineno-101-83"></a><span class="w"> </span><span class="k">private</span><span class="o">:</span>
<a id="__codelineno-101-84" name="__codelineno-101-84" href="#__codelineno-101-84"></a><span class="w">  </span><span class="n">std</span><span class="o">::</span><span class="n">unordered_map</span><span class="o">&lt;</span><span class="kt">int</span><span class="p">,</span><span class="w"> </span><span class="kt">int</span><span class="o">&gt;</span><span class="w"> </span><span class="n">map_</span><span class="p">;</span>
<a id="__codelineno-101-85" name="__codelineno-101-85" href="#__codelineno-101-85"></a><span class="w">  </span><span class="k">mutable</span><span class="w"> </span><span class="n">std</span><span class="o">::</span><span class="n">shared_mutex</span><span class="w"> </span><span class="n">mutex_</span><span class="p">;</span>
<a id="__codelineno-101-86" name="__codelineno-101-86" href="#__codelineno-101-86"></a><span class="p">};</span>
<a id="__codelineno-101-87" name="__codelineno-101-87" href="#__codelineno-101-87"></a>
<a id="__codelineno-101-88" name="__codelineno-101-88" href="#__codelineno-101-88"></a><span class="c1">// Example of using std::future and std::promise</span>
<a id="__codelineno-101-89" name="__codelineno-101-89" href="#__codelineno-101-89"></a><span class="n">std</span><span class="o">::</span><span class="n">future</span><span class="o">&lt;</span><span class="kt">int</span><span class="o">&gt;</span><span class="w"> </span><span class="n">AsyncComputation</span><span class="p">(</span><span class="kt">int</span><span class="w"> </span><span class="n">input</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-101-90" name="__codelineno-101-90" href="#__codelineno-101-90"></a><span class="w">  </span><span class="k">return</span><span class="w"> </span><span class="n">std</span><span class="o">::</span><span class="n">async</span><span class="p">(</span><span class="n">std</span><span class="o">::</span><span class="n">launch</span><span class="o">::</span><span class="n">async</span><span class="p">,</span><span class="w"> </span><span class="p">[</span><span class="n">input</span><span class="p">]</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-101-91" name="__codelineno-101-91" href="#__codelineno-101-91"></a><span class="w">    </span><span class="n">std</span><span class="o">::</span><span class="n">this_thread</span><span class="o">::</span><span class="n">sleep_for</span><span class="p">(</span><span class="n">std</span><span class="o">::</span><span class="n">chrono</span><span class="o">::</span><span class="n">seconds</span><span class="p">(</span><span class="mi">1</span><span class="p">));</span>
<a id="__codelineno-101-92" name="__codelineno-101-92" href="#__codelineno-101-92"></a><span class="w">    </span><span class="k">return</span><span class="w"> </span><span class="n">input</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="mi">2</span><span class="p">;</span>
<a id="__codelineno-101-93" name="__codelineno-101-93" href="#__codelineno-101-93"></a><span class="w">  </span><span class="p">});</span>
<a id="__codelineno-101-94" name="__codelineno-101-94" href="#__codelineno-101-94"></a><span class="p">}</span>
<a id="__codelineno-101-95" name="__codelineno-101-95" href="#__codelineno-101-95"></a>
<a id="__codelineno-101-96" name="__codelineno-101-96" href="#__codelineno-101-96"></a><span class="c1">// Example of using memory fences</span>
<a id="__codelineno-101-97" name="__codelineno-101-97" href="#__codelineno-101-97"></a><span class="k">class</span><span class="w"> </span><span class="nc">FenceExample</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-101-98" name="__codelineno-101-98" href="#__codelineno-101-98"></a><span class="w"> </span><span class="k">public</span><span class="o">:</span>
<a id="__codelineno-101-99" name="__codelineno-101-99" href="#__codelineno-101-99"></a><span class="w">  </span><span class="kt">void</span><span class="w"> </span><span class="n">ProducerThread</span><span class="p">()</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-101-100" name="__codelineno-101-100" href="#__codelineno-101-100"></a><span class="w">    </span><span class="n">data_</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">42</span><span class="p">;</span>
<a id="__codelineno-101-101" name="__codelineno-101-101" href="#__codelineno-101-101"></a><span class="w">    </span><span class="n">std</span><span class="o">::</span><span class="n">atomic_thread_fence</span><span class="p">(</span><span class="n">std</span><span class="o">::</span><span class="n">memory_order_release</span><span class="p">);</span>
<a id="__codelineno-101-102" name="__codelineno-101-102" href="#__codelineno-101-102"></a><span class="w">    </span><span class="n">flag_</span><span class="p">.</span><span class="n">store</span><span class="p">(</span><span class="nb">true</span><span class="p">,</span><span class="w"> </span><span class="n">std</span><span class="o">::</span><span class="n">memory_order_relaxed</span><span class="p">);</span>
<a id="__codelineno-101-103" name="__codelineno-101-103" href="#__codelineno-101-103"></a><span class="w">  </span><span class="p">}</span>
<a id="__codelineno-101-104" name="__codelineno-101-104" href="#__codelineno-101-104"></a>
<a id="__codelineno-101-105" name="__codelineno-101-105" href="#__codelineno-101-105"></a><span class="w">  </span><span class="kt">void</span><span class="w"> </span><span class="n">ConsumerThread</span><span class="p">()</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-101-106" name="__codelineno-101-106" href="#__codelineno-101-106"></a><span class="w">    </span><span class="k">while</span><span class="w"> </span><span class="p">(</span><span class="o">!</span><span class="n">flag_</span><span class="p">.</span><span class="n">load</span><span class="p">(</span><span class="n">std</span><span class="o">::</span><span class="n">memory_order_relaxed</span><span class="p">))</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-101-107" name="__codelineno-101-107" href="#__codelineno-101-107"></a><span class="w">      </span><span class="n">std</span><span class="o">::</span><span class="n">this_thread</span><span class="o">::</span><span class="n">yield</span><span class="p">();</span>
<a id="__codelineno-101-108" name="__codelineno-101-108" href="#__codelineno-101-108"></a><span class="w">    </span><span class="p">}</span>
<a id="__codelineno-101-109" name="__codelineno-101-109" href="#__codelineno-101-109"></a><span class="w">    </span><span class="n">std</span><span class="o">::</span><span class="n">atomic_thread_fence</span><span class="p">(</span><span class="n">std</span><span class="o">::</span><span class="n">memory_order_acquire</span><span class="p">);</span>
<a id="__codelineno-101-110" name="__codelineno-101-110" href="#__codelineno-101-110"></a><span class="w">    </span><span class="n">std</span><span class="o">::</span><span class="n">cout</span><span class="w"> </span><span class="o">&lt;&lt;</span><span class="w"> </span><span class="s">&quot;Data: &quot;</span><span class="w"> </span><span class="o">&lt;&lt;</span><span class="w"> </span><span class="n">data_</span><span class="w"> </span><span class="o">&lt;&lt;</span><span class="w"> </span><span class="n">std</span><span class="o">::</span><span class="n">endl</span><span class="p">;</span>
<a id="__codelineno-101-111" name="__codelineno-101-111" href="#__codelineno-101-111"></a><span class="w">  </span><span class="p">}</span>
<a id="__codelineno-101-112" name="__codelineno-101-112" href="#__codelineno-101-112"></a>
<a id="__codelineno-101-113" name="__codelineno-101-113" href="#__codelineno-101-113"></a><span class="w"> </span><span class="k">private</span><span class="o">:</span>
<a id="__codelineno-101-114" name="__codelineno-101-114" href="#__codelineno-101-114"></a><span class="w">  </span><span class="kt">int</span><span class="w"> </span><span class="n">data_</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">0</span><span class="p">;</span>
<a id="__codelineno-101-115" name="__codelineno-101-115" href="#__codelineno-101-115"></a><span class="w">  </span><span class="n">std</span><span class="o">::</span><span class="n">atomic</span><span class="o">&lt;</span><span class="kt">bool</span><span class="o">&gt;</span><span class="w"> </span><span class="n">flag_</span><span class="p">{</span><span class="nb">false</span><span class="p">};</span>
<a id="__codelineno-101-116" name="__codelineno-101-116" href="#__codelineno-101-116"></a><span class="p">};</span>
<a id="__codelineno-101-117" name="__codelineno-101-117" href="#__codelineno-101-117"></a>
<a id="__codelineno-101-118" name="__codelineno-101-118" href="#__codelineno-101-118"></a><span class="c1">// Example of using std::lock and std::scoped_lock for deadlock prevention</span>
<a id="__codelineno-101-119" name="__codelineno-101-119" href="#__codelineno-101-119"></a><span class="k">class</span><span class="w"> </span><span class="nc">Account</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-101-120" name="__codelineno-101-120" href="#__codelineno-101-120"></a><span class="w"> </span><span class="k">public</span><span class="o">:</span>
<a id="__codelineno-101-121" name="__codelineno-101-121" href="#__codelineno-101-121"></a><span class="w">  </span><span class="n">Account</span><span class="p">(</span><span class="kt">int</span><span class="w"> </span><span class="n">balance</span><span class="p">)</span><span class="w"> </span><span class="o">:</span><span class="w"> </span><span class="n">balance_</span><span class="p">(</span><span class="n">balance</span><span class="p">)</span><span class="w"> </span><span class="p">{}</span>
<a id="__codelineno-101-122" name="__codelineno-101-122" href="#__codelineno-101-122"></a>
<a id="__codelineno-101-123" name="__codelineno-101-123" href="#__codelineno-101-123"></a><span class="w">  </span><span class="kt">void</span><span class="w"> </span><span class="n">Transfer</span><span class="p">(</span><span class="n">Account</span><span class="o">&amp;</span><span class="w"> </span><span class="n">to</span><span class="p">,</span><span class="w"> </span><span class="kt">int</span><span class="w"> </span><span class="n">amount</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-101-124" name="__codelineno-101-124" href="#__codelineno-101-124"></a><span class="w">    </span><span class="n">std</span><span class="o">::</span><span class="n">scoped_lock</span><span class="w"> </span><span class="nf">lock</span><span class="p">(</span><span class="n">mutex_</span><span class="p">,</span><span class="w"> </span><span class="n">to</span><span class="p">.</span><span class="n">mutex_</span><span class="p">);</span>
<a id="__codelineno-101-125" name="__codelineno-101-125" href="#__codelineno-101-125"></a><span class="w">    </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">balance_</span><span class="w"> </span><span class="o">&gt;=</span><span class="w"> </span><span class="n">amount</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-101-126" name="__codelineno-101-126" href="#__codelineno-101-126"></a><span class="w">      </span><span class="n">balance_</span><span class="w"> </span><span class="o">-=</span><span class="w"> </span><span class="n">amount</span><span class="p">;</span>
<a id="__codelineno-101-127" name="__codelineno-101-127" href="#__codelineno-101-127"></a><span class="w">      </span><span class="n">to</span><span class="p">.</span><span class="n">balance_</span><span class="w"> </span><span class="o">+=</span><span class="w"> </span><span class="n">amount</span><span class="p">;</span>
<a id="__codelineno-101-128" name="__codelineno-101-128" href="#__codelineno-101-128"></a><span class="w">    </span><span class="p">}</span>
<a id="__codelineno-101-129" name="__codelineno-101-129" href="#__codelineno-101-129"></a><span class="w">  </span><span class="p">}</span>
<a id="__codelineno-101-130" name="__codelineno-101-130" href="#__codelineno-101-130"></a>
<a id="__codelineno-101-131" name="__codelineno-101-131" href="#__codelineno-101-131"></a><span class="w"> </span><span class="k">private</span><span class="o">:</span>
<a id="__codelineno-101-132" name="__codelineno-101-132" href="#__codelineno-101-132"></a><span class="w">  </span><span class="kt">int</span><span class="w"> </span><span class="n">balance_</span><span class="p">;</span>
<a id="__codelineno-101-133" name="__codelineno-101-133" href="#__codelineno-101-133"></a><span class="w">  </span><span class="n">std</span><span class="o">::</span><span class="n">mutex</span><span class="w"> </span><span class="n">mutex_</span><span class="p">;</span>
<a id="__codelineno-101-134" name="__codelineno-101-134" href="#__codelineno-101-134"></a><span class="p">};</span>
<a id="__codelineno-101-135" name="__codelineno-101-135" href="#__codelineno-101-135"></a>
<a id="__codelineno-101-136" name="__codelineno-101-136" href="#__codelineno-101-136"></a><span class="c1">// Thread pool implementation</span>
<a id="__codelineno-101-137" name="__codelineno-101-137" href="#__codelineno-101-137"></a><span class="k">class</span><span class="w"> </span><span class="nc">ThreadPool</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-101-138" name="__codelineno-101-138" href="#__codelineno-101-138"></a><span class="w"> </span><span class="k">public</span><span class="o">:</span>
<a id="__codelineno-101-139" name="__codelineno-101-139" href="#__codelineno-101-139"></a><span class="w">  </span><span class="k">explicit</span><span class="w"> </span><span class="n">ThreadPool</span><span class="p">(</span><span class="kt">size_t</span><span class="w"> </span><span class="n">num_threads</span><span class="p">)</span>
<a id="__codelineno-101-140" name="__codelineno-101-140" href="#__codelineno-101-140"></a><span class="w">    </span><span class="o">:</span><span class="w"> </span><span class="n">stop_</span><span class="p">(</span><span class="nb">false</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-101-141" name="__codelineno-101-141" href="#__codelineno-101-141"></a><span class="w">    </span><span class="k">for</span><span class="w"> </span><span class="p">(</span><span class="kt">size_t</span><span class="w"> </span><span class="n">i</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">0</span><span class="p">;</span><span class="w"> </span><span class="n">i</span><span class="w"> </span><span class="o">&lt;</span><span class="w"> </span><span class="n">num_threads</span><span class="p">;</span><span class="w"> </span><span class="o">++</span><span class="n">i</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-101-142" name="__codelineno-101-142" href="#__codelineno-101-142"></a><span class="w">      </span><span class="n">workers_</span><span class="p">.</span><span class="n">emplace_back</span><span class="p">([</span><span class="k">this</span><span class="p">]</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-101-143" name="__codelineno-101-143" href="#__codelineno-101-143"></a><span class="w">        </span><span class="k">while</span><span class="w"> </span><span class="p">(</span><span class="nb">true</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-101-144" name="__codelineno-101-144" href="#__codelineno-101-144"></a><span class="w">          </span><span class="n">std</span><span class="o">::</span><span class="n">function</span><span class="o">&lt;</span><span class="kt">void</span><span class="p">()</span><span class="o">&gt;</span><span class="w"> </span><span class="n">task</span><span class="p">;</span>
<a id="__codelineno-101-145" name="__codelineno-101-145" href="#__codelineno-101-145"></a><span class="w">          </span><span class="p">{</span>
<a id="__codelineno-101-146" name="__codelineno-101-146" href="#__codelineno-101-146"></a><span class="w">            </span><span class="n">std</span><span class="o">::</span><span class="n">unique_lock</span><span class="o">&lt;</span><span class="n">std</span><span class="o">::</span><span class="n">mutex</span><span class="o">&gt;</span><span class="w"> </span><span class="n">lock</span><span class="p">(</span><span class="n">queue_mutex_</span><span class="p">);</span>
<a id="__codelineno-101-147" name="__codelineno-101-147" href="#__codelineno-101-147"></a><span class="w">            </span><span class="n">condition_</span><span class="p">.</span><span class="n">wait</span><span class="p">(</span><span class="n">lock</span><span class="p">,</span><span class="w"> </span><span class="p">[</span><span class="k">this</span><span class="p">]</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="k">return</span><span class="w"> </span><span class="n">stop_</span><span class="w"> </span><span class="o">||</span><span class="w"> </span><span class="o">!</span><span class="n">tasks_</span><span class="p">.</span><span class="n">empty</span><span class="p">();</span><span class="w"> </span><span class="p">});</span>
<a id="__codelineno-101-148" name="__codelineno-101-148" href="#__codelineno-101-148"></a><span class="w">            </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">stop_</span><span class="w"> </span><span class="o">&amp;&amp;</span><span class="w"> </span><span class="n">tasks_</span><span class="p">.</span><span class="n">empty</span><span class="p">())</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-101-149" name="__codelineno-101-149" href="#__codelineno-101-149"></a><span class="w">              </span><span class="k">return</span><span class="p">;</span>
<a id="__codelineno-101-150" name="__codelineno-101-150" href="#__codelineno-101-150"></a><span class="w">            </span><span class="p">}</span>
<a id="__codelineno-101-151" name="__codelineno-101-151" href="#__codelineno-101-151"></a><span class="w">            </span><span class="n">task</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">std</span><span class="o">::</span><span class="n">move</span><span class="p">(</span><span class="n">tasks_</span><span class="p">.</span><span class="n">front</span><span class="p">());</span>
<a id="__codelineno-101-152" name="__codelineno-101-152" href="#__codelineno-101-152"></a><span class="w">            </span><span class="n">tasks_</span><span class="p">.</span><span class="n">pop</span><span class="p">();</span>
<a id="__codelineno-101-153" name="__codelineno-101-153" href="#__codelineno-101-153"></a><span class="w">          </span><span class="p">}</span>
<a id="__codelineno-101-154" name="__codelineno-101-154" href="#__codelineno-101-154"></a><span class="w">          </span><span class="n">task</span><span class="p">();</span>
<a id="__codelineno-101-155" name="__codelineno-101-155" href="#__codelineno-101-155"></a><span class="w">        </span><span class="p">}</span>
<a id="__codelineno-101-156" name="__codelineno-101-156" href="#__codelineno-101-156"></a><span class="w">      </span><span class="p">});</span>
<a id="__codelineno-101-157" name="__codelineno-101-157" href="#__codelineno-101-157"></a><span class="w">    </span><span class="p">}</span>
<a id="__codelineno-101-158" name="__codelineno-101-158" href="#__codelineno-101-158"></a><span class="w">  </span><span class="p">}</span>
<a id="__codelineno-101-159" name="__codelineno-101-159" href="#__codelineno-101-159"></a>
<a id="__codelineno-101-160" name="__codelineno-101-160" href="#__codelineno-101-160"></a><span class="w">  </span><span class="k">template</span><span class="o">&lt;</span><span class="k">class</span><span class="w"> </span><span class="nc">F</span><span class="o">&gt;</span>
<a id="__codelineno-101-161" name="__codelineno-101-161" href="#__codelineno-101-161"></a><span class="w">  </span><span class="kt">void</span><span class="w"> </span><span class="n">Enqueue</span><span class="p">(</span><span class="n">F</span><span class="o">&amp;&amp;</span><span class="w"> </span><span class="n">f</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-101-162" name="__codelineno-101-162" href="#__codelineno-101-162"></a><span class="w">    </span><span class="p">{</span>
<a id="__codelineno-101-163" name="__codelineno-101-163" href="#__codelineno-101-163"></a><span class="w">      </span><span class="n">std</span><span class="o">::</span><span class="n">unique_lock</span><span class="o">&lt;</span><span class="n">std</span><span class="o">::</span><span class="n">mutex</span><span class="o">&gt;</span><span class="w"> </span><span class="n">lock</span><span class="p">(</span><span class="n">queue_mutex_</span><span class="p">);</span>
<a id="__codelineno-101-164" name="__codelineno-101-164" href="#__codelineno-101-164"></a><span class="w">      </span><span class="n">tasks_</span><span class="p">.</span><span class="n">emplace</span><span class="p">(</span><span class="n">std</span><span class="o">::</span><span class="n">forward</span><span class="o">&lt;</span><span class="n">F</span><span class="o">&gt;</span><span class="p">(</span><span class="n">f</span><span class="p">));</span>
<a id="__codelineno-101-165" name="__codelineno-101-165" href="#__codelineno-101-165"></a><span class="w">    </span><span class="p">}</span>
<a id="__codelineno-101-166" name="__codelineno-101-166" href="#__codelineno-101-166"></a><span class="w">    </span><span class="n">condition_</span><span class="p">.</span><span class="n">notify_one</span><span class="p">();</span>
<a id="__codelineno-101-167" name="__codelineno-101-167" href="#__codelineno-101-167"></a><span class="w">  </span><span class="p">}</span>
<a id="__codelineno-101-168" name="__codelineno-101-168" href="#__codelineno-101-168"></a>
<a id="__codelineno-101-169" name="__codelineno-101-169" href="#__codelineno-101-169"></a><span class="w">  </span><span class="o">~</span><span class="n">ThreadPool</span><span class="p">()</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-101-170" name="__codelineno-101-170" href="#__codelineno-101-170"></a><span class="w">    </span><span class="p">{</span>
<a id="__codelineno-101-171" name="__codelineno-101-171" href="#__codelineno-101-171"></a><span class="w">      </span><span class="n">std</span><span class="o">::</span><span class="n">unique_lock</span><span class="o">&lt;</span><span class="n">std</span><span class="o">::</span><span class="n">mutex</span><span class="o">&gt;</span><span class="w"> </span><span class="n">lock</span><span class="p">(</span><span class="n">queue_mutex_</span><span class="p">);</span>
<a id="__codelineno-101-172" name="__codelineno-101-172" href="#__codelineno-101-172"></a><span class="w">      </span><span class="n">stop_</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nb">true</span><span class="p">;</span>
<a id="__codelineno-101-173" name="__codelineno-101-173" href="#__codelineno-101-173"></a><span class="w">    </span><span class="p">}</span>
<a id="__codelineno-101-174" name="__codelineno-101-174" href="#__codelineno-101-174"></a><span class="w">    </span><span class="n">condition_</span><span class="p">.</span><span class="n">notify_all</span><span class="p">();</span>
<a id="__codelineno-101-175" name="__codelineno-101-175" href="#__codelineno-101-175"></a><span class="w">    </span><span class="k">for</span><span class="w"> </span><span class="p">(</span><span class="n">std</span><span class="o">::</span><span class="kr">thread</span><span class="o">&amp;</span><span class="w"> </span><span class="n">worker</span><span class="w"> </span><span class="o">:</span><span class="w"> </span><span class="n">workers_</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-101-176" name="__codelineno-101-176" href="#__codelineno-101-176"></a><span class="w">      </span><span class="n">worker</span><span class="p">.</span><span class="n">join</span><span class="p">();</span>
<a id="__codelineno-101-177" name="__codelineno-101-177" href="#__codelineno-101-177"></a><span class="w">    </span><span class="p">}</span>
<a id="__codelineno-101-178" name="__codelineno-101-178" href="#__codelineno-101-178"></a><span class="w">  </span><span class="p">}</span>
<a id="__codelineno-101-179" name="__codelineno-101-179" href="#__codelineno-101-179"></a>
<a id="__codelineno-101-180" name="__codelineno-101-180" href="#__codelineno-101-180"></a><span class="w"> </span><span class="k">private</span><span class="o">:</span>
<a id="__codelineno-101-181" name="__codelineno-101-181" href="#__codelineno-101-181"></a><span class="w">  </span><span class="n">std</span><span class="o">::</span><span class="n">vector</span><span class="o">&lt;</span><span class="n">std</span><span class="o">::</span><span class="kr">thread</span><span class="o">&gt;</span><span class="w"> </span><span class="n">workers_</span><span class="p">;</span>
<a id="__codelineno-101-182" name="__codelineno-101-182" href="#__codelineno-101-182"></a><span class="w">  </span><span class="n">std</span><span class="o">::</span><span class="n">queue</span><span class="o">&lt;</span><span class="n">std</span><span class="o">::</span><span class="n">function</span><span class="o">&lt;</span><span class="kt">void</span><span class="p">()</span><span class="o">&gt;&gt;</span><span class="w"> </span><span class="n">tasks_</span><span class="p">;</span>
<a id="__codelineno-101-183" name="__codelineno-101-183" href="#__codelineno-101-183"></a><span class="w">  </span><span class="n">std</span><span class="o">::</span><span class="n">mutex</span><span class="w"> </span><span class="n">queue_mutex_</span><span class="p">;</span>
<a id="__codelineno-101-184" name="__codelineno-101-184" href="#__codelineno-101-184"></a><span class="w">  </span><span class="n">std</span><span class="o">::</span><span class="n">condition_variable</span><span class="w"> </span><span class="n">condition_</span><span class="p">;</span>
<a id="__codelineno-101-185" name="__codelineno-101-185" href="#__codelineno-101-185"></a><span class="w">  </span><span class="kt">bool</span><span class="w"> </span><span class="n">stop_</span><span class="p">;</span>
<a id="__codelineno-101-186" name="__codelineno-101-186" href="#__codelineno-101-186"></a><span class="p">};</span>
<a id="__codelineno-101-187" name="__codelineno-101-187" href="#__codelineno-101-187"></a>
<a id="__codelineno-101-188" name="__codelineno-101-188" href="#__codelineno-101-188"></a><span class="c1">// Example usage of the multithreading components</span>
<a id="__codelineno-101-189" name="__codelineno-101-189" href="#__codelineno-101-189"></a><span class="kt">void</span><span class="w"> </span><span class="nf">RunMultithreadingExample</span><span class="p">()</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-101-190" name="__codelineno-101-190" href="#__codelineno-101-190"></a><span class="w">  </span><span class="c1">// Thread-safe queue example</span>
<a id="__codelineno-101-191" name="__codelineno-101-191" href="#__codelineno-101-191"></a><span class="w">  </span><span class="n">ThreadSafeQueue</span><span class="o">&lt;</span><span class="kt">int</span><span class="o">&gt;</span><span class="w"> </span><span class="n">queue</span><span class="p">;</span>
<a id="__codelineno-101-192" name="__codelineno-101-192" href="#__codelineno-101-192"></a><span class="w">  </span><span class="n">std</span><span class="o">::</span><span class="kr">thread</span><span class="w"> </span><span class="n">producer</span><span class="p">([</span><span class="o">&amp;</span><span class="n">queue</span><span class="p">]</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-101-193" name="__codelineno-101-193" href="#__codelineno-101-193"></a><span class="w">    </span><span class="k">for</span><span class="w"> </span><span class="p">(</span><span class="kt">int</span><span class="w"> </span><span class="n">i</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">0</span><span class="p">;</span><span class="w"> </span><span class="n">i</span><span class="w"> </span><span class="o">&lt;</span><span class="w"> </span><span class="mi">10</span><span class="p">;</span><span class="w"> </span><span class="o">++</span><span class="n">i</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-101-194" name="__codelineno-101-194" href="#__codelineno-101-194"></a><span class="w">      </span><span class="n">queue</span><span class="p">.</span><span class="n">Push</span><span class="p">(</span><span class="n">i</span><span class="p">);</span>
<a id="__codelineno-101-195" name="__codelineno-101-195" href="#__codelineno-101-195"></a><span class="w">      </span><span class="n">std</span><span class="o">::</span><span class="n">this_thread</span><span class="o">::</span><span class="n">sleep_for</span><span class="p">(</span><span class="n">std</span><span class="o">::</span><span class="n">chrono</span><span class="o">::</span><span class="n">milliseconds</span><span class="p">(</span><span class="mi">100</span><span class="p">));</span>
<a id="__codelineno-101-196" name="__codelineno-101-196" href="#__codelineno-101-196"></a><span class="w">    </span><span class="p">}</span>
<a id="__codelineno-101-197" name="__codelineno-101-197" href="#__codelineno-101-197"></a><span class="w">  </span><span class="p">});</span>
<a id="__codelineno-101-198" name="__codelineno-101-198" href="#__codelineno-101-198"></a>
<a id="__codelineno-101-199" name="__codelineno-101-199" href="#__codelineno-101-199"></a><span class="w">  </span><span class="n">std</span><span class="o">::</span><span class="kr">thread</span><span class="w"> </span><span class="n">consumer</span><span class="p">([</span><span class="o">&amp;</span><span class="n">queue</span><span class="p">]</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-101-200" name="__codelineno-101-200" href="#__codelineno-101-200"></a><span class="w">    </span><span class="k">for</span><span class="w"> </span><span class="p">(</span><span class="kt">int</span><span class="w"> </span><span class="n">i</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">0</span><span class="p">;</span><span class="w"> </span><span class="n">i</span><span class="w"> </span><span class="o">&lt;</span><span class="w"> </span><span class="mi">10</span><span class="p">;</span><span class="w"> </span><span class="o">++</span><span class="n">i</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-101-201" name="__codelineno-101-201" href="#__codelineno-101-201"></a><span class="w">      </span><span class="kt">int</span><span class="w"> </span><span class="n">value</span><span class="p">;</span>
<a id="__codelineno-101-202" name="__codelineno-101-202" href="#__codelineno-101-202"></a><span class="w">      </span><span class="n">queue</span><span class="p">.</span><span class="n">WaitAndPop</span><span class="p">(</span><span class="n">value</span><span class="p">);</span>
<a id="__codelineno-101-203" name="__codelineno-101-203" href="#__codelineno-101-203"></a><span class="w">      </span><span class="n">std</span><span class="o">::</span><span class="n">cout</span><span class="w"> </span><span class="o">&lt;&lt;</span><span class="w"> </span><span class="s">&quot;Consumed: &quot;</span><span class="w"> </span><span class="o">&lt;&lt;</span><span class="w"> </span><span class="n">value</span><span class="w"> </span><span class="o">&lt;&lt;</span><span class="w"> </span><span class="n">std</span><span class="o">::</span><span class="n">endl</span><span class="p">;</span>
<a id="__codelineno-101-204" name="__codelineno-101-204" href="#__codelineno-101-204"></a><span class="w">    </span><span class="p">}</span>
<a id="__codelineno-101-205" name="__codelineno-101-205" href="#__codelineno-101-205"></a><span class="w">  </span><span class="p">});</span>
<a id="__codelineno-101-206" name="__codelineno-101-206" href="#__codelineno-101-206"></a>
<a id="__codelineno-101-207" name="__codelineno-101-207" href="#__codelineno-101-207"></a><span class="w">  </span><span class="n">producer</span><span class="p">.</span><span class="n">join</span><span class="p">();</span>
<a id="__codelineno-101-208" name="__codelineno-101-208" href="#__codelineno-101-208"></a><span class="w">  </span><span class="n">consumer</span><span class="p">.</span><span class="n">join</span><span class="p">();</span>
<a id="__codelineno-101-209" name="__codelineno-101-209" href="#__codelineno-101-209"></a>
<a id="__codelineno-101-210" name="__codelineno-101-210" href="#__codelineno-101-210"></a><span class="w">  </span><span class="c1">// Atomic counter example</span>
<a id="__codelineno-101-211" name="__codelineno-101-211" href="#__codelineno-101-211"></a><span class="w">  </span><span class="n">AtomicCounter</span><span class="w"> </span><span class="n">counter</span><span class="p">;</span>
<a id="__codelineno-101-212" name="__codelineno-101-212" href="#__codelineno-101-212"></a><span class="w">  </span><span class="n">std</span><span class="o">::</span><span class="n">vector</span><span class="o">&lt;</span><span class="n">std</span><span class="o">::</span><span class="kr">thread</span><span class="o">&gt;</span><span class="w"> </span><span class="n">threads</span><span class="p">;</span>
<a id="__codelineno-101-213" name="__codelineno-101-213" href="#__codelineno-101-213"></a><span class="w">  </span><span class="k">for</span><span class="w"> </span><span class="p">(</span><span class="kt">int</span><span class="w"> </span><span class="n">i</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">0</span><span class="p">;</span><span class="w"> </span><span class="n">i</span><span class="w"> </span><span class="o">&lt;</span><span class="w"> </span><span class="mi">10</span><span class="p">;</span><span class="w"> </span><span class="o">++</span><span class="n">i</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-101-214" name="__codelineno-101-214" href="#__codelineno-101-214"></a><span class="w">    </span><span class="n">threads</span><span class="p">.</span><span class="n">emplace_back</span><span class="p">([</span><span class="o">&amp;</span><span class="n">counter</span><span class="p">]</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-101-215" name="__codelineno-101-215" href="#__codelineno-101-215"></a><span class="w">      </span><span class="k">for</span><span class="w"> </span><span class="p">(</span><span class="kt">int</span><span class="w"> </span><span class="n">j</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">0</span><span class="p">;</span><span class="w"> </span><span class="n">j</span><span class="w"> </span><span class="o">&lt;</span><span class="w"> </span><span class="mi">1000</span><span class="p">;</span><span class="w"> </span><span class="o">++</span><span class="n">j</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-101-216" name="__codelineno-101-216" href="#__codelineno-101-216"></a><span class="w">        </span><span class="n">counter</span><span class="p">.</span><span class="n">Increment</span><span class="p">();</span>
<a id="__codelineno-101-217" name="__codelineno-101-217" href="#__codelineno-101-217"></a><span class="w">      </span><span class="p">}</span>
<a id="__codelineno-101-218" name="__codelineno-101-218" href="#__codelineno-101-218"></a><span class="w">    </span><span class="p">});</span>
<a id="__codelineno-101-219" name="__codelineno-101-219" href="#__codelineno-101-219"></a><span class="w">  </span><span class="p">}</span>
<a id="__codelineno-101-220" name="__codelineno-101-220" href="#__codelineno-101-220"></a><span class="w">  </span><span class="k">for</span><span class="w"> </span><span class="p">(</span><span class="k">auto</span><span class="o">&amp;</span><span class="w"> </span><span class="n">t</span><span class="w"> </span><span class="o">:</span><span class="w"> </span><span class="n">threads</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-101-221" name="__codelineno-101-221" href="#__codelineno-101-221"></a><span class="w">    </span><span class="n">t</span><span class="p">.</span><span class="n">join</span><span class="p">();</span>
<a id="__codelineno-101-222" name="__codelineno-101-222" href="#__codelineno-101-222"></a><span class="w">  </span><span class="p">}</span>
<a id="__codelineno-101-223" name="__codelineno-101-223" href="#__codelineno-101-223"></a><span class="w">  </span><span class="n">std</span><span class="o">::</span><span class="n">cout</span><span class="w"> </span><span class="o">&lt;&lt;</span><span class="w"> </span><span class="s">&quot;Final count: &quot;</span><span class="w"> </span><span class="o">&lt;&lt;</span><span class="w"> </span><span class="n">counter</span><span class="p">.</span><span class="n">GetCount</span><span class="p">()</span><span class="w"> </span><span class="o">&lt;&lt;</span><span class="w"> </span><span class="n">std</span><span class="o">::</span><span class="n">endl</span><span class="p">;</span>
<a id="__codelineno-101-224" name="__codelineno-101-224" href="#__codelineno-101-224"></a>
<a id="__codelineno-101-225" name="__codelineno-101-225" href="#__codelineno-101-225"></a><span class="w">  </span><span class="c1">// Future example</span>
<a id="__codelineno-101-226" name="__codelineno-101-226" href="#__codelineno-101-226"></a><span class="w">  </span><span class="k">auto</span><span class="w"> </span><span class="n">future</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">AsyncComputation</span><span class="p">(</span><span class="mi">21</span><span class="p">);</span>
<a id="__codelineno-101-227" name="__codelineno-101-227" href="#__codelineno-101-227"></a><span class="w">  </span><span class="n">std</span><span class="o">::</span><span class="n">cout</span><span class="w"> </span><span class="o">&lt;&lt;</span><span class="w"> </span><span class="s">&quot;Async result: &quot;</span><span class="w"> </span><span class="o">&lt;&lt;</span><span class="w"> </span><span class="n">future</span><span class="p">.</span><span class="n">get</span><span class="p">()</span><span class="w"> </span><span class="o">&lt;&lt;</span><span class="w"> </span><span class="n">std</span><span class="o">::</span><span class="n">endl</span><span class="p">;</span>
<a id="__codelineno-101-228" name="__codelineno-101-228" href="#__codelineno-101-228"></a>
<a id="__codelineno-101-229" name="__codelineno-101-229" href="#__codelineno-101-229"></a><span class="w">  </span><span class="c1">// Fence example</span>
<a id="__codelineno-101-230" name="__codelineno-101-230" href="#__codelineno-101-230"></a><span class="w">  </span><span class="n">FenceExample</span><span class="w"> </span><span class="n">fence</span><span class="p">;</span>
<a id="__codelineno-101-231" name="__codelineno-101-231" href="#__codelineno-101-231"></a><span class="w">  </span><span class="n">std</span><span class="o">::</span><span class="kr">thread</span><span class="w"> </span><span class="n">fence_producer</span><span class="p">(</span><span class="o">&amp;</span><span class="n">FenceExample</span><span class="o">::</span><span class="n">ProducerThread</span><span class="p">,</span><span class="w"> </span><span class="o">&amp;</span><span class="n">fence</span><span class="p">);</span>
<a id="__codelineno-101-232" name="__codelineno-101-232" href="#__codelineno-101-232"></a><span class="w">  </span><span class="n">std</span><span class="o">::</span><span class="kr">thread</span><span class="w"> </span><span class="n">fence_consumer</span><span class="p">(</span><span class="o">&amp;</span><span class="n">FenceExample</span><span class="o">::</span><span class="n">ConsumerThread</span><span class="p">,</span><span class="w"> </span><span class="o">&amp;</span><span class="n">fence</span><span class="p">);</span>
<a id="__codelineno-101-233" name="__codelineno-101-233" href="#__codelineno-101-233"></a><span class="w">  </span><span class="n">fence_producer</span><span class="p">.</span><span class="n">join</span><span class="p">();</span>
<a id="__codelineno-101-234" name="__codelineno-101-234" href="#__codelineno-101-234"></a><span class="w">  </span><span class="n">fence_consumer</span><span class="p">.</span><span class="n">join</span><span class="p">();</span>
<a id="__codelineno-101-235" name="__codelineno-101-235" href="#__codelineno-101-235"></a>
<a id="__codelineno-101-236" name="__codelineno-101-236" href="#__codelineno-101-236"></a><span class="w">  </span><span class="c1">// Deadlock prevention example</span>
<a id="__codelineno-101-237" name="__codelineno-101-237" href="#__codelineno-101-237"></a><span class="w">  </span><span class="n">Account</span><span class="w"> </span><span class="n">account1</span><span class="p">(</span><span class="mi">1000</span><span class="p">);</span>
<a id="__codelineno-101-238" name="__codelineno-101-238" href="#__codelineno-101-238"></a><span class="w">  </span><span class="n">Account</span><span class="w"> </span><span class="n">account2</span><span class="p">(</span><span class="mi">1000</span><span class="p">);</span>
<a id="__codelineno-101-239" name="__codelineno-101-239" href="#__codelineno-101-239"></a><span class="w">  </span><span class="n">std</span><span class="o">::</span><span class="kr">thread</span><span class="w"> </span><span class="n">t1</span><span class="p">([</span><span class="o">&amp;</span><span class="p">]</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="n">account1</span><span class="p">.</span><span class="n">Transfer</span><span class="p">(</span><span class="n">account2</span><span class="p">,</span><span class="w"> </span><span class="mi">500</span><span class="p">);</span><span class="w"> </span><span class="p">});</span>
<a id="__codelineno-101-240" name="__codelineno-101-240" href="#__codelineno-101-240"></a><span class="w">  </span><span class="n">std</span><span class="o">::</span><span class="kr">thread</span><span class="w"> </span><span class="n">t2</span><span class="p">([</span><span class="o">&amp;</span><span class="p">]</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="n">account2</span><span class="p">.</span><span class="n">Transfer</span><span class="p">(</span><span class="n">account1</span><span class="p">,</span><span class="w"> </span><span class="mi">300</span><span class="p">);</span><span class="w"> </span><span class="p">});</span>
<a id="__codelineno-101-241" name="__codelineno-101-241" href="#__codelineno-101-241"></a><span class="w">  </span><span class="n">t1</span><span class="p">.</span><span class="n">join</span><span class="p">();</span>
<a id="__codelineno-101-242" name="__codelineno-101-242" href="#__codelineno-101-242"></a><span class="w">  </span><span class="n">t2</span><span class="p">.</span><span class="n">join</span><span class="p">();</span>
<a id="__codelineno-101-243" name="__codelineno-101-243" href="#__codelineno-101-243"></a>
<a id="__codelineno-101-244" name="__codelineno-101-244" href="#__codelineno-101-244"></a><span class="w">  </span><span class="c1">// Thread pool example</span>
<a id="__codelineno-101-245" name="__codelineno-101-245" href="#__codelineno-101-245"></a><span class="w">  </span><span class="n">ThreadPool</span><span class="w"> </span><span class="n">pool</span><span class="p">(</span><span class="mi">4</span><span class="p">);</span>
<a id="__codelineno-101-246" name="__codelineno-101-246" href="#__codelineno-101-246"></a><span class="w">  </span><span class="n">std</span><span class="o">::</span><span class="n">vector</span><span class="o">&lt;</span><span class="n">std</span><span class="o">::</span><span class="n">future</span><span class="o">&lt;</span><span class="kt">int</span><span class="o">&gt;&gt;</span><span class="w"> </span><span class="n">results</span><span class="p">;</span>
<a id="__codelineno-101-247" name="__codelineno-101-247" href="#__codelineno-101-247"></a>
<a id="__codelineno-101-248" name="__codelineno-101-248" href="#__codelineno-101-248"></a><span class="w">  </span><span class="k">for</span><span class="w"> </span><span class="p">(</span><span class="kt">int</span><span class="w"> </span><span class="n">i</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">0</span><span class="p">;</span><span class="w"> </span><span class="n">i</span><span class="w"> </span><span class="o">&lt;</span><span class="w"> </span><span class="mi">8</span><span class="p">;</span><span class="w"> </span><span class="o">++</span><span class="n">i</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-101-249" name="__codelineno-101-249" href="#__codelineno-101-249"></a><span class="w">    </span><span class="n">results</span><span class="p">.</span><span class="n">emplace_back</span><span class="p">(</span>
<a id="__codelineno-101-250" name="__codelineno-101-250" href="#__codelineno-101-250"></a><span class="w">      </span><span class="n">pool</span><span class="p">.</span><span class="n">Enqueue</span><span class="p">([</span><span class="n">i</span><span class="p">]</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-101-251" name="__codelineno-101-251" href="#__codelineno-101-251"></a><span class="w">        </span><span class="n">std</span><span class="o">::</span><span class="n">this_thread</span><span class="o">::</span><span class="n">sleep_for</span><span class="p">(</span><span class="n">std</span><span class="o">::</span><span class="n">chrono</span><span class="o">::</span><span class="n">seconds</span><span class="p">(</span><span class="mi">1</span><span class="p">));</span>
<a id="__codelineno-101-252" name="__codelineno-101-252" href="#__codelineno-101-252"></a><span class="w">        </span><span class="k">return</span><span class="w"> </span><span class="n">i</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="n">i</span><span class="p">;</span>
<a id="__codelineno-101-253" name="__codelineno-101-253" href="#__codelineno-101-253"></a><span class="w">      </span><span class="p">})</span>
<a id="__codelineno-101-254" name="__codelineno-101-254" href="#__codelineno-101-254"></a><span class="w">    </span><span class="p">);</span>
<a id="__codelineno-101-255" name="__codelineno-101-255" href="#__codelineno-101-255"></a><span class="w">  </span><span class="p">}</span>
<a id="__codelineno-101-256" name="__codelineno-101-256" href="#__codelineno-101-256"></a>
<a id="__codelineno-101-257" name="__codelineno-101-257" href="#__codelineno-101-257"></a><span class="w">  </span><span class="k">for</span><span class="w"> </span><span class="p">(</span><span class="k">auto</span><span class="o">&amp;&amp;</span><span class="w"> </span><span class="n">result</span><span class="w"> </span><span class="o">:</span><span class="w"> </span><span class="n">results</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-101-258" name="__codelineno-101-258" href="#__codelineno-101-258"></a><span class="w">    </span><span class="n">std</span><span class="o">::</span><span class="n">cout</span><span class="w"> </span><span class="o">&lt;&lt;</span><span class="w"> </span><span class="s">&quot;Thread pool result: &quot;</span><span class="w"> </span><span class="o">&lt;&lt;</span><span class="w"> </span><span class="n">result</span><span class="p">.</span><span class="n">get</span><span class="p">()</span><span class="w"> </span><span class="o">&lt;&lt;</span><span class="w"> </span><span class="n">std</span><span class="o">::</span><span class="n">endl</span><span class="p">;</span>
<a id="__codelineno-101-259" name="__codelineno-101-259" href="#__codelineno-101-259"></a><span class="w">  </span><span class="p">}</span>
<a id="__codelineno-101-260" name="__codelineno-101-260" href="#__codelineno-101-260"></a><span class="p">}</span>
<a id="__codelineno-101-261" name="__codelineno-101-261" href="#__codelineno-101-261"></a>
<a id="__codelineno-101-262" name="__codelineno-101-262" href="#__codelineno-101-262"></a><span class="p">}</span><span class="w">  </span><span class="c1">// namespace multithreading</span>
<a id="__codelineno-101-263" name="__codelineno-101-263" href="#__codelineno-101-263"></a><span class="p">}</span><span class="w">  </span><span class="c1">// namespace example</span>
<a id="__codelineno-101-264" name="__codelineno-101-264" href="#__codelineno-101-264"></a>
<a id="__codelineno-101-265" name="__codelineno-101-265" href="#__codelineno-101-265"></a><span class="kt">int</span><span class="w"> </span><span class="n">main</span><span class="p">()</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-101-266" name="__codelineno-101-266" href="#__codelineno-101-266"></a><span class="w">  </span><span class="n">example</span><span class="o">::</span><span class="n">multithreading</span><span class="o">::</span><span class="n">RunMultithreadingExample</span><span class="p">();</span>
<a id="__codelineno-101-267" name="__codelineno-101-267" href="#__codelineno-101-267"></a><span class="w">  </span><span class="k">return</span><span class="w"> </span><span class="mi">0</span><span class="p">;</span>
<a id="__codelineno-101-268" name="__codelineno-101-268" href="#__codelineno-101-268"></a><span class="p">}</span>
</code></pre></div>
<p>This implementation covers various aspects of multithreading in C++:</p>
<ol>
<li>
<p>Thread-safe Queue: Implements a queue that can be safely accessed from multiple threads using mutex and condition variable.</p>
</li>
<li>
<p>Atomic Counter: Uses std::atomic for lock-free increment operations.</p>
</li>
<li>
<p>Thread-safe Map: Demonstrates the use of std::shared_mutex for implementing a reader-writer lock.</p>
</li>
<li>
<p>Asynchronous Computation: Shows how to use std::future and std::async for asynchronous operations.</p>
</li>
<li>
<p>Memory Fences: Illustrates the use of atomic fences to enforce ordering of memory operations.</p>
</li>
<li>
<p>Deadlock Prevention: Demonstrates the use of std::scoped_lock for acquiring multiple mutexes without risking deadlock.</p>
</li>
<li>
<p>Thread Pool: Implements a simple thread pool for managing a group of worker threads.</p>
</li>
</ol>
<p>Key points and best practices demonstrated:</p>
<ul>
<li>Use of appropriate synchronization primitives (mutex, shared_mutex, condition_variable) for different scenarios.</li>
<li>Proper use of RAII (Resource Acquisition Is Initialization) with std::lock_guard and std::unique_lock.</li>
<li>Use of std::atomic for lock-free operations where appropriate.</li>
<li>Demonstrating the concept of memory ordering with atomic operations and fences.</li>
<li>Implementing a thread-safe data structure (ThreadSafeQueue).</li>
<li>Using std::future and std::promise for asynchronous computations.</li>
<li>Proper exception handling and resource management in multithreaded contexts.</li>
<li>Use of modern C++ features like lambda functions, std::function, and variadic templates.</li>
</ul>
<p>This code provides a comprehensive overview of multithreading concepts in C++. In real-world applications, these techniques would be used to improve performance, responsiveness, and resource utilization in complex systems.</p>
<h4 id="key-concepts">Key Concepts</h4>
<ol>
<li>
<p>Thread-safe Queue:
A thread-safe queue is essential in producer-consumer scenarios where multiple threads need to safely enqueue and dequeue items. The implementation uses a mutex to protect the underlying queue and a condition variable to allow threads to wait efficiently for new items. This pattern is commonly used in task scheduling systems, message passing between threads, and implementing work queues.</p>
</li>
<li>
<p>Atomic Operations:
Atomic operations, implemented using std::atomic, provide lock-free synchronization for simple data types. They are crucial for high-performance concurrent programming, especially when dealing with counters, flags, or simple shared state. Atomic operations guarantee that reads and writes to the atomic variable are indivisible, preventing race conditions without the overhead of locks.</p>
</li>
<li>
<p>Reader-Writer Locks:
Reader-writer locks, implemented using std::shared_mutex, allow multiple readers to access shared data simultaneously while ensuring exclusive access for writers. This is particularly useful for data structures that are read frequently but updated infrequently, such as configuration data or caches. It can significantly improve performance in read-heavy scenarios compared to using a standard mutex.</p>
</li>
<li>
<p>Futures and Promises:
std::future and std::promise provide a mechanism for asynchronous computation and communication between threads. They are useful for implementing parallel algorithms, dividing work among multiple threads, and retrieving results from background tasks. This pattern allows for better separation of concerns between the thread initiating a task and the thread performing it.</p>
</li>
<li>
<p>Memory Fences:
Memory fences, or memory barriers, are low-level synchronization primitives that enforce ordering of memory operations across multiple threads. They are crucial in lock-free programming and when implementing custom synchronization mechanisms. Fences ensure that memory operations are visible to other threads in a specific order, which is essential for correct behavior in multi-core systems.</p>
</li>
<li>
<p>Deadlock Prevention:
Deadlocks occur when multiple threads are waiting for each other to release resources, resulting in a circular dependency. Techniques like using std::lock or std::scoped_lock to acquire multiple mutexes simultaneously help prevent deadlocks. It's crucial to have a consistent locking order and use these utilities to ensure robust multithreaded code.</p>
</li>
<li>
<p>Thread Pools:
Thread pools manage a group of worker threads to execute tasks efficiently. They help in reducing the overhead of thread creation and destruction, especially in scenarios with many short-lived tasks. Thread pools are commonly used in server applications, task scheduling systems, and parallel processing frameworks to improve performance and resource utilization.</p>
</li>
<li>
<p>Condition Variables:
Condition variables, used in conjunction with mutexes, allow threads to wait efficiently for specific conditions to be met. They are essential for implementing synchronization patterns like producer-consumer queues, barriers, and thread-safe queues. Condition variables help avoid busy-waiting and improve CPU utilization in multithreaded applications.</p>
</li>
<li>
<p>Mutex and Lock Guards:
Mutexes are fundamental synchronization primitives used to protect shared resources from concurrent access. Lock guards (std::lock_guard, std::unique_lock) provide RAII-style locking, ensuring that mutexes are always properly unlocked, even in the presence of exceptions. Proper use of mutexes and lock guards is crucial for writing correct and exception-safe multithreaded code.</p>
</li>
<li>
<p>Thread Synchronization Patterns:
Various synchronization patterns, such as barriers, semaphores, and latches, can be implemented using the basic building blocks provided by the C++ standard library. These patterns are useful for coordinating the execution of multiple threads in more complex scenarios, such as parallel algorithms or phased computations.</p>
</li>
</ol>
<p>When working with multithreading, it's important to consider:</p>
<ul>
<li>Thread safety: Ensure that shared resources are properly protected from concurrent access.</li>
<li>Performance: Choose appropriate synchronization mechanisms based on the specific use case and contention patterns.</li>
<li>Scalability: Design your multithreaded code to scale well with the number of available cores.</li>
<li>Deadlock and race condition prevention: Carefully analyze your code for potential deadlocks and race conditions.</li>
<li>Error handling: Properly handle exceptions in multithreaded contexts to prevent resource leaks or inconsistent state.</li>
<li>Testing and debugging: Develop strategies for testing multithreaded code and use tools like thread sanitizers to detect issues.</li>
</ul>
<p>Mastering these concepts and techniques allows developers to write efficient, scalable, and robust multithreaded applications that can take full advantage of modern multi-core processors.</p>
<p>Multithreading in C++ is a complex topic that involves several concepts and tools. Let's break down the key aspects:</p>
<h3 id="1-introduction-to-multithreading">1. Introduction to Multithreading</h3>
<h4 id="what-is-multithreading">What is Multithreading?</h4>
<p>Multithreading allows a program to run multiple threads concurrently, which can improve performance by making better use of CPU resources. Each thread represents a separate path of execution.</p>
<h4 id="why-use-multithreading">Why Use Multithreading?</h4>
<ul>
<li><strong>Performance</strong>: Utilize multiple CPU cores to perform multiple operations simultaneously.</li>
<li><strong>Responsiveness</strong>: Keep the application responsive, especially in GUI applications.</li>
<li><strong>Concurrency</strong>: Perform I/O operations concurrently with other computations.</li>
</ul>
<h3 id="2-basic-concepts">2. Basic Concepts</h3>
<h4 id="threads">Threads</h4>
<p>A thread is the smallest unit of processing that can be scheduled by an operating system.</p>
<h4 id="processes-vs-threads">Processes vs. Threads</h4>
<ul>
<li><strong>Process</strong>: An independent program with its own memory space.</li>
<li><strong>Thread</strong>: A unit of execution within a process that shares the same memory space.</li>
</ul>
<h4 id="concurrency-vs-parallelism">Concurrency vs. Parallelism</h4>
<ul>
<li><strong>Concurrency</strong>: Structuring a program as if multiple tasks are happening simultaneously.</li>
<li><strong>Parallelism</strong>: Actually performing multiple tasks simultaneously, typically on multiple CPU cores.</li>
</ul>
<h3 id="3-c-standard-library-support">3. C++ Standard Library Support</h3>
<h4 id="library"><thread> Library</h4>
<p>The <code>&lt;thread&gt;</code> library provides a simple interface to manage threads.</p>
<h4 id="creating-threads">Creating Threads</h4>
<p>Threads are created by passing a function to a <code>std::thread</code> object.</p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-102-1" name="__codelineno-102-1" href="#__codelineno-102-1"></a><span class="cp">#include</span><span class="w"> </span><span class="cpf">&lt;iostream&gt;</span>
<a id="__codelineno-102-2" name="__codelineno-102-2" href="#__codelineno-102-2"></a><span class="cp">#include</span><span class="w"> </span><span class="cpf">&lt;thread&gt;</span>
<a id="__codelineno-102-3" name="__codelineno-102-3" href="#__codelineno-102-3"></a>
<a id="__codelineno-102-4" name="__codelineno-102-4" href="#__codelineno-102-4"></a><span class="kt">void</span><span class="w"> </span><span class="nf">threadFunction</span><span class="p">()</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-102-5" name="__codelineno-102-5" href="#__codelineno-102-5"></a><span class="w">    </span><span class="n">std</span><span class="o">::</span><span class="n">cout</span><span class="w"> </span><span class="o">&lt;&lt;</span><span class="w"> </span><span class="s">&quot;Hello from thread!</span><span class="se">\n</span><span class="s">&quot;</span><span class="p">;</span>
<a id="__codelineno-102-6" name="__codelineno-102-6" href="#__codelineno-102-6"></a><span class="p">}</span>
<a id="__codelineno-102-7" name="__codelineno-102-7" href="#__codelineno-102-7"></a>
<a id="__codelineno-102-8" name="__codelineno-102-8" href="#__codelineno-102-8"></a><span class="kt">int</span><span class="w"> </span><span class="nf">main</span><span class="p">()</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-102-9" name="__codelineno-102-9" href="#__codelineno-102-9"></a><span class="w">    </span><span class="n">std</span><span class="o">::</span><span class="kr">thread</span><span class="w"> </span><span class="n">t</span><span class="p">(</span><span class="n">threadFunction</span><span class="p">);</span>
<a id="__codelineno-102-10" name="__codelineno-102-10" href="#__codelineno-102-10"></a><span class="w">    </span><span class="n">t</span><span class="p">.</span><span class="n">join</span><span class="p">();</span><span class="w">  </span><span class="c1">// Wait for the thread to finish</span>
<a id="__codelineno-102-11" name="__codelineno-102-11" href="#__codelineno-102-11"></a><span class="w">    </span><span class="k">return</span><span class="w"> </span><span class="mi">0</span><span class="p">;</span>
<a id="__codelineno-102-12" name="__codelineno-102-12" href="#__codelineno-102-12"></a><span class="p">}</span>
</code></pre></div>
<h4 id="joining-and-detaching-threads">Joining and Detaching Threads</h4>
<ul>
<li><strong>join()</strong>: Blocks until the thread finishes execution.</li>
<li><strong>detach()</strong>: Allows the thread to run independently.</li>
</ul>
<div class="highlight"><pre><span></span><code><a id="__codelineno-103-1" name="__codelineno-103-1" href="#__codelineno-103-1"></a><span class="n">t</span><span class="p">.</span><span class="n">join</span><span class="p">();</span><span class="w">   </span><span class="c1">// Block until thread completes</span>
<a id="__codelineno-103-2" name="__codelineno-103-2" href="#__codelineno-103-2"></a><span class="n">t</span><span class="p">.</span><span class="n">detach</span><span class="p">();</span><span class="w"> </span><span class="c1">// Allow thread to run independently</span>
</code></pre></div>
<h3 id="4-synchronization-mechanisms">4. Synchronization Mechanisms</h3>
<h4 id="race-conditions">Race Conditions</h4>
<p>Occurs when multiple threads access shared resources simultaneously, leading to inconsistent results.</p>
<h4 id="mutex">Mutex</h4>
<p>A <code>std::mutex</code> is used to protect shared data from being simultaneously accessed by multiple threads.</p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-104-1" name="__codelineno-104-1" href="#__codelineno-104-1"></a><span class="cp">#include</span><span class="w"> </span><span class="cpf">&lt;iostream&gt;</span>
<a id="__codelineno-104-2" name="__codelineno-104-2" href="#__codelineno-104-2"></a><span class="cp">#include</span><span class="w"> </span><span class="cpf">&lt;thread&gt;</span>
<a id="__codelineno-104-3" name="__codelineno-104-3" href="#__codelineno-104-3"></a><span class="cp">#include</span><span class="w"> </span><span class="cpf">&lt;mutex&gt;</span>
<a id="__codelineno-104-4" name="__codelineno-104-4" href="#__codelineno-104-4"></a>
<a id="__codelineno-104-5" name="__codelineno-104-5" href="#__codelineno-104-5"></a><span class="n">std</span><span class="o">::</span><span class="n">mutex</span><span class="w"> </span><span class="n">mtx</span><span class="p">;</span>
<a id="__codelineno-104-6" name="__codelineno-104-6" href="#__codelineno-104-6"></a><span class="kt">int</span><span class="w"> </span><span class="n">counter</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">0</span><span class="p">;</span>
<a id="__codelineno-104-7" name="__codelineno-104-7" href="#__codelineno-104-7"></a>
<a id="__codelineno-104-8" name="__codelineno-104-8" href="#__codelineno-104-8"></a><span class="kt">void</span><span class="w"> </span><span class="nf">increaseCounter</span><span class="p">()</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-104-9" name="__codelineno-104-9" href="#__codelineno-104-9"></a><span class="w">    </span><span class="n">std</span><span class="o">::</span><span class="n">lock_guard</span><span class="o">&lt;</span><span class="n">std</span><span class="o">::</span><span class="n">mutex</span><span class="o">&gt;</span><span class="w"> </span><span class="n">guard</span><span class="p">(</span><span class="n">mtx</span><span class="p">);</span>
<a id="__codelineno-104-10" name="__codelineno-104-10" href="#__codelineno-104-10"></a><span class="w">    </span><span class="o">++</span><span class="n">counter</span><span class="p">;</span>
<a id="__codelineno-104-11" name="__codelineno-104-11" href="#__codelineno-104-11"></a><span class="p">}</span>
<a id="__codelineno-104-12" name="__codelineno-104-12" href="#__codelineno-104-12"></a>
<a id="__codelineno-104-13" name="__codelineno-104-13" href="#__codelineno-104-13"></a><span class="kt">int</span><span class="w"> </span><span class="nf">main</span><span class="p">()</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-104-14" name="__codelineno-104-14" href="#__codelineno-104-14"></a><span class="w">    </span><span class="n">std</span><span class="o">::</span><span class="kr">thread</span><span class="w"> </span><span class="n">t1</span><span class="p">(</span><span class="n">increaseCounter</span><span class="p">);</span>
<a id="__codelineno-104-15" name="__codelineno-104-15" href="#__codelineno-104-15"></a><span class="w">    </span><span class="n">std</span><span class="o">::</span><span class="kr">thread</span><span class="w"> </span><span class="n">t2</span><span class="p">(</span><span class="n">increaseCounter</span><span class="p">);</span>
<a id="__codelineno-104-16" name="__codelineno-104-16" href="#__codelineno-104-16"></a><span class="w">    </span><span class="n">t1</span><span class="p">.</span><span class="n">join</span><span class="p">();</span>
<a id="__codelineno-104-17" name="__codelineno-104-17" href="#__codelineno-104-17"></a><span class="w">    </span><span class="n">t2</span><span class="p">.</span><span class="n">join</span><span class="p">();</span>
<a id="__codelineno-104-18" name="__codelineno-104-18" href="#__codelineno-104-18"></a><span class="w">    </span><span class="n">std</span><span class="o">::</span><span class="n">cout</span><span class="w"> </span><span class="o">&lt;&lt;</span><span class="w"> </span><span class="s">&quot;Counter: &quot;</span><span class="w"> </span><span class="o">&lt;&lt;</span><span class="w"> </span><span class="n">counter</span><span class="w"> </span><span class="o">&lt;&lt;</span><span class="w"> </span><span class="n">std</span><span class="o">::</span><span class="n">endl</span><span class="p">;</span>
<a id="__codelineno-104-19" name="__codelineno-104-19" href="#__codelineno-104-19"></a><span class="w">    </span><span class="k">return</span><span class="w"> </span><span class="mi">0</span><span class="p">;</span>
<a id="__codelineno-104-20" name="__codelineno-104-20" href="#__codelineno-104-20"></a><span class="p">}</span>
</code></pre></div>
<h4 id="stdlock_guard-and-stdunique_lock">std::lock_guard and std::unique_lock</h4>
<ul>
<li><strong>std::lock_guard</strong>: Provides a convenient RAII-style mechanism for owning a mutex for the duration of a scoped block.</li>
<li><strong>std::unique_lock</strong>: More flexible, can lock and unlock the mutex manually.</li>
</ul>
<div class="highlight"><pre><span></span><code><a id="__codelineno-105-1" name="__codelineno-105-1" href="#__codelineno-105-1"></a><span class="n">std</span><span class="o">::</span><span class="n">lock_guard</span><span class="o">&lt;</span><span class="n">std</span><span class="o">::</span><span class="n">mutex</span><span class="o">&gt;</span><span class="w"> </span><span class="n">guard</span><span class="p">(</span><span class="n">mtx</span><span class="p">);</span><span class="w">  </span><span class="c1">// Automatic locking and unlocking</span>
<a id="__codelineno-105-2" name="__codelineno-105-2" href="#__codelineno-105-2"></a><span class="n">std</span><span class="o">::</span><span class="n">unique_lock</span><span class="o">&lt;</span><span class="n">std</span><span class="o">::</span><span class="n">mutex</span><span class="o">&gt;</span><span class="w"> </span><span class="n">lock</span><span class="p">(</span><span class="n">mtx</span><span class="p">);</span>
<a id="__codelineno-105-3" name="__codelineno-105-3" href="#__codelineno-105-3"></a><span class="n">lock</span><span class="p">.</span><span class="n">unlock</span><span class="p">();</span>
</code></pre></div>
<h4 id="condition-variables_1">Condition Variables</h4>
<p>Used for thread synchronization by allowing threads to wait for certain conditions to be met.</p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-106-1" name="__codelineno-106-1" href="#__codelineno-106-1"></a><span class="cp">#include</span><span class="w"> </span><span class="cpf">&lt;iostream&gt;</span>
<a id="__codelineno-106-2" name="__codelineno-106-2" href="#__codelineno-106-2"></a><span class="cp">#include</span><span class="w"> </span><span class="cpf">&lt;thread&gt;</span>
<a id="__codelineno-106-3" name="__codelineno-106-3" href="#__codelineno-106-3"></a><span class="cp">#include</span><span class="w"> </span><span class="cpf">&lt;mutex&gt;</span>
<a id="__codelineno-106-4" name="__codelineno-106-4" href="#__codelineno-106-4"></a><span class="cp">#include</span><span class="w"> </span><span class="cpf">&lt;condition_variable&gt;</span>
<a id="__codelineno-106-5" name="__codelineno-106-5" href="#__codelineno-106-5"></a>
<a id="__codelineno-106-6" name="__codelineno-106-6" href="#__codelineno-106-6"></a><span class="n">std</span><span class="o">::</span><span class="n">mutex</span><span class="w"> </span><span class="n">mtx</span><span class="p">;</span>
<a id="__codelineno-106-7" name="__codelineno-106-7" href="#__codelineno-106-7"></a><span class="n">std</span><span class="o">::</span><span class="n">condition_variable</span><span class="w"> </span><span class="n">cv</span><span class="p">;</span>
<a id="__codelineno-106-8" name="__codelineno-106-8" href="#__codelineno-106-8"></a><span class="kt">bool</span><span class="w"> </span><span class="n">ready</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nb">false</span><span class="p">;</span>
<a id="__codelineno-106-9" name="__codelineno-106-9" href="#__codelineno-106-9"></a>
<a id="__codelineno-106-10" name="__codelineno-106-10" href="#__codelineno-106-10"></a><span class="kt">void</span><span class="w"> </span><span class="nf">printID</span><span class="p">(</span><span class="kt">int</span><span class="w"> </span><span class="n">id</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-106-11" name="__codelineno-106-11" href="#__codelineno-106-11"></a><span class="w">    </span><span class="n">std</span><span class="o">::</span><span class="n">unique_lock</span><span class="o">&lt;</span><span class="n">std</span><span class="o">::</span><span class="n">mutex</span><span class="o">&gt;</span><span class="w"> </span><span class="n">lock</span><span class="p">(</span><span class="n">mtx</span><span class="p">);</span>
<a id="__codelineno-106-12" name="__codelineno-106-12" href="#__codelineno-106-12"></a><span class="w">    </span><span class="n">cv</span><span class="p">.</span><span class="n">wait</span><span class="p">(</span><span class="n">lock</span><span class="p">,</span><span class="w"> </span><span class="p">[]</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="k">return</span><span class="w"> </span><span class="n">ready</span><span class="p">;</span><span class="w"> </span><span class="p">});</span>
<a id="__codelineno-106-13" name="__codelineno-106-13" href="#__codelineno-106-13"></a><span class="w">    </span><span class="n">std</span><span class="o">::</span><span class="n">cout</span><span class="w"> </span><span class="o">&lt;&lt;</span><span class="w"> </span><span class="s">&quot;Thread &quot;</span><span class="w"> </span><span class="o">&lt;&lt;</span><span class="w"> </span><span class="n">id</span><span class="w"> </span><span class="o">&lt;&lt;</span><span class="w"> </span><span class="n">std</span><span class="o">::</span><span class="n">endl</span><span class="p">;</span>
<a id="__codelineno-106-14" name="__codelineno-106-14" href="#__codelineno-106-14"></a><span class="p">}</span>
<a id="__codelineno-106-15" name="__codelineno-106-15" href="#__codelineno-106-15"></a>
<a id="__codelineno-106-16" name="__codelineno-106-16" href="#__codelineno-106-16"></a><span class="kt">void</span><span class="w"> </span><span class="nf">setReady</span><span class="p">()</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-106-17" name="__codelineno-106-17" href="#__codelineno-106-17"></a><span class="w">    </span><span class="n">std</span><span class="o">::</span><span class="n">unique_lock</span><span class="o">&lt;</span><span class="n">std</span><span class="o">::</span><span class="n">mutex</span><span class="o">&gt;</span><span class="w"> </span><span class="n">lock</span><span class="p">(</span><span class="n">mtx</span><span class="p">);</span>
<a id="__codelineno-106-18" name="__codelineno-106-18" href="#__codelineno-106-18"></a><span class="w">    </span><span class="n">ready</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nb">true</span><span class="p">;</span>
<a id="__codelineno-106-19" name="__codelineno-106-19" href="#__codelineno-106-19"></a><span class="w">    </span><span class="n">cv</span><span class="p">.</span><span class="n">notify_all</span><span class="p">();</span>
<a id="__codelineno-106-20" name="__codelineno-106-20" href="#__codelineno-106-20"></a><span class="p">}</span>
<a id="__codelineno-106-21" name="__codelineno-106-21" href="#__codelineno-106-21"></a>
<a id="__codelineno-106-22" name="__codelineno-106-22" href="#__codelineno-106-22"></a><span class="kt">int</span><span class="w"> </span><span class="nf">main</span><span class="p">()</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-106-23" name="__codelineno-106-23" href="#__codelineno-106-23"></a><span class="w">    </span><span class="n">std</span><span class="o">::</span><span class="kr">thread</span><span class="w"> </span><span class="n">threads</span><span class="p">[</span><span class="mi">10</span><span class="p">];</span>
<a id="__codelineno-106-24" name="__codelineno-106-24" href="#__codelineno-106-24"></a><span class="w">    </span><span class="k">for</span><span class="w"> </span><span class="p">(</span><span class="kt">int</span><span class="w"> </span><span class="n">i</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">0</span><span class="p">;</span><span class="w"> </span><span class="n">i</span><span class="w"> </span><span class="o">&lt;</span><span class="w"> </span><span class="mi">10</span><span class="p">;</span><span class="w"> </span><span class="o">++</span><span class="n">i</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-106-25" name="__codelineno-106-25" href="#__codelineno-106-25"></a><span class="w">        </span><span class="n">threads</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">std</span><span class="o">::</span><span class="kr">thread</span><span class="p">(</span><span class="n">printID</span><span class="p">,</span><span class="w"> </span><span class="n">i</span><span class="p">);</span>
<a id="__codelineno-106-26" name="__codelineno-106-26" href="#__codelineno-106-26"></a><span class="w">    </span><span class="p">}</span>
<a id="__codelineno-106-27" name="__codelineno-106-27" href="#__codelineno-106-27"></a><span class="w">    </span><span class="n">setReady</span><span class="p">();</span>
<a id="__codelineno-106-28" name="__codelineno-106-28" href="#__codelineno-106-28"></a><span class="w">    </span><span class="k">for</span><span class="w"> </span><span class="p">(</span><span class="k">auto</span><span class="o">&amp;</span><span class="w"> </span><span class="n">th</span><span class="w"> </span><span class="o">:</span><span class="w"> </span><span class="n">threads</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-106-29" name="__codelineno-106-29" href="#__codelineno-106-29"></a><span class="w">        </span><span class="n">th</span><span class="p">.</span><span class="n">join</span><span class="p">();</span>
<a id="__codelineno-106-30" name="__codelineno-106-30" href="#__codelineno-106-30"></a><span class="w">    </span><span class="p">}</span>
<a id="__codelineno-106-31" name="__codelineno-106-31" href="#__codelineno-106-31"></a><span class="w">    </span><span class="k">return</span><span class="w"> </span><span class="mi">0</span><span class="p">;</span>
<a id="__codelineno-106-32" name="__codelineno-106-32" href="#__codelineno-106-32"></a><span class="p">}</span>
</code></pre></div>
<h3 id="5-advanced-topics">5. Advanced Topics</h3>
<h4 id="atomic-operations">Atomic Operations</h4>
<p><code>std::atomic</code> provides atomic operations that are free from data races.</p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-107-1" name="__codelineno-107-1" href="#__codelineno-107-1"></a><span class="cp">#include</span><span class="w"> </span><span class="cpf">&lt;iostream&gt;</span>
<a id="__codelineno-107-2" name="__codelineno-107-2" href="#__codelineno-107-2"></a><span class="cp">#include</span><span class="w"> </span><span class="cpf">&lt;thread&gt;</span>
<a id="__codelineno-107-3" name="__codelineno-107-3" href="#__codelineno-107-3"></a><span class="cp">#include</span><span class="w"> </span><span class="cpf">&lt;atomic&gt;</span>
<a id="__codelineno-107-4" name="__codelineno-107-4" href="#__codelineno-107-4"></a>
<a id="__codelineno-107-5" name="__codelineno-107-5" href="#__codelineno-107-5"></a><span class="n">std</span><span class="o">::</span><span class="n">atomic</span><span class="o">&lt;</span><span class="kt">int</span><span class="o">&gt;</span><span class="w"> </span><span class="n">counter</span><span class="p">(</span><span class="mi">0</span><span class="p">);</span>
<a id="__codelineno-107-6" name="__codelineno-107-6" href="#__codelineno-107-6"></a>
<a id="__codelineno-107-7" name="__codelineno-107-7" href="#__codelineno-107-7"></a><span class="kt">void</span><span class="w"> </span><span class="nf">increaseCounter</span><span class="p">()</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-107-8" name="__codelineno-107-8" href="#__codelineno-107-8"></a><span class="w">    </span><span class="o">++</span><span class="n">counter</span><span class="p">;</span>
<a id="__codelineno-107-9" name="__codelineno-107-9" href="#__codelineno-107-9"></a><span class="p">}</span>
<a id="__codelineno-107-10" name="__codelineno-107-10" href="#__codelineno-107-10"></a>
<a id="__codelineno-107-11" name="__codelineno-107-11" href="#__codelineno-107-11"></a><span class="kt">int</span><span class="w"> </span><span class="nf">main</span><span class="p">()</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-107-12" name="__codelineno-107-12" href="#__codelineno-107-12"></a><span class="w">    </span><span class="n">std</span><span class="o">::</span><span class="kr">thread</span><span class="w"> </span><span class="n">t1</span><span class="p">(</span><span class="n">increaseCounter</span><span class="p">);</span>
<a id="__codelineno-107-13" name="__codelineno-107-13" href="#__codelineno-107-13"></a><span class="w">    </span><span class="n">std</span><span class="o">::</span><span class="kr">thread</span><span class="w"> </span><span class="n">t2</span><span class="p">(</span><span class="n">increaseCounter</span><span class="p">);</span>
<a id="__codelineno-107-14" name="__codelineno-107-14" href="#__codelineno-107-14"></a><span class="w">    </span><span class="n">t1</span><span class="p">.</span><span class="n">join</span><span class="p">();</span>
<a id="__codelineno-107-15" name="__codelineno-107-15" href="#__codelineno-107-15"></a><span class="w">    </span><span class="n">t2</span><span class="p">.</span><span class="n">join</span><span class="p">();</span>
<a id="__codelineno-107-16" name="__codelineno-107-16" href="#__codelineno-107-16"></a><span class="w">    </span><span class="n">std</span><span class="o">::</span><span class="n">cout</span><span class="w"> </span><span class="o">&lt;&lt;</span><span class="w"> </span><span class="s">&quot;Counter: &quot;</span><span class="w"> </span><span class="o">&lt;&lt;</span><span class="w"> </span><span class="n">counter</span><span class="p">.</span><span class="n">load</span><span class="p">()</span><span class="w"> </span><span class="o">&lt;&lt;</span><span class="w"> </span><span class="n">std</span><span class="o">::</span><span class="n">endl</span><span class="p">;</span>
<a id="__codelineno-107-17" name="__codelineno-107-17" href="#__codelineno-107-17"></a><span class="w">    </span><span class="k">return</span><span class="w"> </span><span class="mi">0</span><span class="p">;</span>
<a id="__codelineno-107-18" name="__codelineno-107-18" href="#__codelineno-107-18"></a><span class="p">}</span>
</code></pre></div>
<h4 id="thread-pools">Thread Pools</h4>
<p>A thread pool is a collection of threads that can be reused to perform multiple tasks, improving efficiency by reducing the overhead of creating and destroying threads.</p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-108-1" name="__codelineno-108-1" href="#__codelineno-108-1"></a><span class="cp">#include</span><span class="w"> </span><span class="cpf">&lt;iostream&gt;</span>
<a id="__codelineno-108-2" name="__codelineno-108-2" href="#__codelineno-108-2"></a><span class="cp">#include</span><span class="w"> </span><span class="cpf">&lt;vector&gt;</span>
<a id="__codelineno-108-3" name="__codelineno-108-3" href="#__codelineno-108-3"></a><span class="cp">#include</span><span class="w"> </span><span class="cpf">&lt;thread&gt;</span>
<a id="__codelineno-108-4" name="__codelineno-108-4" href="#__codelineno-108-4"></a><span class="cp">#include</span><span class="w"> </span><span class="cpf">&lt;queue&gt;</span>
<a id="__codelineno-108-5" name="__codelineno-108-5" href="#__codelineno-108-5"></a><span class="cp">#include</span><span class="w"> </span><span class="cpf">&lt;functional&gt;</span>
<a id="__codelineno-108-6" name="__codelineno-108-6" href="#__codelineno-108-6"></a><span class="cp">#include</span><span class="w"> </span><span class="cpf">&lt;mutex&gt;</span>
<a id="__codelineno-108-7" name="__codelineno-108-7" href="#__codelineno-108-7"></a><span class="cp">#include</span><span class="w"> </span><span class="cpf">&lt;condition_variable&gt;</span>
<a id="__codelineno-108-8" name="__codelineno-108-8" href="#__codelineno-108-8"></a><span class="cp">#include</span><span class="w"> </span><span class="cpf">&lt;future&gt;</span>
<a id="__codelineno-108-9" name="__codelineno-108-9" href="#__codelineno-108-9"></a>
<a id="__codelineno-108-10" name="__codelineno-108-10" href="#__codelineno-108-10"></a><span class="k">class</span><span class="w"> </span><span class="nc">ThreadPool</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-108-11" name="__codelineno-108-11" href="#__codelineno-108-11"></a><span class="k">public</span><span class="o">:</span>
<a id="__codelineno-108-12" name="__codelineno-108-12" href="#__codelineno-108-12"></a><span class="w">    </span><span class="n">ThreadPool</span><span class="p">(</span><span class="kt">size_t</span><span class="p">);</span>
<a id="__codelineno-108-13" name="__codelineno-108-13" href="#__codelineno-108-13"></a><span class="w">    </span><span class="k">template</span><span class="o">&lt;</span><span class="k">class</span><span class="w"> </span><span class="nc">F</span><span class="p">,</span><span class="w"> </span><span class="k">class</span><span class="p">...</span><span class="w"> </span><span class="n">Args</span><span class="o">&gt;</span>
<a id="__codelineno-108-14" name="__codelineno-108-14" href="#__codelineno-108-14"></a><span class="w">    </span><span class="k">auto</span><span class="w"> </span><span class="n">enqueue</span><span class="p">(</span><span class="n">F</span><span class="o">&amp;&amp;</span><span class="w"> </span><span class="n">f</span><span class="p">,</span><span class="w"> </span><span class="n">Args</span><span class="o">&amp;&amp;</span><span class="p">...</span><span class="w"> </span><span class="n">args</span><span class="p">)</span><span class="w"> </span><span class="o">-&gt;</span><span class="w"> </span><span class="n">std</span><span class="o">::</span><span class="n">future</span><span class="o">&lt;</span><span class="k">typename</span><span class="w"> </span><span class="nc">std</span><span class="o">::</span><span class="n">result_of</span><span class="o">&lt;</span><span class="n">F</span><span class="p">(</span><span class="n">Args</span><span class="p">...)</span><span class="o">&gt;::</span><span class="n">type</span><span class="o">&gt;</span><span class="p">;</span>
<a id="__codelineno-108-15" name="__codelineno-108-15" href="#__codelineno-108-15"></a><span class="w">    </span><span class="o">~</span><span class="n">ThreadPool</span><span class="p">();</span>
<a id="__codelineno-108-16" name="__codelineno-108-16" href="#__codelineno-108-16"></a><span class="k">private</span><span class="o">:</span>
<a id="__codelineno-108-17" name="__codelineno-108-17" href="#__codelineno-108-17"></a><span class="w">    </span><span class="n">std</span><span class="o">::</span><span class="n">vector</span><span class="o">&lt;</span><span class="n">std</span><span class="o">::</span><span class="kr">thread</span><span class="o">&gt;</span><span class="w"> </span><span class="n">workers</span><span class="p">;</span>
<a id="__codelineno-108-18" name="__codelineno-108-18" href="#__codelineno-108-18"></a><span class="w">    </span><span class="n">std</span><span class="o">::</span><span class="n">queue</span><span class="o">&lt;</span><span class="n">std</span><span class="o">::</span><span class="n">function</span><span class="o">&lt;</span><span class="kt">void</span><span class="p">()</span><span class="o">&gt;&gt;</span><span class="w"> </span><span class="n">tasks</span><span class="p">;</span>
<a id="__codelineno-108-19" name="__codelineno-108-19" href="#__codelineno-108-19"></a><span class="w">    </span><span class="n">std</span><span class="o">::</span><span class="n">mutex</span><span class="w"> </span><span class="n">queue_mutex</span><span class="p">;</span>
<a id="__codelineno-108-20" name="__codelineno-108-20" href="#__codelineno-108-20"></a><span class="w">    </span><span class="n">std</span><span class="o">::</span><span class="n">condition_variable</span><span class="w"> </span><span class="n">condition</span><span class="p">;</span>
<a id="__codelineno-108-21" name="__codelineno-108-21" href="#__codelineno-108-21"></a><span class="w">    </span><span class="kt">bool</span><span class="w"> </span><span class="n">stop</span><span class="p">;</span>
<a id="__codelineno-108-22" name="__codelineno-108-22" href="#__codelineno-108-22"></a><span class="p">};</span>
<a id="__codelineno-108-23" name="__codelineno-108-23" href="#__codelineno-108-23"></a>
<a id="__codelineno-108-24" name="__codelineno-108-24" href="#__codelineno-108-24"></a><span class="kr">inline</span><span class="w"> </span><span class="n">ThreadPool</span><span class="o">::</span><span class="n">ThreadPool</span><span class="p">(</span><span class="kt">size_t</span><span class="w"> </span><span class="n">threads</span><span class="p">)</span>
<a id="__codelineno-108-25" name="__codelineno-108-25" href="#__codelineno-108-25"></a><span class="w">    </span><span class="o">:</span><span class="w"> </span><span class="n">stop</span><span class="p">(</span><span class="nb">false</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-108-26" name="__codelineno-108-26" href="#__codelineno-108-26"></a><span class="w">    </span><span class="k">for</span><span class="p">(</span><span class="kt">size_t</span><span class="w"> </span><span class="n">i</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">0</span><span class="p">;</span><span class="w"> </span><span class="n">i</span><span class="w"> </span><span class="o">&lt;</span><span class="w"> </span><span class="n">threads</span><span class="p">;</span><span class="w"> </span><span class="o">++</span><span class="n">i</span><span class="p">)</span>
<a id="__codelineno-108-27" name="__codelineno-108-27" href="#__codelineno-108-27"></a><span class="w">        </span><span class="n">workers</span><span class="p">.</span><span class="n">emplace_back</span><span class="p">([</span><span class="k">this</span><span class="p">]</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-108-28" name="__codelineno-108-28" href="#__codelineno-108-28"></a><span class="w">            </span><span class="k">for</span><span class="p">(;;)</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-108-29" name="__codelineno-108-29" href="#__codelineno-108-29"></a><span class="w">                </span><span class="n">std</span><span class="o">::</span><span class="n">function</span><span class="o">&lt;</span><span class="kt">void</span><span class="p">()</span><span class="o">&gt;</span><span class="w"> </span><span class="n">task</span><span class="p">;</span>
<a id="__codelineno-108-30" name="__codelineno-108-30" href="#__codelineno-108-30"></a><span class="w">                </span><span class="p">{</span>
<a id="__codelineno-108-31" name="__codelineno-108-31" href="#__codelineno-108-31"></a><span class="w">                    </span><span class="n">std</span><span class="o">::</span><span class="n">unique_lock</span><span class="o">&lt;</span><span class="n">std</span><span class="o">::</span><span class="n">mutex</span><span class="o">&gt;</span><span class="w"> </span><span class="n">lock</span><span class="p">(</span><span class="k">this</span><span class="o">-&gt;</span><span class="n">queue_mutex</span><span class="p">);</span>
<a id="__codelineno-108-32" name="__codelineno-108-32" href="#__codelineno-108-32"></a><span class="w">                    </span><span class="k">this</span><span class="o">-&gt;</span><span class="n">condition</span><span class="p">.</span><span class="n">wait</span><span class="p">(</span><span class="n">lock</span><span class="p">,</span><span class="w"> </span><span class="p">[</span><span class="k">this</span><span class="p">]</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="k">return</span><span class="w"> </span><span class="k">this</span><span class="o">-&gt;</span><span class="n">stop</span><span class="w"> </span><span class="o">||</span><span class="w"> </span><span class="o">!</span><span class="k">this</span><span class="o">-&gt;</span><span class="n">tasks</span><span class="p">.</span><span class="n">empty</span><span class="p">();</span><span class="w"> </span><span class="p">});</span>
<a id="__codelineno-108-33" name="__codelineno-108-33" href="#__codelineno-108-33"></a><span class="w">                    </span><span class="k">if</span><span class="p">(</span><span class="k">this</span><span class="o">-&gt;</span><span class="n">stop</span><span class="w"> </span><span class="o">&amp;&amp;</span><span class="w"> </span><span class="k">this</span><span class="o">-&gt;</span><span class="n">tasks</span><span class="p">.</span><span class="n">empty</span><span class="p">())</span>
<a id="__codelineno-108-34" name="__codelineno-108-34" href="#__codelineno-108-34"></a><span class="w">                        </span><span class="k">return</span><span class="p">;</span>
<a id="__codelineno-108-35" name="__codelineno-108-35" href="#__codelineno-108-35"></a><span class="w">                    </span><span class="n">task</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">std</span><span class="o">::</span><span class="n">move</span><span class="p">(</span><span class="k">this</span><span class="o">-&gt;</span><span class="n">tasks</span><span class="p">.</span><span class="n">front</span><span class="p">());</span>
<a id="__codelineno-108-36" name="__codelineno-108-36" href="#__codelineno-108-36"></a><span class="w">                    </span><span class="k">this</span><span class="o">-&gt;</span><span class="n">tasks</span><span class="p">.</span><span class="n">pop</span><span class="p">();</span>
<a id="__codelineno-108-37" name="__codelineno-108-37" href="#__codelineno-108-37"></a><span class="w">                </span><span class="p">}</span>
<a id="__codelineno-108-38" name="__codelineno-108-38" href="#__codelineno-108-38"></a><span class="w">                </span><span class="n">task</span><span class="p">();</span>
<a id="__codelineno-108-39" name="__codelineno-108-39" href="#__codelineno-108-39"></a><span class="w">            </span><span class="p">}</span>
<a id="__codelineno-108-40" name="__codelineno-108-40" href="#__codelineno-108-40"></a><span class="w">        </span><span class="p">});</span>
<a id="__codelineno-108-41" name="__codelineno-108-41" href="#__codelineno-108-41"></a><span class="p">}</span>
<a id="__codelineno-108-42" name="__codelineno-108-42" href="#__codelineno-108-42"></a>
<a id="__codelineno-108-43" name="__codelineno-108-43" href="#__codelineno-108-43"></a><span class="k">template</span><span class="o">&lt;</span><span class="k">class</span><span class="w"> </span><span class="nc">F</span><span class="p">,</span><span class="w"> </span><span class="k">class</span><span class="p">...</span><span class="w"> </span><span class="n">Args</span><span class="o">&gt;</span>
<a id="__codelineno-108-44" name="__codelineno-108-44" href="#__codelineno-108-44"></a><span class="k">auto</span><span class="w"> </span><span class="n">ThreadPool</span><span class="o">::</span><span class="n">enqueue</span><span class="p">(</span><span class="n">F</span><span class="o">&amp;&amp;</span><span class="w"> </span><span class="n">f</span><span class="p">,</span><span class="w"> </span><span class="n">Args</span><span class="o">&amp;&amp;</span><span class="p">...</span><span class="w"> </span><span class="n">args</span><span class="p">)</span><span class="w"> </span><span class="o">-&gt;</span><span class="w"> </span><span class="n">std</span><span class="o">::</span><span class="n">future</span><span class="o">&lt;</span><span class="k">typename</span><span class="w"> </span><span class="nc">std</span><span class="o">::</span><span class="n">result_of</span><span class="o">&lt;</span><span class="n">F</span><span class="p">(</span><span class="n">Args</span><span class="p">...)</span><span class="o">&gt;::</span><span class="n">type</span><span class="o">&gt;</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-108-45" name="__codelineno-108-45" href="#__codelineno-108-45"></a><span class="w">    </span><span class="k">using</span><span class="w"> </span><span class="n">return_type</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">typename</span><span class="w"> </span><span class="nc">std</span><span class="o">::</span><span class="n">result_of</span><span class="o">&lt;</span><span class="n">F</span><span class="p">(</span><span class="n">Args</span><span class="p">...)</span><span class="o">&gt;::</span><span class="n">type</span><span class="p">;</span>
<a id="__codelineno-108-46" name="__codelineno-108-46" href="#__codelineno-108-46"></a><span class="w">    </span><span class="k">auto</span><span class="w"> </span><span class="n">task</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">std</span><span class="o">::</span><span class="n">make_shared</span><span class="o">&lt;</span><span class="n">std</span><span class="o">::</span><span class="n">packaged_task</span><span class="o">&lt;</span><span class="n">return_type</span><span class="p">()</span><span class="o">&gt;&gt;</span><span class="p">(</span>
<a id="__codelineno-108-47" name="__codelineno-108-47" href="#__codelineno-108-47"></a><span class="w">        </span><span class="n">std</span><span class="o">::</span><span class="n">bind</span><span class="p">(</span><span class="n">std</span><span class="o">::</span><span class="n">forward</span><span class="o">&lt;</span><span class="n">F</span><span class="o">&gt;</span><span class="p">(</span><span class="n">f</span><span class="p">),</span><span class="w"> </span><span class="n">std</span><span class="o">::</span><span class="n">forward</span><span class="o">&lt;</span><span class="n">Args</span><span class="o">&gt;</span><span class="p">(</span><span class="n">args</span><span class="p">)...)</span>
<a id="__codelineno-108-48" name="__codelineno-108-48" href="#__codelineno-108-48"></a><span class="w">    </span><span class="p">);</span>
<a id="__codelineno-108-49" name="__codelineno-108-49" href="#__codelineno-108-49"></a><span class="w">    </span><span class="n">std</span><span class="o">::</span><span class="n">future</span><span class="o">&lt;</span><span class="n">return_type</span><span class="o">&gt;</span><span class="w"> </span><span class="n">res</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">task</span><span class="o">-&gt;</span><span class="n">get_future</span><span class="p">();</span>
<a id="__codelineno-108-50" name="__codelineno-108-50" href="#__codelineno-108-50"></a><span class="w">    </span><span class="p">{</span>
<a id="__codelineno-108-51" name="__codelineno-108-51" href="#__codelineno-108-51"></a><span class="w">        </span><span class="n">std</span><span class="o">::</span><span class="n">unique_lock</span><span class="o">&lt;</span><span class="n">std</span><span class="o">::</span><span class="n">mutex</span><span class="o">&gt;</span><span class="w"> </span><span class="n">lock</span><span class="p">(</span><span class="n">queue_mutex</span><span class="p">);</span>
<a id="__codelineno-108-52" name="__codelineno-108-52" href="#__codelineno-108-52"></a><span class="w">        </span><span class="k">if</span><span class="p">(</span><span class="n">stop</span><span class="p">)</span>
<a id="__codelineno-108-53" name="__codelineno-108-53" href="#__codelineno-108-53"></a><span class="w">            </span><span class="k">throw</span><span class="w"> </span><span class="n">std</span><span class="o">::</span><span class="n">runtime_error</span><span class="p">(</span><span class="s">&quot;enqueue on stopped ThreadPool&quot;</span><span class="p">);</span>
<a id="__codelineno-108-54" name="__codelineno-108-54" href="#__codelineno-108-54"></a><span class="w">        </span><span class="n">tasks</span><span class="p">.</span><span class="n">emplace</span><span class="p">([</span><span class="n">task</span><span class="p">]()</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="p">(</span><span class="o">*</span><span class="n">task</span><span class="p">)();</span><span class="w"> </span><span class="p">});</span>
<a id="__codelineno-108-55" name="__codelineno-108-55" href="#__codelineno-108-55"></a><span class="w">    </span><span class="p">}</span>
<a id="__codelineno-108-56" name="__codelineno-108-56" href="#__codelineno-108-56"></a><span class="w">    </span><span class="n">condition</span><span class="p">.</span><span class="n">notify_one</span><span class="p">();</span>
<a id="__codelineno-108-57" name="__codelineno-108-57" href="#__codelineno-108-57"></a><span class="w">    </span><span class="k">return</span><span class="w"> </span><span class="n">res</span><span class="p">;</span>
<a id="__codelineno-108-58" name="__codelineno-108-58" href="#__codelineno-108-58"></a><span class="p">}</span>
<a id="__codelineno-108-59" name="__codelineno-108-59" href="#__codelineno-108-59"></a>
<a id="__codelineno-108-60" name="__codelineno-108-60" href="#__codelineno-108-60"></a><span class="kr">inline</span><span class="w"> </span><span class="n">ThreadPool</span><span class="o">::~</span><span class="n">ThreadPool</span><span class="p">()</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-108-61" name="__codelineno-108-61" href="#__codelineno-108-61"></a><span class="w">    </span><span class="p">{</span>
<a id="__codelineno-108-62" name="__codelineno-108-62" href="#__codelineno-108-62"></a><span class="w">        </span><span class="n">std</span><span class="o">::</span><span class="n">unique_lock</span><span class="o">&lt;</span><span class="n">std</span><span class="o">::</span><span class="n">mutex</span><span class="o">&gt;</span><span class="w"> </span><span class="n">lock</span><span class="p">(</span><span class="n">queue_mutex</span><span class="p">);</span>
<a id="__codelineno-108-63" name="__codelineno-108-63" href="#__codelineno-108-63"></a><span class="w">        </span><span class="n">stop</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nb">true</span><span class="p">;</span>
<a id="__codelineno-108-64" name="__codelineno-108-64" href="#__codelineno-108-64"></a><span class="w">    </span><span class="p">}</span>
<a id="__codelineno-108-65" name="__codelineno-108-65" href="#__codelineno-108-65"></a><span class="w">    </span><span class="n">condition</span><span class="p">.</span><span class="n">notify_all</span><span class="p">();</span>
<a id="__codelineno-108-66" name="__codelineno-108-66" href="#__codelineno-108-66"></a><span class="w">    </span><span class="k">for</span><span class="p">(</span><span class="n">std</span><span class="o">::</span><span class="kr">thread</span><span class="w"> </span><span class="o">&amp;</span><span class="n">worker</span><span class="o">:</span><span class="w"> </span><span class="n">workers</span><span class="p">)</span>
<a id="__codelineno-108-67" name="__codelineno-108-67" href="#__codelineno-108-67"></a><span class="w">        </span><span class="n">worker</span><span class="p">.</span><span class="n">join</span><span class="p">();</span>
<a id="__codelineno-108-68" name="__codelineno-108-68" href="#__codelineno-108-68"></a><span class="p">}</span>
<a id="__codelineno-108-69" name="__codelineno-108-69" href="#__codelineno-108-69"></a>
<a id="__codelineno-108-70" name="__codelineno-108-70" href="#__codelineno-108-70"></a><span class="kt">int</span><span class="w"> </span><span class="n">main</span><span class="p">()</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-108-71" name="__codelineno-108-71" href="#__codelineno-108-71"></a><span class="w">    </span><span class="n">ThreadPool</span><span class="w"> </span><span class="nf">pool</span><span class="p">(</span><span class="mi">4</span><span class="p">);</span>
<a id="__codelineno-108-72" name="__codelineno-108-72" href="#__codelineno-108-72"></a><span class="w">    </span><span class="k">auto</span><span class="w"> </span><span class="n">result1</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">pool</span><span class="p">.</span><span class="n">enqueue</span><span class="p">([]</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="k">return</span><span class="w"> </span><span class="s">&quot;Task 1&quot;</span><span class="p">;</span><span class="w"> </span><span class="p">});</span>
<a id="__codelineno-108-73" name="__codelineno-108-73" href="#__codelineno-108-73"></a><span class="w">    </span><span class="k">auto</span><span class="w"> </span><span class="n">result2</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">pool</span><span class="p">.</span><span class="n">enqueue</span><span class="p">([]</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="k">return</span><span class="w"> </span><span class="s">&quot;Task 2&quot;</span><span class="p">;</span><span class="w"> </span><span class="p">});</span>
<a id="__codelineno-108-74" name="__codelineno-108-74" href="#__codelineno-108-74"></a><span class="w">    </span><span class="n">std</span><span class="o">::</span><span class="n">cout</span><span class="w"> </span><span class="o">&lt;&lt;</span><span class="w"> </span><span class="n">result1</span><span class="p">.</span><span class="n">get</span><span class="p">()</span><span class="w"> </span><span class="o">&lt;&lt;</span><span class="w"> </span><span class="n">std</span><span class="o">::</span><span class="n">endl</span><span class="p">;</span>
<a id="__codelineno-108-75" name="__codelineno-108-75" href="#__codelineno-108-75"></a><span class="w">    </span><span class="n">std</span><span class="o">::</span><span class="n">cout</span><span class="w"> </span><span class="o">&lt;&lt;</span><span class="w"> </span><span class="n">result2</span><span class="p">.</span><span class="n">get</span><span class="p">()</span><span class="w"> </span><span class="o">&lt;&lt;</span><span class="w"> </span><span class="n">std</span><span class="o">::</span><span class="n">endl</span><span class="p">;</span>
<a id="__codelineno-108-76" name="__codelineno-108-76" href="#__codelineno-108-76"></a><span class="w">    </span><span class="k">return</span><span class="w"> </span><span class="mi">0</span><span class="p">;</span>
<a id="__codelineno-108-77" name="__codelineno-108-77" href="#__codelineno-108-77"></a><span class="p">}</span>
</code></pre></div>
<h4 id="parallel-algorithms">Parallel Algorithms</h4>
<p>The C++ Standard Library provides parallel versions of many algorithms (e.g., <code>std::for_each</code>, <code>std::sort</code>).</p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-109-1" name="__codelineno-109-1" href="#__codelineno-109-1"></a><span class="cp">#include</span><span class="w"> </span><span class="cpf">&lt;iostream&gt;</span>
<a id="__codelineno-109-2" name="__codelineno-109-2" href="#__codelineno-109-2"></a><span class="cp">#include</span><span class="w"> </span><span class="cpf">&lt;vector&gt;</span>
<a id="__codelineno-109-3" name="__codelineno-109-3" href="#__codelineno-109-3"></a><span class="cp">#include</span><span class="w"> </span><span class="cpf">&lt;algorithm&gt;</span>
<a id="__codelineno-109-4" name="__codelineno-109-4" href="#__codelineno-109-4"></a><span class="cp">#include</span><span class="w"> </span><span class="cpf">&lt;execution&gt;</span>
<a id="__codelineno-109-5" name="__codelineno-109-5" href="#__codelineno-109-5"></a>
<a id="__codelineno-109-6" name="__codelineno-109-6" href="#__codelineno-109-6"></a><span class="kt">int</span><span class="w"> </span><span class="nf">main</span><span class="p">()</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-109-7" name="__codelineno-109-7" href="#__codelineno-109-7"></a><span class="w">    </span><span class="n">std</span><span class="o">::</span><span class="n">vector</span><span class="o">&lt;</span><span class="kt">int</span><span class="o">&gt;</span><span class="w"> </span><span class="n">vec</span><span class="p">(</span><span class="mi">1000</span><span class="p">,</span><span class="w"> </span><span class="mi">1</span><span class="p">);</span>
<a id="__codelineno-109-8" name="__codelineno-109-8" href="#__codelineno-109-8"></a><span class="w">    </span><span class="n">std</span><span class="o">::</span><span class="n">for_each</span><span class="p">(</span><span class="n">std</span><span class="o">::</span><span class="n">execution</span><span class="o">::</span><span class="n">par</span><span class="p">,</span><span class="w"> </span><span class="n">vec</span><span class="p">.</span><span class="n">begin</span><span class="p">(),</span><span class="w"> </span><span class="n">vec</span><span class="p">.</span><span class="n">end</span><span class="p">(),</span><span class="w"> </span><span class="p">[](</span><span class="kt">int</span><span class="o">&amp;</span><span class="w"> </span><span class="n">n</span><span class="p">)</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="n">n</span><span class="w"> </span><span class="o">*=</span><span class="w"> </span><span class="mi">2</span><span class="p">;</span><span class="w"> </span><span class="p">});</span>
<a id="__codelineno-109-9" name="__codelineno-109-9" href="#__codelineno-109-9"></a><span class="w">    </span><span class="k">return</span><span class="w"> </span><span class="mi">0</span><span class="p">;</span>
<a id="__codelineno-109-10" name="__codelineno-109-10" href="#__codelineno-109-10"></a><span class="p">}</span>
</code></pre></div>
<h4 id="future-and-promise">Future and Promise</h4>
<p><code>std::future</code> and <code>std::promise</code> provide a mechanism to transfer a value between threads.</p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-110-1" name="__codelineno-110-1" href="#__codelineno-110-1"></a><span class="cp">#include</span><span class="w"> </span><span class="cpf">&lt;iostream&gt;</span>
<a id="__codelineno-110-2" name="__codelineno-110-2" href="#__codelineno-110-2"></a><span class="cp">#include</span><span class="w"> </span><span class="cpf">&lt;thread&gt;</span>
<a id="__codelineno-110-3" name="__codelineno-110-3" href="#__codelineno-110-3"></a><span class="cp">#include</span><span class="w"> </span><span class="cpf">&lt;future&gt;</span>
<a id="__codelineno-110-4" name="__codelineno-110-4" href="#__codelineno-110-4"></a>
<a id="__codelineno-110-5" name="__codelineno-110-5" href="#__codelineno-110-5"></a><span class="kt">void</span><span class="w"> </span><span class="nf">printPromise</span><span class="p">(</span><span class="n">std</span><span class="o">::</span><span class="n">promise</span><span class="o">&lt;</span><span class="kt">int</span><span class="o">&gt;&amp;&amp;</span><span class="w"> </span><span class="n">prms</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-110-6" name="__codelineno-110-6" href="#__codelineno-110-6"></a><span class="w">    </span><span class="n">std</span><span class="o">::</span><span class="n">this_thread</span><span class="o">::</span><span class="n">sleep_for</span><span class="p">(</span><span class="n">std</span><span class="o">::</span><span class="n">chrono</span><span class="o">::</span><span class="n">seconds</span><span class="p">(</span><span class="mi">2</span><span class="p">));</span>
<a id="__codelineno-110-7" name="__codelineno-110-7" href="#__codelineno-110-7"></a><span class="w">    </span><span class="n">prms</span><span class="p">.</span><span class="n">set_value</span><span class="p">(</span><span class="mi">42</span><span class="p">);</span>
<a id="__codelineno-110-8" name="__codelineno-110-8" href="#__codelineno-110-8"></a><span class="p">}</span>
<a id="__codelineno-110-9" name="__codelineno-110-9" href="#__codelineno-110-9"></a>
<a id="__codelineno-110-10" name="__codelineno-110-10" href="#__codelineno-110-10"></a><span class="kt">int</span><span class="w"> </span><span class="nf">main</span><span class="p">()</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-110-11" name="__codelineno-110-11" href="#__codelineno-110-11"></a><span class="w">    </span><span class="n">std</span><span class="o">::</span><span class="n">promise</span><span class="o">&lt;</span><span class="kt">int</span><span class="o">&gt;</span><span class="w"> </span><span class="n">prms</span><span class="p">;</span>
<a id="__codelineno-110-12" name="__codelineno-110-12" href="#__codelineno-110-12"></a><span class="w">    </span><span class="n">std</span><span class="o">::</span><span class="n">future</span><span class="o">&lt;</span><span class="kt">int</span><span class="o">&gt;</span><span class="w"> </span><span class="n">ftr</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">prms</span><span class="p">.</span><span class="n">get_future</span><span class="p">();</span>
<a id="__codelineno-110-13" name="__codelineno-110-13" href="#__codelineno-110-13"></a><span class="w">    </span><span class="n">std</span><span class="o">::</span><span class="kr">thread</span><span class="w"> </span><span class="n">th</span><span class="p">(</span><span class="n">printPromise</span><span class="p">,</span><span class="w"> </span><span class="n">std</span><span class="o">::</span><span class="n">move</span><span class="p">(</span><span class="n">prms</span><span class="p">));</span>
<a id="__codelineno-110-14" name="__codelineno-110-14" href="#__codelineno-110-14"></a><span class="w">    </span><span class="n">std</span><span class="o">::</span><span class="n">cout</span><span class="w"> </span><span class="o">&lt;&lt;</span><span class="w"> </span><span class="s">&quot;Future value: &quot;</span><span class="w"> </span><span class="o">&lt;&lt;</span><span class="w"> </span><span class="n">ftr</span><span class="p">.</span><span class="n">get</span><span class="p">()</span><span class="w"> </span><span class="o">&lt;&lt;</span><span class="w"> </span><span class="n">std</span><span class="o">::</span><span class="n">endl</span><span class="p">;</span>
<a id="__codelineno-110-15" name="__codelineno-110-15" href="#__codelineno-110-15"></a><span class="w">    </span><span class="n">th</span><span class="p">.</span><span class="n">join</span><span class="p">();</span>
<a id="__codelineno-110-16" name="__codelineno-110-16" href="#__codelineno-110-16"></a><span class="w">    </span><span class="k">return</span><span class="w"> </span><span class="mi">0</span><span class="p">;</span>
<a id="__codelineno-110-17" name="__codelineno-110-17" href="#__codelineno-110-17"></a><span class="p">}</span>
</code></pre></div>
<h3 id="6-best-practices">6. Best Practices</h3>
<ul>
<li><strong>Minimize shared data:</strong> Reduce the amount of shared data to minimize synchronization overhead.</li>
<li><strong>Use appropriate synchronization primitives:</strong> Choose the right synchronization tools for the task (e.g., mutexes, condition variables, atomics).</li>
<li><strong>Avoid deadlocks:</strong> Ensure proper locking order and use lock-free algorithms when possible.</li>
<li><strong>Test thoroughly:</strong> Multithreaded code can have subtle bugs that are difficult to reproduce, so thorough testing is crucial.</li>
<li><strong>Profile performance:</strong> Use profiling tools to identify and address performance bottlenecks.</li>
</ul>
<h3 id="conclusion_4">Conclusion</h3>
<p>Multithreading in C++ provides powerful capabilities to improve performance and responsiveness. By understanding and utilizing the various tools and techniques, you can effectively manage concurrency and parallelism in your applications. Whether you're working on a simple multithreaded task or implementing complex synchronization mechanisms, the C++ Standard Library offers comprehensive support to help you achieve your goals.</p>
<p>A job system is an essential component in game engines to handle concurrency and parallelism. It efficiently distributes tasks (jobs) across multiple threads, maximizing CPU usage and improving performance. Below is a professional implementation of a basic job system in C++:</p>
<h2 id="job-system-design">Job System Design</h2>
<ol>
<li><strong>Job</strong>: Represents a unit of work.</li>
<li><strong>JobQueue</strong>: Manages the queue of pending jobs.</li>
<li><strong>WorkerThread</strong>: Worker threads that pull jobs from the queue and execute them.</li>
<li><strong>JobSystem</strong>: Manages the job queue and worker threads.</li>
</ol>
<h3 id="jobh">Job.h</h3>
<div class="highlight"><pre><span></span><code><a id="__codelineno-111-1" name="__codelineno-111-1" href="#__codelineno-111-1"></a><span class="cp">#ifndef JOB_H</span>
<a id="__codelineno-111-2" name="__codelineno-111-2" href="#__codelineno-111-2"></a><span class="cp">#define JOB_H</span>
<a id="__codelineno-111-3" name="__codelineno-111-3" href="#__codelineno-111-3"></a>
<a id="__codelineno-111-4" name="__codelineno-111-4" href="#__codelineno-111-4"></a><span class="cp">#include</span><span class="w"> </span><span class="cpf">&lt;functional&gt;</span>
<a id="__codelineno-111-5" name="__codelineno-111-5" href="#__codelineno-111-5"></a>
<a id="__codelineno-111-6" name="__codelineno-111-6" href="#__codelineno-111-6"></a><span class="k">class</span><span class="w"> </span><span class="nc">Job</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-111-7" name="__codelineno-111-7" href="#__codelineno-111-7"></a><span class="k">public</span><span class="o">:</span>
<a id="__codelineno-111-8" name="__codelineno-111-8" href="#__codelineno-111-8"></a><span class="w">    </span><span class="k">using</span><span class="w"> </span><span class="n">JobFunction</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">std</span><span class="o">::</span><span class="n">function</span><span class="o">&lt;</span><span class="kt">void</span><span class="p">()</span><span class="o">&gt;</span><span class="p">;</span>
<a id="__codelineno-111-9" name="__codelineno-111-9" href="#__codelineno-111-9"></a>
<a id="__codelineno-111-10" name="__codelineno-111-10" href="#__codelineno-111-10"></a><span class="w">    </span><span class="n">Job</span><span class="p">(</span><span class="n">JobFunction</span><span class="w"> </span><span class="n">func</span><span class="p">)</span><span class="w"> </span><span class="o">:</span><span class="w"> </span><span class="n">function</span><span class="p">(</span><span class="n">func</span><span class="p">)</span><span class="w"> </span><span class="p">{}</span>
<a id="__codelineno-111-11" name="__codelineno-111-11" href="#__codelineno-111-11"></a>
<a id="__codelineno-111-12" name="__codelineno-111-12" href="#__codelineno-111-12"></a><span class="w">    </span><span class="kt">void</span><span class="w"> </span><span class="n">Execute</span><span class="p">()</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-111-13" name="__codelineno-111-13" href="#__codelineno-111-13"></a><span class="w">        </span><span class="n">function</span><span class="p">();</span>
<a id="__codelineno-111-14" name="__codelineno-111-14" href="#__codelineno-111-14"></a><span class="w">    </span><span class="p">}</span>
<a id="__codelineno-111-15" name="__codelineno-111-15" href="#__codelineno-111-15"></a>
<a id="__codelineno-111-16" name="__codelineno-111-16" href="#__codelineno-111-16"></a><span class="k">private</span><span class="o">:</span>
<a id="__codelineno-111-17" name="__codelineno-111-17" href="#__codelineno-111-17"></a><span class="w">    </span><span class="n">JobFunction</span><span class="w"> </span><span class="n">function</span><span class="p">;</span>
<a id="__codelineno-111-18" name="__codelineno-111-18" href="#__codelineno-111-18"></a><span class="p">};</span>
<a id="__codelineno-111-19" name="__codelineno-111-19" href="#__codelineno-111-19"></a>
<a id="__codelineno-111-20" name="__codelineno-111-20" href="#__codelineno-111-20"></a><span class="cp">#endif </span><span class="c1">// JOB_H</span>
</code></pre></div>
<h3 id="jobqueueh">JobQueue.h</h3>
<div class="highlight"><pre><span></span><code><a id="__codelineno-112-1" name="__codelineno-112-1" href="#__codelineno-112-1"></a><span class="cp">#ifndef JOBQUEUE_H</span>
<a id="__codelineno-112-2" name="__codelineno-112-2" href="#__codelineno-112-2"></a><span class="cp">#define JOBQUEUE_H</span>
<a id="__codelineno-112-3" name="__codelineno-112-3" href="#__codelineno-112-3"></a>
<a id="__codelineno-112-4" name="__codelineno-112-4" href="#__codelineno-112-4"></a><span class="cp">#include</span><span class="w"> </span><span class="cpf">&lt;queue&gt;</span>
<a id="__codelineno-112-5" name="__codelineno-112-5" href="#__codelineno-112-5"></a><span class="cp">#include</span><span class="w"> </span><span class="cpf">&lt;mutex&gt;</span>
<a id="__codelineno-112-6" name="__codelineno-112-6" href="#__codelineno-112-6"></a><span class="cp">#include</span><span class="w"> </span><span class="cpf">&lt;condition_variable&gt;</span>
<a id="__codelineno-112-7" name="__codelineno-112-7" href="#__codelineno-112-7"></a><span class="cp">#include</span><span class="w"> </span><span class="cpf">&quot;Job.h&quot;</span>
<a id="__codelineno-112-8" name="__codelineno-112-8" href="#__codelineno-112-8"></a>
<a id="__codelineno-112-9" name="__codelineno-112-9" href="#__codelineno-112-9"></a><span class="k">class</span><span class="w"> </span><span class="nc">JobQueue</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-112-10" name="__codelineno-112-10" href="#__codelineno-112-10"></a><span class="k">public</span><span class="o">:</span>
<a id="__codelineno-112-11" name="__codelineno-112-11" href="#__codelineno-112-11"></a><span class="w">    </span><span class="kt">void</span><span class="w"> </span><span class="n">Push</span><span class="p">(</span><span class="n">Job</span><span class="w"> </span><span class="n">job</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-112-12" name="__codelineno-112-12" href="#__codelineno-112-12"></a><span class="w">        </span><span class="n">std</span><span class="o">::</span><span class="n">unique_lock</span><span class="o">&lt;</span><span class="n">std</span><span class="o">::</span><span class="n">mutex</span><span class="o">&gt;</span><span class="w"> </span><span class="n">lock</span><span class="p">(</span><span class="n">mutex</span><span class="p">);</span>
<a id="__codelineno-112-13" name="__codelineno-112-13" href="#__codelineno-112-13"></a><span class="w">        </span><span class="n">jobs</span><span class="p">.</span><span class="n">push</span><span class="p">(</span><span class="n">std</span><span class="o">::</span><span class="n">move</span><span class="p">(</span><span class="n">job</span><span class="p">));</span>
<a id="__codelineno-112-14" name="__codelineno-112-14" href="#__codelineno-112-14"></a><span class="w">        </span><span class="n">condition</span><span class="p">.</span><span class="n">notify_one</span><span class="p">();</span>
<a id="__codelineno-112-15" name="__codelineno-112-15" href="#__codelineno-112-15"></a><span class="w">    </span><span class="p">}</span>
<a id="__codelineno-112-16" name="__codelineno-112-16" href="#__codelineno-112-16"></a>
<a id="__codelineno-112-17" name="__codelineno-112-17" href="#__codelineno-112-17"></a><span class="w">    </span><span class="kt">bool</span><span class="w"> </span><span class="n">Pop</span><span class="p">(</span><span class="n">Job</span><span class="o">&amp;</span><span class="w"> </span><span class="n">job</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-112-18" name="__codelineno-112-18" href="#__codelineno-112-18"></a><span class="w">        </span><span class="n">std</span><span class="o">::</span><span class="n">unique_lock</span><span class="o">&lt;</span><span class="n">std</span><span class="o">::</span><span class="n">mutex</span><span class="o">&gt;</span><span class="w"> </span><span class="n">lock</span><span class="p">(</span><span class="n">mutex</span><span class="p">);</span>
<a id="__codelineno-112-19" name="__codelineno-112-19" href="#__codelineno-112-19"></a><span class="w">        </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">jobs</span><span class="p">.</span><span class="n">empty</span><span class="p">())</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-112-20" name="__codelineno-112-20" href="#__codelineno-112-20"></a><span class="w">            </span><span class="k">return</span><span class="w"> </span><span class="nb">false</span><span class="p">;</span>
<a id="__codelineno-112-21" name="__codelineno-112-21" href="#__codelineno-112-21"></a><span class="w">        </span><span class="p">}</span>
<a id="__codelineno-112-22" name="__codelineno-112-22" href="#__codelineno-112-22"></a><span class="w">        </span><span class="n">job</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">std</span><span class="o">::</span><span class="n">move</span><span class="p">(</span><span class="n">jobs</span><span class="p">.</span><span class="n">front</span><span class="p">());</span>
<a id="__codelineno-112-23" name="__codelineno-112-23" href="#__codelineno-112-23"></a><span class="w">        </span><span class="n">jobs</span><span class="p">.</span><span class="n">pop</span><span class="p">();</span>
<a id="__codelineno-112-24" name="__codelineno-112-24" href="#__codelineno-112-24"></a><span class="w">        </span><span class="k">return</span><span class="w"> </span><span class="nb">true</span><span class="p">;</span>
<a id="__codelineno-112-25" name="__codelineno-112-25" href="#__codelineno-112-25"></a><span class="w">    </span><span class="p">}</span>
<a id="__codelineno-112-26" name="__codelineno-112-26" href="#__codelineno-112-26"></a>
<a id="__codelineno-112-27" name="__codelineno-112-27" href="#__codelineno-112-27"></a><span class="w">    </span><span class="kt">void</span><span class="w"> </span><span class="n">WaitAndPop</span><span class="p">(</span><span class="n">Job</span><span class="o">&amp;</span><span class="w"> </span><span class="n">job</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-112-28" name="__codelineno-112-28" href="#__codelineno-112-28"></a><span class="w">        </span><span class="n">std</span><span class="o">::</span><span class="n">unique_lock</span><span class="o">&lt;</span><span class="n">std</span><span class="o">::</span><span class="n">mutex</span><span class="o">&gt;</span><span class="w"> </span><span class="n">lock</span><span class="p">(</span><span class="n">mutex</span><span class="p">);</span>
<a id="__codelineno-112-29" name="__codelineno-112-29" href="#__codelineno-112-29"></a><span class="w">        </span><span class="n">condition</span><span class="p">.</span><span class="n">wait</span><span class="p">(</span><span class="n">lock</span><span class="p">,</span><span class="w"> </span><span class="p">[</span><span class="k">this</span><span class="p">]</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="k">return</span><span class="w"> </span><span class="o">!</span><span class="n">jobs</span><span class="p">.</span><span class="n">empty</span><span class="p">();</span><span class="w"> </span><span class="p">});</span>
<a id="__codelineno-112-30" name="__codelineno-112-30" href="#__codelineno-112-30"></a><span class="w">        </span><span class="n">job</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">std</span><span class="o">::</span><span class="n">move</span><span class="p">(</span><span class="n">jobs</span><span class="p">.</span><span class="n">front</span><span class="p">());</span>
<a id="__codelineno-112-31" name="__codelineno-112-31" href="#__codelineno-112-31"></a><span class="w">        </span><span class="n">jobs</span><span class="p">.</span><span class="n">pop</span><span class="p">();</span>
<a id="__codelineno-112-32" name="__codelineno-112-32" href="#__codelineno-112-32"></a><span class="w">    </span><span class="p">}</span>
<a id="__codelineno-112-33" name="__codelineno-112-33" href="#__codelineno-112-33"></a>
<a id="__codelineno-112-34" name="__codelineno-112-34" href="#__codelineno-112-34"></a><span class="k">private</span><span class="o">:</span>
<a id="__codelineno-112-35" name="__codelineno-112-35" href="#__codelineno-112-35"></a><span class="w">    </span><span class="n">std</span><span class="o">::</span><span class="n">queue</span><span class="o">&lt;</span><span class="n">Job</span><span class="o">&gt;</span><span class="w"> </span><span class="n">jobs</span><span class="p">;</span>
<a id="__codelineno-112-36" name="__codelineno-112-36" href="#__codelineno-112-36"></a><span class="w">    </span><span class="n">std</span><span class="o">::</span><span class="n">mutex</span><span class="w"> </span><span class="n">mutex</span><span class="p">;</span>
<a id="__codelineno-112-37" name="__codelineno-112-37" href="#__codelineno-112-37"></a><span class="w">    </span><span class="n">std</span><span class="o">::</span><span class="n">condition_variable</span><span class="w"> </span><span class="n">condition</span><span class="p">;</span>
<a id="__codelineno-112-38" name="__codelineno-112-38" href="#__codelineno-112-38"></a><span class="p">};</span>
<a id="__codelineno-112-39" name="__codelineno-112-39" href="#__codelineno-112-39"></a>
<a id="__codelineno-112-40" name="__codelineno-112-40" href="#__codelineno-112-40"></a><span class="cp">#endif </span><span class="c1">// JOBQUEUE_H</span>
</code></pre></div>
<h3 id="workerthreadh">WorkerThread.h</h3>
<div class="highlight"><pre><span></span><code><a id="__codelineno-113-1" name="__codelineno-113-1" href="#__codelineno-113-1"></a><span class="cp">#ifndef WORKERTHREAD_H</span>
<a id="__codelineno-113-2" name="__codelineno-113-2" href="#__codelineno-113-2"></a><span class="cp">#define WORKERTHREAD_H</span>
<a id="__codelineno-113-3" name="__codelineno-113-3" href="#__codelineno-113-3"></a>
<a id="__codelineno-113-4" name="__codelineno-113-4" href="#__codelineno-113-4"></a><span class="cp">#include</span><span class="w"> </span><span class="cpf">&lt;thread&gt;</span>
<a id="__codelineno-113-5" name="__codelineno-113-5" href="#__codelineno-113-5"></a><span class="cp">#include</span><span class="w"> </span><span class="cpf">&lt;atomic&gt;</span>
<a id="__codelineno-113-6" name="__codelineno-113-6" href="#__codelineno-113-6"></a><span class="cp">#include</span><span class="w"> </span><span class="cpf">&quot;JobQueue.h&quot;</span>
<a id="__codelineno-113-7" name="__codelineno-113-7" href="#__codelineno-113-7"></a>
<a id="__codelineno-113-8" name="__codelineno-113-8" href="#__codelineno-113-8"></a><span class="k">class</span><span class="w"> </span><span class="nc">WorkerThread</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-113-9" name="__codelineno-113-9" href="#__codelineno-113-9"></a><span class="k">public</span><span class="o">:</span>
<a id="__codelineno-113-10" name="__codelineno-113-10" href="#__codelineno-113-10"></a><span class="w">    </span><span class="n">WorkerThread</span><span class="p">(</span><span class="n">JobQueue</span><span class="o">&amp;</span><span class="w"> </span><span class="n">queue</span><span class="p">)</span><span class="w"> </span><span class="o">:</span><span class="w"> </span><span class="n">jobQueue</span><span class="p">(</span><span class="n">queue</span><span class="p">),</span><span class="w"> </span><span class="n">stopFlag</span><span class="p">(</span><span class="nb">false</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-113-11" name="__codelineno-113-11" href="#__codelineno-113-11"></a><span class="w">        </span><span class="kr">thread</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">std</span><span class="o">::</span><span class="kr">thread</span><span class="p">(</span><span class="o">&amp;</span><span class="n">WorkerThread</span><span class="o">::</span><span class="n">Run</span><span class="p">,</span><span class="w"> </span><span class="k">this</span><span class="p">);</span>
<a id="__codelineno-113-12" name="__codelineno-113-12" href="#__codelineno-113-12"></a><span class="w">    </span><span class="p">}</span>
<a id="__codelineno-113-13" name="__codelineno-113-13" href="#__codelineno-113-13"></a>
<a id="__codelineno-113-14" name="__codelineno-113-14" href="#__codelineno-113-14"></a><span class="w">    </span><span class="o">~</span><span class="n">WorkerThread</span><span class="p">()</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-113-15" name="__codelineno-113-15" href="#__codelineno-113-15"></a><span class="w">        </span><span class="n">stopFlag</span><span class="p">.</span><span class="n">store</span><span class="p">(</span><span class="nb">true</span><span class="p">);</span>
<a id="__codelineno-113-16" name="__codelineno-113-16" href="#__codelineno-113-16"></a><span class="w">        </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="kr">thread</span><span class="p">.</span><span class="n">joinable</span><span class="p">())</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-113-17" name="__codelineno-113-17" href="#__codelineno-113-17"></a><span class="w">            </span><span class="kr">thread</span><span class="p">.</span><span class="n">join</span><span class="p">();</span>
<a id="__codelineno-113-18" name="__codelineno-113-18" href="#__codelineno-113-18"></a><span class="w">        </span><span class="p">}</span>
<a id="__codelineno-113-19" name="__codelineno-113-19" href="#__codelineno-113-19"></a><span class="w">    </span><span class="p">}</span>
<a id="__codelineno-113-20" name="__codelineno-113-20" href="#__codelineno-113-20"></a>
<a id="__codelineno-113-21" name="__codelineno-113-21" href="#__codelineno-113-21"></a><span class="w">    </span><span class="kt">void</span><span class="w"> </span><span class="n">Run</span><span class="p">()</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-113-22" name="__codelineno-113-22" href="#__codelineno-113-22"></a><span class="w">        </span><span class="k">while</span><span class="w"> </span><span class="p">(</span><span class="o">!</span><span class="n">stopFlag</span><span class="p">.</span><span class="n">load</span><span class="p">())</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-113-23" name="__codelineno-113-23" href="#__codelineno-113-23"></a><span class="w">            </span><span class="n">Job</span><span class="w"> </span><span class="n">job</span><span class="p">;</span>
<a id="__codelineno-113-24" name="__codelineno-113-24" href="#__codelineno-113-24"></a><span class="w">            </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">jobQueue</span><span class="p">.</span><span class="n">Pop</span><span class="p">(</span><span class="n">job</span><span class="p">))</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-113-25" name="__codelineno-113-25" href="#__codelineno-113-25"></a><span class="w">                </span><span class="n">job</span><span class="p">.</span><span class="n">Execute</span><span class="p">();</span>
<a id="__codelineno-113-26" name="__codelineno-113-26" href="#__codelineno-113-26"></a><span class="w">            </span><span class="p">}</span><span class="w"> </span><span class="k">else</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-113-27" name="__codelineno-113-27" href="#__codelineno-113-27"></a><span class="w">                </span><span class="n">std</span><span class="o">::</span><span class="n">this_thread</span><span class="o">::</span><span class="n">yield</span><span class="p">();</span>
<a id="__codelineno-113-28" name="__codelineno-113-28" href="#__codelineno-113-28"></a><span class="w">            </span><span class="p">}</span>
<a id="__codelineno-113-29" name="__codelineno-113-29" href="#__codelineno-113-29"></a><span class="w">        </span><span class="p">}</span>
<a id="__codelineno-113-30" name="__codelineno-113-30" href="#__codelineno-113-30"></a><span class="w">    </span><span class="p">}</span>
<a id="__codelineno-113-31" name="__codelineno-113-31" href="#__codelineno-113-31"></a>
<a id="__codelineno-113-32" name="__codelineno-113-32" href="#__codelineno-113-32"></a><span class="k">private</span><span class="o">:</span>
<a id="__codelineno-113-33" name="__codelineno-113-33" href="#__codelineno-113-33"></a><span class="w">    </span><span class="n">JobQueue</span><span class="o">&amp;</span><span class="w"> </span><span class="n">jobQueue</span><span class="p">;</span>
<a id="__codelineno-113-34" name="__codelineno-113-34" href="#__codelineno-113-34"></a><span class="w">    </span><span class="n">std</span><span class="o">::</span><span class="kr">thread</span><span class="w"> </span><span class="kr">thread</span><span class="p">;</span>
<a id="__codelineno-113-35" name="__codelineno-113-35" href="#__codelineno-113-35"></a><span class="w">    </span><span class="n">std</span><span class="o">::</span><span class="n">atomic</span><span class="o">&lt;</span><span class="kt">bool</span><span class="o">&gt;</span><span class="w"> </span><span class="n">stopFlag</span><span class="p">;</span>
<a id="__codelineno-113-36" name="__codelineno-113-36" href="#__codelineno-113-36"></a><span class="p">};</span>
<a id="__codelineno-113-37" name="__codelineno-113-37" href="#__codelineno-113-37"></a>
<a id="__codelineno-113-38" name="__codelineno-113-38" href="#__codelineno-113-38"></a><span class="cp">#endif </span><span class="c1">// WORKERTHREAD_H</span>
</code></pre></div>
<h3 id="jobsystemh">JobSystem.h</h3>
<div class="highlight"><pre><span></span><code><a id="__codelineno-114-1" name="__codelineno-114-1" href="#__codelineno-114-1"></a><span class="cp">#ifndef JOBSYSTEM_H</span>
<a id="__codelineno-114-2" name="__codelineno-114-2" href="#__codelineno-114-2"></a><span class="cp">#define JOBSYSTEM_H</span>
<a id="__codelineno-114-3" name="__codelineno-114-3" href="#__codelineno-114-3"></a>
<a id="__codelineno-114-4" name="__codelineno-114-4" href="#__codelineno-114-4"></a><span class="cp">#include</span><span class="w"> </span><span class="cpf">&lt;vector&gt;</span>
<a id="__codelineno-114-5" name="__codelineno-114-5" href="#__codelineno-114-5"></a><span class="cp">#include</span><span class="w"> </span><span class="cpf">&quot;JobQueue.h&quot;</span>
<a id="__codelineno-114-6" name="__codelineno-114-6" href="#__codelineno-114-6"></a><span class="cp">#include</span><span class="w"> </span><span class="cpf">&quot;WorkerThread.h&quot;</span>
<a id="__codelineno-114-7" name="__codelineno-114-7" href="#__codelineno-114-7"></a>
<a id="__codelineno-114-8" name="__codelineno-114-8" href="#__codelineno-114-8"></a><span class="k">class</span><span class="w"> </span><span class="nc">JobSystem</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-114-9" name="__codelineno-114-9" href="#__codelineno-114-9"></a><span class="k">public</span><span class="o">:</span>
<a id="__codelineno-114-10" name="__codelineno-114-10" href="#__codelineno-114-10"></a><span class="w">    </span><span class="n">JobSystem</span><span class="p">(</span><span class="kt">size_t</span><span class="w"> </span><span class="n">numThreads</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-114-11" name="__codelineno-114-11" href="#__codelineno-114-11"></a><span class="w">        </span><span class="k">for</span><span class="w"> </span><span class="p">(</span><span class="kt">size_t</span><span class="w"> </span><span class="n">i</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">0</span><span class="p">;</span><span class="w"> </span><span class="n">i</span><span class="w"> </span><span class="o">&lt;</span><span class="w"> </span><span class="n">numThreads</span><span class="p">;</span><span class="w"> </span><span class="o">++</span><span class="n">i</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-114-12" name="__codelineno-114-12" href="#__codelineno-114-12"></a><span class="w">            </span><span class="n">workers</span><span class="p">.</span><span class="n">emplace_back</span><span class="p">(</span><span class="n">std</span><span class="o">::</span><span class="n">make_unique</span><span class="o">&lt;</span><span class="n">WorkerThread</span><span class="o">&gt;</span><span class="p">(</span><span class="n">jobQueue</span><span class="p">));</span>
<a id="__codelineno-114-13" name="__codelineno-114-13" href="#__codelineno-114-13"></a><span class="w">        </span><span class="p">}</span>
<a id="__codelineno-114-14" name="__codelineno-114-14" href="#__codelineno-114-14"></a><span class="w">    </span><span class="p">}</span>
<a id="__codelineno-114-15" name="__codelineno-114-15" href="#__codelineno-114-15"></a>
<a id="__codelineno-114-16" name="__codelineno-114-16" href="#__codelineno-114-16"></a><span class="w">    </span><span class="kt">void</span><span class="w"> </span><span class="n">Submit</span><span class="p">(</span><span class="n">Job</span><span class="w"> </span><span class="n">job</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-114-17" name="__codelineno-114-17" href="#__codelineno-114-17"></a><span class="w">        </span><span class="n">jobQueue</span><span class="p">.</span><span class="n">Push</span><span class="p">(</span><span class="n">std</span><span class="o">::</span><span class="n">move</span><span class="p">(</span><span class="n">job</span><span class="p">));</span>
<a id="__codelineno-114-18" name="__codelineno-114-18" href="#__codelineno-114-18"></a><span class="w">    </span><span class="p">}</span>
<a id="__codelineno-114-19" name="__codelineno-114-19" href="#__codelineno-114-19"></a>
<a id="__codelineno-114-20" name="__codelineno-114-20" href="#__codelineno-114-20"></a><span class="k">private</span><span class="o">:</span>
<a id="__codelineno-114-21" name="__codelineno-114-21" href="#__codelineno-114-21"></a><span class="w">    </span><span class="n">JobQueue</span><span class="w"> </span><span class="n">jobQueue</span><span class="p">;</span>
<a id="__codelineno-114-22" name="__codelineno-114-22" href="#__codelineno-114-22"></a><span class="w">    </span><span class="n">std</span><span class="o">::</span><span class="n">vector</span><span class="o">&lt;</span><span class="n">std</span><span class="o">::</span><span class="n">unique_ptr</span><span class="o">&lt;</span><span class="n">WorkerThread</span><span class="o">&gt;&gt;</span><span class="w"> </span><span class="n">workers</span><span class="p">;</span>
<a id="__codelineno-114-23" name="__codelineno-114-23" href="#__codelineno-114-23"></a><span class="p">};</span>
<a id="__codelineno-114-24" name="__codelineno-114-24" href="#__codelineno-114-24"></a>
<a id="__codelineno-114-25" name="__codelineno-114-25" href="#__codelineno-114-25"></a><span class="cp">#endif </span><span class="c1">// JOBSYSTEM_H</span>
</code></pre></div>
<h3 id="maincpp">Main.cpp</h3>
<div class="highlight"><pre><span></span><code><a id="__codelineno-115-1" name="__codelineno-115-1" href="#__codelineno-115-1"></a><span class="cp">#include</span><span class="w"> </span><span class="cpf">&lt;iostream&gt;</span>
<a id="__codelineno-115-2" name="__codelineno-115-2" href="#__codelineno-115-2"></a><span class="cp">#include</span><span class="w"> </span><span class="cpf">&quot;JobSystem.h&quot;</span>
<a id="__codelineno-115-3" name="__codelineno-115-3" href="#__codelineno-115-3"></a>
<a id="__codelineno-115-4" name="__codelineno-115-4" href="#__codelineno-115-4"></a><span class="kt">void</span><span class="w"> </span><span class="nf">TestJobFunction</span><span class="p">()</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-115-5" name="__codelineno-115-5" href="#__codelineno-115-5"></a><span class="w">    </span><span class="n">std</span><span class="o">::</span><span class="n">cout</span><span class="w"> </span><span class="o">&lt;&lt;</span><span class="w"> </span><span class="s">&quot;Job executed by thread &quot;</span><span class="w"> </span><span class="o">&lt;&lt;</span><span class="w"> </span><span class="n">std</span><span class="o">::</span><span class="n">this_thread</span><span class="o">::</span><span class="n">get_id</span><span class="p">()</span><span class="w"> </span><span class="o">&lt;&lt;</span><span class="w"> </span><span class="n">std</span><span class="o">::</span><span class="n">endl</span><span class="p">;</span>
<a id="__codelineno-115-6" name="__codelineno-115-6" href="#__codelineno-115-6"></a><span class="p">}</span>
<a id="__codelineno-115-7" name="__codelineno-115-7" href="#__codelineno-115-7"></a>
<a id="__codelineno-115-8" name="__codelineno-115-8" href="#__codelineno-115-8"></a><span class="kt">int</span><span class="w"> </span><span class="nf">main</span><span class="p">()</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-115-9" name="__codelineno-115-9" href="#__codelineno-115-9"></a><span class="w">    </span><span class="k">const</span><span class="w"> </span><span class="kt">size_t</span><span class="w"> </span><span class="n">numThreads</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">std</span><span class="o">::</span><span class="kr">thread</span><span class="o">::</span><span class="n">hardware_concurrency</span><span class="p">();</span>
<a id="__codelineno-115-10" name="__codelineno-115-10" href="#__codelineno-115-10"></a><span class="w">    </span><span class="n">JobSystem</span><span class="w"> </span><span class="n">jobSystem</span><span class="p">(</span><span class="n">numThreads</span><span class="p">);</span>
<a id="__codelineno-115-11" name="__codelineno-115-11" href="#__codelineno-115-11"></a>
<a id="__codelineno-115-12" name="__codelineno-115-12" href="#__codelineno-115-12"></a><span class="w">    </span><span class="k">for</span><span class="w"> </span><span class="p">(</span><span class="kt">int</span><span class="w"> </span><span class="n">i</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">0</span><span class="p">;</span><span class="w"> </span><span class="n">i</span><span class="w"> </span><span class="o">&lt;</span><span class="w"> </span><span class="mi">10</span><span class="p">;</span><span class="w"> </span><span class="o">++</span><span class="n">i</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-115-13" name="__codelineno-115-13" href="#__codelineno-115-13"></a><span class="w">        </span><span class="n">jobSystem</span><span class="p">.</span><span class="n">Submit</span><span class="p">(</span><span class="n">Job</span><span class="p">(</span><span class="n">TestJobFunction</span><span class="p">));</span>
<a id="__codelineno-115-14" name="__codelineno-115-14" href="#__codelineno-115-14"></a><span class="w">    </span><span class="p">}</span>
<a id="__codelineno-115-15" name="__codelineno-115-15" href="#__codelineno-115-15"></a>
<a id="__codelineno-115-16" name="__codelineno-115-16" href="#__codelineno-115-16"></a><span class="w">    </span><span class="n">std</span><span class="o">::</span><span class="n">this_thread</span><span class="o">::</span><span class="n">sleep_for</span><span class="p">(</span><span class="n">std</span><span class="o">::</span><span class="n">chrono</span><span class="o">::</span><span class="n">seconds</span><span class="p">(</span><span class="mi">2</span><span class="p">));</span><span class="w"> </span><span class="c1">// Allow time for jobs to complete</span>
<a id="__codelineno-115-17" name="__codelineno-115-17" href="#__codelineno-115-17"></a><span class="w">    </span><span class="k">return</span><span class="w"> </span><span class="mi">0</span><span class="p">;</span>
<a id="__codelineno-115-18" name="__codelineno-115-18" href="#__codelineno-115-18"></a><span class="p">}</span>
</code></pre></div>
<h3 id="explanation_2">Explanation</h3>
<ol>
<li><strong>Job.h</strong>: Defines a <code>Job</code> class that encapsulates a <code>std::function&lt;void()&gt;</code> to represent the task.</li>
<li><strong>JobQueue.h</strong>: Implements a thread-safe job queue using <code>std::queue</code>, <code>std::mutex</code>, and <code>std::condition_variable</code>.</li>
<li><strong>WorkerThread.h</strong>: Implements a worker thread that continuously pulls jobs from the <code>JobQueue</code> and executes them.</li>
<li><strong>JobSystem.h</strong>: Manages a pool of worker threads and the job queue, providing a method to submit jobs to the system.</li>
<li><strong>Main.cpp</strong>: Demonstrates the use of the job system by submitting several test jobs and allowing them to be processed by the worker threads.</li>
</ol>
<p>This implementation ensures that jobs are executed concurrently by multiple worker threads, improving the efficiency and performance of the system. Adjustments and enhancements can be made based on specific needs and use cases.</p>
<h2 id="improved-jobsystem">Improved JobSystem</h2>
<h3 id="key-features">Key Features</h3>
<ol>
<li><strong>Job Dependencies</strong>: Allow jobs to depend on the completion of other jobs.</li>
<li><strong>Job Prioritization</strong>: Support for prioritizing certain jobs over others.</li>
<li><strong>Work-Stealing</strong>: Improve load balancing across threads.</li>
<li><strong>Custom Allocator</strong>: Efficient memory management for job allocation.</li>
<li><strong>Thread Affinity</strong>: Option to pin jobs to specific threads.</li>
<li><strong>Job Groups</strong>: Group jobs for batch submission and synchronization.</li>
</ol>
<h3 id="enhanced-design">Enhanced Design</h3>
<ol>
<li><strong>Job</strong>: Represents a unit of work with dependencies and priority.</li>
<li><strong>JobQueue</strong>: Manages the queue of pending jobs with prioritization.</li>
<li><strong>WorkerThread</strong>: Worker threads that pull jobs from the queue and execute them, supporting work-stealing.</li>
<li><strong>JobSystem</strong>: Manages job queues and worker threads.</li>
</ol>
<h3 id="jobh_1">Job.h</h3>
<div class="highlight"><pre><span></span><code><a id="__codelineno-116-1" name="__codelineno-116-1" href="#__codelineno-116-1"></a><span class="cp">#ifndef JOB_H</span>
<a id="__codelineno-116-2" name="__codelineno-116-2" href="#__codelineno-116-2"></a><span class="cp">#define JOB_H</span>
<a id="__codelineno-116-3" name="__codelineno-116-3" href="#__codelineno-116-3"></a>
<a id="__codelineno-116-4" name="__codelineno-116-4" href="#__codelineno-116-4"></a><span class="cp">#include</span><span class="w"> </span><span class="cpf">&lt;functional&gt;</span>
<a id="__codelineno-116-5" name="__codelineno-116-5" href="#__codelineno-116-5"></a><span class="cp">#include</span><span class="w"> </span><span class="cpf">&lt;atomic&gt;</span>
<a id="__codelineno-116-6" name="__codelineno-116-6" href="#__codelineno-116-6"></a><span class="cp">#include</span><span class="w"> </span><span class="cpf">&lt;vector&gt;</span>
<a id="__codelineno-116-7" name="__codelineno-116-7" href="#__codelineno-116-7"></a>
<a id="__codelineno-116-8" name="__codelineno-116-8" href="#__codelineno-116-8"></a><span class="k">class</span><span class="w"> </span><span class="nc">Job</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-116-9" name="__codelineno-116-9" href="#__codelineno-116-9"></a><span class="k">public</span><span class="o">:</span>
<a id="__codelineno-116-10" name="__codelineno-116-10" href="#__codelineno-116-10"></a><span class="w">    </span><span class="k">using</span><span class="w"> </span><span class="n">JobFunction</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">std</span><span class="o">::</span><span class="n">function</span><span class="o">&lt;</span><span class="kt">void</span><span class="p">()</span><span class="o">&gt;</span><span class="p">;</span>
<a id="__codelineno-116-11" name="__codelineno-116-11" href="#__codelineno-116-11"></a>
<a id="__codelineno-116-12" name="__codelineno-116-12" href="#__codelineno-116-12"></a><span class="w">    </span><span class="n">Job</span><span class="p">(</span><span class="n">JobFunction</span><span class="w"> </span><span class="n">func</span><span class="p">,</span><span class="w"> </span><span class="kt">int</span><span class="w"> </span><span class="n">priority</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">0</span><span class="p">)</span>
<a id="__codelineno-116-13" name="__codelineno-116-13" href="#__codelineno-116-13"></a><span class="w">        </span><span class="o">:</span><span class="w"> </span><span class="n">function</span><span class="p">(</span><span class="n">func</span><span class="p">),</span><span class="w"> </span><span class="n">priority</span><span class="p">(</span><span class="n">priority</span><span class="p">),</span><span class="w"> </span><span class="n">unfinishedJobs</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span><span class="w"> </span><span class="p">{}</span>
<a id="__codelineno-116-14" name="__codelineno-116-14" href="#__codelineno-116-14"></a>
<a id="__codelineno-116-15" name="__codelineno-116-15" href="#__codelineno-116-15"></a><span class="w">    </span><span class="kt">void</span><span class="w"> </span><span class="n">Execute</span><span class="p">()</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-116-16" name="__codelineno-116-16" href="#__codelineno-116-16"></a><span class="w">        </span><span class="n">function</span><span class="p">();</span>
<a id="__codelineno-116-17" name="__codelineno-116-17" href="#__codelineno-116-17"></a><span class="w">        </span><span class="n">Finish</span><span class="p">();</span>
<a id="__codelineno-116-18" name="__codelineno-116-18" href="#__codelineno-116-18"></a><span class="w">    </span><span class="p">}</span>
<a id="__codelineno-116-19" name="__codelineno-116-19" href="#__codelineno-116-19"></a>
<a id="__codelineno-116-20" name="__codelineno-116-20" href="#__codelineno-116-20"></a><span class="w">    </span><span class="kt">void</span><span class="w"> </span><span class="n">AddDependency</span><span class="p">(</span><span class="n">Job</span><span class="o">*</span><span class="w"> </span><span class="n">dependency</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-116-21" name="__codelineno-116-21" href="#__codelineno-116-21"></a><span class="w">        </span><span class="n">dependency</span><span class="o">-&gt;</span><span class="n">unfinishedJobs</span><span class="p">.</span><span class="n">fetch_add</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span><span class="w"> </span><span class="n">std</span><span class="o">::</span><span class="n">memory_order_relaxed</span><span class="p">);</span>
<a id="__codelineno-116-22" name="__codelineno-116-22" href="#__codelineno-116-22"></a><span class="w">        </span><span class="n">dependencies</span><span class="p">.</span><span class="n">push_back</span><span class="p">(</span><span class="n">dependency</span><span class="p">);</span>
<a id="__codelineno-116-23" name="__codelineno-116-23" href="#__codelineno-116-23"></a><span class="w">    </span><span class="p">}</span>
<a id="__codelineno-116-24" name="__codelineno-116-24" href="#__codelineno-116-24"></a>
<a id="__codelineno-116-25" name="__codelineno-116-25" href="#__codelineno-116-25"></a><span class="w">    </span><span class="kt">void</span><span class="w"> </span><span class="n">Finish</span><span class="p">()</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-116-26" name="__codelineno-116-26" href="#__codelineno-116-26"></a><span class="w">        </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">unfinishedJobs</span><span class="p">.</span><span class="n">fetch_sub</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span><span class="w"> </span><span class="n">std</span><span class="o">::</span><span class="n">memory_order_acq_rel</span><span class="p">)</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="mi">1</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-116-27" name="__codelineno-116-27" href="#__codelineno-116-27"></a><span class="w">            </span><span class="k">for</span><span class="w"> </span><span class="p">(</span><span class="k">auto</span><span class="w"> </span><span class="n">dep</span><span class="w"> </span><span class="o">:</span><span class="w"> </span><span class="n">dependencies</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-116-28" name="__codelineno-116-28" href="#__codelineno-116-28"></a><span class="w">                </span><span class="n">dep</span><span class="o">-&gt;</span><span class="n">Finish</span><span class="p">();</span>
<a id="__codelineno-116-29" name="__codelineno-116-29" href="#__codelineno-116-29"></a><span class="w">            </span><span class="p">}</span>
<a id="__codelineno-116-30" name="__codelineno-116-30" href="#__codelineno-116-30"></a><span class="w">        </span><span class="p">}</span>
<a id="__codelineno-116-31" name="__codelineno-116-31" href="#__codelineno-116-31"></a><span class="w">    </span><span class="p">}</span>
<a id="__codelineno-116-32" name="__codelineno-116-32" href="#__codelineno-116-32"></a>
<a id="__codelineno-116-33" name="__codelineno-116-33" href="#__codelineno-116-33"></a><span class="w">    </span><span class="kt">int</span><span class="w"> </span><span class="n">GetPriority</span><span class="p">()</span><span class="w"> </span><span class="k">const</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-116-34" name="__codelineno-116-34" href="#__codelineno-116-34"></a><span class="w">        </span><span class="k">return</span><span class="w"> </span><span class="n">priority</span><span class="p">;</span>
<a id="__codelineno-116-35" name="__codelineno-116-35" href="#__codelineno-116-35"></a><span class="w">    </span><span class="p">}</span>
<a id="__codelineno-116-36" name="__codelineno-116-36" href="#__codelineno-116-36"></a>
<a id="__codelineno-116-37" name="__codelineno-116-37" href="#__codelineno-116-37"></a><span class="k">private</span><span class="o">:</span>
<a id="__codelineno-116-38" name="__codelineno-116-38" href="#__codelineno-116-38"></a><span class="w">    </span><span class="n">JobFunction</span><span class="w"> </span><span class="n">function</span><span class="p">;</span>
<a id="__codelineno-116-39" name="__codelineno-116-39" href="#__codelineno-116-39"></a><span class="w">    </span><span class="kt">int</span><span class="w"> </span><span class="n">priority</span><span class="p">;</span>
<a id="__codelineno-116-40" name="__codelineno-116-40" href="#__codelineno-116-40"></a><span class="w">    </span><span class="n">std</span><span class="o">::</span><span class="n">atomic</span><span class="o">&lt;</span><span class="kt">int</span><span class="o">&gt;</span><span class="w"> </span><span class="n">unfinishedJobs</span><span class="p">;</span>
<a id="__codelineno-116-41" name="__codelineno-116-41" href="#__codelineno-116-41"></a><span class="w">    </span><span class="n">std</span><span class="o">::</span><span class="n">vector</span><span class="o">&lt;</span><span class="n">Job</span><span class="o">*&gt;</span><span class="w"> </span><span class="n">dependencies</span><span class="p">;</span>
<a id="__codelineno-116-42" name="__codelineno-116-42" href="#__codelineno-116-42"></a><span class="p">};</span>
<a id="__codelineno-116-43" name="__codelineno-116-43" href="#__codelineno-116-43"></a>
<a id="__codelineno-116-44" name="__codelineno-116-44" href="#__codelineno-116-44"></a><span class="cp">#endif </span><span class="c1">// JOB_H</span>
</code></pre></div>
<h3 id="jobqueueh_1">JobQueue.h</h3>
<div class="highlight"><pre><span></span><code><a id="__codelineno-117-1" name="__codelineno-117-1" href="#__codelineno-117-1"></a><span class="cp">#ifndef JOBQUEUE_H</span>
<a id="__codelineno-117-2" name="__codelineno-117-2" href="#__codelineno-117-2"></a><span class="cp">#define JOBQUEUE_H</span>
<a id="__codelineno-117-3" name="__codelineno-117-3" href="#__codelineno-117-3"></a>
<a id="__codelineno-117-4" name="__codelineno-117-4" href="#__codelineno-117-4"></a><span class="cp">#include</span><span class="w"> </span><span class="cpf">&lt;queue&gt;</span>
<a id="__codelineno-117-5" name="__codelineno-117-5" href="#__codelineno-117-5"></a><span class="cp">#include</span><span class="w"> </span><span class="cpf">&lt;mutex&gt;</span>
<a id="__codelineno-117-6" name="__codelineno-117-6" href="#__codelineno-117-6"></a><span class="cp">#include</span><span class="w"> </span><span class="cpf">&lt;condition_variable&gt;</span>
<a id="__codelineno-117-7" name="__codelineno-117-7" href="#__codelineno-117-7"></a><span class="cp">#include</span><span class="w"> </span><span class="cpf">&lt;vector&gt;</span>
<a id="__codelineno-117-8" name="__codelineno-117-8" href="#__codelineno-117-8"></a><span class="cp">#include</span><span class="w"> </span><span class="cpf">&quot;Job.h&quot;</span>
<a id="__codelineno-117-9" name="__codelineno-117-9" href="#__codelineno-117-9"></a>
<a id="__codelineno-117-10" name="__codelineno-117-10" href="#__codelineno-117-10"></a><span class="k">class</span><span class="w"> </span><span class="nc">JobQueue</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-117-11" name="__codelineno-117-11" href="#__codelineno-117-11"></a><span class="k">public</span><span class="o">:</span>
<a id="__codelineno-117-12" name="__codelineno-117-12" href="#__codelineno-117-12"></a><span class="w">    </span><span class="kt">void</span><span class="w"> </span><span class="n">Push</span><span class="p">(</span><span class="n">Job</span><span class="o">*</span><span class="w"> </span><span class="n">job</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-117-13" name="__codelineno-117-13" href="#__codelineno-117-13"></a><span class="w">        </span><span class="n">std</span><span class="o">::</span><span class="n">unique_lock</span><span class="o">&lt;</span><span class="n">std</span><span class="o">::</span><span class="n">mutex</span><span class="o">&gt;</span><span class="w"> </span><span class="n">lock</span><span class="p">(</span><span class="n">mutex</span><span class="p">);</span>
<a id="__codelineno-117-14" name="__codelineno-117-14" href="#__codelineno-117-14"></a><span class="w">        </span><span class="n">jobs</span><span class="p">.</span><span class="n">push</span><span class="p">(</span><span class="n">job</span><span class="p">);</span>
<a id="__codelineno-117-15" name="__codelineno-117-15" href="#__codelineno-117-15"></a><span class="w">        </span><span class="n">condition</span><span class="p">.</span><span class="n">notify_one</span><span class="p">();</span>
<a id="__codelineno-117-16" name="__codelineno-117-16" href="#__codelineno-117-16"></a><span class="w">    </span><span class="p">}</span>
<a id="__codelineno-117-17" name="__codelineno-117-17" href="#__codelineno-117-17"></a>
<a id="__codelineno-117-18" name="__codelineno-117-18" href="#__codelineno-117-18"></a><span class="w">    </span><span class="kt">bool</span><span class="w"> </span><span class="n">Pop</span><span class="p">(</span><span class="n">Job</span><span class="o">*&amp;</span><span class="w"> </span><span class="n">job</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-117-19" name="__codelineno-117-19" href="#__codelineno-117-19"></a><span class="w">        </span><span class="n">std</span><span class="o">::</span><span class="n">unique_lock</span><span class="o">&lt;</span><span class="n">std</span><span class="o">::</span><span class="n">mutex</span><span class="o">&gt;</span><span class="w"> </span><span class="n">lock</span><span class="p">(</span><span class="n">mutex</span><span class="p">);</span>
<a id="__codelineno-117-20" name="__codelineno-117-20" href="#__codelineno-117-20"></a><span class="w">        </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">jobs</span><span class="p">.</span><span class="n">empty</span><span class="p">())</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-117-21" name="__codelineno-117-21" href="#__codelineno-117-21"></a><span class="w">            </span><span class="k">return</span><span class="w"> </span><span class="nb">false</span><span class="p">;</span>
<a id="__codelineno-117-22" name="__codelineno-117-22" href="#__codelineno-117-22"></a><span class="w">        </span><span class="p">}</span>
<a id="__codelineno-117-23" name="__codelineno-117-23" href="#__codelineno-117-23"></a><span class="w">        </span><span class="n">job</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">jobs</span><span class="p">.</span><span class="n">top</span><span class="p">();</span>
<a id="__codelineno-117-24" name="__codelineno-117-24" href="#__codelineno-117-24"></a><span class="w">        </span><span class="n">jobs</span><span class="p">.</span><span class="n">pop</span><span class="p">();</span>
<a id="__codelineno-117-25" name="__codelineno-117-25" href="#__codelineno-117-25"></a><span class="w">        </span><span class="k">return</span><span class="w"> </span><span class="nb">true</span><span class="p">;</span>
<a id="__codelineno-117-26" name="__codelineno-117-26" href="#__codelineno-117-26"></a><span class="w">    </span><span class="p">}</span>
<a id="__codelineno-117-27" name="__codelineno-117-27" href="#__codelineno-117-27"></a>
<a id="__codelineno-117-28" name="__codelineno-117-28" href="#__codelineno-117-28"></a><span class="w">    </span><span class="kt">bool</span><span class="w"> </span><span class="n">TrySteal</span><span class="p">(</span><span class="n">Job</span><span class="o">*&amp;</span><span class="w"> </span><span class="n">job</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-117-29" name="__codelineno-117-29" href="#__codelineno-117-29"></a><span class="w">        </span><span class="n">std</span><span class="o">::</span><span class="n">unique_lock</span><span class="o">&lt;</span><span class="n">std</span><span class="o">::</span><span class="n">mutex</span><span class="o">&gt;</span><span class="w"> </span><span class="n">lock</span><span class="p">(</span><span class="n">mutex</span><span class="p">);</span>
<a id="__codelineno-117-30" name="__codelineno-117-30" href="#__codelineno-117-30"></a><span class="w">        </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">jobs</span><span class="p">.</span><span class="n">empty</span><span class="p">())</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-117-31" name="__codelineno-117-31" href="#__codelineno-117-31"></a><span class="w">            </span><span class="k">return</span><span class="w"> </span><span class="nb">false</span><span class="p">;</span>
<a id="__codelineno-117-32" name="__codelineno-117-32" href="#__codelineno-117-32"></a><span class="w">        </span><span class="p">}</span>
<a id="__codelineno-117-33" name="__codelineno-117-33" href="#__codelineno-117-33"></a><span class="w">        </span><span class="n">job</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">jobs</span><span class="p">.</span><span class="n">top</span><span class="p">();</span>
<a id="__codelineno-117-34" name="__codelineno-117-34" href="#__codelineno-117-34"></a><span class="w">        </span><span class="n">jobs</span><span class="p">.</span><span class="n">pop</span><span class="p">();</span>
<a id="__codelineno-117-35" name="__codelineno-117-35" href="#__codelineno-117-35"></a><span class="w">        </span><span class="k">return</span><span class="w"> </span><span class="nb">true</span><span class="p">;</span>
<a id="__codelineno-117-36" name="__codelineno-117-36" href="#__codelineno-117-36"></a><span class="w">    </span><span class="p">}</span>
<a id="__codelineno-117-37" name="__codelineno-117-37" href="#__codelineno-117-37"></a>
<a id="__codelineno-117-38" name="__codelineno-117-38" href="#__codelineno-117-38"></a><span class="w">    </span><span class="kt">void</span><span class="w"> </span><span class="n">WaitAndPop</span><span class="p">(</span><span class="n">Job</span><span class="o">*&amp;</span><span class="w"> </span><span class="n">job</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-117-39" name="__codelineno-117-39" href="#__codelineno-117-39"></a><span class="w">        </span><span class="n">std</span><span class="o">::</span><span class="n">unique_lock</span><span class="o">&lt;</span><span class="n">std</span><span class="o">::</span><span class="n">mutex</span><span class="o">&gt;</span><span class="w"> </span><span class="n">lock</span><span class="p">(</span><span class="n">mutex</span><span class="p">);</span>
<a id="__codelineno-117-40" name="__codelineno-117-40" href="#__codelineno-117-40"></a><span class="w">        </span><span class="n">condition</span><span class="p">.</span><span class="n">wait</span><span class="p">(</span><span class="n">lock</span><span class="p">,</span><span class="w"> </span><span class="p">[</span><span class="k">this</span><span class="p">]</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="k">return</span><span class="w"> </span><span class="o">!</span><span class="n">jobs</span><span class="p">.</span><span class="n">empty</span><span class="p">();</span><span class="w"> </span><span class="p">});</span>
<a id="__codelineno-117-41" name="__codelineno-117-41" href="#__codelineno-117-41"></a><span class="w">        </span><span class="n">job</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">jobs</span><span class="p">.</span><span class="n">top</span><span class="p">();</span>
<a id="__codelineno-117-42" name="__codelineno-117-42" href="#__codelineno-117-42"></a><span class="w">        </span><span class="n">jobs</span><span class="p">.</span><span class="n">pop</span><span class="p">();</span>
<a id="__codelineno-117-43" name="__codelineno-117-43" href="#__codelineno-117-43"></a><span class="w">    </span><span class="p">}</span>
<a id="__codelineno-117-44" name="__codelineno-117-44" href="#__codelineno-117-44"></a>
<a id="__codelineno-117-45" name="__codelineno-117-45" href="#__codelineno-117-45"></a><span class="k">private</span><span class="o">:</span>
<a id="__codelineno-117-46" name="__codelineno-117-46" href="#__codelineno-117-46"></a><span class="w">    </span><span class="k">struct</span><span class="w"> </span><span class="nc">JobComparator</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-117-47" name="__codelineno-117-47" href="#__codelineno-117-47"></a><span class="w">        </span><span class="kt">bool</span><span class="w"> </span><span class="nf">operator</span><span class="p">()(</span><span class="n">Job</span><span class="o">*</span><span class="w"> </span><span class="n">a</span><span class="p">,</span><span class="w"> </span><span class="n">Job</span><span class="o">*</span><span class="w"> </span><span class="n">b</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-117-48" name="__codelineno-117-48" href="#__codelineno-117-48"></a><span class="w">            </span><span class="k">return</span><span class="w"> </span><span class="n">a</span><span class="o">-&gt;</span><span class="n">GetPriority</span><span class="p">()</span><span class="w"> </span><span class="o">&lt;</span><span class="w"> </span><span class="n">b</span><span class="o">-&gt;</span><span class="n">GetPriority</span><span class="p">();</span>
<a id="__codelineno-117-49" name="__codelineno-117-49" href="#__codelineno-117-49"></a><span class="w">        </span><span class="p">}</span>
<a id="__codelineno-117-50" name="__codelineno-117-50" href="#__codelineno-117-50"></a><span class="w">    </span><span class="p">};</span>
<a id="__codelineno-117-51" name="__codelineno-117-51" href="#__codelineno-117-51"></a>
<a id="__codelineno-117-52" name="__codelineno-117-52" href="#__codelineno-117-52"></a><span class="w">    </span><span class="n">std</span><span class="o">::</span><span class="n">priority_queue</span><span class="o">&lt;</span><span class="n">Job</span><span class="o">*</span><span class="p">,</span><span class="w"> </span><span class="n">std</span><span class="o">::</span><span class="n">vector</span><span class="o">&lt;</span><span class="n">Job</span><span class="o">*&gt;</span><span class="p">,</span><span class="w"> </span><span class="n">JobComparator</span><span class="o">&gt;</span><span class="w"> </span><span class="n">jobs</span><span class="p">;</span>
<a id="__codelineno-117-53" name="__codelineno-117-53" href="#__codelineno-117-53"></a><span class="w">    </span><span class="n">std</span><span class="o">::</span><span class="n">mutex</span><span class="w"> </span><span class="n">mutex</span><span class="p">;</span>
<a id="__codelineno-117-54" name="__codelineno-117-54" href="#__codelineno-117-54"></a><span class="w">    </span><span class="n">std</span><span class="o">::</span><span class="n">condition_variable</span><span class="w"> </span><span class="n">condition</span><span class="p">;</span>
<a id="__codelineno-117-55" name="__codelineno-117-55" href="#__codelineno-117-55"></a><span class="p">};</span>
<a id="__codelineno-117-56" name="__codelineno-117-56" href="#__codelineno-117-56"></a>
<a id="__codelineno-117-57" name="__codelineno-117-57" href="#__codelineno-117-57"></a><span class="cp">#endif </span><span class="c1">// JOBQUEUE_H</span>
</code></pre></div>
<h3 id="workerthreadh_1">WorkerThread.h</h3>
<div class="highlight"><pre><span></span><code><a id="__codelineno-118-1" name="__codelineno-118-1" href="#__codelineno-118-1"></a><span class="cp">#ifndef WORKERTHREAD_H</span>
<a id="__codelineno-118-2" name="__codelineno-118-2" href="#__codelineno-118-2"></a><span class="cp">#define WORKERTHREAD_H</span>
<a id="__codelineno-118-3" name="__codelineno-118-3" href="#__codelineno-118-3"></a>
<a id="__codelineno-118-4" name="__codelineno-118-4" href="#__codelineno-118-4"></a><span class="cp">#include</span><span class="w"> </span><span class="cpf">&lt;thread&gt;</span>
<a id="__codelineno-118-5" name="__codelineno-118-5" href="#__codelineno-118-5"></a><span class="cp">#include</span><span class="w"> </span><span class="cpf">&lt;atomic&gt;</span>
<a id="__codelineno-118-6" name="__codelineno-118-6" href="#__codelineno-118-6"></a><span class="cp">#include</span><span class="w"> </span><span class="cpf">&lt;vector&gt;</span>
<a id="__codelineno-118-7" name="__codelineno-118-7" href="#__codelineno-118-7"></a><span class="cp">#include</span><span class="w"> </span><span class="cpf">&quot;JobQueue.h&quot;</span>
<a id="__codelineno-118-8" name="__codelineno-118-8" href="#__codelineno-118-8"></a>
<a id="__codelineno-118-9" name="__codelineno-118-9" href="#__codelineno-118-9"></a><span class="k">class</span><span class="w"> </span><span class="nc">WorkerThread</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-118-10" name="__codelineno-118-10" href="#__codelineno-118-10"></a><span class="k">public</span><span class="o">:</span>
<a id="__codelineno-118-11" name="__codelineno-118-11" href="#__codelineno-118-11"></a><span class="w">    </span><span class="n">WorkerThread</span><span class="p">(</span><span class="n">JobQueue</span><span class="o">&amp;</span><span class="w"> </span><span class="n">queue</span><span class="p">,</span><span class="w"> </span><span class="n">std</span><span class="o">::</span><span class="n">vector</span><span class="o">&lt;</span><span class="n">JobQueue</span><span class="o">*&gt;&amp;</span><span class="w"> </span><span class="n">queues</span><span class="p">)</span>
<a id="__codelineno-118-12" name="__codelineno-118-12" href="#__codelineno-118-12"></a><span class="w">        </span><span class="o">:</span><span class="w"> </span><span class="n">jobQueue</span><span class="p">(</span><span class="n">queue</span><span class="p">),</span><span class="w"> </span><span class="n">allQueues</span><span class="p">(</span><span class="n">queues</span><span class="p">),</span><span class="w"> </span><span class="n">stopFlag</span><span class="p">(</span><span class="nb">false</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-118-13" name="__codelineno-118-13" href="#__codelineno-118-13"></a><span class="w">        </span><span class="kr">thread</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">std</span><span class="o">::</span><span class="kr">thread</span><span class="p">(</span><span class="o">&amp;</span><span class="n">WorkerThread</span><span class="o">::</span><span class="n">Run</span><span class="p">,</span><span class="w"> </span><span class="k">this</span><span class="p">);</span>
<a id="__codelineno-118-14" name="__codelineno-118-14" href="#__codelineno-118-14"></a><span class="w">    </span><span class="p">}</span>
<a id="__codelineno-118-15" name="__codelineno-118-15" href="#__codelineno-118-15"></a>
<a id="__codelineno-118-16" name="__codelineno-118-16" href="#__codelineno-118-16"></a><span class="w">    </span><span class="o">~</span><span class="n">WorkerThread</span><span class="p">()</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-118-17" name="__codelineno-118-17" href="#__codelineno-118-17"></a><span class="w">        </span><span class="n">stopFlag</span><span class="p">.</span><span class="n">store</span><span class="p">(</span><span class="nb">true</span><span class="p">);</span>
<a id="__codelineno-118-18" name="__codelineno-118-18" href="#__codelineno-118-18"></a><span class="w">        </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="kr">thread</span><span class="p">.</span><span class="n">joinable</span><span class="p">())</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-118-19" name="__codelineno-118-19" href="#__codelineno-118-19"></a><span class="w">            </span><span class="kr">thread</span><span class="p">.</span><span class="n">join</span><span class="p">();</span>
<a id="__codelineno-118-20" name="__codelineno-118-20" href="#__codelineno-118-20"></a><span class="w">        </span><span class="p">}</span>
<a id="__codelineno-118-21" name="__codelineno-118-21" href="#__codelineno-118-21"></a><span class="w">    </span><span class="p">}</span>
<a id="__codelineno-118-22" name="__codelineno-118-22" href="#__codelineno-118-22"></a>
<a id="__codelineno-118-23" name="__codelineno-118-23" href="#__codelineno-118-23"></a><span class="w">    </span><span class="kt">void</span><span class="w"> </span><span class="n">Run</span><span class="p">()</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-118-24" name="__codelineno-118-24" href="#__codelineno-118-24"></a><span class="w">        </span><span class="k">while</span><span class="w"> </span><span class="p">(</span><span class="o">!</span><span class="n">stopFlag</span><span class="p">.</span><span class="n">load</span><span class="p">())</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-118-25" name="__codelineno-118-25" href="#__codelineno-118-25"></a><span class="w">            </span><span class="n">Job</span><span class="o">*</span><span class="w"> </span><span class="n">job</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">nullptr</span><span class="p">;</span>
<a id="__codelineno-118-26" name="__codelineno-118-26" href="#__codelineno-118-26"></a><span class="w">            </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">jobQueue</span><span class="p">.</span><span class="n">Pop</span><span class="p">(</span><span class="n">job</span><span class="p">))</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-118-27" name="__codelineno-118-27" href="#__codelineno-118-27"></a><span class="w">                </span><span class="n">job</span><span class="o">-&gt;</span><span class="n">Execute</span><span class="p">();</span>
<a id="__codelineno-118-28" name="__codelineno-118-28" href="#__codelineno-118-28"></a><span class="w">            </span><span class="p">}</span><span class="w"> </span><span class="k">else</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-118-29" name="__codelineno-118-29" href="#__codelineno-118-29"></a><span class="w">                </span><span class="k">for</span><span class="w"> </span><span class="p">(</span><span class="k">auto</span><span class="o">&amp;</span><span class="w"> </span><span class="n">queue</span><span class="w"> </span><span class="o">:</span><span class="w"> </span><span class="n">allQueues</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-118-30" name="__codelineno-118-30" href="#__codelineno-118-30"></a><span class="w">                    </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">queue</span><span class="o">-&gt;</span><span class="n">TrySteal</span><span class="p">(</span><span class="n">job</span><span class="p">))</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-118-31" name="__codelineno-118-31" href="#__codelineno-118-31"></a><span class="w">                        </span><span class="n">job</span><span class="o">-&gt;</span><span class="n">Execute</span><span class="p">();</span>
<a id="__codelineno-118-32" name="__codelineno-118-32" href="#__codelineno-118-32"></a><span class="w">                        </span><span class="k">break</span><span class="p">;</span>
<a id="__codelineno-118-33" name="__codelineno-118-33" href="#__codelineno-118-33"></a><span class="w">                    </span><span class="p">}</span>
<a id="__codelineno-118-34" name="__codelineno-118-34" href="#__codelineno-118-34"></a><span class="w">                </span><span class="p">}</span>
<a id="__codelineno-118-35" name="__codelineno-118-35" href="#__codelineno-118-35"></a><span class="w">                </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="o">!</span><span class="n">job</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-118-36" name="__codelineno-118-36" href="#__codelineno-118-36"></a><span class="w">                    </span><span class="n">std</span><span class="o">::</span><span class="n">this_thread</span><span class="o">::</span><span class="n">yield</span><span class="p">();</span>
<a id="__codelineno-118-37" name="__codelineno-118-37" href="#__codelineno-118-37"></a><span class="w">                </span><span class="p">}</span>
<a id="__codelineno-118-38" name="__codelineno-118-38" href="#__codelineno-118-38"></a><span class="w">            </span><span class="p">}</span>
<a id="__codelineno-118-39" name="__codelineno-118-39" href="#__codelineno-118-39"></a><span class="w">        </span><span class="p">}</span>
<a id="__codelineno-118-40" name="__codelineno-118-40" href="#__codelineno-118-40"></a><span class="w">    </span><span class="p">}</span>
<a id="__codelineno-118-41" name="__codelineno-118-41" href="#__codelineno-118-41"></a>
<a id="__codelineno-118-42" name="__codelineno-118-42" href="#__codelineno-118-42"></a><span class="k">private</span><span class="o">:</span>
<a id="__codelineno-118-43" name="__codelineno-118-43" href="#__codelineno-118-43"></a><span class="w">    </span><span class="n">JobQueue</span><span class="o">&amp;</span><span class="w"> </span><span class="n">jobQueue</span><span class="p">;</span>
<a id="__codelineno-118-44" name="__codelineno-118-44" href="#__codelineno-118-44"></a><span class="w">    </span><span class="n">std</span><span class="o">::</span><span class="n">vector</span><span class="o">&lt;</span><span class="n">JobQueue</span><span class="o">*&gt;&amp;</span><span class="w"> </span><span class="n">allQueues</span><span class="p">;</span>
<a id="__codelineno-118-45" name="__codelineno-118-45" href="#__codelineno-118-45"></a><span class="w">    </span><span class="n">std</span><span class="o">::</span><span class="kr">thread</span><span class="w"> </span><span class="kr">thread</span><span class="p">;</span>
<a id="__codelineno-118-46" name="__codelineno-118-46" href="#__codelineno-118-46"></a><span class="w">    </span><span class="n">std</span><span class="o">::</span><span class="n">atomic</span><span class="o">&lt;</span><span class="kt">bool</span><span class="o">&gt;</span><span class="w"> </span><span class="n">stopFlag</span><span class="p">;</span>
<a id="__codelineno-118-47" name="__codelineno-118-47" href="#__codelineno-118-47"></a><span class="p">};</span>
<a id="__codelineno-118-48" name="__codelineno-118-48" href="#__codelineno-118-48"></a>
<a id="__codelineno-118-49" name="__codelineno-118-49" href="#__codelineno-118-49"></a><span class="cp">#endif </span><span class="c1">// WORKERTHREAD_H</span>
</code></pre></div>
<h3 id="jobsystemh_1">JobSystem.h</h3>
<div class="highlight"><pre><span></span><code><a id="__codelineno-119-1" name="__codelineno-119-1" href="#__codelineno-119-1"></a><span class="cp">#ifndef JOBSYSTEM_H</span>
<a id="__codelineno-119-2" name="__codelineno-119-2" href="#__codelineno-119-2"></a><span class="cp">#define JOBSYSTEM_H</span>
<a id="__codelineno-119-3" name="__codelineno-119-3" href="#__codelineno-119-3"></a>
<a id="__codelineno-119-4" name="__codelineno-119-4" href="#__codelineno-119-4"></a><span class="cp">#include</span><span class="w"> </span><span class="cpf">&lt;vector&gt;</span>
<a id="__codelineno-119-5" name="__codelineno-119-5" href="#__codelineno-119-5"></a><span class="cp">#include</span><span class="w"> </span><span class="cpf">&lt;memory&gt;</span>
<a id="__codelineno-119-6" name="__codelineno-119-6" href="#__codelineno-119-6"></a><span class="cp">#include</span><span class="w"> </span><span class="cpf">&quot;JobQueue.h&quot;</span>
<a id="__codelineno-119-7" name="__codelineno-119-7" href="#__codelineno-119-7"></a><span class="cp">#include</span><span class="w"> </span><span class="cpf">&quot;WorkerThread.h&quot;</span>
<a id="__codelineno-119-8" name="__codelineno-119-8" href="#__codelineno-119-8"></a>
<a id="__codelineno-119-9" name="__codelineno-119-9" href="#__codelineno-119-9"></a><span class="k">class</span><span class="w"> </span><span class="nc">JobSystem</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-119-10" name="__codelineno-119-10" href="#__codelineno-119-10"></a><span class="k">public</span><span class="o">:</span>
<a id="__codelineno-119-11" name="__codelineno-119-11" href="#__codelineno-119-11"></a><span class="w">    </span><span class="n">JobSystem</span><span class="p">(</span><span class="kt">size_t</span><span class="w"> </span><span class="n">numThreads</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-119-12" name="__codelineno-119-12" href="#__codelineno-119-12"></a><span class="w">        </span><span class="k">for</span><span class="w"> </span><span class="p">(</span><span class="kt">size_t</span><span class="w"> </span><span class="n">i</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">0</span><span class="p">;</span><span class="w"> </span><span class="n">i</span><span class="w"> </span><span class="o">&lt;</span><span class="w"> </span><span class="n">numThreads</span><span class="p">;</span><span class="w"> </span><span class="o">++</span><span class="n">i</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-119-13" name="__codelineno-119-13" href="#__codelineno-119-13"></a><span class="w">            </span><span class="k">auto</span><span class="w"> </span><span class="n">queue</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">std</span><span class="o">::</span><span class="n">make_unique</span><span class="o">&lt;</span><span class="n">JobQueue</span><span class="o">&gt;</span><span class="p">();</span>
<a id="__codelineno-119-14" name="__codelineno-119-14" href="#__codelineno-119-14"></a><span class="w">            </span><span class="n">jobQueues</span><span class="p">.</span><span class="n">push_back</span><span class="p">(</span><span class="n">std</span><span class="o">::</span><span class="n">move</span><span class="p">(</span><span class="n">queue</span><span class="p">));</span>
<a id="__codelineno-119-15" name="__codelineno-119-15" href="#__codelineno-119-15"></a><span class="w">        </span><span class="p">}</span>
<a id="__codelineno-119-16" name="__codelineno-119-16" href="#__codelineno-119-16"></a><span class="w">        </span><span class="k">for</span><span class="w"> </span><span class="p">(</span><span class="kt">size_t</span><span class="w"> </span><span class="n">i</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">0</span><span class="p">;</span><span class="w"> </span><span class="n">i</span><span class="w"> </span><span class="o">&lt;</span><span class="w"> </span><span class="n">numThreads</span><span class="p">;</span><span class="w"> </span><span class="o">++</span><span class="n">i</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-119-17" name="__codelineno-119-17" href="#__codelineno-119-17"></a><span class="w">            </span><span class="n">workerThreads</span><span class="p">.</span><span class="n">emplace_back</span><span class="p">(</span><span class="n">std</span><span class="o">::</span><span class="n">make_unique</span><span class="o">&lt;</span><span class="n">WorkerThread</span><span class="o">&gt;</span><span class="p">(</span><span class="o">*</span><span class="n">jobQueues</span><span class="p">[</span><span class="n">i</span><span class="p">],</span><span class="w"> </span><span class="n">jobQueues</span><span class="p">));</span>
<a id="__codelineno-119-18" name="__codelineno-119-18" href="#__codelineno-119-18"></a><span class="w">        </span><span class="p">}</span>
<a id="__codelineno-119-19" name="__codelineno-119-19" href="#__codelineno-119-19"></a><span class="w">    </span><span class="p">}</span>
<a id="__codelineno-119-20" name="__codelineno-119-20" href="#__codelineno-119-20"></a>
<a id="__codelineno-119-21" name="__codelineno-119-21" href="#__codelineno-119-21"></a><span class="w">    </span><span class="kt">void</span><span class="w"> </span><span class="n">Submit</span><span class="p">(</span><span class="n">Job</span><span class="o">*</span><span class="w"> </span><span class="n">job</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-119-22" name="__codelineno-119-22" href="#__codelineno-119-22"></a><span class="w">        </span><span class="n">jobQueues</span><span class="p">[</span><span class="n">GetNextQueueIndex</span><span class="p">()]</span><span class="o">-&gt;</span><span class="n">Push</span><span class="p">(</span><span class="n">job</span><span class="p">);</span>
<a id="__codelineno-119-23" name="__codelineno-119-23" href="#__codelineno-119-23"></a><span class="w">    </span><span class="p">}</span>
<a id="__codelineno-119-24" name="__codelineno-119-24" href="#__codelineno-119-24"></a>
<a id="__codelineno-119-25" name="__codelineno-119-25" href="#__codelineno-119-25"></a><span class="k">private</span><span class="o">:</span>
<a id="__codelineno-119-26" name="__codelineno-119-26" href="#__codelineno-119-26"></a><span class="w">    </span><span class="kt">size_t</span><span class="w"> </span><span class="n">GetNextQueueIndex</span><span class="p">()</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-119-27" name="__codelineno-119-27" href="#__codelineno-119-27"></a><span class="w">        </span><span class="k">return</span><span class="w"> </span><span class="n">nextQueueIndex</span><span class="o">++</span><span class="w"> </span><span class="o">%</span><span class="w"> </span><span class="n">jobQueues</span><span class="p">.</span><span class="n">size</span><span class="p">();</span>
<a id="__codelineno-119-28" name="__codelineno-119-28" href="#__codelineno-119-28"></a><span class="w">    </span><span class="p">}</span>
<a id="__codelineno-119-29" name="__codelineno-119-29" href="#__codelineno-119-29"></a>
<a id="__codelineno-119-30" name="__codelineno-119-30" href="#__codelineno-119-30"></a><span class="w">    </span><span class="n">std</span><span class="o">::</span><span class="n">vector</span><span class="o">&lt;</span><span class="n">std</span><span class="o">::</span><span class="n">unique_ptr</span><span class="o">&lt;</span><span class="n">JobQueue</span><span class="o">&gt;&gt;</span><span class="w"> </span><span class="n">jobQueues</span><span class="p">;</span>
<a id="__codelineno-119-31" name="__codelineno-119-31" href="#__codelineno-119-31"></a><span class="w">    </span><span class="n">std</span><span class="o">::</span><span class="n">vector</span><span class="o">&lt;</span><span class="n">std</span><span class="o">::</span><span class="n">unique_ptr</span><span class="o">&lt;</span><span class="n">WorkerThread</span><span class="o">&gt;&gt;</span><span class="w"> </span><span class="n">workerThreads</span><span class="p">;</span>
<a id="__codelineno-119-32" name="__codelineno-119-32" href="#__codelineno-119-32"></a><span class="w">    </span><span class="n">std</span><span class="o">::</span><span class="n">atomic</span><span class="o">&lt;</span><span class="kt">size_t</span><span class="o">&gt;</span><span class="w"> </span><span class="n">nextQueueIndex</span><span class="p">{</span><span class="mi">0</span><span class="p">};</span>
<a id="__codelineno-119-33" name="__codelineno-119-33" href="#__codelineno-119-33"></a><span class="p">};</span>
<a id="__codelineno-119-34" name="__codelineno-119-34" href="#__codelineno-119-34"></a>
<a id="__codelineno-119-35" name="__codelineno-119-35" href="#__codelineno-119-35"></a><span class="cp">#endif </span><span class="c1">// JOBSYSTEM_H</span>
</code></pre></div>
<h3 id="maincpp_1">Main.cpp</h3>
<div class="highlight"><pre><span></span><code><a id="__codelineno-120-1" name="__codelineno-120-1" href="#__codelineno-120-1"></a><span class="cp">#include</span><span class="w"> </span><span class="cpf">&lt;iostream&gt;</span>
<a id="__codelineno-120-2" name="__codelineno-120-2" href="#__codelineno-120-2"></a><span class="cp">#include</span><span class="w"> </span><span class="cpf">&quot;JobSystem.h&quot;</span>
<a id="__codelineno-120-3" name="__codelineno-120-3" href="#__codelineno-120-3"></a>
<a id="__codelineno-120-4" name="__codelineno-120-4" href="#__codelineno-120-4"></a><span class="kt">void</span><span class="w"> </span><span class="nf">TestJobFunction</span><span class="p">()</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-120-5" name="__codelineno-120-5" href="#__codelineno-120-5"></a><span class="w">    </span><span class="n">std</span><span class="o">::</span><span class="n">cout</span><span class="w"> </span><span class="o">&lt;&lt;</span><span class="w"> </span><span class="s">&quot;Job executed by thread &quot;</span><span class="w"> </span><span class="o">&lt;&lt;</span><span class="w"> </span><span class="n">std</span><span class="o">::</span><span class="n">this_thread</span><span class="o">::</span><span class="n">get_id</span><span class="p">()</span><span class="w"> </span><span class="o">&lt;&lt;</span><span class="w"> </span><span class="n">std</span><span class="o">::</span><span class="n">endl</span><span class="p">;</span>
<a id="__codelineno-120-6" name="__codelineno-120-6" href="#__codelineno-120-6"></a><span class="p">}</span>
<a id="__codelineno-120-7" name="__codelineno-120-7" href="#__codelineno-120-7"></a>
<a id="__codelineno-120-8" name="__codelineno-120-8" href="#__codelineno-120-8"></a><span class="kt">int</span><span class="w"> </span><span class="nf">main</span><span class="p">()</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-120-9" name="__codelineno-120-9" href="#__codelineno-120-9"></a><span class="w">    </span><span class="k">const</span><span class="w"> </span><span class="kt">size_t</span><span class="w"> </span><span class="n">numThreads</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">std</span><span class="o">::</span><span class="kr">thread</span><span class="o">::</span><span class="n">hardware_concurrency</span><span class="p">();</span>
<a id="__codelineno-120-10" name="__codelineno-120-10" href="#__codelineno-120-10"></a><span class="w">    </span><span class="n">JobSystem</span><span class="w"> </span><span class="n">jobSystem</span><span class="p">(</span><span class="n">numThreads</span><span class="p">);</span>
<a id="__codelineno-120-11" name="__codelineno-120-11" href="#__codelineno-120-11"></a>
<a id="__codelineno-120-12" name="__codelineno-120-12" href="#__codelineno-120-12"></a><span class="w">    </span><span class="n">Job</span><span class="w"> </span><span class="n">job1</span><span class="p">(</span><span class="n">TestJobFunction</span><span class="p">,</span><span class="w"> </span><span class="mi">10</span><span class="p">);</span>
<a id="__codelineno-120-13" name="__codelineno-120-13" href="#__codelineno-120-13"></a><span class="w">    </span><span class="n">Job</span><span class="w"> </span><span class="n">job2</span><span class="p">(</span><span class="n">TestJobFunction</span><span class="p">,</span><span class="w"> </span><span class="mi">20</span><span class="p">);</span>
<a id="__codelineno-120-14" name="__codelineno-120-14" href="#__codelineno-120-14"></a><span class="w">    </span><span class="n">Job</span><span class="w"> </span><span class="n">job3</span><span class="p">(</span><span class="n">TestJobFunction</span><span class="p">,</span><span class="w"> </span><span class="mi">30</span><span class="p">);</span>
<a id="__codelineno-120-15" name="__codelineno-120-15" href="#__codelineno-120-15"></a>
<a id="__codelineno-120-16" name="__codelineno-120-16" href="#__codelineno-120-16"></a><span class="w">    </span><span class="n">job2</span><span class="p">.</span><span class="n">AddDependency</span><span class="p">(</span><span class="o">&amp;</span><span class="n">job1</span><span class="p">);</span>
<a id="__codelineno-120-17" name="__codelineno-120-17" href="#__codelineno-120-17"></a><span class="w">    </span><span class="n">job3</span><span class="p">.</span><span class="n">AddDependency</span><span class="p">(</span><span class="o">&amp;</span><span class="n">job2</span><span class="p">);</span>
<a id="__codelineno-120-18" name="__codelineno-120-18" href="#__codelineno-120-18"></a>
<a id="__codelineno-120-19" name="__codelineno-120-19" href="#__codelineno-120-19"></a><span class="w">    </span><span class="n">jobSystem</span><span class="p">.</span><span class="n">Submit</span><span class="p">(</span><span class="o">&amp;</span><span class="n">job1</span><span class="p">);</span>
<a id="__codelineno-120-20" name="__codelineno-120-20" href="#__codelineno-120-20"></a><span class="w">    </span><span class="n">jobSystem</span><span class="p">.</span><span class="n">Submit</span><span class="p">(</span><span class="o">&amp;</span><span class="n">job2</span><span class="p">);</span>
<a id="__codelineno-120-21" name="__codelineno-120-21" href="#__codelineno-120-21"></a><span class="w">    </span><span class="n">jobSystem</span><span class="p">.</span><span class="n">Submit</span><span class="p">(</span><span class="o">&amp;</span><span class="n">job3</span><span class="p">);</span>
<a id="__codelineno-120-22" name="__codelineno-120-22" href="#__codelineno-120-22"></a>
<a id="__codelineno-120-23" name="__codelineno-120-23" href="#__codelineno-120-23"></a><span class="w">    </span><span class="n">std</span><span class="o">::</span><span class="n">this_thread</span><span class="o">::</span><span class="n">sleep_for</span><span class="p">(</span><span class="n">std</span><span class="o">::</span><span class="n">chrono</span><span class="o">::</span><span class="n">seconds</span><span class="p">(</span><span class="mi">2</span><span class="p">));</span><span class="w"> </span><span class="c1">// Allow time for jobs to complete</span>
<a id="__codelineno-120-24" name="__codelineno-120-24" href="#__codelineno-120-24"></a><span class="w">    </span><span class="k">return</span><span class="w"> </span><span class="mi">0</span><span class="p">;</span>
<a id="__codelineno-120-25" name="__codelineno-120-25" href="#__codelineno-120-25"></a><span class="p">}</span>
</code></pre></div>
<h3 id="explanation_3">Explanation</h3>
<ol>
<li><strong>Job.h</strong>: Adds support for job dependencies and priority. Jobs can depend on other jobs, ensuring they execute only after their dependencies are completed.</li>
<li><strong>JobQueue.h</strong>: Implements a priority queue for jobs and supports work-stealing to improve load balancing.</li>
<li><strong>WorkerThread.h</strong>: Worker threads now support work-stealing from other queues when their own queue is empty, reducing idle time.</li>
<li><strong>JobSystem.h</strong>: Manages multiple job queues and worker threads, distributing jobs across queues for load balancing.</li>
<li><strong>Main.cpp</strong>: Demonstrates the submission of jobs with dependencies and different priorities.</li>
</ol>
<p>This implementation provides a more robust and flexible job system suitable for the complex and demanding requirements of game development. Further enhancements can be made based on specific needs and use cases.</p>
<h2 id="simd-and-vectorization">SIMD and Vectorization</h2>
<ul>
<li>Intrinsics for SSE, AVX</li>
<li>Auto-vectorization techniques</li>
<li>Data alignment for SIMD operations</li>
<li>SIMD-friendly data structures</li>
</ul>
<h2 id="c-20-features">C++ 20 Features</h2>
<p>C++20 introduced several major features that can significantly impact game development. Here's an overview of key additions:</p>
<h3 id="concepts-and-constraints">Concepts and Constraints</h3>
<p>Concepts allow you to specify constraints on template parameters, improving code readability and error messages.</p>
<p>Example:
<div class="highlight"><pre><span></span><code><a id="__codelineno-121-1" name="__codelineno-121-1" href="#__codelineno-121-1"></a><span class="cp">#include</span><span class="w"> </span><span class="cpf">&lt;concepts&gt;</span>
<a id="__codelineno-121-2" name="__codelineno-121-2" href="#__codelineno-121-2"></a>
<a id="__codelineno-121-3" name="__codelineno-121-3" href="#__codelineno-121-3"></a><span class="k">template</span><span class="o">&lt;</span><span class="k">typename</span><span class="w"> </span><span class="nc">T</span><span class="o">&gt;</span>
<a id="__codelineno-121-4" name="__codelineno-121-4" href="#__codelineno-121-4"></a><span class="k">concept</span><span class="w"> </span><span class="nc">Numeric</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">std</span><span class="o">::</span><span class="n">is_arithmetic_v</span><span class="o">&lt;</span><span class="n">T</span><span class="o">&gt;</span><span class="p">;</span>
<a id="__codelineno-121-5" name="__codelineno-121-5" href="#__codelineno-121-5"></a>
<a id="__codelineno-121-6" name="__codelineno-121-6" href="#__codelineno-121-6"></a><span class="k">template</span><span class="o">&lt;</span><span class="n">Numeric</span><span class="w"> </span><span class="n">T</span><span class="o">&gt;</span>
<a id="__codelineno-121-7" name="__codelineno-121-7" href="#__codelineno-121-7"></a><span class="n">T</span><span class="w"> </span><span class="n">add</span><span class="p">(</span><span class="n">T</span><span class="w"> </span><span class="n">a</span><span class="p">,</span><span class="w"> </span><span class="n">T</span><span class="w"> </span><span class="n">b</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-121-8" name="__codelineno-121-8" href="#__codelineno-121-8"></a><span class="w">    </span><span class="k">return</span><span class="w"> </span><span class="n">a</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="n">b</span><span class="p">;</span>
<a id="__codelineno-121-9" name="__codelineno-121-9" href="#__codelineno-121-9"></a><span class="p">}</span>
<a id="__codelineno-121-10" name="__codelineno-121-10" href="#__codelineno-121-10"></a>
<a id="__codelineno-121-11" name="__codelineno-121-11" href="#__codelineno-121-11"></a><span class="c1">// Usage</span>
<a id="__codelineno-121-12" name="__codelineno-121-12" href="#__codelineno-121-12"></a><span class="kt">int</span><span class="w"> </span><span class="n">result1</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">add</span><span class="p">(</span><span class="mi">5</span><span class="p">,</span><span class="w"> </span><span class="mi">3</span><span class="p">);</span><span class="w">      </span><span class="c1">// OK</span>
<a id="__codelineno-121-13" name="__codelineno-121-13" href="#__codelineno-121-13"></a><span class="c1">// double result2 = add(5.0, 3); // Error: deduced conflicting types</span>
<a id="__codelineno-121-14" name="__codelineno-121-14" href="#__codelineno-121-14"></a>
<a id="__codelineno-121-15" name="__codelineno-121-15" href="#__codelineno-121-15"></a><span class="k">template</span><span class="o">&lt;</span><span class="k">typename</span><span class="w"> </span><span class="nc">T</span><span class="o">&gt;</span>
<a id="__codelineno-121-16" name="__codelineno-121-16" href="#__codelineno-121-16"></a><span class="w">    </span><span class="k">requires</span><span class="w"> </span><span class="n">std</span><span class="o">::</span><span class="n">totally_ordered</span><span class="o">&lt;</span><span class="n">T</span><span class="o">&gt;</span><span class="w"> </span><span class="o">&amp;&amp;</span><span class="w"> </span><span class="n">std</span><span class="o">::</span><span class="n">default_initializable</span><span class="o">&lt;</span><span class="n">T</span><span class="o">&gt;</span>
<a id="__codelineno-121-17" name="__codelineno-121-17" href="#__codelineno-121-17"></a><span class="k">class</span><span class="w"> </span><span class="nc">GameEntity</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-121-18" name="__codelineno-121-18" href="#__codelineno-121-18"></a><span class="w">    </span><span class="n">T</span><span class="w"> </span><span class="n">position</span><span class="p">;</span>
<a id="__codelineno-121-19" name="__codelineno-121-19" href="#__codelineno-121-19"></a><span class="k">public</span><span class="o">:</span>
<a id="__codelineno-121-20" name="__codelineno-121-20" href="#__codelineno-121-20"></a><span class="w">    </span><span class="c1">// ...</span>
<a id="__codelineno-121-21" name="__codelineno-121-21" href="#__codelineno-121-21"></a><span class="p">};</span>
</code></pre></div></p>
<h3 id="coroutines">Coroutines</h3>
<p>Coroutines enable you to write asynchronous code that looks synchronous, which can be particularly useful for game logic, AI, and animations.</p>
<p>Example:
<div class="highlight"><pre><span></span><code><a id="__codelineno-122-1" name="__codelineno-122-1" href="#__codelineno-122-1"></a><span class="cp">#include</span><span class="w"> </span><span class="cpf">&lt;coroutine&gt;</span>
<a id="__codelineno-122-2" name="__codelineno-122-2" href="#__codelineno-122-2"></a><span class="cp">#include</span><span class="w"> </span><span class="cpf">&lt;iostream&gt;</span>
<a id="__codelineno-122-3" name="__codelineno-122-3" href="#__codelineno-122-3"></a>
<a id="__codelineno-122-4" name="__codelineno-122-4" href="#__codelineno-122-4"></a><span class="k">struct</span><span class="w"> </span><span class="nc">Task</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-122-5" name="__codelineno-122-5" href="#__codelineno-122-5"></a><span class="w">    </span><span class="k">struct</span><span class="w"> </span><span class="nc">promise_type</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-122-6" name="__codelineno-122-6" href="#__codelineno-122-6"></a><span class="w">        </span><span class="n">Task</span><span class="w"> </span><span class="nf">get_return_object</span><span class="p">()</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="k">return</span><span class="w"> </span><span class="p">{};</span><span class="w"> </span><span class="p">}</span>
<a id="__codelineno-122-7" name="__codelineno-122-7" href="#__codelineno-122-7"></a><span class="w">        </span><span class="n">std</span><span class="o">::</span><span class="n">suspend_never</span><span class="w"> </span><span class="nf">initial_suspend</span><span class="p">()</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="k">return</span><span class="w"> </span><span class="p">{};</span><span class="w"> </span><span class="p">}</span>
<a id="__codelineno-122-8" name="__codelineno-122-8" href="#__codelineno-122-8"></a><span class="w">        </span><span class="n">std</span><span class="o">::</span><span class="n">suspend_never</span><span class="w"> </span><span class="nf">final_suspend</span><span class="p">()</span><span class="w"> </span><span class="k">noexcept</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="k">return</span><span class="w"> </span><span class="p">{};</span><span class="w"> </span><span class="p">}</span>
<a id="__codelineno-122-9" name="__codelineno-122-9" href="#__codelineno-122-9"></a><span class="w">        </span><span class="kt">void</span><span class="w"> </span><span class="nf">return_void</span><span class="p">()</span><span class="w"> </span><span class="p">{}</span>
<a id="__codelineno-122-10" name="__codelineno-122-10" href="#__codelineno-122-10"></a><span class="w">        </span><span class="kt">void</span><span class="w"> </span><span class="nf">unhandled_exception</span><span class="p">()</span><span class="w"> </span><span class="p">{}</span>
<a id="__codelineno-122-11" name="__codelineno-122-11" href="#__codelineno-122-11"></a><span class="w">    </span><span class="p">};</span>
<a id="__codelineno-122-12" name="__codelineno-122-12" href="#__codelineno-122-12"></a><span class="p">};</span>
<a id="__codelineno-122-13" name="__codelineno-122-13" href="#__codelineno-122-13"></a>
<a id="__codelineno-122-14" name="__codelineno-122-14" href="#__codelineno-122-14"></a><span class="n">Task</span><span class="w"> </span><span class="nf">simulateGameLoop</span><span class="p">()</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-122-15" name="__codelineno-122-15" href="#__codelineno-122-15"></a><span class="w">    </span><span class="k">for</span><span class="w"> </span><span class="p">(</span><span class="kt">int</span><span class="w"> </span><span class="n">frame</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">0</span><span class="p">;</span><span class="w"> </span><span class="n">frame</span><span class="w"> </span><span class="o">&lt;</span><span class="w"> </span><span class="mi">100</span><span class="p">;</span><span class="w"> </span><span class="o">++</span><span class="n">frame</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-122-16" name="__codelineno-122-16" href="#__codelineno-122-16"></a><span class="w">        </span><span class="n">std</span><span class="o">::</span><span class="n">cout</span><span class="w"> </span><span class="o">&lt;&lt;</span><span class="w"> </span><span class="s">&quot;Processing frame &quot;</span><span class="w"> </span><span class="o">&lt;&lt;</span><span class="w"> </span><span class="n">frame</span><span class="w"> </span><span class="o">&lt;&lt;</span><span class="w"> </span><span class="n">std</span><span class="o">::</span><span class="n">endl</span><span class="p">;</span>
<a id="__codelineno-122-17" name="__codelineno-122-17" href="#__codelineno-122-17"></a><span class="w">        </span><span class="k">co_await</span><span class="w"> </span><span class="n">std</span><span class="o">::</span><span class="n">suspend_always</span><span class="p">{};</span>
<a id="__codelineno-122-18" name="__codelineno-122-18" href="#__codelineno-122-18"></a><span class="w">    </span><span class="p">}</span>
<a id="__codelineno-122-19" name="__codelineno-122-19" href="#__codelineno-122-19"></a><span class="p">}</span>
<a id="__codelineno-122-20" name="__codelineno-122-20" href="#__codelineno-122-20"></a>
<a id="__codelineno-122-21" name="__codelineno-122-21" href="#__codelineno-122-21"></a><span class="kt">int</span><span class="w"> </span><span class="nf">main</span><span class="p">()</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-122-22" name="__codelineno-122-22" href="#__codelineno-122-22"></a><span class="w">    </span><span class="k">auto</span><span class="w"> </span><span class="n">task</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">simulateGameLoop</span><span class="p">();</span>
<a id="__codelineno-122-23" name="__codelineno-122-23" href="#__codelineno-122-23"></a><span class="w">    </span><span class="c1">// ... run the game loop</span>
<a id="__codelineno-122-24" name="__codelineno-122-24" href="#__codelineno-122-24"></a><span class="p">}</span>
</code></pre></div></p>
<h3 id="ranges">Ranges</h3>
<p>Ranges provide a more powerful and composable way to work with sequences of data, which can be useful for game data processing and AI.</p>
<p>Example:
<div class="highlight"><pre><span></span><code><a id="__codelineno-123-1" name="__codelineno-123-1" href="#__codelineno-123-1"></a><span class="cp">#include</span><span class="w"> </span><span class="cpf">&lt;ranges&gt;</span>
<a id="__codelineno-123-2" name="__codelineno-123-2" href="#__codelineno-123-2"></a><span class="cp">#include</span><span class="w"> </span><span class="cpf">&lt;vector&gt;</span>
<a id="__codelineno-123-3" name="__codelineno-123-3" href="#__codelineno-123-3"></a><span class="cp">#include</span><span class="w"> </span><span class="cpf">&lt;iostream&gt;</span>
<a id="__codelineno-123-4" name="__codelineno-123-4" href="#__codelineno-123-4"></a>
<a id="__codelineno-123-5" name="__codelineno-123-5" href="#__codelineno-123-5"></a><span class="kt">int</span><span class="w"> </span><span class="nf">main</span><span class="p">()</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-123-6" name="__codelineno-123-6" href="#__codelineno-123-6"></a><span class="w">    </span><span class="n">std</span><span class="o">::</span><span class="n">vector</span><span class="o">&lt;</span><span class="kt">int</span><span class="o">&gt;</span><span class="w"> </span><span class="n">scores</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">{</span><span class="mi">10</span><span class="p">,</span><span class="w"> </span><span class="mi">50</span><span class="p">,</span><span class="w"> </span><span class="mi">30</span><span class="p">,</span><span class="w"> </span><span class="mi">70</span><span class="p">,</span><span class="w"> </span><span class="mi">90</span><span class="p">};</span>
<a id="__codelineno-123-7" name="__codelineno-123-7" href="#__codelineno-123-7"></a>
<a id="__codelineno-123-8" name="__codelineno-123-8" href="#__codelineno-123-8"></a><span class="w">    </span><span class="k">auto</span><span class="w"> </span><span class="n">highScores</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">scores</span><span class="w"> </span><span class="o">|</span><span class="w"> </span><span class="n">std</span><span class="o">::</span><span class="n">views</span><span class="o">::</span><span class="n">filter</span><span class="p">([](</span><span class="kt">int</span><span class="w"> </span><span class="n">score</span><span class="p">)</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="k">return</span><span class="w"> </span><span class="n">score</span><span class="w"> </span><span class="o">&gt;</span><span class="w"> </span><span class="mi">50</span><span class="p">;</span><span class="w"> </span><span class="p">})</span>
<a id="__codelineno-123-9" name="__codelineno-123-9" href="#__codelineno-123-9"></a><span class="w">                             </span><span class="o">|</span><span class="w"> </span><span class="n">std</span><span class="o">::</span><span class="n">views</span><span class="o">::</span><span class="n">transform</span><span class="p">([](</span><span class="kt">int</span><span class="w"> </span><span class="n">score</span><span class="p">)</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="k">return</span><span class="w"> </span><span class="n">score</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="mi">2</span><span class="p">;</span><span class="w"> </span><span class="p">});</span>
<a id="__codelineno-123-10" name="__codelineno-123-10" href="#__codelineno-123-10"></a>
<a id="__codelineno-123-11" name="__codelineno-123-11" href="#__codelineno-123-11"></a><span class="w">    </span><span class="k">for</span><span class="w"> </span><span class="p">(</span><span class="kt">int</span><span class="w"> </span><span class="n">score</span><span class="w"> </span><span class="o">:</span><span class="w"> </span><span class="n">highScores</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-123-12" name="__codelineno-123-12" href="#__codelineno-123-12"></a><span class="w">        </span><span class="n">std</span><span class="o">::</span><span class="n">cout</span><span class="w"> </span><span class="o">&lt;&lt;</span><span class="w"> </span><span class="n">score</span><span class="w"> </span><span class="o">&lt;&lt;</span><span class="w"> </span><span class="s">&quot; &quot;</span><span class="p">;</span>
<a id="__codelineno-123-13" name="__codelineno-123-13" href="#__codelineno-123-13"></a><span class="w">    </span><span class="p">}</span>
<a id="__codelineno-123-14" name="__codelineno-123-14" href="#__codelineno-123-14"></a><span class="w">    </span><span class="c1">// Output: 140 180</span>
<a id="__codelineno-123-15" name="__codelineno-123-15" href="#__codelineno-123-15"></a><span class="p">}</span>
</code></pre></div></p>
<h3 id="modules">Modules</h3>
<p>Modules aim to replace the traditional header file system, potentially speeding up compilation times and reducing complexity in large game projects.</p>
<p>Example:
<div class="highlight"><pre><span></span><code><a id="__codelineno-124-1" name="__codelineno-124-1" href="#__codelineno-124-1"></a><span class="c1">// math.ixx</span>
<a id="__codelineno-124-2" name="__codelineno-124-2" href="#__codelineno-124-2"></a><span class="k">export</span><span class="w"> </span><span class="k">module</span><span class="w"> </span><span class="n">math</span><span class="p">;</span>
<a id="__codelineno-124-3" name="__codelineno-124-3" href="#__codelineno-124-3"></a>
<a id="__codelineno-124-4" name="__codelineno-124-4" href="#__codelineno-124-4"></a><span class="k">export</span><span class="w"> </span><span class="kt">int</span><span class="w"> </span><span class="nf">add</span><span class="p">(</span><span class="kt">int</span><span class="w"> </span><span class="n">a</span><span class="p">,</span><span class="w"> </span><span class="kt">int</span><span class="w"> </span><span class="n">b</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-124-5" name="__codelineno-124-5" href="#__codelineno-124-5"></a><span class="w">    </span><span class="k">return</span><span class="w"> </span><span class="n">a</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="n">b</span><span class="p">;</span>
<a id="__codelineno-124-6" name="__codelineno-124-6" href="#__codelineno-124-6"></a><span class="p">}</span>
<a id="__codelineno-124-7" name="__codelineno-124-7" href="#__codelineno-124-7"></a>
<a id="__codelineno-124-8" name="__codelineno-124-8" href="#__codelineno-124-8"></a><span class="c1">// main.cpp</span>
<a id="__codelineno-124-9" name="__codelineno-124-9" href="#__codelineno-124-9"></a><span class="k">import</span><span class="w"> </span><span class="n">math</span><span class="p">;</span>
<a id="__codelineno-124-10" name="__codelineno-124-10" href="#__codelineno-124-10"></a><span class="cp">#include</span><span class="w"> </span><span class="cpf">&lt;iostream&gt;</span>
<a id="__codelineno-124-11" name="__codelineno-124-11" href="#__codelineno-124-11"></a>
<a id="__codelineno-124-12" name="__codelineno-124-12" href="#__codelineno-124-12"></a><span class="kt">int</span><span class="w"> </span><span class="nf">main</span><span class="p">()</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-124-13" name="__codelineno-124-13" href="#__codelineno-124-13"></a><span class="w">    </span><span class="n">std</span><span class="o">::</span><span class="n">cout</span><span class="w"> </span><span class="o">&lt;&lt;</span><span class="w"> </span><span class="n">add</span><span class="p">(</span><span class="mi">5</span><span class="p">,</span><span class="w"> </span><span class="mi">3</span><span class="p">)</span><span class="w"> </span><span class="o">&lt;&lt;</span><span class="w"> </span><span class="n">std</span><span class="o">::</span><span class="n">endl</span><span class="p">;</span>
<a id="__codelineno-124-14" name="__codelineno-124-14" href="#__codelineno-124-14"></a><span class="p">}</span>
</code></pre></div></p>
<h3 id="spaceship-operator">Spaceship Operator (&lt;=&gt;)</h3>
<p>The spaceship operator simplifies the implementation of comparison operators, which can be useful for game objects that need to be sorted or compared.</p>
<p>Example:
<div class="highlight"><pre><span></span><code><a id="__codelineno-125-1" name="__codelineno-125-1" href="#__codelineno-125-1"></a><span class="cp">#include</span><span class="w"> </span><span class="cpf">&lt;compare&gt;</span>
<a id="__codelineno-125-2" name="__codelineno-125-2" href="#__codelineno-125-2"></a>
<a id="__codelineno-125-3" name="__codelineno-125-3" href="#__codelineno-125-3"></a><span class="k">class</span><span class="w"> </span><span class="nc">Player</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-125-4" name="__codelineno-125-4" href="#__codelineno-125-4"></a><span class="w">    </span><span class="kt">int</span><span class="w"> </span><span class="n">score</span><span class="p">;</span>
<a id="__codelineno-125-5" name="__codelineno-125-5" href="#__codelineno-125-5"></a><span class="k">public</span><span class="o">:</span>
<a id="__codelineno-125-6" name="__codelineno-125-6" href="#__codelineno-125-6"></a><span class="w">    </span><span class="n">Player</span><span class="p">(</span><span class="kt">int</span><span class="w"> </span><span class="n">s</span><span class="p">)</span><span class="w"> </span><span class="o">:</span><span class="w"> </span><span class="n">score</span><span class="p">(</span><span class="n">s</span><span class="p">)</span><span class="w"> </span><span class="p">{}</span>
<a id="__codelineno-125-7" name="__codelineno-125-7" href="#__codelineno-125-7"></a>
<a id="__codelineno-125-8" name="__codelineno-125-8" href="#__codelineno-125-8"></a><span class="w">    </span><span class="k">auto</span><span class="w"> </span><span class="k">operator</span><span class="o">&lt;=&gt;</span><span class="p">(</span><span class="k">const</span><span class="w"> </span><span class="n">Player</span><span class="o">&amp;</span><span class="w"> </span><span class="n">other</span><span class="p">)</span><span class="w"> </span><span class="k">const</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">default</span><span class="p">;</span>
<a id="__codelineno-125-9" name="__codelineno-125-9" href="#__codelineno-125-9"></a><span class="w">    </span><span class="c1">// This automatically generates &lt;, &lt;=, &gt;, &gt;=, ==, and !=</span>
<a id="__codelineno-125-10" name="__codelineno-125-10" href="#__codelineno-125-10"></a><span class="p">};</span>
<a id="__codelineno-125-11" name="__codelineno-125-11" href="#__codelineno-125-11"></a>
<a id="__codelineno-125-12" name="__codelineno-125-12" href="#__codelineno-125-12"></a><span class="kt">int</span><span class="w"> </span><span class="nf">main</span><span class="p">()</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-125-13" name="__codelineno-125-13" href="#__codelineno-125-13"></a><span class="w">    </span><span class="n">Player</span><span class="w"> </span><span class="n">p1</span><span class="p">(</span><span class="mi">100</span><span class="p">),</span><span class="w"> </span><span class="n">p2</span><span class="p">(</span><span class="mi">200</span><span class="p">);</span>
<a id="__codelineno-125-14" name="__codelineno-125-14" href="#__codelineno-125-14"></a><span class="w">    </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">p1</span><span class="w"> </span><span class="o">&lt;</span><span class="w"> </span><span class="n">p2</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-125-15" name="__codelineno-125-15" href="#__codelineno-125-15"></a><span class="w">        </span><span class="c1">// p1 has a lower score</span>
<a id="__codelineno-125-16" name="__codelineno-125-16" href="#__codelineno-125-16"></a><span class="w">    </span><span class="p">}</span>
<a id="__codelineno-125-17" name="__codelineno-125-17" href="#__codelineno-125-17"></a><span class="p">}</span>
</code></pre></div></p>
<h3 id="best-practices-and-considerations">Best Practices and Considerations</h3>
<ol>
<li>Use concepts to make template code more readable and to provide better error messages.</li>
<li>Consider using coroutines for asynchronous game logic, such as AI behavior trees or complex animations.</li>
<li>Leverage ranges for more expressive and efficient data processing in game systems.</li>
<li>Start experimenting with modules in non-critical parts of your codebase to prepare for future adoption.</li>
<li>Use the spaceship operator to simplify comparison logic for game objects.</li>
</ol>
<p>Remember that while these features can provide significant benefits, they may not be supported by all compilers or platforms yet. Always check compatibility with your target environments before fully adopting C++20 features in production game code.</p>
<h2 id="performance-optimization">Performance Optimization</h2>
<ul>
<li>Profiling techniques</li>
<li>Cache-friendly data structures</li>
<li>Compiler optimizations</li>
<li>Inline assembly for critical sections</li>
<li>Branch prediction and data-oriented design</li>
</ul>
<h3 id="advanced-language-features">Advanced Language Features</h3>
<p>C++ provides several advanced language features that enhance the power and flexibility of the language, enabling developers to write more efficient and expressive code. Below are some of these features:</p>
<h4 id="argument-dependent-lookup-adl">Argument-dependent lookup (ADL)</h4>
<p>Argument-dependent lookup, also known as Koenig lookup, is a feature that allows the C++ compiler to consider the namespaces of the arguments of a function call when resolving which function to call. This is particularly useful for operator overloading and making the code more intuitive.</p>
<ul>
<li><strong>Example:</strong> Demonstrating ADL with operator overloading.</li>
</ul>
<div class="highlight"><pre><span></span><code><a id="__codelineno-126-1" name="__codelineno-126-1" href="#__codelineno-126-1"></a><span class="cp">#include</span><span class="w"> </span><span class="cpf">&lt;iostream&gt;</span>
<a id="__codelineno-126-2" name="__codelineno-126-2" href="#__codelineno-126-2"></a>
<a id="__codelineno-126-3" name="__codelineno-126-3" href="#__codelineno-126-3"></a><span class="k">namespace</span><span class="w"> </span><span class="nn">MyNamespace</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-126-4" name="__codelineno-126-4" href="#__codelineno-126-4"></a><span class="w">    </span><span class="k">class</span><span class="w"> </span><span class="nc">MyClass</span><span class="w"> </span><span class="p">{};</span>
<a id="__codelineno-126-5" name="__codelineno-126-5" href="#__codelineno-126-5"></a>
<a id="__codelineno-126-6" name="__codelineno-126-6" href="#__codelineno-126-6"></a><span class="w">    </span><span class="kt">void</span><span class="w"> </span><span class="nf">print</span><span class="p">(</span><span class="k">const</span><span class="w"> </span><span class="n">MyClass</span><span class="o">&amp;</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-126-7" name="__codelineno-126-7" href="#__codelineno-126-7"></a><span class="w">        </span><span class="n">std</span><span class="o">::</span><span class="n">cout</span><span class="w"> </span><span class="o">&lt;&lt;</span><span class="w"> </span><span class="s">&quot;MyClass from MyNamespace&quot;</span><span class="w"> </span><span class="o">&lt;&lt;</span><span class="w"> </span><span class="n">std</span><span class="o">::</span><span class="n">endl</span><span class="p">;</span>
<a id="__codelineno-126-8" name="__codelineno-126-8" href="#__codelineno-126-8"></a><span class="w">    </span><span class="p">}</span>
<a id="__codelineno-126-9" name="__codelineno-126-9" href="#__codelineno-126-9"></a><span class="p">}</span>
<a id="__codelineno-126-10" name="__codelineno-126-10" href="#__codelineno-126-10"></a>
<a id="__codelineno-126-11" name="__codelineno-126-11" href="#__codelineno-126-11"></a><span class="kt">int</span><span class="w"> </span><span class="n">main</span><span class="p">()</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-126-12" name="__codelineno-126-12" href="#__codelineno-126-12"></a><span class="w">    </span><span class="n">MyNamespace</span><span class="o">::</span><span class="n">MyClass</span><span class="w"> </span><span class="n">obj</span><span class="p">;</span>
<a id="__codelineno-126-13" name="__codelineno-126-13" href="#__codelineno-126-13"></a><span class="w">    </span><span class="n">print</span><span class="p">(</span><span class="n">obj</span><span class="p">);</span><span class="w"> </span><span class="c1">// ADL finds MyNamespace::print</span>
<a id="__codelineno-126-14" name="__codelineno-126-14" href="#__codelineno-126-14"></a><span class="p">}</span>
</code></pre></div>
<p>In this example, <code>print(obj)</code> finds the appropriate function in <code>MyNamespace</code> due to ADL.</p>
<h4 id="fold-expressions">Fold expressions</h4>
<p>Fold expressions simplify the implementation of variadic templates by allowing you to perform operations on parameter packs in a concise manner. This feature was introduced in C++17.</p>
<ul>
<li><strong>Example:</strong> Summing a variadic number of arguments using a fold expression.</li>
</ul>
<div class="highlight"><pre><span></span><code><a id="__codelineno-127-1" name="__codelineno-127-1" href="#__codelineno-127-1"></a><span class="cp">#include</span><span class="w"> </span><span class="cpf">&lt;iostream&gt;</span>
<a id="__codelineno-127-2" name="__codelineno-127-2" href="#__codelineno-127-2"></a>
<a id="__codelineno-127-3" name="__codelineno-127-3" href="#__codelineno-127-3"></a><span class="k">template</span><span class="o">&lt;</span><span class="k">typename</span><span class="p">...</span><span class="w"> </span><span class="n">Args</span><span class="o">&gt;</span>
<a id="__codelineno-127-4" name="__codelineno-127-4" href="#__codelineno-127-4"></a><span class="k">auto</span><span class="w"> </span><span class="n">sum</span><span class="p">(</span><span class="n">Args</span><span class="p">...</span><span class="w"> </span><span class="n">args</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-127-5" name="__codelineno-127-5" href="#__codelineno-127-5"></a><span class="w">    </span><span class="k">return</span><span class="w"> </span><span class="p">(</span><span class="n">args</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="p">...);</span><span class="w"> </span><span class="c1">// Fold expression</span>
<a id="__codelineno-127-6" name="__codelineno-127-6" href="#__codelineno-127-6"></a><span class="p">}</span>
<a id="__codelineno-127-7" name="__codelineno-127-7" href="#__codelineno-127-7"></a>
<a id="__codelineno-127-8" name="__codelineno-127-8" href="#__codelineno-127-8"></a><span class="kt">int</span><span class="w"> </span><span class="n">main</span><span class="p">()</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-127-9" name="__codelineno-127-9" href="#__codelineno-127-9"></a><span class="w">    </span><span class="n">std</span><span class="o">::</span><span class="n">cout</span><span class="w"> </span><span class="o">&lt;&lt;</span><span class="w"> </span><span class="n">sum</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span><span class="w"> </span><span class="mi">2</span><span class="p">,</span><span class="w"> </span><span class="mi">3</span><span class="p">,</span><span class="w"> </span><span class="mi">4</span><span class="p">)</span><span class="w"> </span><span class="o">&lt;&lt;</span><span class="w"> </span><span class="n">std</span><span class="o">::</span><span class="n">endl</span><span class="p">;</span><span class="w"> </span><span class="c1">// Outputs 10</span>
<a id="__codelineno-127-10" name="__codelineno-127-10" href="#__codelineno-127-10"></a><span class="p">}</span>
</code></pre></div>
<p>In this example, the fold expression <code>(args + ...)</code> sums all the arguments in the parameter pack.</p>
<h4 id="variadic-templates">Variadic templates</h4>
<p>Variadic templates allow templates to accept an arbitrary number of arguments. This feature provides great flexibility and is widely used in template metaprogramming and library development.</p>
<ul>
<li><strong>Example:</strong> A simple variadic template function to print multiple arguments.</li>
</ul>
<div class="highlight"><pre><span></span><code><a id="__codelineno-128-1" name="__codelineno-128-1" href="#__codelineno-128-1"></a><span class="cp">#include</span><span class="w"> </span><span class="cpf">&lt;iostream&gt;</span>
<a id="__codelineno-128-2" name="__codelineno-128-2" href="#__codelineno-128-2"></a>
<a id="__codelineno-128-3" name="__codelineno-128-3" href="#__codelineno-128-3"></a><span class="kt">void</span><span class="w"> </span><span class="nf">print</span><span class="p">()</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-128-4" name="__codelineno-128-4" href="#__codelineno-128-4"></a><span class="w">    </span><span class="n">std</span><span class="o">::</span><span class="n">cout</span><span class="w"> </span><span class="o">&lt;&lt;</span><span class="w"> </span><span class="n">std</span><span class="o">::</span><span class="n">endl</span><span class="p">;</span>
<a id="__codelineno-128-5" name="__codelineno-128-5" href="#__codelineno-128-5"></a><span class="p">}</span>
<a id="__codelineno-128-6" name="__codelineno-128-6" href="#__codelineno-128-6"></a>
<a id="__codelineno-128-7" name="__codelineno-128-7" href="#__codelineno-128-7"></a><span class="k">template</span><span class="o">&lt;</span><span class="k">typename</span><span class="w"> </span><span class="nc">T</span><span class="p">,</span><span class="w"> </span><span class="k">typename</span><span class="p">...</span><span class="w"> </span><span class="n">Args</span><span class="o">&gt;</span>
<a id="__codelineno-128-8" name="__codelineno-128-8" href="#__codelineno-128-8"></a><span class="kt">void</span><span class="w"> </span><span class="n">print</span><span class="p">(</span><span class="n">T</span><span class="w"> </span><span class="n">first</span><span class="p">,</span><span class="w"> </span><span class="n">Args</span><span class="p">...</span><span class="w"> </span><span class="n">args</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-128-9" name="__codelineno-128-9" href="#__codelineno-128-9"></a><span class="w">    </span><span class="n">std</span><span class="o">::</span><span class="n">cout</span><span class="w"> </span><span class="o">&lt;&lt;</span><span class="w"> </span><span class="n">first</span><span class="w"> </span><span class="o">&lt;&lt;</span><span class="w"> </span><span class="s">&quot; &quot;</span><span class="p">;</span>
<a id="__codelineno-128-10" name="__codelineno-128-10" href="#__codelineno-128-10"></a><span class="w">    </span><span class="n">print</span><span class="p">(</span><span class="n">args</span><span class="p">...);</span><span class="w"> </span><span class="c1">// Recursive call with the remaining arguments</span>
<a id="__codelineno-128-11" name="__codelineno-128-11" href="#__codelineno-128-11"></a><span class="p">}</span>
<a id="__codelineno-128-12" name="__codelineno-128-12" href="#__codelineno-128-12"></a>
<a id="__codelineno-128-13" name="__codelineno-128-13" href="#__codelineno-128-13"></a><span class="kt">int</span><span class="w"> </span><span class="n">main</span><span class="p">()</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-128-14" name="__codelineno-128-14" href="#__codelineno-128-14"></a><span class="w">    </span><span class="n">print</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span><span class="w"> </span><span class="mf">2.5</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;Hello&quot;</span><span class="p">,</span><span class="w"> </span><span class="sc">&#39;c&#39;</span><span class="p">);</span><span class="w"> </span><span class="c1">// Outputs: 1 2.5 Hello c</span>
<a id="__codelineno-128-15" name="__codelineno-128-15" href="#__codelineno-128-15"></a><span class="p">}</span>
</code></pre></div>
<p>In this example, the <code>print</code> function uses variadic templates to handle multiple arguments of different types.</p>
<h4 id="constexpr-and-compile-time-computation">Constexpr and compile-time computation</h4>
<p><code>constexpr</code> is a keyword introduced in C++11 that allows for the evaluation of functions and variables at compile time. This can lead to more optimized code and better performance.</p>
<ul>
<li><strong>Example:</strong> Defining a <code>constexpr</code> function for compile-time computation.</li>
</ul>
<div class="highlight"><pre><span></span><code><a id="__codelineno-129-1" name="__codelineno-129-1" href="#__codelineno-129-1"></a><span class="cp">#include</span><span class="w"> </span><span class="cpf">&lt;iostream&gt;</span>
<a id="__codelineno-129-2" name="__codelineno-129-2" href="#__codelineno-129-2"></a>
<a id="__codelineno-129-3" name="__codelineno-129-3" href="#__codelineno-129-3"></a><span class="k">constexpr</span><span class="w"> </span><span class="kt">int</span><span class="w"> </span><span class="nf">factorial</span><span class="p">(</span><span class="kt">int</span><span class="w"> </span><span class="n">n</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-129-4" name="__codelineno-129-4" href="#__codelineno-129-4"></a><span class="w">    </span><span class="k">return</span><span class="w"> </span><span class="p">(</span><span class="n">n</span><span class="w"> </span><span class="o">&lt;=</span><span class="w"> </span><span class="mi">1</span><span class="p">)</span><span class="w"> </span><span class="o">?</span><span class="w"> </span><span class="mi">1</span><span class="w"> </span><span class="o">:</span><span class="w"> </span><span class="p">(</span><span class="n">n</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="n">factorial</span><span class="p">(</span><span class="n">n</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="mi">1</span><span class="p">));</span>
<a id="__codelineno-129-5" name="__codelineno-129-5" href="#__codelineno-129-5"></a><span class="p">}</span>
<a id="__codelineno-129-6" name="__codelineno-129-6" href="#__codelineno-129-6"></a>
<a id="__codelineno-129-7" name="__codelineno-129-7" href="#__codelineno-129-7"></a><span class="kt">int</span><span class="w"> </span><span class="nf">main</span><span class="p">()</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-129-8" name="__codelineno-129-8" href="#__codelineno-129-8"></a><span class="w">    </span><span class="k">constexpr</span><span class="w"> </span><span class="kt">int</span><span class="w"> </span><span class="n">result</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">factorial</span><span class="p">(</span><span class="mi">5</span><span class="p">);</span><span class="w"> </span><span class="c1">// Computed at compile time</span>
<a id="__codelineno-129-9" name="__codelineno-129-9" href="#__codelineno-129-9"></a><span class="w">    </span><span class="n">std</span><span class="o">::</span><span class="n">cout</span><span class="w"> </span><span class="o">&lt;&lt;</span><span class="w"> </span><span class="n">result</span><span class="w"> </span><span class="o">&lt;&lt;</span><span class="w"> </span><span class="n">std</span><span class="o">::</span><span class="n">endl</span><span class="p">;</span><span class="w"> </span><span class="c1">// Outputs 120</span>
<a id="__codelineno-129-10" name="__codelineno-129-10" href="#__codelineno-129-10"></a><span class="p">}</span>
</code></pre></div>
<p>In this example, the <code>factorial</code> function is evaluated at compile time, resulting in the value <code>120</code> being directly embedded in the binary.</p>
<h4 id="custom-literals">Custom literals</h4>
<p>Custom literals allow you to define new literal types that can make your code more readable and expressive. This feature was introduced in C++11 and can be used for various types, such as user-defined units or custom string types.</p>
<ul>
<li><strong>Example:</strong> Defining a custom literal for meters.</li>
</ul>
<div class="highlight"><pre><span></span><code><a id="__codelineno-130-1" name="__codelineno-130-1" href="#__codelineno-130-1"></a><span class="cp">#include</span><span class="w"> </span><span class="cpf">&lt;iostream&gt;</span>
<a id="__codelineno-130-2" name="__codelineno-130-2" href="#__codelineno-130-2"></a>
<a id="__codelineno-130-3" name="__codelineno-130-3" href="#__codelineno-130-3"></a><span class="k">class</span><span class="w"> </span><span class="nc">Distance</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-130-4" name="__codelineno-130-4" href="#__codelineno-130-4"></a><span class="k">public</span><span class="o">:</span>
<a id="__codelineno-130-5" name="__codelineno-130-5" href="#__codelineno-130-5"></a><span class="w">    </span><span class="k">explicit</span><span class="w"> </span><span class="n">Distance</span><span class="p">(</span><span class="kt">long</span><span class="w"> </span><span class="kt">double</span><span class="w"> </span><span class="n">meters</span><span class="p">)</span><span class="w"> </span><span class="o">:</span><span class="w"> </span><span class="n">meters</span><span class="p">(</span><span class="n">meters</span><span class="p">)</span><span class="w"> </span><span class="p">{}</span>
<a id="__codelineno-130-6" name="__codelineno-130-6" href="#__codelineno-130-6"></a>
<a id="__codelineno-130-7" name="__codelineno-130-7" href="#__codelineno-130-7"></a><span class="w">    </span><span class="kt">long</span><span class="w"> </span><span class="kt">double</span><span class="w"> </span><span class="n">toMeters</span><span class="p">()</span><span class="w"> </span><span class="k">const</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="k">return</span><span class="w"> </span><span class="n">meters</span><span class="p">;</span><span class="w"> </span><span class="p">}</span>
<a id="__codelineno-130-8" name="__codelineno-130-8" href="#__codelineno-130-8"></a>
<a id="__codelineno-130-9" name="__codelineno-130-9" href="#__codelineno-130-9"></a><span class="k">private</span><span class="o">:</span>
<a id="__codelineno-130-10" name="__codelineno-130-10" href="#__codelineno-130-10"></a><span class="w">    </span><span class="kt">long</span><span class="w"> </span><span class="kt">double</span><span class="w"> </span><span class="n">meters</span><span class="p">;</span>
<a id="__codelineno-130-11" name="__codelineno-130-11" href="#__codelineno-130-11"></a><span class="p">};</span>
<a id="__codelineno-130-12" name="__codelineno-130-12" href="#__codelineno-130-12"></a>
<a id="__codelineno-130-13" name="__codelineno-130-13" href="#__codelineno-130-13"></a><span class="n">Distance</span><span class="w"> </span><span class="k">operator</span><span class="s">&quot;&quot;</span><span class="w"> </span><span class="n">_m</span><span class="p">(</span><span class="kt">long</span><span class="w"> </span><span class="kt">double</span><span class="w"> </span><span class="n">meters</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-130-14" name="__codelineno-130-14" href="#__codelineno-130-14"></a><span class="w">    </span><span class="k">return</span><span class="w"> </span><span class="n">Distance</span><span class="p">(</span><span class="n">meters</span><span class="p">);</span>
<a id="__codelineno-130-15" name="__codelineno-130-15" href="#__codelineno-130-15"></a><span class="p">}</span>
<a id="__codelineno-130-16" name="__codelineno-130-16" href="#__codelineno-130-16"></a>
<a id="__codelineno-130-17" name="__codelineno-130-17" href="#__codelineno-130-17"></a><span class="kt">int</span><span class="w"> </span><span class="n">main</span><span class="p">()</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-130-18" name="__codelineno-130-18" href="#__codelineno-130-18"></a><span class="w">    </span><span class="n">Distance</span><span class="w"> </span><span class="n">d</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mf">100.0</span><span class="n">_m</span><span class="p">;</span>
<a id="__codelineno-130-19" name="__codelineno-130-19" href="#__codelineno-130-19"></a><span class="w">    </span><span class="n">std</span><span class="o">::</span><span class="n">cout</span><span class="w"> </span><span class="o">&lt;&lt;</span><span class="w"> </span><span class="n">d</span><span class="p">.</span><span class="n">toMeters</span><span class="p">()</span><span class="w"> </span><span class="o">&lt;&lt;</span><span class="w"> </span><span class="s">&quot; meters&quot;</span><span class="w"> </span><span class="o">&lt;&lt;</span><span class="w"> </span><span class="n">std</span><span class="o">::</span><span class="n">endl</span><span class="p">;</span><span class="w"> </span><span class="c1">// Outputs: 100 meters</span>
<a id="__codelineno-130-20" name="__codelineno-130-20" href="#__codelineno-130-20"></a><span class="p">}</span>
</code></pre></div>
<p>In this example, the custom literal <code>_m</code> allows you to create <code>Distance</code> objects directly from floating-point literals.</p>
<p>By leveraging these advanced language features, C++ developers can write more powerful, expressive, and efficient code, making full use of the language's capabilities.</p>












                
              </article>
            </div>
          
          
  <script>var tabs=__md_get("__tabs");if(Array.isArray(tabs))e:for(var set of document.querySelectorAll(".tabbed-set")){var tab,labels=set.querySelector(".tabbed-labels");for(tab of tabs)for(var label of labels.getElementsByTagName("label"))if(label.innerText.trim()===tab){var input=document.getElementById(label.htmlFor);input.checked=!0;continue e}}</script>

<script>var target=document.getElementById(location.hash.slice(1));target&&target.name&&(target.checked=target.name.startsWith("__tabbed_"))</script>
        </div>
        
          <button type="button" class="md-top md-icon" data-md-component="top" hidden>
  
  <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M13 20h-2V8l-5.5 5.5-1.42-1.42L12 4.16l7.92 7.92-1.42 1.42L13 8v12Z"/></svg>
  Back to top
</button>
        
      </main>
      
        <footer class="md-footer">
  
  <div class="md-footer-meta md-typeset">
    <div class="md-footer-meta__inner md-grid">
      <div class="md-copyright">
  
  
    Made with
    <a href="https://squidfunk.github.io/mkdocs-material/" target="_blank" rel="noopener">
      Material for MkDocs
    </a>
  
</div>
      
    </div>
  </div>
</footer>
      
    </div>
    <div class="md-dialog" data-md-component="dialog">
      <div class="md-dialog__inner md-typeset"></div>
    </div>
    
    
    <script id="__config" type="application/json">{"base": "..", "features": ["navigation.tabs", "navigation.sections", "toc.integrate", "navigation.top", "search.suggest", "search.highlight", "content.tabs.link", "content.code.annotation", "content.code.copy"], "search": "../assets/javascripts/workers/search.b8dbb3d2.min.js", "translations": {"clipboard.copied": "Copied to clipboard", "clipboard.copy": "Copy to clipboard", "search.result.more.one": "1 more on this page", "search.result.more.other": "# more on this page", "search.result.none": "No matching documents", "search.result.one": "1 matching document", "search.result.other": "# matching documents", "search.result.placeholder": "Type to start searching", "search.result.term.missing": "Missing", "select.version": "Select version"}}</script>
    
    
      <script src="../assets/javascripts/bundle.fe8b6f2b.min.js"></script>
      
        <script src="https://polyfill.io/v3/polyfill.min.js?features=es6"></script>
      
        <script src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-mml-chtml.js"></script>
      
    
  </body>
</html>